<div class="p-6 bg-white rounded-xl shadow-sm border border-gray-100">
  <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-5">
    <h2 class="text-2xl font-semibold text-gray-800">Lotes</h2>

    <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-end">
      <!-- Filter -->
      <app-property-group-dropdown
        [selectedGroupId]="selectedGroupId"
        (groupSelect)="onGroupSelect($event)">
      </app-property-group-dropdown>

      <!-- Search + Button -->
      <div class="flex items-center gap-3">
        <app-search
          class="w-64"
          [param_activate]="true"
          param_name="search"
          (searchChange)="onSearchChange($event)">
        </app-search>

        <app-button
          text="Crear Lote"
          custom_class="btn_primary"
          (clicked)="createProperty()">
        </app-button>
      </div>
    </div>
  </div>

  <app-datatable-wrapper
    [config]="table_config()"
    [rowTemplate]="tableTemplate"
    (pageChange)="onPageChange($event)"
    (sortChange)="onSortChange($event)"
    (rowClick)="onRowClick($event)">
  </app-datatable-wrapper>
</div>

<ng-template #tableTemplate let-item="$implicit">
  <td>
    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 whitespace-nowrap">
      {{ item.code }}
    </span>
  </td>
  <td>{{ item.block || '—' }}</td>
  <td>{{ item.name }}</td>
  <td>{{ item.group?.name || '—' }}</td>
  <td (click)="$event.stopPropagation()">
    <div *ngIf="hasOwner(item); else noOwner">
      <span 
        (click)="navigateToCustomer(item)"
        class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 whitespace-nowrap cursor-pointer hover:bg-blue-200 transition-colors">
        {{ getOwnerName(item) }}
      </span>
    </div>
    <ng-template #noOwner>
      <span class="text-sm text-gray-400">—</span>
    </ng-template>
  </td>
  <td>{{ item.total_area }} {{ item.measurement_unit?.symbol || 'm²' }}</td>
  <td>{{ item.total_price | currency:item.currency }}</td>
  <td>
    <span [class]="getStatusClass(item.status)">
      {{ getStatusLabel(item.status) }}
    </span>
  </td>
  <td (click)="$event.stopPropagation()">
    <app-button
      text="Detalle"
      size="sm"
      [fullWidth]="false"
      custom_class="btn_primary"
      (clicked)="viewDetail(item)"
      [icon]="ArrowRight">
    </app-button>
  </td>
</ng-template>
