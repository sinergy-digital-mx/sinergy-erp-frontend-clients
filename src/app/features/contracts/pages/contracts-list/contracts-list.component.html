<div class="p-6 bg-white rounded-xl shadow-sm border border-gray-100">
  <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-5">
    <h2 class="text-2xl font-semibold text-gray-800">Contratos</h2>

    <div class="flex items-center gap-3">
      <app-search
        class="w-64"
        [param_activate]="true"
        param_name="search"
        (searchChange)="onSearchChange($event)">
      </app-search>

      <app-button
        text="Crear Contrato"
        custom_class="btn_primary"
        (clicked)="createContract()">
      </app-button>
    </div>
  </div>

  <app-datatable-wrapper
    [config]="table_config()"
    [rowTemplate]="tableTemplate"
    (pageChange)="onPageChange($event)"
    (sortChange)="onSortChange($event)"
    (rowClick)="onRowClick($event)">
  </app-datatable-wrapper>
</div>

<ng-template #tableTemplate let-item="$implicit">
  <td>
    <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-800 whitespace-nowrap">
      {{ item.contract_number }}
    </span>
  </td>
  <td>
    <span 
      *ngIf="item.customer"
      (click)="navigateToCustomer(item.customer.id); $event.stopPropagation()"
      class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 cursor-pointer hover:bg-blue-200 transition-colors max-w-[200px] truncate"
      [title]="getCustomerName(item)">
      {{ getCustomerName(item) }}
    </span>
    <span *ngIf="!item.customer" class="text-sm text-gray-400">—</span>
  </td>
  <td>
    <span 
      *ngIf="item.property"
      (click)="navigateToProperty(item.property.id); $event.stopPropagation()"
      class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 whitespace-nowrap cursor-pointer hover:bg-green-200 transition-colors">
      {{ item.property.code }}
    </span>
    <span *ngIf="!item.property" class="text-sm text-gray-400">—</span>
  </td>
  <td>{{ item.contract_date | date:'mediumDate' }}</td>
  <td>{{ item.total_price | currency:item.currency }}</td>
  <td>{{ item.remaining_balance | currency:item.currency }}</td>
  <td>{{ item.first_payment_date | date:'mediumDate' }}</td>
  <td>
    <span [class]="getStatusClass(item.status)">
      {{ getStatusLabel(item.status) }}
    </span>
  </td>
  <td (click)="$event.stopPropagation()">
    <app-button
      text="Detalle"
      size="sm"
      [fullWidth]="false"
      custom_class="btn_primary"
      (clicked)="viewDetail(item)"
      [icon]="ArrowRight">
    </app-button>
  </td>
</ng-template>
