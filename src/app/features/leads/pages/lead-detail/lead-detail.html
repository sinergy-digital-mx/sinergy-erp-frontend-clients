<div class="space-y-10 min-h-screen">

    <!-- HEADER -->
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-3xl font-bold text-gray-900">
          {{ lead()?.name }} {{ lead()?.lastname }}
        </h2>
        <p class="text-sm text-gray-500">
          {{ lead()?.email }}
        </p>
      </div>
  
      <button
        (click)="openEdit()"
        pButton
        label="Editar lead"
        icon="pi pi-pencil"
        class="p-button-rounded p-button-solid text-sm"
        size="small">
      </button>
    </div>
  
<!-- LEAD INFORMATION -->
<div class="bg-white shadow-md rounded-xl p-6 border border-gray-100">
  <h3 class="text-lg font-semibold text-gray-800 mb-4">
    Información del Lead
  </h3>

  <div class="grid grid-cols-2 gap-y-3 gap-x-10 text-sm text-gray-800">

    <div>
      <span class="font-semibold text-gray-500">Nombre:</span>
      {{ lead()?.name }}
    </div>

    <div>
      <span class="font-semibold text-gray-500">Apellido:</span>
      {{ lead()?.lastname }}
    </div>

    <div>
      <span class="font-semibold text-gray-500">Email:</span>
      <a
      *ngIf="lead()?.email; else noEmail"
      [href]="'mailto:' + lead()?.email"
      class="link-pro link-pro-break"
    >
      {{ lead()?.email }}
      <i class="pi pi-envelope link-pro-icon"></i>
    </a>
      <ng-template #noEmail>—</ng-template>
    </div>

    <div>
      <span class="font-semibold text-gray-500">Teléfono:</span>
      <app-phone 
        [phone]="lead()?.phone"
        [countryCode]="lead()?.phone_country"
        [countryPhoneCode]="lead()?.phone_code">
      </app-phone>
    </div>

    <div>
      <span class="font-semibold text-gray-500">Fuente:</span>
      {{ lead()?.source }}
    </div>

    <!-- Website ocupa 2 columnas -->
    <div class="col-span-2">
      <span class="font-semibold text-gray-500">Sitio web:</span>

      <a
      *ngIf="lead()?.website; else noWebsite"
      [href]="lead()?.website?.startsWith('http') ? lead()?.website : ('https://' + lead()?.website)"
      target="_blank"
      rel="noopener noreferrer"
      class="link-pro link-pro-break"
    >
      {{ lead()?.website }}
      <i class="pi pi-external-link link-pro-icon"></i>
    </a>
      <ng-template #noWebsite>—</ng-template>
    </div>

    <div class="flex items-center gap-2">
      <span class="font-semibold text-gray-500">Estado:</span>
      <p-tag
        [value]="lead()?.status?.name"
        rounded="true">
      </p-tag>
    </div>

    <div class="col-span-2">
      <span class="font-semibold text-gray-500">Creado el:</span>
      <div class="mt-0.5">
        {{ lead()?.created_at | date:'medium' }}
      </div>
    </div>

  </div>
</div>

<!-- EMAIL THREADS -->
<app-email-threads-section
  [leadId]="lead_id()"
  [leadEmail]="lead()?.email"
></app-email-threads-section>

<!-- ADDRESSES -->
<div class="bg-white shadow-md rounded-xl p-6 border border-gray-100">

    <!-- Header with action -->
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-gray-800">
        Direcciones
      </h3>
  
      <button
        pButton
        icon="pi pi-plus"
        label="Agregar dirección"
        class="p-button-sm p-button-outlined"
    >
      </button>
    </div>
  
    <p-table
      [value]="lead()?.addresses"
      responsiveLayout="scroll"
      styleClass="p-datatable-sm w-full">
  
      <!-- HEADER -->
      <ng-template pTemplate="header">
        <tr>
          <th>Tipo</th>
          <th>Dirección</th>
          <th>Ciudad</th>
          <th>Estado</th>
          <th>Código postal</th>
          <th>País</th>
          <th>Principal</th>
        </tr>
      </ng-template>
  
      <!-- BODY -->
      <ng-template pTemplate="body" let-address>
        <tr>
          <td class="capitalize">
            {{ address.type }}
          </td>
  
          <td>
            <a
            [href]="mapsUrl(address)"
            target="_blank"
            rel="noopener noreferrer"
            class="link-pro link-pro-muted"
          >
            {{ address.street_address }}
            <i class="pi pi-map-marker link-pro-icon"></i>
          </a>
          </td>
          
  
          <td>
            {{ address.city }}
          </td>
  
          <td>
            {{ address.state }}
          </td>
  
          <td>
            {{ address.postal_code }}
          </td>
  
          <td>
            {{ address.country }}
          </td>
  
          <td class="text-center">
            <p-tag
              *ngIf="address.is_primary"
              value="Principal"
              severity="success"
              rounded="true">
            </p-tag>
          </td>
        </tr>
      </ng-template>
  
    </p-table>
</div>


<!-- ACTIVITIES -->
<div class="bg-white shadow-md rounded-xl p-6 border border-gray-100">

    <!-- Header with action -->
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-gray-800">
        Actividades
      </h3>
  
      <button
        pButton
        icon="pi pi-plus"
        label="Agregar actividad"
        class="p-button-sm p-button-outlined"
        (click)="createActivity()"
        >
      </button>
    </div>
  
    <p-table
      [value]="lead()?.activities"
      responsiveLayout="scroll"
      styleClass="p-datatable-sm w-full"
      >
  
      <!-- HEADER -->
      <ng-template pTemplate="header">
        <tr>
          <th>Tipo</th>
          <th>Título</th>
          <th>Estado</th>
          <th>Fecha de actividad</th>
          <th>Duración</th>
          <th>Resultado</th>
        </tr>
      </ng-template>
  
      <!-- BODY -->
      <ng-template pTemplate="body" let-activity>
        <tr>
  
          <!-- Type -->
          <td class="capitalize">
            <p-tag
              [value]="activity.type"
              severity="info"
              rounded="true">
            </p-tag>
          </td>
  
          <!-- Title + description -->
          <td>
            <div class="font-medium text-gray-800">
              {{ activity.title }}
            </div>
            <div class="text-xs text-gray-500">
              {{ activity.description }}
            </div>
          </td>
  
          <!-- Status -->
          <td>
            <p-tag
              [value]="activity.status"
              severity="success"
              rounded="true">
            </p-tag>
          </td>
  
          <!-- Activity date -->
          <td>
            {{ activity.activity_date | date:'medium' }}
          </td>
  
          <!-- Duration -->
          <td>
            {{ activity.duration_minutes }} min
          </td>
  
          <!-- Outcome -->
          <td class="capitalize">
            {{ activity.outcome?.replace('_', ' ') }}
          </td>
  
        </tr>
      </ng-template>
  
    </p-table>
  </div>
  
  
  
  </div>
  