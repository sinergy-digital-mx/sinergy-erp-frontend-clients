import{a as z}from"./chunk-ESGHQXLB.js";import{H as q,I as V,J as X,S as B}from"./chunk-RBHIJQFK.js";import{c as d,f as w,l as A,q as F,s as j,t as R,v as L}from"./chunk-7TNFDLAZ.js";import{A as T,x as G,y as O,z as $}from"./chunk-5MRBIJ7N.js";import{A as x,e as I,m as k,t as N}from"./chunk-UZLFZEBK.js";import{Fb as i,Gb as n,Hb as r,Ib as l,Pb as E,S as b,Ta as o,Tb as y,Vb as h,W as _,aa as S,ab as m,ba as C,gb as P,hc as s,ic as U,jc as D,mb as M,na as c}from"./chunk-NOG5ANO3.js";import{a as u,b as g}from"./chunk-7CGTOI24.js";var v=class p{constructor(e){this.http=e}api=T.api;getProperties(e){return this.http.get(`${this.api}/tenant/properties`,{params:e})}getProperty(e){return this.http.get(`${this.api}/tenant/properties/${e}`)}getPropertyByCode(e){return this.http.get(`${this.api}/tenant/properties/by-code/${e}`)}createProperty(e){return this.http.post(`${this.api}/tenant/properties`,e)}updateProperty(e,a){return this.http.put(`${this.api}/tenant/properties/${e}`,a)}deleteProperty(e){return this.http.delete(`${this.api}/tenant/properties/${e}`)}getMeasurementUnits(){return this.http.get(`${this.api}/tenant/properties/measurement-units/all`)}static \u0275fac=function(a){return new(a||p)(_(N))};static \u0275prov=b({token:p,factory:p.\u0275fac,providedIn:"root"})};function Q(p,e){if(p&1){let a=E();n(0,"div")(1,"label",11),s(2,"Propietario"),r(),n(3,"div",18)(4,"span",19),y("click",function(){S(a);let f=h();return C(f.navigateToCustomer())}),s(5),r(),n(6,"span",20),s(7,"(Contrato activo)"),r()()()}if(p&2){let a=h();o(5),D(" ",a.getOwnerName()," ")}}var H=class p{constructor(e,a,t,f,W,Y,Z){this.fb=e;this.dialog=a;this.dialog_ref=t;this.data=f;this.propertyService=W;this.interceptor_service=Y;this.router=Z;this.form=this.fb.group({code:["",[d.required]],block:[""],name:["",[d.required]],description:[""],location:[""],group_id:["",[d.required]],total_area:["",[d.required,d.min(0)]],measurement_unit_id:["",[d.required]],total_price:["",[d.required,d.min(0)]],currency:["MXN"],status:["disponible"]}),this.statusSelectConfig.form_control=this.form.get("status"),this.measurementUnitSelectConfig.form_control=this.form.get("measurement_unit_id"),this.currencySelectConfig.form_control=this.form.get("currency"),this.groupSelectConfig.form_control=this.form.get("group_id"),this.data?.property&&this.form.patchValue({code:this.data.property.code,block:this.data.property.block||"",name:this.data.property.name,description:this.data.property.description||"",location:this.data.property.location||"",group_id:this.data.property.group_id,total_area:this.data.property.total_area,measurement_unit_id:this.data.property.measurement_unit_id,total_price:this.data.property.total_price,currency:this.data.property.currency,status:this.data.property.status})}loading=c(!1);update=c(!1);measurementUnits=c([]);loadingUnits=c(!1);propertyGroups=c([]);loadingGroups=c(!1);X=G;form;statusSelectConfig={placeholder:"Selecciona un estado",data:[{value:"disponible",label:"Disponible"},{value:"vendido",label:"Vendido"},{value:"reservado",label:"Reservado"},{value:"cancelado",label:"Cancelado"}],value:"value",option:"label",form_control:null};measurementUnitSelectConfig={placeholder:"Selecciona una unidad",data:[],value:"id",option:"displayName",form_control:null,loading:!0};currencySelectConfig={placeholder:"Selecciona una moneda",data:[{value:"MXN",label:"MXN - Peso Mexicano"},{value:"USD",label:"USD - D\xF3lar"},{value:"EUR",label:"EUR - Euro"}],value:"value",option:"label",form_control:null};groupSelectConfig={placeholder:"Selecciona un proyecto",data:[],value:"id",option:"name",form_control:null,loading:!0};ngOnInit(){this.loadMeasurementUnits(),this.loadPropertyGroups()}loadPropertyGroups(){this.loadingGroups.set(!0);let e=[{id:"550e8400-e29b-41d4-a716-446655440100",name:"Campestre Divino"}];this.propertyGroups.set(e),this.groupSelectConfig=g(u({},this.groupSelectConfig),{data:e,loading:!1}),this.loadingGroups.set(!1)}loadMeasurementUnits(){this.loadingUnits.set(!0),this.propertyService.getMeasurementUnits().subscribe({next:e=>{this.measurementUnits.set(e);let a=e.map(t=>({id:t.id,name:t.name,symbol:t.symbol,displayName:`${t.name} (${t.symbol})`}));this.measurementUnitSelectConfig=g(u({},this.measurementUnitSelectConfig),{data:a,loading:!1}),this.loadingUnits.set(!1)},error:()=>{this.measurementUnitSelectConfig=g(u({},this.measurementUnitSelectConfig),{loading:!1}),this.loadingUnits.set(!1),this.interceptor_service.openSnackbar({type:"error",title:"Error",message:"No pudimos cargar las unidades de medida."})}})}closeDialog(){this.loading()||this.dialog_ref.close(this.update())}getOwnerName(){let e=this.data?.property?.contracts?.[0]?.customer;return e?`${e.name} ${e.lastname}`:null}navigateToCustomer(){let e=this.data?.property?.contracts?.[0]?.customer?.id;e&&(this.dialog_ref.close(),this.router.navigate(["/customers/detail",e]))}submit(){this.data?.property?.id?this.updateProperty():this.createProperty()}createProperty(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading.set(!0);let e=u({},this.form.value);this.propertyService.createProperty(e).subscribe({next:()=>{this.update.set(!0),this.loading.set(!1),this.interceptor_service.openSnackbar({type:"success",title:"\xC9xito",message:"Lote creado correctamente."}),this.closeDialog()},error:()=>{this.loading.set(!1),this.interceptor_service.openSnackbar({type:"error",title:"Error",message:"No pudimos crear el lote. Por favor intenta de nuevo."})}})}updateProperty(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading.set(!0);let e=u({},this.form.value);this.propertyService.updateProperty(this.data.property.id,e).subscribe({next:()=>{this.update.set(!0),this.loading.set(!1),this.interceptor_service.openSnackbar({type:"success",title:"\xC9xito",message:"Lote actualizado correctamente."}),this.closeDialog()},error:()=>{this.loading.set(!1),this.interceptor_service.openSnackbar({type:"error",title:"Error",message:"No pudimos actualizar el lote. Por favor intenta de nuevo."})}})}static \u0275fac=function(a){return new(a||p)(m(F),m(X),m(q),m(V),m(v),m(B),m(x))};static \u0275cmp=P({type:p,selectors:[["app-property-edit-modal"]],decls:36,vars:17,consts:[[1,"dialog"],[1,"dialog__header"],[1,"close","cursor-pointer",3,"click","img"],[1,"dialog__body"],[1,"container","grid","grid-cols-1","md:grid-cols-2","gap-4",3,"formGroup"],["label","C\xF3digo del Lote",3,"form_control"],["label","Manzana",3,"form_control"],[1,"md:col-span-2"],["label","Nombre del Lote",3,"form_control"],["label","Descripci\xF3n","type","textarea",3,"form_control"],["label","Ubicaci\xF3n",3,"form_control"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"config"],["label","\xC1rea Total","type","number",3,"form_control"],["label","Precio Total","type","number",3,"form_control"],[4,"ngIf"],[1,"dialog__footer"],["custom_class","btn_primary",3,"clicked","text","loading"],[1,"flex","items-center","gap-2","px-3","py-2","bg-gray-50","border","border-gray-200","rounded-lg"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-blue-100","text-blue-800","cursor-pointer","hover:bg-blue-200","transition-colors",3,"click"],[1,"text-xs","text-gray-500"]],template:function(a,t){a&1&&(n(0,"div",0)(1,"div",1)(2,"h2"),s(3),r(),n(4,"lucide-icon",2),y("click",function(){return t.closeDialog()}),r()(),n(5,"div",3)(6,"div",4),l(7,"app-input",5)(8,"app-input",6),n(9,"div",7),l(10,"app-input",8),r(),n(11,"div",7),l(12,"app-input",9),r(),n(13,"div",7),l(14,"app-input",10),r(),n(15,"div",7)(16,"label",11),s(17,"Proyecto"),r(),l(18,"app-select",12),r(),l(19,"app-input",13),n(20,"div")(21,"label",11),s(22,"Unidad de Medida"),r(),l(23,"app-select",12),r(),l(24,"app-input",14),n(25,"div")(26,"label",11),s(27,"Moneda"),r(),l(28,"app-select",12),r(),n(29,"div")(30,"label",11),s(31,"Estado"),r(),l(32,"app-select",12),r(),M(33,Q,8,1,"div",15),r()(),n(34,"div",16)(35,"app-button",17),y("clicked",function(){return t.submit()}),r()()()),a&2&&(o(3),U(!(t.data==null||t.data.property==null)&&t.data.property.id?"Actualizar Lote":"Crear Lote"),o(),i("img",t.X),o(2),i("formGroup",t.form),o(),i("form_control",t.form.controls.code),o(),i("form_control",t.form.controls.block),o(2),i("form_control",t.form.controls.name),o(2),i("form_control",t.form.controls.description),o(2),i("form_control",t.form.controls.location),o(4),i("config",t.groupSelectConfig),o(),i("form_control",t.form.controls.total_area),o(4),i("config",t.measurementUnitSelectConfig),o(),i("form_control",t.form.controls.total_price),o(4),i("config",t.currencySelectConfig),o(4),i("config",t.statusSelectConfig),o(),i("ngIf",(t.data==null||t.data.property==null?null:t.data.property.id)&&t.getOwnerName()),o(2),i("text",!(t.data==null||t.data.property==null)&&t.data.property.id?"Actualizar":"Crear")("loading",t.loading()))},dependencies:[k,I,j,w,A,R,L,z,$,O],styles:[".dialog[_ngcontent-%COMP%]{width:100dvw;max-width:700px}"]})};export{v as a,H as b};
