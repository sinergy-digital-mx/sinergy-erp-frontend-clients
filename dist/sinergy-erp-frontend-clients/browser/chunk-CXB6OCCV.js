import{a as Re,b as yt}from"./chunk-AWUHIJQD.js";import{a as io}from"./chunk-U35SLASU.js";import{a as Ri}from"./chunk-5XN6F6LE.js";import{b as oo,c as no}from"./chunk-6RVAJVAQ.js";import"./chunk-HO6VT44Y.js";import{a as Ae}from"./chunk-ESGHQXLB.js";import{A as _t,B as bt,C as vt,D as Bt,E as Zi,G as fe,H as Y,I as he,J as K,K as ge,L as Ji,M as eo,N as to,S as V,a as Li,b as zi,c as mt,d as Nt,e as Ni,f as Vi,g as Bi,h as ji,i as $i,j as Hi,k as qi,l as pt,m as pe,n as Gi,o as Vt,p as ut,q as Ui,r as ft,s as ue,t as Wi,u as Xi,v as ht,w as Qi,x as Yi,y as gt,z as Ki}from"./chunk-RBHIJQFK.js";import{a as Ti,b as Te,c as y,e as Fe,f as le,h as Fi,i as dt,k as ct,l as se,q as de,r as Ai,s as ce,t as me,v as F}from"./chunk-7TNFDLAZ.js";import{A as Oe,a as Ci,d as Si,e as wi,h as Pi,i as Mi,j as Di,l as Ei,q as lt,r as ki,t as Ii,u as st,v as Oi,x as $,y as z,z as N}from"./chunk-5MRBIJ7N.js";import{A as rt,c as vi,d as ke,e as L,i as yi,j as O,l as re,m as T,t as Ie,y as xi}from"./chunk-UZLFZEBK.js";import{$a as qe,$b as R,A as Lt,Ab as ee,Ac as w,B as Zt,Bc as xe,C as Jt,Cc as bi,D as zt,Fb as c,Gb as a,Hb as r,Ib as _,Jb as Ee,Kb as Ge,L as ve,Lc as ae,M as tt,N as U,O as ei,Pb as D,Pc as te,Qa as ai,Qb as nt,R as ti,S as Pe,T as ie,Ta as l,Tb as u,Ub as ci,V as q,Vb as p,W as Me,Wb as at,X as h,Xb as Ue,Ya as He,Yb as mi,Za as ri,Zb as X,_ as ii,_b as A,a as Je,aa as x,ab as f,ba as C,c as Tt,cb as it,cc as We,d as G,ea as De,ec as M,fa as oi,gb as k,gc as Q,hb as oe,hc as s,i as Ft,ia as ye,ib as ot,ic as b,ja as $e,jb as li,jc as g,kc as pi,m as Xt,mb as P,mc as ui,n as At,na as S,nb as si,nc as fi,oc as hi,pb as di,pc as j,r as Qt,s as Yt,t as Kt,ta as ni,uc as gi,v as et,vb as ne,w as Rt,wa as W,yb as J,yc as v,zc as _i}from"./chunk-NOG5ANO3.js";import{a as B,b as Ot}from"./chunk-7CGTOI24.js";var wo=["tooltip"],Po=20;var Mo=new q("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{let n=h(De);return()=>gt(n,{scrollThrottle:Po})}}),Do=new q("mat-tooltip-default-options",{providedIn:"root",factory:()=>({showDelay:0,hideDelay:0,touchendHideDelay:1500})});var ao="tooltip-panel",Eo={passive:!0},ko=8,Io=8,Oo=24,To=200,jt=(()=>{class n{_elementRef=h(W);_ngZone=h($e);_platform=h(mt);_ariaDescriber=h(Ui);_focusMonitor=h(Ni);_dir=h(ft);_injector=h(De);_viewContainerRef=h(it);_mediaMatcher=h($i);_document=h(oi);_renderer=h(qe);_animationsDisabled=fe();_defaultOptions=h(Do,{optional:!0});_overlayRef=null;_tooltipInstance=null;_overlayPanelClass;_portal;_position="below";_positionAtOrigin=!1;_disabled=!1;_tooltipClass;_viewInitialized=!1;_pointerExitEventsInitialized=!1;_tooltipComponent=ro;_viewportMargin=8;_currentPosition;_cssClassPrefix="mat-mdc";_ariaDescriptionPending=!1;_dirSubscribed=!1;get position(){return this._position}set position(e){e!==this._position&&(this._position=e,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(e){this._positionAtOrigin=Bt(e),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(e){let t=Bt(e);this._disabled!==t&&(this._disabled=t,t?this.hide(0):this._setupPointerEnterEventsIfNeeded(),this._syncAriaDescription(this.message))}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=Nt(e)}_showDelay;get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=Nt(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}_hideDelay;touchGestures="auto";get message(){return this._message}set message(e){let t=this._message;this._message=e!=null?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage()),this._syncAriaDescription(t)}_message="";get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_eventCleanups=[];_touchstartTimeout=null;_destroyed=new G;_isDestroyed=!1;constructor(){let e=this._defaultOptions;e&&(this._showDelay=e.showDelay,this._hideDelay=e.hideDelay,e.position&&(this.position=e.position),e.positionAtOrigin&&(this.positionAtOrigin=e.positionAtOrigin),e.touchGestures&&(this.touchGestures=e.touchGestures),e.tooltipClass&&(this.tooltipClass=e.tooltipClass)),this._viewportMargin=ko}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(U(this._destroyed)).subscribe(e=>{e?e==="keyboard"&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){let e=this._elementRef.nativeElement;this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._eventCleanups.forEach(t=>t()),this._eventCleanups.length=0,this._destroyed.next(),this._destroyed.complete(),this._isDestroyed=!0,this._ariaDescriber.removeDescription(e,this.message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay,t){if(this.disabled||!this.message||this._isTooltipVisible()){this._tooltipInstance?._cancelPendingAnimations();return}let o=this._createOverlay(t);this._detach(),this._portal=this._portal||new Qi(this._tooltipComponent,this._viewContainerRef);let d=this._tooltipInstance=o.attach(this._portal).instance;d._triggerElement=this._elementRef.nativeElement,d._mouseLeaveHideDelay=this._hideDelay,d.afterHidden().pipe(U(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),d.show(e)}hide(e=this.hideDelay){let t=this._tooltipInstance;t&&(t.isVisible()?t.hide(e):(t._cancelPendingAnimations(),this._detach()))}toggle(e){this._isTooltipVisible()?this.hide():this.show(void 0,e)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(e){if(this._overlayRef){let m=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!e)&&m._origin instanceof W)return this._overlayRef;this._detach()}let t=this._injector.get(Wi).getAncestorScrollContainers(this._elementRef),o=`${this._cssClassPrefix}-${ao}`,d=_t(this._injector,this.positionAtOrigin?e||this._elementRef:this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(t).withPopoverLocation("global");return d.positionChanges.pipe(U(this._destroyed)).subscribe(m=>{this._updateCurrentPositionClass(m.connectionPair),this._tooltipInstance&&m.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=bt(this._injector,{direction:this._dir,positionStrategy:d,panelClass:this._overlayPanelClass?[...this._overlayPanelClass,o]:o,scrollStrategy:this._injector.get(Mo)(),disableAnimations:this._animationsDisabled}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(U(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(U(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(U(this._destroyed)).subscribe(m=>{this._isTooltipVisible()&&m.keyCode===27&&!pe(m)&&(m.preventDefault(),m.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._dirSubscribed||(this._dirSubscribed=!0,this._dir.change.pipe(U(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(e){let t=e.getConfig().positionStrategy,o=this._getOrigin(),d=this._getOverlayPosition();t.withPositions([this._addOffset(B(B({},o.main),d.main)),this._addOffset(B(B({},o.fallback),d.fallback))])}_addOffset(e){let t=Io,o=!this._dir||this._dir.value=="ltr";return e.originY==="top"?e.offsetY=-t:e.originY==="bottom"?e.offsetY=t:e.originX==="start"?e.offsetX=o?-t:t:e.originX==="end"&&(e.offsetX=o?t:-t),e}_getOrigin(){let e=!this._dir||this._dir.value=="ltr",t=this.position,o;t=="above"||t=="below"?o={originX:"center",originY:t=="above"?"top":"bottom"}:t=="before"||t=="left"&&e||t=="right"&&!e?o={originX:"start",originY:"center"}:(t=="after"||t=="right"&&e||t=="left"&&!e)&&(o={originX:"end",originY:"center"});let{x:d,y:m}=this._invertPosition(o.originX,o.originY);return{main:o,fallback:{originX:d,originY:m}}}_getOverlayPosition(){let e=!this._dir||this._dir.value=="ltr",t=this.position,o;t=="above"?o={overlayX:"center",overlayY:"bottom"}:t=="below"?o={overlayX:"center",overlayY:"top"}:t=="before"||t=="left"&&e||t=="right"&&!e?o={overlayX:"end",overlayY:"center"}:(t=="after"||t=="right"&&e||t=="left"&&!e)&&(o={overlayX:"start",overlayY:"center"});let{x:d,y:m}=this._invertPosition(o.overlayX,o.overlayY);return{main:o,fallback:{overlayX:d,overlayY:m}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),He(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()},{injector:this._injector}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e instanceof Set?Array.from(e):e,this._tooltipInstance._markForCheck())}_invertPosition(e,t){return this.position==="above"||this.position==="below"?t==="top"?t="bottom":t==="bottom"&&(t="top"):e==="end"?e="start":e==="start"&&(e="end"),{x:e,y:t}}_updateCurrentPositionClass(e){let{overlayY:t,originX:o,originY:d}=e,m;if(t==="center"?this._dir&&this._dir.value==="rtl"?m=o==="end"?"left":"right":m=o==="start"?"left":"right":m=t==="bottom"&&d==="top"?"above":"below",m!==this._currentPosition){let E=this._overlayRef;if(E){let H=`${this._cssClassPrefix}-${ao}-`;E.removePanelClass(H+this._currentPosition),E.addPanelClass(H+m)}this._currentPosition=m}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._eventCleanups.length||(this._isTouchPlatform()?this.touchGestures!=="off"&&(this._disableNativeGesturesIfNecessary(),this._addListener("touchstart",e=>{let t=e.targetTouches?.[0],o=t?{x:t.clientX,y:t.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),this._touchstartTimeout&&clearTimeout(this._touchstartTimeout);let d=500;this._touchstartTimeout=setTimeout(()=>{this._touchstartTimeout=null,this.show(void 0,o)},this._defaultOptions?.touchLongPressShowDelay??d)})):this._addListener("mouseenter",e=>{this._setupPointerExitEventsIfNeeded();let t;e.x!==void 0&&e.y!==void 0&&(t=e),this.show(void 0,t)}))}_setupPointerExitEventsIfNeeded(){if(!this._pointerExitEventsInitialized){if(this._pointerExitEventsInitialized=!0,!this._isTouchPlatform())this._addListener("mouseleave",e=>{let t=e.relatedTarget;(!t||!this._overlayRef?.overlayElement.contains(t))&&this.hide()}),this._addListener("wheel",e=>{if(this._isTooltipVisible()){let t=this._document.elementFromPoint(e.clientX,e.clientY),o=this._elementRef.nativeElement;t!==o&&!o.contains(t)&&this.hide()}});else if(this.touchGestures!=="off"){this._disableNativeGesturesIfNecessary();let e=()=>{this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions?.touchendHideDelay)};this._addListener("touchend",e),this._addListener("touchcancel",e)}}}_addListener(e,t){this._eventCleanups.push(this._renderer.listen(this._elementRef.nativeElement,e,t,Eo))}_isTouchPlatform(){return this._platform.IOS||this._platform.ANDROID?!0:this._platform.isBrowser?!!this._defaultOptions?.detectHoverCapability&&this._mediaMatcher.matchMedia("(any-hover: none)").matches:!1}_disableNativeGesturesIfNecessary(){let e=this.touchGestures;if(e!=="off"){let t=this._elementRef.nativeElement,o=t.style;(e==="on"||t.nodeName!=="INPUT"&&t.nodeName!=="TEXTAREA")&&(o.userSelect=o.msUserSelect=o.webkitUserSelect=o.MozUserSelect="none"),(e==="on"||!t.draggable)&&(o.webkitUserDrag="none"),o.touchAction="none",o.webkitTapHighlightColor="transparent"}}_syncAriaDescription(e){this._ariaDescriptionPending||(this._ariaDescriptionPending=!0,this._ariaDescriber.removeDescription(this._elementRef.nativeElement,e,"tooltip"),this._isDestroyed||He({write:()=>{this._ariaDescriptionPending=!1,this.message&&!this.disabled&&this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")}},{injector:this._injector}))}static \u0275fac=function(t){return new(t||n)};static \u0275dir=ot({type:n,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(t,o){t&2&&M("mat-mdc-tooltip-disabled",o.disabled)},inputs:{position:[0,"matTooltipPosition","position"],positionAtOrigin:[0,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[0,"matTooltipDisabled","disabled"],showDelay:[0,"matTooltipShowDelay","showDelay"],hideDelay:[0,"matTooltipHideDelay","hideDelay"],touchGestures:[0,"matTooltipTouchGestures","touchGestures"],message:[0,"matTooltip","message"],tooltipClass:[0,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"]})}return n})(),ro=(()=>{class n{_changeDetectorRef=h(ae);_elementRef=h(W);_isMultiline=!1;message;tooltipClass;_showTimeoutId;_hideTimeoutId;_triggerElement;_mouseLeaveHideDelay;_animationsDisabled=fe();_tooltip;_closeOnInteraction=!1;_isVisible=!1;_onHide=new G;_showAnimation="mat-mdc-tooltip-show";_hideAnimation="mat-mdc-tooltip-hide";constructor(){}show(e){this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},e)}hide(e){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},e)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){(!e||!this._triggerElement.contains(e))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){let e=this._elementRef.nativeElement.getBoundingClientRect();return e.height>Oo&&e.width>=To}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_cancelPendingAnimations(){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(e){let t=this._tooltip.nativeElement,o=this._showAnimation,d=this._hideAnimation;if(t.classList.remove(e?d:o),t.classList.add(e?o:d),this._isVisible!==e&&(this._isVisible=e,this._changeDetectorRef.markForCheck()),e&&!this._animationsDisabled&&typeof getComputedStyle=="function"){let m=getComputedStyle(t);(m.getPropertyValue("animation-duration")==="0s"||m.getPropertyValue("animation-name")==="none")&&(this._animationsDisabled=!0)}e&&this._onShow(),this._animationsDisabled&&(t.classList.add("_mat-animation-noopable"),this._finalizeAnimation(e))}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=k({type:n,selectors:[["mat-tooltip-component"]],viewQuery:function(t,o){if(t&1&&X(wo,7),t&2){let d;A(d=R())&&(o._tooltip=d.first)}},hostAttrs:["aria-hidden","true"],hostBindings:function(t,o){t&1&&u("mouseleave",function(m){return o._handleMouseLeave(m)})},decls:4,vars:5,consts:[["tooltip",""],[1,"mdc-tooltip","mat-mdc-tooltip",3,"animationend"],[1,"mat-mdc-tooltip-surface","mdc-tooltip__surface"]],template:function(t,o){if(t&1){let d=D();Ee(0,"div",1,0),ci("animationend",function(E){return x(d),C(o._handleAnimationEnd(E))}),Ee(2,"div",2),s(3),Ge()()}t&2&&(Q(o.tooltipClass),M("mdc-tooltip--multiline",o._isMultiline),l(3),b(o.message))},styles:[`.mat-mdc-tooltip{position:relative;transform:scale(0);display:inline-flex}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-surface{word-break:normal;overflow-wrap:anywhere;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center;will-change:transform,opacity;background-color:var(--mat-tooltip-container-color, var(--mat-sys-inverse-surface));color:var(--mat-tooltip-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-tooltip-container-shape, var(--mat-sys-corner-extra-small));font-family:var(--mat-tooltip-supporting-text-font, var(--mat-sys-body-small-font));font-size:var(--mat-tooltip-supporting-text-size, var(--mat-sys-body-small-size));font-weight:var(--mat-tooltip-supporting-text-weight, var(--mat-sys-body-small-weight));line-height:var(--mat-tooltip-supporting-text-line-height, var(--mat-sys-body-small-line-height));letter-spacing:var(--mat-tooltip-supporting-text-tracking, var(--mat-sys-body-small-tracking))}.mat-mdc-tooltip-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:right}.mat-mdc-tooltip-panel{line-height:normal}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}
`],encapsulation:2,changeDetection:0})}return n})();var lo=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=oe({type:n});static \u0275inj=ie({imports:[qi,vt,ue,ht]})}return n})();var Le=class n{constructor(i){this.http=i}api=Oe.api;getContractDocuments(i){return this.http.get(`${this.api}/tenant/contracts/${i}/documents`)}uploadDocument(i,e){return this.http.post(`${this.api}/tenant/contracts/${i}/documents`,e)}updateDocumentStatus(i,e,t){return this.http.patch(`${this.api}/tenant/contracts/${i}/documents/${e}/status`,t)}deleteDocument(i,e){return this.http.delete(`${this.api}/tenant/contracts/${i}/documents/${e}`)}static \u0275fac=function(e){return new(e||n)(Me(Ie))};static \u0275prov=Pe({token:n,factory:n.\u0275fac,providedIn:"root"})};function Ao(n,i){if(n&1&&(a(0,"p",17),s(1),r()),n&2){let e=p();l(),pi(" \u2713 ",e.selectedFile.name," (",e.formatFileSize(e.selectedFile.size),") ")}}var Ct=class n{constructor(i,e,t,o){this.data=i;this.dialogRef=e;this.documentService=t;this.interceptorService=o}uploading=S(!1);selectedFile=null;notes="";Upload=Oi;X=$;onFileSelected(i){let e=i.target.files[0];if(e){if(e.size>10*1024*1024){this.interceptorService.openSnackbar({type:"error",title:"Error",message:"El archivo es muy grande (m\xE1ximo 10MB)"});return}this.selectedFile=e}}uploadDocument(){if(!this.selectedFile){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Selecciona un archivo"});return}this.uploading.set(!0);let i=new FormData;i.append("file",this.selectedFile),this.notes&&i.append("notes",this.notes),this.documentService.uploadDocument(this.data.contractId,i).subscribe({next:()=>{this.uploading.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Documento subido correctamente"}),this.dialogRef.close(!0)},error:e=>{this.uploading.set(!1);let t="Error al subir documento";e.status===413?t="Archivo muy grande (m\xE1ximo 10MB)":e.status===415&&(t="Tipo de archivo no permitido"),this.interceptorService.openSnackbar({type:"error",title:"Error",message:t})}})}close(){this.dialogRef.close()}formatFileSize(i){return i<1024?i+" B":i<1024*1024?(i/1024).toFixed(1)+" KB":(i/(1024*1024)).toFixed(1)+" MB"}static \u0275fac=function(e){return new(e||n)(f(he),f(Y),f(Le),f(V))};static \u0275cmp=k({type:n,selectors:[["app-contract-document-upload-modal"]],decls:24,vars:7,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-title"],[1,"close-button",3,"click"],[3,"img","size"],[1,"dialog-content"],[1,"form-grid"],[1,"form-field","full-width"],[1,"field-label"],[1,"file-input-wrapper"],["type","file","accept",".jpg,.jpeg,.png,.pdf,.doc,.docx","id","fileInput",1,"field-input","file-input",3,"change"],["class","file-info",4,"ngIf"],["placeholder","Notas adicionales...","rows","3",1,"field-input",3,"ngModelChange","ngModel"],[1,"help-text"],[1,"dialog-footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Subir Documento","custom_class","btn_primary",3,"clicked","loading","disabled","icon"],[1,"file-info"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),s(3,"Subir Documento del Contrato"),r(),a(4,"button",3),u("click",function(){return t.close()}),_(5,"lucide-icon",4),r()(),a(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),s(10,"Archivo"),r(),a(11,"div",9)(12,"input",10),u("change",function(d){return t.onFileSelected(d)}),r()(),P(13,Ao,2,2,"p",11),r(),a(14,"div",7)(15,"label",8),s(16,"Notas (Opcional)"),r(),a(17,"textarea",12),hi("ngModelChange",function(d){return fi(t.notes,d)||(t.notes=d),d}),s(18,"        "),r()()(),a(19,"p",13),s(20," Formatos permitidos: JPG, PNG, PDF, DOC, DOCX (m\xE1x. 10MB) "),r()(),a(21,"div",14)(22,"app-button",15),u("clicked",function(){return t.close()}),r(),a(23,"app-button",16),u("clicked",function(){return t.uploadDocument()}),r()()()),e&2&&(l(5),c("img",t.X)("size",20),l(8),c("ngIf",t.selectedFile),l(4),ui("ngModel",t.notes),l(6),c("loading",t.uploading())("disabled",!t.selectedFile)("icon",t.Upload))},dependencies:[T,L,Ai,Te,Fe,Fi,ge,F,N,z],styles:[".dialog[_ngcontent-%COMP%]{width:100dvw;max-width:600px}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid #e5e7eb}.dialog-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#111827;margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#6b7280;padding:.5rem;border-radius:.375rem;transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#111827}.dialog-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:1rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-field.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.field-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#374151}.field-input[_ngcontent-%COMP%]{width:100%;padding:.625rem .75rem;border:1px solid #d1d5db;border-radius:.5rem;font-size:.875rem;transition:all .2s;background-color:#fff;cursor:pointer}.field-input[_ngcontent-%COMP%]:hover{border-color:#9ca3af;background-color:#f9fafb}.field-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px #6366f11a;background-color:#fff}.field-input[_ngcontent-%COMP%]:disabled{background-color:#f9fafb;cursor:not-allowed;opacity:.6}input[type=file].field-input[_ngcontent-%COMP%]{padding:.5rem .75rem;cursor:pointer}input[type=file].field-input[_ngcontent-%COMP%]::file-selector-button{padding:.375rem .75rem;margin-right:.75rem;background-color:#6366f1;color:#fff;border:none;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s}input[type=file].field-input[_ngcontent-%COMP%]::file-selector-button:hover{background-color:#4f46e5}textarea.field-input[_ngcontent-%COMP%]{resize:vertical;font-family:inherit}.file-info[_ngcontent-%COMP%]{font-size:.75rem;color:#059669;margin-top:.5rem;font-weight:500}.file-input-wrapper[_ngcontent-%COMP%]{position:relative}.help-text[_ngcontent-%COMP%]{font-size:.75rem;color:#6b7280;margin-top:1rem;margin-bottom:0}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1.5rem;border-top:1px solid #e5e7eb}"]})};function Ro(n,i){n&1&&(a(0,"div",7)(1,"p",8),s(2,"Cargando documentos..."),r()())}function Lo(n,i){n&1&&(a(0,"div",9)(1,"p",10),s(2,"No hay documentos subidos"),r()())}function zo(n,i){if(n&1&&(a(0,"p",26),s(1),r()),n&2){let e=p().$implicit;l(),b(e.notes)}}function No(n,i){if(n&1){let e=D();a(0,"div",27)(1,"button",28),u("click",function(){x(e);let o=p().$implicit,d=p(2);return C(d.updateStatus(o,"approved"))}),_(2,"lucide-icon",25),r(),a(3,"button",29),u("click",function(){x(e);let o=p().$implicit,d=p(2);return C(d.updateStatus(o,"rejected"))}),_(4,"lucide-icon",25),r()()}if(n&2){let e=p(3);l(2),c("img",e.FileCheck)("size",16),l(2),c("img",e.FileX)("size",16)}}function Vo(n,i){if(n&1&&(a(0,"a",30),_(1,"lucide-icon",25),r()),n&2){let e=p().$implicit,t=p(2);c("href",e.download_url,ai),l(),c("img",t.Download)("size",16)}}function Bo(n,i){if(n&1){let e=D();a(0,"div",13)(1,"div",14),_(2,"lucide-icon",15),a(3,"div",16)(4,"div",17)(5,"span",18),s(6),r(),a(7,"span"),s(8),r()(),a(9,"div",19)(10,"span"),s(11),r(),a(12,"span"),s(13,"\u2022"),r(),a(14,"span"),s(15),v(16,"date"),r()(),P(17,zo,2,1,"p",20),r()(),a(18,"div",21),P(19,No,5,4,"div",22)(20,Vo,2,3,"a",23),a(21,"button",24),u("click",function(){let o=x(e).$implicit,d=p(2);return C(d.deleteDocument(o))}),_(22,"lucide-icon",25),r()()()}if(n&2){let e=i.$implicit,t=p(2);l(2),c("img",t.getFileIcon(e.mime_type))("size",20),l(4),b(e.file_name),l(),Q(t.getStatusClass(e.status)),l(),g(" ",t.getStatusLabel(e.status)," "),l(3),b(t.formatFileSize(e.file_size)),l(4),b(w(16,13,e.created_at,"mediumDate")),l(2),c("ngIf",e.notes),l(2),c("ngIf",e.status==="pending"),l(),c("ngIf",e.download_url),l(2),c("img",t.Trash2)("size",16)}}function jo(n,i){if(n&1&&(a(0,"div",11),P(1,Bo,23,16,"div",12),r()),n&2){let e=p();l(),c("ngForOf",e.documents())}}var wt=class n{constructor(i,e,t){this.documentService=i;this.interceptorService=e;this.dialog=t}contractId;documents=S([]);loading=S(!1);Plus=lt;Download=wi;Trash2=st;FileText=Mi;Image=Ei;FileCheck=Pi;FileX=Di;ngOnInit(){this.loadDocuments()}loadDocuments(){this.loading.set(!0),this.documentService.getContractDocuments(this.contractId).subscribe({next:i=>{this.documents.set(i),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar los documentos"})}})}openUploadModal(){this.dialog.open(Ct,{data:{contractId:this.contractId}}).afterClosed().subscribe(e=>{e&&this.loadDocuments()})}deleteDocument(i){confirm(`\xBFEliminar documento "${i.file_name}"?`)&&this.documentService.deleteDocument(this.contractId,i.id).subscribe({next:()=>{this.loadDocuments(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Documento eliminado"})},error:()=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudo eliminar el documento"})}})}updateStatus(i,e){this.documentService.updateDocumentStatus(this.contractId,i.id,{status:e}).subscribe({next:()=>{this.loadDocuments(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Estado actualizado"})},error:()=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudo actualizar el estado"})}})}getStatusClass(i){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[i]}`}getStatusLabel(i){return{pending:"Pendiente",approved:"Aprobado",rejected:"Rechazado"}[i]}getFileIcon(i){return i.startsWith("image/")?this.Image:i.includes("pdf")?this.FileText:this.FileText}formatFileSize(i){return i<1024?i+" B":i<1024*1024?(i/1024).toFixed(1)+" KB":(i/(1024*1024)).toFixed(1)+" MB"}static \u0275fac=function(e){return new(e||n)(f(Le),f(V),f(K))};static \u0275cmp=k({type:n,selectors:[["app-contract-documents"]],inputs:{contractId:"contractId"},decls:8,vars:4,consts:[[1,"documents-section"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-base","font-semibold","text-gray-800"],["text","Subir Documento","custom_class","btn_primary","size","sm",3,"clicked","icon"],["class","text-center py-6",4,"ngIf"],["class","text-center py-6 text-gray-500",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"text-center","py-6"],[1,"text-sm","text-gray-500"],[1,"text-center","py-6","text-gray-500"],[1,"text-sm"],[1,"space-y-2"],["class","flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-3","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors"],[1,"flex","items-center","gap-3","flex-1","min-w-0"],[1,"text-gray-400","flex-shrink-0",3,"img","size"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","mb-1"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"flex","items-center","gap-2","text-xs","text-gray-500"],["class","text-xs text-gray-600 mt-1 truncate",4,"ngIf"],[1,"flex","items-center","gap-1","flex-shrink-0"],["class","flex gap-1",4,"ngIf"],["target","_blank","class","p-1.5 text-indigo-600 hover:bg-indigo-50 rounded transition-colors","title","Descargar",3,"href",4,"ngIf"],["title","Eliminar",1,"p-1.5","text-red-600","hover:bg-red-50","rounded","transition-colors",3,"click"],[3,"img","size"],[1,"text-xs","text-gray-600","mt-1","truncate"],[1,"flex","gap-1"],["title","Aprobar",1,"p-1.5","text-green-600","hover:bg-green-50","rounded","transition-colors",3,"click"],["title","Rechazar",1,"p-1.5","text-red-600","hover:bg-red-50","rounded","transition-colors",3,"click"],["target","_blank","title","Descargar",1,"p-1.5","text-indigo-600","hover:bg-indigo-50","rounded","transition-colors",3,"href"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"h4",2),s(3,"Documentos del Contrato"),r(),a(4,"app-button",3),u("clicked",function(){return t.openUploadModal()}),r()(),P(5,Ro,3,0,"div",4)(6,Lo,3,0,"div",5)(7,jo,2,1,"div",6),r()),e&2&&(l(4),c("icon",t.Plus),l(),c("ngIf",t.loading()),l(),c("ngIf",!t.loading()&&t.documents().length===0),l(),c("ngIf",!t.loading()&&t.documents().length>0))},dependencies:[T,ke,L,F,N,z,O],styles:[".documents-section[_ngcontent-%COMP%]{margin-top:0;padding-top:0;border-top:none}"]})};var Z=class n{constructor(i){this.http=i}api=Oe.api;generatePayments(i){return this.http.post(`${this.api}/tenant/contracts/${i}/payments/generate`,{})}getPayments(i){return this.http.get(`${this.api}/tenant/contracts/${i}/payments`)}getPaymentStats(i){return this.http.get(`${this.api}/tenant/contracts/${i}/payments/stats`)}getPayment(i,e){return this.http.get(`${this.api}/tenant/contracts/${i}/payments/${e}`)}updatePayment(i,e,t){return this.http.put(`${this.api}/tenant/contracts/${i}/payments/${e}`,t)}markAsPaid(i,e,t){return this.http.post(`${this.api}/tenant/contracts/${i}/payments/${e}/pay`,t)}cancelPayment(i,e){return this.http.post(`${this.api}/tenant/contracts/${i}/payments/${e}/cancel`,{})}deletePayment(i,e){return this.http.delete(`${this.api}/tenant/contracts/${i}/payments/${e}`)}registerPartialPayment(i,e,t){return this.http.post(`${this.api}/tenant/contracts/${i}/payments/${e}/pay`,t)}uploadDocument(i,e,t,o,d){let m=new FormData;return m.append("file",t),m.append("document_type",o),d&&m.append("notes",d),this.http.post(`${this.api}/tenant/contracts/${i}/payments/${e}/documents`,m)}getDocuments(i,e){return this.http.get(`${this.api}/tenant/contracts/${i}/payments/${e}/documents`)}getDocumentUrl(i,e,t,o=3600){return this.http.get(`${this.api}/tenant/contracts/${i}/payments/${e}/documents/${t}/url?expiresIn=${o}`)}deleteDocument(i,e,t){return this.http.delete(`${this.api}/tenant/contracts/${i}/payments/${e}/documents/${t}`)}static \u0275fac=function(e){return new(e||n)(Me(Ie))};static \u0275prov=Pe({token:n,factory:n.\u0275fac,providedIn:"root"})};function $o(n,i){if(n&1&&(a(0,"p",21),s(1),v(2,"currency"),r()),n&2){let e=p();l(),g(" El monto no puede exceder ",w(2,1,e.amountPending,e.data.currency)," ")}}function Ho(n,i){if(n&1&&(a(0,"p",22),s(1),r()),n&2){let e=p();M("text-green-600",e.isFullPayment)("text-blue-600",!e.isFullPayment),l(),g(" ",e.paymentTypeMessage," ")}}var Mt=class n{constructor(i,e,t,o,d){this.data=i;this.dialogRef=e;this.fb=t;this.paymentService=o;this.interceptorService=d;let m=this.getLocalDateString(new Date);this.form=this.fb.group({amount:["",[y.required,y.min(.01),this.maxAmountValidator.bind(this)]],payment_date:[m,y.required],payment_method:["",y.required],reference_number:[""],notes:[""]}),this.paymentMethodSelectConfig.form_control=this.form.get("payment_method")}X=$;form;saving=S(!1);paymentMethodSelectConfig={placeholder:"Selecciona un m\xE9todo",data:[{value:"transferencia",label:"Transferencia"},{value:"efectivo",label:"Efectivo"},{value:"tarjeta",label:"Tarjeta"},{value:"cheque",label:"Cheque"}],value:"value",option:"label",form_control:null};getLocalDateString(i){let e=i.getFullYear(),t=String(i.getMonth()+1).padStart(2,"0"),o=String(i.getDate()).padStart(2,"0");return`${e}-${t}-${o}`}maxAmountValidator(i){if(!i.value)return null;let e=parseFloat(i.value);return e>this.data.payment.amount_pending?{maxAmount:{max:this.data.payment.amount_pending,actual:e}}:null}get amountPending(){return this.data.payment.amount_pending}get isFullPayment(){return parseFloat(this.form.get("amount")?.value||0)===this.amountPending}get paymentTypeMessage(){return this.isFullPayment?"Se marcar\xE1 como pagado completo":"Se registrar\xE1 como pago parcial"}save(){if(this.form.invalid){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Completa todos los campos requeridos correctamente"});return}this.saving.set(!0),this.paymentService.registerPartialPayment(this.data.contractId,this.data.payment.id,this.form.value).subscribe({next:()=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pago registrado correctamente"}),this.dialogRef.close(!0)},error:i=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:i.error?.message||"Error al registrar el pago"})}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(f(he),f(Y),f(de),f(Z),f(V))};static \u0275cmp=k({type:n,selectors:[["app-partial-payment-modal"]],features:[j([O])],decls:35,vars:15,consts:[[1,"modal-container"],[1,"modal-header"],[1,"text-xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-600","mt-1"],[1,"font-semibold","text-orange-600"],["type","button",1,"close-button",3,"click"],[3,"img","size"],[1,"modal-body"],[1,"space-y-4",3,"formGroup"],["label","Monto a Pagar","type","number","placeholder","Ingresa el monto",3,"form_control"],["class","text-xs text-red-600 mt-1",4,"ngIf"],["class","text-xs mt-1",3,"text-green-600","text-blue-600",4,"ngIf"],["label","Fecha de Pago","type","date",3,"form_control"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],[3,"config"],["label","N\xFAmero de Referencia","type","text","placeholder","Ej: REF123456",3,"form_control"],["formControlName","notes","rows","3","placeholder","Notas adicionales sobre el pago...",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent"],[1,"modal-footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Registrar Pago","custom_class","btn_primary",3,"clicked","loading"],[1,"text-xs","text-red-600","mt-1"],[1,"text-xs","mt-1"]],template:function(e,t){if(e&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"h2",2),s(4,"Registrar Pago"),r(),a(5,"p",3),s(6),a(7,"span",4),s(8),v(9,"currency"),r()()(),a(10,"button",5),u("click",function(){return t.close()}),_(11,"lucide-icon",6),r()(),a(12,"div",7)(13,"form",8)(14,"div"),_(15,"app-input",9),P(16,$o,3,4,"p",10)(17,Ho,2,5,"p",11),r(),a(18,"div"),_(19,"app-input",12),r(),a(20,"div")(21,"label",13),s(22," M\xE9todo de Pago "),a(23,"span",14),s(24,"*"),r()(),_(25,"app-select",15),r(),a(26,"div"),_(27,"app-input",16),r(),a(28,"div")(29,"label",13),s(30,"Notas"),r(),_(31,"textarea",17),r()()(),a(32,"div",18)(33,"app-button",19),u("clicked",function(){return t.close()}),r(),a(34,"app-button",20),u("clicked",function(){return t.save()}),r()()()),e&2){let o,d;l(6),g(" Pago #",t.data.payment.payment_number," - Monto pendiente: "),l(2),b(w(9,12,t.amountPending,t.data.currency)),l(3),c("img",t.X)("size",20),l(2),c("formGroup",t.form),l(2),c("form_control",t.form.get("amount")),l(),c("ngIf",(o=t.form.get("amount"))==null?null:o.hasError("maxAmount")),l(),c("ngIf",!((d=t.form.get("amount"))!=null&&d.hasError("maxAmount"))&&((d=t.form.get("amount"))==null?null:d.value)),l(2),c("form_control",t.form.get("payment_date")),l(6),c("config",t.paymentMethodSelectConfig),l(2),c("form_control",t.form.get("reference_number")),l(7),c("loading",t.saving())}},dependencies:[T,L,ce,dt,Te,Fe,le,se,ct,ge,F,me,Ae,N,z,re],styles:[".modal-container[_ngcontent-%COMP%]{width:600px;max-width:90vw;max-height:90vh;display:flex;flex-direction:column;background:#fff;border-radius:8px}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding:24px;border-bottom:1px solid #e5e7eb}.close-button[_ngcontent-%COMP%]{padding:4px;color:#6b7280;transition:all .2s;border-radius:4px}.close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#111827}.modal-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:24px}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:12px;padding:16px 24px;border-top:1px solid #e5e7eb}"]})};var _e=class n{constructor(i){this.datePipe=i}transform(i,e="mediumDate"){if(!i)return null;if(typeof i=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(i)){let[t,o,d]=i.split("-").map(Number),m=new Date(t,o-1,d);return this.datePipe.transform(m,e)}return this.datePipe.transform(i,e)}static \u0275fac=function(e){return new(e||n)(f(O,16))};static \u0275pipe=li({name:"localDate",type:n,pure:!0})};var Dt=class n{constructor(i,e,t,o,d){this.data=i;this.dialogRef=e;this.fb=t;this.paymentService=o;this.interceptorService=d;this.form=this.fb.group({amount:[this.data.payment.amount,[y.required,y.min(.01)]],due_date:[this.data.payment.due_date,y.required],notes:[this.data.payment.notes||""]})}X=$;form;saving=S(!1);save(){if(this.form.invalid){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Completa todos los campos requeridos"});return}this.saving.set(!0),this.paymentService.updatePayment(this.data.contractId,this.data.payment.id,this.form.value).subscribe({next:()=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pago actualizado correctamente"}),this.dialogRef.close(!0)},error:i=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:i.error?.message||"Error al actualizar el pago"})}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(f(he),f(Y),f(de),f(Z),f(V))};static \u0275cmp=k({type:n,selectors:[["app-edit-payment-modal"]],features:[j([O])],decls:24,vars:13,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-title"],[1,"close-button",3,"click"],[3,"img","size"],[1,"dialog-content",3,"formGroup"],[1,"mb-3","p-2","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"text-sm","text-blue-900"],[1,"font-semibold"],[1,"space-y-3"],["label","Monto","type","number",3,"form_control"],["label","Fecha de Vencimiento",3,"form_control"],["label","Notas","type","textarea",3,"form_control"],[1,"dialog-footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Guardar Cambios","custom_class","btn_primary",3,"clicked","loading"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"h2",2),s(3),r(),a(4,"button",3),u("click",function(){return t.close()}),_(5,"lucide-icon",4),r()(),a(6,"div",5)(7,"div",6)(8,"p",7)(9,"span",8),s(10,"Estado:"),r(),s(11),r(),a(12,"p",7)(13,"span",8),s(14,"Vencimiento Original:"),r(),s(15),v(16,"localDate"),r()(),a(17,"div",9),_(18,"app-input",10)(19,"app-input",11)(20,"app-input",12),r()(),a(21,"div",13)(22,"app-button",14),u("clicked",function(){return t.close()}),r(),a(23,"app-button",15),u("clicked",function(){return t.save()}),r()()()),e&2&&(l(3),g("Editar Pago #",t.data.payment.payment_number),l(2),c("img",t.X)("size",20),l(),c("formGroup",t.form),l(5),g(" ",t.data.payment.status," "),l(4),g(" ",w(16,10,t.data.payment.due_date,"mediumDate")," "),l(3),c("form_control",t.form.controls.amount),l(),c("form_control",t.form.controls.due_date),l(),c("form_control",t.form.controls.notes),l(3),c("loading",t.saving()))},dependencies:[T,ce,le,se,ge,F,me,N,z,_e],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh;width:100dvw;max-width:500px}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.25rem 1.5rem;border-bottom:1px solid #e5e7eb}.dialog-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#111827;margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#6b7280;padding:.5rem;border-radius:.375rem;transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#111827}.dialog-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1.25rem 1.5rem;border-top:1px solid #e5e7eb}"]})};function qo(n,i){if(n&1){let e=D();a(0,"app-button",9),u("clicked",function(){x(e);let o=p();return C(o.generatePayments())}),r()}if(n&2){let e=p();c("icon",e.Plus)("loading",e.generating())}}function Go(n,i){if(n&1&&(a(0,"div",15)(1,"p",16),s(2,"Meses Pagados"),r(),a(3,"p",17),s(4),a(5,"span",14),s(6,"meses"),r()()()),n&2){let e=p(2);l(4),g("",e.stats().paid_months," ")}}function Uo(n,i){if(n&1&&(a(0,"div",30)(1,"p",31),s(2),r(),a(3,"p",31),s(4),v(5,"currency"),r(),a(6,"p",32),s(7),v(8,"currency"),r()()),n&2){let e=p(2);l(2),g("Pago #",e.stats().partial_payment.installment_number),l(2),g("Abonado: ",w(5,3,e.stats().partial_payment.amount_paid,e.currency)),l(3),g("Faltante: ",w(8,6,e.stats().partial_payment.remaining_amount,e.currency))}}function Wo(n,i){if(n&1&&(a(0,"p",33),s(1),v(2,"currency"),r()),n&2){let e=p(2);l(),g(" + 1 pago con saldo de ",w(2,1,e.stats().partial_payment.remaining_amount,e.currency)," ")}}function Xo(n,i){if(n&1&&(a(0,"div",10)(1,"div",11)(2,"p",12),s(3,"Total Pagos"),r(),a(4,"p",13),s(5),a(6,"span",14),s(7,"meses"),r()()(),a(8,"div",15)(9,"p",16),s(10,"Pagados"),r(),a(11,"p",17),s(12),a(13,"span",14),s(14,"meses"),r()(),a(15,"p",18),s(16),v(17,"currency"),r()(),P(18,Go,7,1,"div",19),a(19,"div",11)(20,"p",12),s(21,"Parciales"),r(),a(22,"p",13),s(23),r(),P(24,Uo,9,9,"div",20),r(),a(25,"div",21)(26,"p",22),s(27,"Pendientes"),r(),a(28,"div",23)(29,"p",24),s(30),a(31,"span",14),s(32,"meses"),r()(),P(33,Wo,3,4,"p",25),a(34,"p",26),s(35),v(36,"currency"),r()()(),a(37,"div",27)(38,"p",28),s(39,"Vencidos"),r(),a(40,"p",29),s(41),a(42,"span",14),s(43,"meses"),r()()()()),n&2){let e=p();l(5),g("",e.stats().total_payments," "),l(7),g("",e.stats().paid_count," "),l(4),b(w(17,10,e.stats().total_paid||0,e.currency)),l(2),c("ngIf",e.stats().paid_months!==void 0),l(5),b(e.stats().partial_count),l(),c("ngIf",e.stats().partial_payment),l(6),g(" ",e.stats().pending_full_payments||0," "),l(3),c("ngIf",e.stats().partial_payment),l(2),g(" Total: ",w(36,13,e.stats().total_pending_amount||0,e.currency)," "),l(6),g("",e.stats().overdue_count," ")}}function Qo(n,i){n&1&&(a(0,"div",34)(1,"p",35),s(2,"Cargando pagos..."),r()())}function Yo(n,i){n&1&&(a(0,"div",36)(1,"p",37),s(2,"No hay pagos generados"),r()())}function Ko(n,i){if(n&1&&(a(0,"div"),s(1),v(2,"localDate"),r()),n&2){let e=p().$implicit;l(),b(w(2,1,e.paid_date,"mediumDate"))}}function Zo(n,i){if(n&1&&(a(0,"div",57),s(1),v(2,"localDate"),r()),n&2){let e=p().$implicit;l(),g(" Primer pago: ",w(2,1,e.first_partial_payment_date,"mediumDate")," ")}}function Jo(n,i){n&1&&(a(0,"div"),s(1,"\u2014"),r())}function en(n,i){if(n&1){let e=D();a(0,"button",58),u("click",function(){x(e);let o=p().$implicit,d=p(2);return C(d.registerPayment(o))}),_(1,"lucide-icon",59),r()}if(n&2){let e=p(3);l(),c("img",e.DollarSign)("size",16)}}function tn(n,i){if(n&1){let e=D();a(0,"button",60),u("click",function(){x(e);let o=p().$implicit,d=p(2);return C(d.editPayment(o))}),_(1,"lucide-icon",59),r()}if(n&2){let e=p(3);l(),c("img",e.Edit)("size",16)}}function on(n,i){if(n&1){let e=D();a(0,"button",61),u("click",function(){x(e);let o=p().$implicit,d=p(2);return C(d.cancelPayment(o))}),_(1,"lucide-icon",59),r()}if(n&2){let e=p(3);l(),c("img",e.X)("size",16)}}function nn(n,i){if(n&1){let e=D();a(0,"button",62),u("click",function(){x(e);let o=p().$implicit,d=p(2);return C(d.deletePayment(o))}),_(1,"lucide-icon",59),r()}if(n&2){let e=p(3);l(),c("img",e.Trash2)("size",16)}}function an(n,i){if(n&1&&(a(0,"tr",44)(1,"td",45),s(2),r(),a(3,"td",46),s(4),v(5,"currency"),r(),a(6,"td",47),s(7),v(8,"currency"),r(),a(9,"td",47),s(10),v(11,"currency"),r(),a(12,"td",48),s(13),v(14,"localDate"),r(),a(15,"td",48),P(16,Ko,3,4,"div",49)(17,Zo,3,4,"div",50)(18,Jo,2,0,"div",49),r(),a(19,"td",51)(20,"span"),s(21),r()(),a(22,"td",48),s(23),r(),a(24,"td",48),s(25),r(),a(26,"td",51)(27,"div",52),P(28,en,2,2,"button",53)(29,tn,2,2,"button",54)(30,on,2,2,"button",55)(31,nn,2,2,"button",56),r()()()),n&2){let e=i.$implicit,t=p(2);l(2),b(e.payment_number),l(2),b(w(5,25,e.amount,t.currency)),l(2),M("text-blue-600",e.status==="parcial")("font-medium",e.status==="parcial"),l(),g(" ",w(8,28,e.amount_paid,t.currency)," "),l(2),M("text-orange-600",e.status==="parcial")("font-medium",e.status==="parcial"),l(),g(" ",w(11,31,e.amount_pending,t.currency)," "),l(3),b(w(14,34,e.due_date,"mediumDate")),l(3),c("ngIf",e.paid_date),l(),c("ngIf",!e.paid_date&&e.first_partial_payment_date),l(),c("ngIf",!e.paid_date&&!e.first_partial_payment_date),l(2),Q(t.getStatusClass(e.status)),l(),g(" ",t.getStatusLabel(e.status)," "),l(2),b(e.payment_method||"\u2014"),l(2),b(e.reference_number||"\u2014"),l(3),c("ngIf",t.canRegisterPayment(e)),l(),c("ngIf",t.canEdit(e)),l(),c("ngIf",t.canCancel(e)),l(),c("ngIf",t.canDelete(e))}}function rn(n,i){if(n&1&&(a(0,"div",38)(1,"table",39)(2,"thead",40)(3,"tr")(4,"th",41),s(5,"#"),r(),a(6,"th",41),s(7,"Monto"),r(),a(8,"th",41),s(9,"Pagado"),r(),a(10,"th",41),s(11,"Pendiente"),r(),a(12,"th",41),s(13,"Vencimiento"),r(),a(14,"th",41),s(15,"Fecha Pago"),r(),a(16,"th",41),s(17,"Estado"),r(),a(18,"th",41),s(19,"M\xE9todo"),r(),a(20,"th",41),s(21,"Referencia"),r(),a(22,"th",41),s(23,"Acciones"),r()()(),a(24,"tbody",42),P(25,an,32,37,"tr",43),r()()()),n&2){let e=p();l(25),c("ngForOf",e.payments())}}var Et=class n{constructor(i,e,t){this.paymentService=i;this.interceptorService=e;this.dialog=t}contractId;currency="USD";payments=S([]);stats=S(null);loading=S(!1);generating=S(!1);Plus=lt;RefreshCw=ki;Edit=Ii;Trash2=st;X=$;DollarSign=Si;ngOnInit(){this.loadPayments(),this.loadStats()}loadPayments(){this.loading.set(!0),this.paymentService.getPayments(this.contractId).subscribe({next:i=>{this.payments.set(i),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar los pagos"})}})}loadStats(){this.paymentService.getPaymentStats(this.contractId).subscribe({next:i=>{console.log("Payment stats received:",i),this.stats.set(i)},error:()=>{}})}generatePayments(){confirm("\xBFGenerar todos los pagos del contrato? Esta acci\xF3n solo se puede realizar una vez.")&&(this.generating.set(!0),this.paymentService.generatePayments(this.contractId).subscribe({next:()=>{this.generating.set(!1),this.loadPayments(),this.loadStats(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pagos generados correctamente"})},error:i=>{this.generating.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:i.error?.message||"Error al generar pagos"})}}))}editPayment(i){this.dialog.open(Dt,{data:{payment:i,contractId:this.contractId,currency:this.currency}}).afterClosed().subscribe(t=>{t&&(this.loadPayments(),this.loadStats())})}cancelPayment(i){confirm(`\xBFCancelar el pago #${i.payment_number}?`)&&this.paymentService.cancelPayment(this.contractId,i.id).subscribe({next:()=>{this.loadPayments(),this.loadStats(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pago cancelado"})},error:e=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:e.error?.message||"No se pudo cancelar el pago"})}})}deletePayment(i){confirm(`\xBFEliminar permanentemente el pago #${i.payment_number}? Esta acci\xF3n no se puede deshacer.`)&&this.paymentService.deletePayment(this.contractId,i.id).subscribe({next:()=>{this.loadPayments(),this.loadStats(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pago eliminado"})},error:e=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:e.error?.message||"No se pudo eliminar el pago"})}})}getStatusClass(i){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{pendiente:"bg-yellow-100 text-yellow-800",pagado:"bg-green-100 text-green-800",parcial:"bg-blue-100 text-blue-800",vencido:"bg-red-100 text-red-800",cancelado:"bg-gray-100 text-gray-800"}[i]||"bg-gray-100 text-gray-800"}`}getStatusLabel(i){return{pendiente:"Pendiente",pagado:"Pagado",parcial:"Parcial",vencido:"Vencido",cancelado:"Cancelado"}[i]||i}canEdit(i){return i.status==="pendiente"||i.status==="vencido"}canDelete(i){return i.status!=="pagado"}canCancel(i){return i.status==="pendiente"||i.status==="vencido"}canRegisterPayment(i){return i.status==="pendiente"||i.status==="vencido"||i.status==="parcial"}registerPayment(i){this.dialog.open(Mt,{data:{payment:i,contractId:this.contractId,currency:this.currency}}).afterClosed().subscribe(t=>{t&&(this.loadPayments(),this.loadStats())})}static \u0275fac=function(e){return new(e||n)(f(Z),f(V),f(K))};static \u0275cmp=k({type:n,selectors:[["app-contract-payments"]],inputs:{contractId:"contractId",currency:"currency"},features:[j([O])],decls:10,vars:5,consts:[[1,"payments-container"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-base","font-semibold","text-gray-800"],[1,"flex","gap-2"],["text","Generar Pagos","custom_class","btn_primary","size","sm",3,"icon","loading","clicked",4,"ngIf"],["class","grid grid-cols-6 gap-3 mb-4",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","text-center py-8 text-gray-500",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["text","Generar Pagos","custom_class","btn_primary","size","sm",3,"clicked","icon","loading"],[1,"grid","grid-cols-6","gap-3","mb-4"],[1,"bg-blue-50","p-3","rounded-lg","border","border-blue-200"],[1,"text-xs","text-blue-600","font-medium"],[1,"text-lg","font-bold","text-blue-900"],[1,"text-sm","font-normal"],[1,"bg-green-50","p-3","rounded-lg","border","border-green-200"],[1,"text-xs","text-green-600","font-medium"],[1,"text-lg","font-bold","text-green-900"],[1,"text-xs","text-green-700"],["class","bg-green-50 p-3 rounded-lg border border-green-200",4,"ngIf"],["class","mt-1 space-y-0.5",4,"ngIf"],[1,"bg-yellow-50","p-3","rounded-lg","border","border-yellow-200"],[1,"text-xs","text-yellow-600","font-medium"],[1,"space-y-1"],[1,"text-lg","font-bold","text-yellow-900"],["class","text-xs text-orange-600",4,"ngIf"],[1,"text-xs","text-yellow-700","font-medium","mt-1"],[1,"bg-red-50","p-3","rounded-lg","border","border-red-200"],[1,"text-xs","text-red-600","font-medium"],[1,"text-lg","font-bold","text-red-900"],[1,"mt-1","space-y-0.5"],[1,"text-xs","text-blue-700"],[1,"text-xs","text-orange-600","font-medium"],[1,"text-xs","text-orange-600"],[1,"text-center","py-8"],[1,"text-sm","text-gray-500"],[1,"text-center","py-8","text-gray-500"],[1,"text-sm"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-3","py-2","text-left","text-xs","font-medium","text-gray-500","uppercase"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50"],[1,"px-3","py-2","text-sm","font-medium","text-gray-900"],[1,"px-3","py-2","text-sm","text-gray-900"],[1,"px-3","py-2","text-sm"],[1,"px-3","py-2","text-sm","text-gray-600"],[4,"ngIf"],["class","text-xs text-blue-600",4,"ngIf"],[1,"px-3","py-2"],[1,"flex","gap-1"],["class","p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors","title","Registrar Pago",3,"click",4,"ngIf"],["class","p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors","title","Editar",3,"click",4,"ngIf"],["class","p-1 text-orange-600 hover:bg-orange-50 rounded transition-colors","title","Cancelar",3,"click",4,"ngIf"],["class","p-1 text-red-600 hover:bg-red-50 rounded transition-colors","title","Eliminar",3,"click",4,"ngIf"],[1,"text-xs","text-blue-600"],["title","Registrar Pago",1,"p-1","text-blue-600","hover:bg-blue-50","rounded","transition-colors",3,"click"],[3,"img","size"],["title","Editar",1,"p-1","text-blue-600","hover:bg-blue-50","rounded","transition-colors",3,"click"],["title","Cancelar",1,"p-1","text-orange-600","hover:bg-orange-50","rounded","transition-colors",3,"click"],["title","Eliminar",1,"p-1","text-red-600","hover:bg-red-50","rounded","transition-colors",3,"click"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"h4",2),s(3,"Pagos del Contrato"),r(),a(4,"div",3),P(5,qo,1,2,"app-button",4),r()(),P(6,Xo,44,16,"div",5)(7,Qo,3,0,"div",6)(8,Yo,3,0,"div",7)(9,rn,26,1,"div",8),r()),e&2&&(l(5),c("ngIf",t.payments().length===0),l(),c("ngIf",t.stats()),l(),c("ngIf",t.loading()),l(),c("ngIf",!t.loading()&&t.payments().length===0),l(),c("ngIf",!t.loading()&&t.payments().length>0))},dependencies:[T,ke,L,F,N,z,re,_e],styles:["table[_ngcontent-%COMP%]{font-size:.875rem}"]})};var be=class n{constructor(i){this.http=i}api=Oe.api;getContracts(i){return this.http.get(`${this.api}/tenant/contracts`,{params:i})}getContract(i){return this.http.get(`${this.api}/tenant/contracts/${i}`)}getContractByNumber(i){return this.http.get(`${this.api}/tenant/contracts/by-number/${i}`)}getContractStats(){return this.http.get(`${this.api}/tenant/contracts/stats`)}createContract(i){return this.http.post(`${this.api}/tenant/contracts`,i)}updateContract(i,e){return this.http.put(`${this.api}/tenant/contracts/${i}`,e)}deleteContract(i){return this.http.delete(`${this.api}/tenant/contracts/${i}`)}static \u0275fac=function(e){return new(e||n)(Me(Ie))};static \u0275prov=Pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var sn=(n,i,e,t)=>({"bg-green-100 text-green-800":n,"bg-blue-100 text-blue-800":i,"bg-red-100 text-red-800":e,"bg-yellow-100 text-yellow-800":t});function dn(n,i){if(n&1){let e=D();a(0,"div",43)(1,"span",44),u("click",function(){x(e);let o=p();return C(o.navigateToCustomer())}),s(2),r()()}if(n&2){let e=p();l(2),g(" ",e.getCustomerName()," ")}}function cn(n,i){if(n&1&&(a(0,"span",45),s(1," \u24D8 "),r()),n&2){let e=p();c("matTooltip",e.getPendingBreakdown())}}function mn(n,i){if(n&1){let e=D();a(0,"span",46),u("click",function(){x(e);let o=p();return C(o.openPropertyModal())}),s(1),r()}if(n&2){let e=p();l(),g(" ",e.data.contract.property.code," ")}}function pn(n,i){n&1&&(a(0,"span",47),s(1,"\u2014"),r())}function un(n,i){if(n&1){let e=D();a(0,"app-button",48),u("clicked",function(){x(e);let o=p();return C(o.saveContract())}),r()}if(n&2){let e=p();c("loading",e.saving())}}var kt=class n{constructor(i,e,t,o,d,m,E,H,je){this.dialog=i;this.dialog_ref=e;this.data=t;this.router=o;this.propertyService=d;this.contractService=m;this.paymentService=E;this.interceptorService=H;this.fb=je;this.form=this.fb.group({contract_date:[this.data.contract.contract_date,y.required],total_price:[this.data.contract.total_price,[y.required,y.min(0)]],down_payment:[this.data.contract.down_payment,[y.required,y.min(0)]],remaining_balance:[{value:this.data.contract.remaining_balance,disabled:!0},[y.required,y.min(0)]],payment_months:[this.data.contract.payment_months,[y.required,y.min(0)]],monthly_payment:[{value:this.data.contract.monthly_payment,disabled:!0},[y.required,y.min(0)]],first_payment_date:[this.data.contract.first_payment_date,y.required],currency:[this.data.contract.currency||"USD",y.required],status:[this.data.contract.status,y.required],notes:[this.data.contract.notes||""]}),this.statusSelectConfig.form_control=this.form.get("status")}X=$;form;saving=S(!1);activeTab=S("edit");paymentStats=S(null);statusSelectConfig={placeholder:"Selecciona un estado",data:[{value:"activo",label:"Activo"},{value:"completado",label:"Completado"},{value:"cancelado",label:"Cancelado"},{value:"suspendido",label:"Suspendido"}],value:"value",option:"label",form_control:null};ngOnInit(){this.loadPaymentStats()}loadPaymentStats(){this.paymentService.getPaymentStats(this.data.contract.id).subscribe({next:i=>{this.paymentStats.set(i)},error:()=>{}})}getPendingBreakdown(){let i=this.paymentStats();if(!i)return"";let e=this.data.contract.currency||"USD",t=this.formatCurrency(this.data.contract.monthly_payment,e),o=i.partial_payment?this.formatCurrency(i.partial_payment.remaining_amount,e):"",d=this.formatCurrency(i.total_pending_amount,e),m=`${i.pending_full_payments} pagos \xD7 ${t}`;return i.partial_payment&&(m+=` + ${o} (pago parcial #${i.partial_payment.installment_number})`),m+=` = ${d}`,m}formatCurrency(i,e){return new Intl.NumberFormat("es-MX",{style:"currency",currency:e}).format(i)}setActiveTab(i){this.activeTab.set(i)}saveContract(){if(this.form.invalid){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Por favor completa todos los campos requeridos"});return}this.saving.set(!0),this.contractService.updateContract(this.data.contract.id,this.form.value).subscribe({next:()=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Contrato actualizado correctamente"}),this.dialog_ref.close(!0)},error:i=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:i.error?.message||"Error al actualizar el contrato"})}})}closeDialog(){this.dialog_ref.close()}navigateToCustomer(){this.data.contract.customer&&(this.dialog_ref.close(),this.router.navigate(["/customers/detail",this.data.contract.customer.id]))}openPropertyModal(){this.data.contract.property&&this.propertyService.getProperty(this.data.contract.property.id).subscribe({next:i=>{this.dialog.open(yt,{data:{property:i}})}})}getStatusClass(i){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{activo:"bg-green-100 text-green-800",completado:"bg-blue-100 text-blue-800",cancelado:"bg-red-100 text-red-800",suspendido:"bg-yellow-100 text-yellow-800"}[i]||"bg-gray-100 text-gray-800"}`}getStatusLabel(i){return{activo:"Activo",completado:"Completado",cancelado:"Cancelado",suspendido:"Suspendido"}[i]||i}getCustomerName(){return this.data.contract.customer?`${this.data.contract.customer.name} ${this.data.contract.customer.lastname}`:"\u2014"}static \u0275fac=function(e){return new(e||n)(f(K),f(Y),f(he),f(rt),f(Re),f(be),f(Z),f(V),f(de))};static \u0275cmp=k({type:n,selectors:[["app-contract-detail-modal"]],features:[j([O])],decls:110,vars:77,consts:[[1,"dialog"],[1,"dialog__header"],[1,"flex","items-center","gap-2"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium",3,"ngClass"],["class","mt-1",4,"ngIf"],[1,"close","cursor-pointer",3,"click","img"],[1,"tabs","px-6","pt-4"],[1,"tab",3,"click"],[1,"contract-summary","px-6","py-3","bg-gray-50","border-b","border-gray-200"],[1,"grid","grid-cols-7","gap-3","text-xs"],[1,"block","text-gray-500","font-medium","mb-0.5"],[1,"text-gray-900","font-semibold"],[1,"text-green-600","font-semibold"],[1,"flex","items-center","gap-1","text-gray-500","font-medium","mb-0.5"],["class","cursor-help text-gray-400 hover:text-gray-600","matTooltipPosition","above","matTooltipShowDelay","100",3,"matTooltip",4,"ngIf"],[1,"text-red-600","font-semibold"],[1,"dialog__body"],[1,"tab-content"],[1,"mb-2","p-1.5","bg-gray-50","rounded-lg","border","border-gray-200"],[1,"grid","grid-cols-2","gap-2","text-xs"],[1,"block","font-semibold","text-gray-500","mb-0.5"],[1,"text-gray-600"],[1,"space-y-2.5",3,"formGroup"],[1,"grid","grid-cols-2","gap-2.5"],[1,"block","text-xs","font-semibold","text-gray-500","mb-1"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-purple-100","text-purple-800"],["class","inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 cursor-pointer hover:bg-green-200 transition-colors",3,"click",4,"ngIf"],["class","text-gray-900",4,"ngIf"],["label","Fecha del Contrato",3,"form_control"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"config"],["label","Precio Total","type","number",3,"form_control"],["label","Enganche","type","number",3,"form_control"],["label","Saldo Pendiente","type","number",3,"form_control"],["label","Meses de Pago","type","number",3,"form_control"],["label","Pago Mensual","type","number",3,"form_control"],["label","Fecha Primer Pago",3,"form_control"],["label","Notas","type","textarea",3,"form_control"],[3,"contractId","currency"],[3,"contractId"],[1,"dialog__footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Guardar Cambios","custom_class","btn_primary",3,"loading","clicked",4,"ngIf"],[1,"mt-1"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-blue-100","text-blue-800","cursor-pointer","hover:bg-blue-200","transition-colors",3,"click"],["matTooltipPosition","above","matTooltipShowDelay","100",1,"cursor-help","text-gray-400","hover:text-gray-600",3,"matTooltip"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-green-100","text-green-800","cursor-pointer","hover:bg-green-200","transition-colors",3,"click"],[1,"text-gray-900"],["text","Guardar Cambios","custom_class","btn_primary",3,"clicked","loading"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"div")(3,"div",2)(4,"h2"),s(5),r(),a(6,"span",3),s(7),v(8,"titlecase"),r()(),P(9,dn,3,1,"div",4),r(),a(10,"lucide-icon",5),u("click",function(){return t.closeDialog()}),r()(),a(11,"div",6)(12,"button",7),u("click",function(){return t.setActiveTab("edit")}),s(13," Editar "),r(),a(14,"button",7),u("click",function(){return t.setActiveTab("payments")}),s(15," Pagos "),r(),a(16,"button",7),u("click",function(){return t.setActiveTab("documents")}),s(17," Documentos "),r()(),a(18,"div",8)(19,"div",9)(20,"div")(21,"span",10),s(22,"Fecha Contrato"),r(),a(23,"span",11),s(24),v(25,"localDate"),r()(),a(26,"div")(27,"span",10),s(28,"Precio Total"),r(),a(29,"span",11),s(30),v(31,"currency"),r()(),a(32,"div")(33,"span",10),s(34,"Enganche"),r(),a(35,"span",11),s(36),v(37,"currency"),r()(),a(38,"div")(39,"span",10),s(40,"Total Pagado"),r(),a(41,"span",12),s(42),v(43,"currency"),r()(),a(44,"div")(45,"span",13),s(46," Saldo Pendiente "),P(47,cn,2,1,"span",14),r(),a(48,"span",15),s(49),v(50,"currency"),r()(),a(51,"div")(52,"span",10),s(53,"Meses de Pago"),r(),a(54,"span",11),s(55),r()(),a(56,"div")(57,"span",10),s(58,"Pago Mensual"),r(),a(59,"span",11),s(60),v(61,"currency"),r()()()(),a(62,"div",16)(63,"div",17)(64,"div",18)(65,"div",19)(66,"div")(67,"span",20),s(68,"Creado"),r(),a(69,"span",21),s(70),v(71,"date"),r()(),a(72,"div")(73,"span",20),s(74,"Actualizado"),r(),a(75,"span",21),s(76),v(77,"date"),r()()()(),a(78,"div",22)(79,"div",23)(80,"div")(81,"span",24),s(82,"N\xFAmero de Contrato"),r(),a(83,"span",25),s(84),r()(),a(85,"div")(86,"span",24),s(87,"Lote"),r(),P(88,mn,2,1,"span",26)(89,pn,2,0,"span",27),r()(),a(90,"div",23),_(91,"app-input",28),a(92,"div")(93,"label",29),s(94,"Estado"),r(),_(95,"app-select",30),r(),_(96,"app-input",31)(97,"app-input",32)(98,"app-input",33)(99,"app-input",34)(100,"app-input",35)(101,"app-input",36),r(),_(102,"app-input",37),r()(),a(103,"div",17),_(104,"app-contract-payments",38),r(),a(105,"div",17),_(106,"app-contract-documents",39),r()(),a(107,"div",40)(108,"app-button",41),u("clicked",function(){return t.closeDialog()}),r(),P(109,un,1,1,"app-button",42),r()()),e&2&&(M("dialog--wide",t.activeTab()==="payments"),l(5),g("Contrato ",t.data.contract.contract_number),l(),c("ngClass",gi(72,sn,t.data.contract.status==="activo",t.data.contract.status==="completado",t.data.contract.status==="cancelado",t.data.contract.status==="suspendido")),l(),g(" ",_i(8,46,t.data.contract.status)," "),l(2),c("ngIf",t.data.contract.customer),l(),c("img",t.X),l(2),M("active",t.activeTab()==="edit"),l(2),M("active",t.activeTab()==="payments"),l(2),M("active",t.activeTab()==="documents"),l(8),b(w(25,48,t.data.contract.contract_date,"mediumDate")),l(6),b(w(31,51,t.data.contract.total_price,t.data.contract.currency)),l(6),b(w(37,54,t.data.contract.down_payment,t.data.contract.currency)),l(6),b(w(43,57,t.data.contract.total_price-t.data.contract.remaining_balance,t.data.contract.currency)),l(5),c("ngIf",t.paymentStats()),l(2),b(w(50,60,t.data.contract.remaining_balance,t.data.contract.currency)),l(6),g("",t.data.contract.payment_months," meses"),l(5),b(w(61,63,t.data.contract.monthly_payment,t.data.contract.currency)),l(3),M("active",t.activeTab()==="edit"),l(7),b(w(71,66,t.data.contract.created_at,"medium")),l(6),b(w(77,69,t.data.contract.updated_at,"medium")),l(2),c("formGroup",t.form),l(6),g(" ",t.data.contract.contract_number," "),l(4),c("ngIf",t.data.contract.property),l(),c("ngIf",!t.data.contract.property),l(2),c("form_control",t.form.controls.contract_date),l(4),c("config",t.statusSelectConfig),l(),c("form_control",t.form.controls.total_price),l(),c("form_control",t.form.controls.down_payment),l(),c("form_control",t.form.controls.remaining_balance),l(),c("form_control",t.form.controls.payment_months),l(),c("form_control",t.form.controls.monthly_payment),l(),c("form_control",t.form.controls.first_payment_date),l(),c("form_control",t.form.controls.notes),l(),M("active",t.activeTab()==="payments"),l(),c("contractId",t.data.contract.id)("currency",t.data.contract.currency),l(),M("active",t.activeTab()==="documents"),l(),c("contractId",t.data.contract.id),l(3),c("ngIf",t.activeTab()==="edit"))},dependencies:[T,vi,L,ce,le,se,F,me,Ae,N,z,lo,jt,wt,Et,yi,re,O,_e],styles:[".dialog[_ngcontent-%COMP%]{width:90vw;max-width:1400px;height:90vh;max-height:95vh;margin:.5rem auto;display:flex;flex-direction:column;transition:max-width .3s ease}.dialog.dialog--wide[_ngcontent-%COMP%]{max-width:1400px}.dialog__header[_ngcontent-%COMP%]{padding:.75rem 1rem;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}.dialog__header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:600;color:#111827}.dialog__header[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{cursor:pointer;color:#6b7280;transition:color .2s}.dialog__header[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover{color:#111827}.dialog__body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:.5rem 1rem;min-height:0}.dialog__footer[_ngcontent-%COMP%]{padding:.625rem 1rem;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;gap:.625rem;flex-shrink:0}.tabs[_ngcontent-%COMP%]{display:flex;border-bottom:2px solid #e5e7eb;margin-bottom:.625rem;gap:.25rem;flex-shrink:0}.tab[_ngcontent-%COMP%]{padding:.5rem .75rem;font-size:.875rem;font-weight:500;color:#6b7280;background:none;border:none;border-bottom:2px solid transparent;margin-bottom:-2px;cursor:pointer;transition:all .2s}.tab[_ngcontent-%COMP%]:hover{color:#111827}.tab.active[_ngcontent-%COMP%]{color:#6366f1;border-bottom-color:#6366f1}.tab-content[_ngcontent-%COMP%]{display:none}.tab-content.active[_ngcontent-%COMP%]{display:block}"]})};var po=(()=>{class n{_animationsDisabled=fe();state="unchecked";disabled=!1;appearance="full";constructor(){}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=k({type:n,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:12,hostBindings:function(t,o){t&2&&M("mat-pseudo-checkbox-indeterminate",o.state==="indeterminate")("mat-pseudo-checkbox-checked",o.state==="checked")("mat-pseudo-checkbox-disabled",o.disabled)("mat-pseudo-checkbox-minimal",o.appearance==="minimal")("mat-pseudo-checkbox-full",o.appearance==="full")("_mat-animation-noopable",o._animationsDisabled)},inputs:{state:"state",disabled:"disabled",appearance:"appearance"},decls:0,vars:0,template:function(t,o){},styles:[`.mat-pseudo-checkbox{border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox._mat-animation-noopable{transition:none !important;animation:none !important}.mat-pseudo-checkbox._mat-animation-noopable::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{left:1px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{left:1px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-pseudo-checkbox-minimal-selected-checkmark-color, var(--mat-sys-primary))}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-pseudo-checkbox-minimal-disabled-selected-checkmark-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full{border-color:var(--mat-pseudo-checkbox-full-unselected-icon-color, var(--mat-sys-on-surface-variant));border-width:2px;border-style:solid}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-disabled{border-color:var(--mat-pseudo-checkbox-full-disabled-unselected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate{background-color:var(--mat-pseudo-checkbox-full-selected-icon-color, var(--mat-sys-primary));border-color:rgba(0,0,0,0)}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{color:var(--mat-pseudo-checkbox-full-selected-checkmark-color, var(--mat-sys-on-primary))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled{background-color:var(--mat-pseudo-checkbox-full-disabled-selected-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked.mat-pseudo-checkbox-disabled::after,.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate.mat-pseudo-checkbox-disabled::after{color:var(--mat-pseudo-checkbox-full-disabled-selected-checkmark-color, var(--mat-sys-surface))}.mat-pseudo-checkbox{width:18px;height:18px}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-checked::after{width:14px;height:6px;transform-origin:center;top:-4.2426406871px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-minimal.mat-pseudo-checkbox-indeterminate::after{top:8px;width:16px}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-checked::after{width:10px;height:4px;transform-origin:center;top:-2.8284271247px;left:0;bottom:0;right:0;margin:auto}.mat-pseudo-checkbox-full.mat-pseudo-checkbox-indeterminate::after{top:6px;width:12px}
`],encapsulation:2,changeDetection:0})}return n})();var hn=["text"],gn=[[["mat-icon"]],"*"],_n=["mat-icon","*"];function bn(n,i){if(n&1&&_(0,"mat-pseudo-checkbox",1),n&2){let e=p();c("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function vn(n,i){if(n&1&&_(0,"mat-pseudo-checkbox",3),n&2){let e=p();c("disabled",e.disabled)}}function yn(n,i){if(n&1&&(a(0,"span",4),s(1),r()),n&2){let e=p();l(),g("(",e.group.label,")")}}var qt=new q("MAT_OPTION_PARENT_COMPONENT"),Gt=new q("MatOptgroup");var Xe=class{source;isUserInput;constructor(i,e=!1){this.source=i,this.isUserInput=e}},Ve=(()=>{class n{_element=h(W);_changeDetectorRef=h(ae);_parent=h(qt,{optional:!0});group=h(Gt,{optional:!0});_signalDisableRipple=!1;_selected=!1;_active=!1;_mostRecentViewValue="";get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}value;id=h(pt).getId("mat-option-");get disabled(){return this.group&&this.group.disabled||this._disabled()}set disabled(e){this._disabled.set(e)}_disabled=S(!1);get disableRipple(){return this._signalDisableRipple?this._parent.disableRipple():!!this._parent?.disableRipple}get hideSingleSelectionIndicator(){return!!(this._parent&&this._parent.hideSingleSelectionIndicator)}onSelectionChange=new ye;_text;_stateChanges=new G;constructor(){let e=h(Vi);e.load(eo),e.load(Bi),this._signalDisableRipple=!!this._parent&&di(this._parent.disableRipple)}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(e=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}deselect(e=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}focus(e,t){let o=this._getHostElement();typeof o.focus=="function"&&o.focus(t)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(e.keyCode===13||e.keyCode===32)&&!pe(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=this.multiple?!this._selected:!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){let e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=e)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new Xe(this,e))}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=k({type:n,selectors:[["mat-option"]],viewQuery:function(t,o){if(t&1&&X(hn,7),t&2){let d;A(d=R())&&(o._text=d.first)}},hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(t,o){t&1&&u("click",function(){return o._selectViaInteraction()})("keydown",function(m){return o._handleKeydown(m)}),t&2&&(nt("id",o.id),ne("aria-selected",o.selected)("aria-disabled",o.disabled.toString()),M("mdc-list-item--selected",o.selected)("mat-mdc-option-multiple",o.multiple)("mat-mdc-option-active",o.active)("mdc-list-item--disabled",o.disabled))},inputs:{value:"value",id:"id",disabled:[2,"disabled","disabled",te]},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["matOption"],ngContentSelectors:_n,decls:8,vars:5,consts:[["text",""],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],[1,"mdc-list-item__primary-text"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"]],template:function(t,o){t&1&&(at(gn),J(0,bn,1,2,"mat-pseudo-checkbox",1),Ue(1),a(2,"span",2,0),Ue(4,1),r(),J(5,vn,1,1,"mat-pseudo-checkbox",3),J(6,yn,2,1,"span",4),_(7,"div",5)),t&2&&(ee(o.multiple?0:-1),l(5),ee(!o.multiple&&o.selected&&!o.hideSingleSelectionIndicator?5:-1),l(),ee(o.group&&o.group._inert?6:-1),l(),c("matRippleTrigger",o._getHostElement())("matRippleDisabled",o.disabled||o.disableRipple))},dependencies:[po,Ji],styles:[`.mat-mdc-option{-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;min-height:48px;padding:0 16px;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-option-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mat-option-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mat-option-label-text-size, var(--mat-sys-body-large-size));letter-spacing:var(--mat-option-label-text-tracking, var(--mat-sys-label-large-tracking));font-weight:var(--mat-option-label-text-weight, var(--mat-sys-body-large-weight))}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));outline:0}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-active,.mat-mdc-option-multiple,:focus,:hover){background-color:var(--mat-option-selected-state-layer-color, var(--mat-sys-secondary-container))}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-active,.mat-mdc-option-multiple,:focus,:hover) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option .mat-pseudo-checkbox{--mat-pseudo-checkbox-minimal-selected-checkmark-color: var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option.mdc-list-item{align-items:center;background:rgba(0,0,0,0)}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}@media(forced-colors: active){.mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{right:auto;left:16px}}.mat-mdc-option-multiple{--mat-list-list-item-selected-container-color: var(--mat-list-list-item-container-color, transparent)}.mat-mdc-option-active .mat-focus-indicator::before{content:""}
`],encapsulation:2,changeDetection:0})}return n})();function uo(n,i,e){if(e.length){let t=i.toArray(),o=e.toArray(),d=0;for(let m=0;m<n+1;m++)t[m].group&&t[m].group===o[d]&&d++;return d}return 0}function fo(n,i,e,t){return n<e?n:n+i>e+t?Math.max(0,n-t+i):e}var ho=new q("MatFormField");var go=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=oe({type:n});static \u0275inj=ie({imports:[ue]})}return n})();var Ut=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=oe({type:n});static \u0275inj=ie({imports:[to,go,Ve,ue]})}return n})();var Sn=["panel"],wn=["*"];function Pn(n,i){if(n&1&&(Ee(0,"div",1,0),Ue(2),Ge()),n&2){let e=i.id,t=p();Q(t._classList),M("mat-mdc-autocomplete-visible",t.showPanel)("mat-mdc-autocomplete-hidden",!t.showPanel)("mat-autocomplete-panel-animations-enabled",!t._animationsDisabled)("mat-primary",t._color==="primary")("mat-accent",t._color==="accent")("mat-warn",t._color==="warn"),nt("id",t.id),ne("aria-label",t.ariaLabel||null)("aria-labelledby",t._getPanelAriaLabelledby(e))}}var Wt=class{source;option;constructor(i,e){this.source=i,this.option=e}},bo=new q("mat-autocomplete-default-options",{providedIn:"root",factory:()=>({autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1,hasBackdrop:!1})}),vo=(()=>{class n{_changeDetectorRef=h(ae);_elementRef=h(W);_defaults=h(bo);_animationsDisabled=fe();_activeOptionChanges=Je.EMPTY;_keyManager;showPanel=!1;get isOpen(){return this._isOpen&&this.showPanel}_isOpen=!1;_latestOpeningTrigger;_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}_color;template;panel;options;optionGroups;ariaLabel;ariaLabelledby;displayWith=null;autoActiveFirstOption;autoSelectActiveOption;requireSelection;panelWidth;disableRipple=!1;optionSelected=new ye;opened=new ye;closed=new ye;optionActivated=new ye;set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}_classList;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator;_syncParentProperties(){if(this.options)for(let e of this.options)e._changeDetectorRef.markForCheck()}id=h(pt).getId("mat-autocomplete-");inertGroups;constructor(){let e=h(mt);this.inertGroups=e?.SAFARI||!1,this.autoActiveFirstOption=!!this._defaults.autoActiveFirstOption,this.autoSelectActiveOption=!!this._defaults.autoSelectActiveOption,this.requireSelection=!!this._defaults.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new Gi(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options?.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){let t=new Wt(this,e);this.optionSelected.emit(t)}_getPanelAriaLabelledby(e){if(this.ariaLabel)return null;let t=e?e+" ":"";return this.ariaLabelledby?t+this.ariaLabelledby:e}_skipPredicate(){return!1}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=k({type:n,selectors:[["mat-autocomplete"]],contentQueries:function(t,o,d){if(t&1&&mi(d,Ve,5)(d,Gt,5),t&2){let m;A(m=R())&&(o.options=m),A(m=R())&&(o.optionGroups=m)}},viewQuery:function(t,o){if(t&1&&X(ri,7)(Sn,5),t&2){let d;A(d=R())&&(o.template=d.first),A(d=R())&&(o.panel=d.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[2,"autoActiveFirstOption","autoActiveFirstOption",te],autoSelectActiveOption:[2,"autoSelectActiveOption","autoSelectActiveOption",te],requireSelection:[2,"requireSelection","requireSelection",te],panelWidth:"panelWidth",disableRipple:[2,"disableRipple","disableRipple",te],classList:[0,"class","classList"],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",te]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[j([{provide:qt,useExisting:n}])],ngContentSelectors:wn,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(t,o){t&1&&(at(),si(0,Pn,3,17,"ng-template"))},styles:[`div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:relative;border-radius:var(--mat-autocomplete-container-shape, var(--mat-sys-corner-extra-small));box-shadow:var(--mat-autocomplete-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));background-color:var(--mat-autocomplete-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-autocomplete-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden,.cdk-overlay-pane:has(>.mat-mdc-autocomplete-hidden){visibility:hidden;pointer-events:none}@keyframes _mat-autocomplete-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}.mat-autocomplete-panel-animations-enabled{animation:_mat-autocomplete-enter 120ms cubic-bezier(0, 0, 0.2, 1)}mat-autocomplete{display:none}
`],encapsulation:2,changeDetection:0})}return n})();var Mn={provide:Ti,useExisting:ti(()=>Be),multi:!0};var Dn=new q("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let n=h(De);return()=>gt(n)}}),Be=(()=>{class n{_environmentInjector=h(ii);_element=h(W);_injector=h(De);_viewContainerRef=h(it);_zone=h($e);_changeDetectorRef=h(ae);_dir=h(ft,{optional:!0});_formField=h(ho,{optional:!0,host:!0});_viewportRuler=h(Xi);_scrollStrategy=h(Dn);_renderer=h(qe);_animationsDisabled=fe();_defaults=h(bo,{optional:!0});_overlayRef=null;_portal;_componentDestroyed=!1;_initialized=new G;_keydownSubscription;_outsideClickSubscription;_cleanupWindowBlur;_previousValue=null;_valueOnAttach=null;_valueOnLastKeydown=null;_positionStrategy;_manuallyFloatingLabel=!1;_closingActionsSubscription;_viewportSubscription=Je.EMPTY;_breakpointObserver=h(Hi);_handsetLandscapeSubscription=Je.EMPTY;_canOpenOnNextFocus=!0;_valueBeforeAutoSelection;_pendingAutoselectedOption=null;_closeKeyEventStream=new G;_overlayPanelClass=ji(this._defaults?.overlayPanelClass||[]);_windowBlurHandler=()=>{this._canOpenOnNextFocus=this.panelOpen||!this._hasFocus()};_onChange=()=>{};_onTouched=()=>{};autocomplete;position="auto";connectedTo;autocompleteAttribute="off";autocompleteDisabled=!1;constructor(){}_aboveClass="mat-mdc-autocomplete-panel-above";ngAfterViewInit(){this._initialized.next(),this._initialized.complete(),this._cleanupWindowBlur=this._renderer.listen("window","blur",this._windowBlurHandler)}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){this._cleanupWindowBlur?.(),this._handsetLandscapeSubscription.unsubscribe(),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}_overlayAttached=!1;openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&ut(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return et(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Rt(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Rt(()=>this._overlayAttached)):Ft()).pipe(Xt(e=>e instanceof Xe?e:null))}optionSelections=Qt(()=>{let e=this.autocomplete?this.autocomplete.options:null;return e?e.changes.pipe(ve(e),tt(()=>et(...e.map(t=>t.onSelectionChange)))):this._initialized.pipe(tt(()=>this.optionSelections))});get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return new Tt(e=>{let t=d=>{let m=zi(d),E=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,H=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;this._overlayAttached&&m!==this._element.nativeElement&&!this._hasFocus()&&(!E||!E.contains(m))&&(!H||!H.contains(m))&&this._overlayRef&&!this._overlayRef.overlayElement.contains(m)&&e.next(d)},o=[this._renderer.listen("document","click",t),this._renderer.listen("document","auxclick",t),this._renderer.listen("document","touchend",t)];return()=>{o.forEach(d=>d())}})}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){let t=e,o=t.keyCode,d=pe(t);if(o===27&&!d&&t.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&o===13&&this.panelOpen&&!d)this.activeOption._selectViaInteraction(),this._resetActiveItem(),t.preventDefault();else if(this.autocomplete){let m=this.autocomplete._keyManager.activeItem,E=o===38||o===40;o===9||E&&!d&&this.panelOpen?this.autocomplete._keyManager.onKeydown(t):E&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(E||this.autocomplete._keyManager.activeItem!==m)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let t=e.target,o=t.value;if(t.type==="number"&&(o=o==""?null:parseFloat(o)),this._previousValue!==o){if(this._previousValue=o,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(o),!o)this._clearPreviousSelectedOption(null,!1);else if(this.panelOpen&&!this.autocomplete.requireSelection){let d=this.autocomplete.options?.find(m=>m.selected);if(d){let m=this._getDisplayValue(d.value);o!==m&&d.deselect(!1)}}if(this._canOpen()&&this._hasFocus()){let d=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(d)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_hasFocus(){return Li()===this._element.nativeElement}_floatLabel(e=!1){this._formField&&this._formField.floatLabel==="auto"&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){let e=new Tt(o=>{He(()=>{o.next()},{injector:this._environmentInjector})}),t=this.autocomplete.options?.changes.pipe(ei(()=>this._positionStrategy.reapplyLastPosition()),Jt(0))??Ft();return et(e,t).pipe(tt(()=>this._zone.run(()=>{let o=this.panelOpen;return this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),o!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit()),this.panelClosingActions})),Zt(1)).subscribe(o=>this._setValueAndClose(o))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){let t=this.autocomplete;return t&&t.displayWith?t.displayWith(e):e}_assignOptionValue(e){let t=this._getDisplayValue(e);e==null&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(t??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){let t=this.autocomplete,o=e?e.source:this._pendingAutoselectedOption;o?(this._clearPreviousSelectedOption(o),this._assignOptionValue(o.value),this._onChange(o.value),t._emitSelectEvent(o),this._element.nativeElement.focus()):t.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,t){this.autocomplete?.options?.forEach(o=>{o!==e&&o.selected&&o.deselect(t)})}_openPanelInternal(e=this._element.nativeElement.value){if(this._attachOverlay(e),this._floatLabel(),this._trackedModal){let t=this.autocomplete.id;Vt(this._trackedModal,"aria-owns",t)}}_attachOverlay(e){if(!this.autocomplete)return;let t=this._overlayRef;t?(this._positionStrategy.setOrigin(this._getConnectedElement()),t.updateSize({width:this._getPanelWidth()})):(this._portal=new Yi(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),t=bt(this._injector,this._getOverlayConfig()),this._overlayRef=t,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&t&&t.updateSize({width:this._getPanelWidth()})}),this._handsetLandscapeSubscription=this._breakpointObserver.observe(Zi.HandsetLandscape).subscribe(d=>{d.matches?this._positionStrategy.withFlexibleDimensions(!0).withGrowAfterOpen(!0).withViewportMargin(8):this._positionStrategy.withFlexibleDimensions(!1).withGrowAfterOpen(!1).withViewportMargin(0)})),t&&!t.hasAttached()&&(t.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());let o=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&o!==this.panelOpen&&this._emitOpened()}_handlePanelKeydown=e=>{(e.keyCode===27&&!pe(e)||e.keyCode===38&&pe(e,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),e.stopPropagation(),e.preventDefault())};_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){let e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=void 0}_getOverlayConfig(){return new Ki({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,hasBackdrop:this._defaults?.hasBackdrop,backdropClass:this._defaults?.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:this._overlayPanelClass,disableAnimations:this._animationsDisabled})}_getOverlayPosition(){let e=_t(this._injector,this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1).withPopoverLocation("inline");return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){let t=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],o=this._aboveClass,d=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:o},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:o}],m;this.position==="above"?m=d:this.position==="below"?m=t:m=[...t,...d],e.withPositions(m)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){let e=this.autocomplete;if(e.autoActiveFirstOption){let t=-1;for(let o=0;o<e.options.length;o++)if(!e.options.get(o).disabled){t=o;break}e._keyManager.setActiveItem(t)}else e._keyManager.setActiveItem(-1)}_canOpen(){let e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_scrollToOption(e){let t=this.autocomplete,o=uo(e,t.options,t.optionGroups);if(e===0&&o===1)t._setScrollTop(0);else if(t.panel){let d=t.options.toArray()[e];if(d){let m=d._getHostElement(),E=fo(m.offsetTop,m.offsetHeight,t._getScrollTop(),t.panel.nativeElement.offsetHeight);t._setScrollTop(E)}}}_trackedModal=null;_applyModalPanelOwnership(){let e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;let t=this.autocomplete.id;this._trackedModal&&ut(this._trackedModal,"aria-owns",t),Vt(e,"aria-owns",t),this._trackedModal=e}_clearFromModal(){if(this._trackedModal){let e=this.autocomplete.id;ut(this._trackedModal,"aria-owns",e),this._trackedModal=null}}static \u0275fac=function(t){return new(t||n)};static \u0275dir=ot({type:n,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(t,o){t&1&&u("focusin",function(){return o._handleFocus()})("blur",function(){return o._onTouched()})("input",function(m){return o._handleInput(m)})("keydown",function(m){return o._handleKeydown(m)})("click",function(){return o._handleClick()}),t&2&&ne("autocomplete",o.autocompleteAttribute)("role",o.autocompleteDisabled?null:"combobox")("aria-autocomplete",o.autocompleteDisabled?null:"list")("aria-activedescendant",o.panelOpen&&o.activeOption?o.activeOption.id:null)("aria-expanded",o.autocompleteDisabled?null:o.panelOpen.toString())("aria-controls",o.autocompleteDisabled||!o.panelOpen||o.autocomplete==null?null:o.autocomplete.id)("aria-haspopup",o.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[0,"matAutocomplete","autocomplete"],position:[0,"matAutocompletePosition","position"],connectedTo:[0,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[0,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[2,"matAutocompleteDisabled","autocompleteDisabled",te]},exportAs:["matAutocompleteTrigger"],features:[j([Mn]),ni]})}return n})(),yo=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=oe({type:n});static \u0275inj=ie({imports:[vt,Ut,ht,Ut,ue]})}return n})();var kn=["customerAutocompleteTrigger"],In=["propertyAutocompleteTrigger"],On=["modalBody"];function Tn(n,i){n&1&&(a(0,"span",15),s(1,"*"),r())}function Fn(n,i){n&1&&(a(0,"p",18),s(1," Selecciona un cliente "),r())}function An(n,i){if(n&1){let e=D();a(0,"mat-option",37),u("onSelectionChange",function(){let o=x(e).$implicit,d=p();return C(d.onCustomerSelected(o))}),s(1),r()}if(n&2){let e=i.$implicit,t=p();c("value",e),l(),g(" ",t.displayCustomer(e)," ")}}function Rn(n,i){n&1&&(a(0,"mat-option",38)(1,"span",39),s(2,"No se encontraron clientes"),r()())}function Ln(n,i){n&1&&(a(0,"span",15),s(1,"*"),r())}function zn(n,i){n&1&&(a(0,"p",26),s(1," Selecciona un lote "),r())}function Nn(n,i){if(n&1){let e=D();a(0,"mat-option",37),u("onSelectionChange",function(){let o=x(e).$implicit,d=p();return C(d.onPropertySelected(o))}),s(1),r()}if(n&2){let e=i.$implicit,t=p();c("value",e),l(),g(" ",t.displayProperty(e)," ")}}function Vn(n,i){n&1&&(a(0,"mat-option",38)(1,"span",39),s(2,"No hay lotes disponibles"),r()())}var It=class n{constructor(i,e,t,o,d,m,E){this.fb=i;this.dialogRef=e;this.contractService=t;this.customerService=o;this.propertyService=d;this.interceptorService=m;this.dialog=E;this.form=this.fb.group({customer_search:[""],customer_id:[null,y.required],property_search:[""],property_id:["",y.required],contract_number:["",y.required],contract_date:[this.getTodayDate(),y.required],total_price:[0,[y.required,y.min(0)]],down_payment:[0,[y.required,y.min(0)]],payment_months:[1,[y.required,y.min(1)]],first_payment_date:["",y.required],currency:["MXN",y.required],status:["activo",y.required],notes:[""],remaining_balance:[{value:0,disabled:!0}],monthly_payment:[{value:0,disabled:!0}]}),this.currencySelectConfig.form_control=this.form.get("currency"),this.statusSelectConfig.form_control=this.form.get("status")}X=$;customerAutocompleteTrigger;propertyAutocompleteTrigger;modalBody;loading=S(!1);customers=S([]);filteredCustomers=S([]);properties=S([]);filteredProperties=S([]);formattedRemainingBalance=S("0.00");formattedMonthlyPayment=S("0.00");form;currencySelectConfig={placeholder:"Selecciona una moneda",data:[{value:"MXN",label:"MXN - Peso Mexicano"},{value:"USD",label:"USD - D\xF3lar"},{value:"EUR",label:"EUR - Euro"}],value:"value",option:"label",form_control:null};statusSelectConfig={placeholder:"Selecciona un estado",data:[{value:"activo",label:"Activo"},{value:"completado",label:"Completado"},{value:"cancelado",label:"Cancelado"},{value:"suspendido",label:"Suspendido"}],value:"value",option:"label",form_control:null};ngOnInit(){this.initializeForm(),this.setupCalculations(),this.loadInitialData()}ngAfterViewInit(){this.modalBody&&Kt(this.modalBody.nativeElement,"scroll").subscribe(()=>{this.customerAutocompleteTrigger?.panelOpen&&this.customerAutocompleteTrigger.closePanel(),this.propertyAutocompleteTrigger?.panelOpen&&this.propertyAutocompleteTrigger.closePanel()})}getTodayDate(){let i=new Date,e=i.getFullYear(),t=String(i.getMonth()+1).padStart(2,"0"),o=String(i.getDate()).padStart(2,"0");return`${e}-${t}-${o}`}initializeForm(){this.form.get("customer_search").valueChanges.pipe(Lt(300),zt()).subscribe(i=>{this.filterCustomers(i||"")}),this.form.get("property_search").valueChanges.pipe(Lt(300),zt()).subscribe(i=>{this.filterProperties(i||"")})}setupCalculations(){At([this.form.get("total_price").valueChanges.pipe(ve(this.form.get("total_price").value)),this.form.get("down_payment").valueChanges.pipe(ve(this.form.get("down_payment").value))]).subscribe(()=>{this.calculateRemainingBalance()}),At([this.form.get("remaining_balance").valueChanges.pipe(ve(this.form.get("remaining_balance").value)),this.form.get("payment_months").valueChanges.pipe(ve(this.form.get("payment_months").value))]).subscribe(()=>{this.calculateMonthlyPayment()})}loadInitialData(){Yt({customers:this.customerService.getCustomers({limit:100}),properties:this.propertyService.getProperties({status:"disponible",limit:100})}).subscribe({next:({customers:i,properties:e})=>{let t=[];i.data?t=i.data:Array.isArray(i)?t=i:i.results&&(t=i.results),this.customers.set(t),this.filteredCustomers.set(t);let o=[];e.data?o=e.data:Array.isArray(e)?o=e:e.results&&(o=e.results),this.properties.set(o),this.filteredProperties.set(o)},error:i=>{console.error("Error loading initial data:",i),this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar los datos iniciales"})}})}loadCustomers(){this.customerService.getCustomers({limit:100}).subscribe({next:i=>{let e=[];i.data?e=i.data:Array.isArray(i)?e=i:i.results&&(e=i.results),this.customers.set(e),this.filteredCustomers.set(e)},error:i=>{console.error("Error loading customers:",i),this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar los clientes"})}})}loadAvailableProperties(){this.propertyService.getProperties({status:"disponible"}).subscribe({next:i=>{let e=i.data||i;this.properties.set(e),this.filteredProperties.set(e)},error:()=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar las propiedades"})}})}filterCustomers(i){if(!i||i.trim().length===0){this.customerService.getCustomers({limit:100}).subscribe({next:e=>{let t=[];e.data?t=e.data:Array.isArray(e)?t=e:e.results&&(t=e.results),this.filteredCustomers.set(t)},error:e=>{console.error("Error loading customers:",e)}});return}this.customerService.getCustomers({search:i.trim(),limit:100}).subscribe({next:e=>{let t=[];e.data?t=e.data:Array.isArray(e)?t=e:e.results&&(t=e.results),this.filteredCustomers.set(t)},error:e=>{console.error("Error searching customers:",e),this.filteredCustomers.set([])}})}filterProperties(i){if(!i||i.trim().length===0){this.filteredProperties.set(this.properties());return}let e=i.toLowerCase(),t=this.properties().filter(o=>o.code.toLowerCase().includes(e)||o.name.toLowerCase().includes(e)||o.block.toLowerCase().includes(e));this.filteredProperties.set(t)}onCustomerSelected(i){this.form.patchValue({customer_id:i.id})}onPropertySelected(i){this.form.patchValue({property_id:i.id,total_price:i.total_price})}openCreateCustomerModal(){this.dialog.open(no,{width:"600px",data:{customer:null}}).afterClosed().subscribe(e=>{e&&this.loadCustomers()})}calculateRemainingBalance(){let i=this.form.get("total_price").value||0,e=this.form.get("down_payment").value||0,t=i-e;this.form.get("remaining_balance").setValue(t,{emitEvent:!0}),this.formattedRemainingBalance.set(this.formatNumber(t))}calculateMonthlyPayment(){let i=this.form.get("remaining_balance").value||0,e=this.form.get("payment_months").value||1,t=e>0?i/e:0;this.form.get("monthly_payment").setValue(t,{emitEvent:!1}),this.formattedMonthlyPayment.set(this.formatNumber(t))}displayCustomer(i){return i?`${i.name} ${i.lastname} (${i.email})`:""}displayProperty(i){return i?`${i.code} - ${i.name} (Mz: ${i.block}, ${i.total_price.toLocaleString()})`:""}formatNumber(i){return i==null||isNaN(i)?"0":i.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})}submit(){if(this.form.invalid){this.form.markAllAsTouched(),this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Completa todos los campos obligatorios"});return}let i=this.form.get("total_price").value;if(this.form.get("down_payment").value>i){this.interceptorService.openSnackbar({type:"error",title:"Error",message:"El enganche no puede ser mayor al precio total"});return}let t={customer_id:this.form.get("customer_id").value,property_id:this.form.get("property_id").value,contract_number:this.form.get("contract_number").value,contract_date:this.form.get("contract_date").value,total_price:this.form.get("total_price").value,down_payment:this.form.get("down_payment").value,payment_months:this.form.get("payment_months").value,first_payment_date:this.form.get("first_payment_date").value,currency:this.form.get("currency").value,status:this.form.get("status").value,notes:this.form.get("notes").value||void 0};this.loading.set(!0),this.contractService.createContract(t).subscribe({next:()=>{this.loading.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Contrato creado correctamente"}),this.dialogRef.close(!0)},error:o=>{this.loading.set(!1);let d=o.error?.message||"No se pudo crear el contrato";this.interceptorService.openSnackbar({type:"error",title:"Error",message:d})}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||n)(f(de),f(Y),f(be),f(oo),f(Re),f(V),f(K))};static \u0275cmp=k({type:n,selectors:[["app-contract-create-modal"]],viewQuery:function(e,t){if(e&1&&X(kn,5,Be)(In,5,Be)(On,5),e&2){let o;A(o=R())&&(t.customerAutocompleteTrigger=o.first),A(o=R())&&(t.propertyAutocompleteTrigger=o.first),A(o=R())&&(t.modalBody=o.first)}},decls:70,vars:69,consts:[["modalBody",""],["customerAutocompleteTrigger","matAutocompleteTrigger"],["autoCustomer","matAutocomplete"],["propertyAutocompleteTrigger","matAutocompleteTrigger"],["autoProperty","matAutocomplete"],[1,"modal-container"],[1,"modal-header"],["type","button",1,"close-button",3,"click"],[3,"img","size"],[1,"modal-body"],[3,"formGroup"],[1,"section"],[1,"autocomplete-with-button"],[1,"autocomplete-field"],["for","customer-search",1,"field-label"],[1,"text-red-500"],["id","customer-search","type","text","formControlName","customer_search","placeholder","Buscar por nombre, apellido o email","aria-label","Buscar cliente","role","combobox","aria-expanded","false","aria-autocomplete","list",1,"autocomplete-input",3,"matAutocomplete"],["id","customer-help-text",1,"sr-only"],["id","customer-error","role","alert",1,"mt-1","text-sm","text-red-600"],[3,"displayWith"],[3,"value","onSelectionChange",4,"ngFor","ngForOf"],["disabled","",4,"ngIf"],[3,"clicked","text","variant","size","fullWidth"],["for","property-search",1,"field-label"],["id","property-search","type","text","formControlName","property_search","placeholder","Buscar por c\xF3digo, nombre o manzana","aria-label","Buscar propiedad","role","combobox","aria-expanded","false","aria-autocomplete","list",1,"autocomplete-input",3,"matAutocomplete"],["id","property-help-text",1,"sr-only"],["id","property-error","role","alert",1,"mt-1","text-sm","text-red-600"],[1,"grid","grid-cols-2","gap-4"],[3,"label","placeholder","form_control","type"],[3,"label","form_control","type"],[1,"w-full","p-1"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"w-full","rounded-lg","border","border-gray-300","bg-gray-50","px-3","py-2","text-sm","text-gray-700"],[3,"label","config"],[1,"mt-4"],[1,"modal-footer"],[3,"clicked","text","variant","size","fullWidth","disabled","loading"],[3,"onSelectionChange","value"],["disabled",""],[1,"no-results-text"]],template:function(e,t){if(e&1){let o=D();a(0,"div",5)(1,"div",6)(2,"h2"),s(3,"Crear Contrato"),r(),a(4,"button",7),u("click",function(){return x(o),C(t.close())}),_(5,"lucide-icon",8),r()(),a(6,"div",9,0)(8,"form",10)(9,"div",11)(10,"h3"),s(11,"Cliente"),r(),a(12,"div",12)(13,"div",13)(14,"label",14),s(15," Cliente * "),J(16,Tn,2,0,"span",15),r(),_(17,"input",16,1),a(19,"span",17),s(20,"Busca clientes por nombre, apellido o email. Usa las flechas para navegar por los resultados."),r(),J(21,Fn,2,0,"p",18),a(22,"mat-autocomplete",19,2),P(24,An,2,2,"mat-option",20)(25,Rn,3,0,"mat-option",21),r()(),a(26,"app-button",22),u("clicked",function(){return x(o),C(t.openCreateCustomerModal())}),r()()(),a(27,"div",11)(28,"h3"),s(29,"Propiedad"),r(),a(30,"div",13)(31,"label",23),s(32," Lote * "),J(33,Ln,2,0,"span",15),r(),_(34,"input",24,3),a(36,"span",25),s(37,"Busca propiedades disponibles por c\xF3digo, nombre o manzana. Usa las flechas para navegar por los resultados."),r(),J(38,zn,2,0,"p",26),a(39,"mat-autocomplete",19,4),P(41,Nn,2,2,"mat-option",20)(42,Vn,3,0,"mat-option",21),r()()(),a(43,"div",11)(44,"h3"),s(45,"Datos del Contrato"),r(),a(46,"div",27),_(47,"app-input",28)(48,"app-input",29)(49,"app-input",28)(50,"app-input",28),a(51,"div",30)(52,"label",31),s(53," Saldo Pendiente "),r(),a(54,"div",32),s(55),r()(),_(56,"app-input",28),a(57,"div",30)(58,"label",31),s(59," Pago Mensual "),r(),a(60,"div",32),s(61),r()(),_(62,"app-input",29)(63,"app-select",33)(64,"app-select",33),r(),a(65,"div",34),_(66,"app-input",28),r()()()(),a(67,"div",35)(68,"app-button",22),u("clicked",function(){return x(o),C(t.close())}),r(),a(69,"app-button",36),u("clicked",function(){return x(o),C(t.submit())}),r()()()}if(e&2){let o,d,m,E,H,je,Qe,Ye,Ke,Ze,Co=We(23),So=We(40);l(5),c("img",t.X)("size",20),l(3),c("formGroup",t.form),l(8),ee((o=t.form.get("customer_id"))!=null&&o.invalid&&((o=t.form.get("customer_id"))!=null&&o.touched)?16:-1),l(),M("error-border",((d=t.form.get("customer_id"))==null?null:d.invalid)&&((d=t.form.get("customer_id"))==null?null:d.touched)),c("matAutocomplete",Co),ne("aria-describedby",(m=t.form.get("customer_id"))!=null&&m.invalid&&((m=t.form.get("customer_id"))!=null&&m.touched)?"customer-error":"customer-help-text")("aria-invalid",((E=t.form.get("customer_id"))==null?null:E.invalid)&&((E=t.form.get("customer_id"))==null?null:E.touched)),l(4),ee((H=t.form.get("customer_id"))!=null&&H.invalid&&((H=t.form.get("customer_id"))!=null&&H.touched)?21:-1),l(),c("displayWith",t.displayCustomer.bind(t)),l(2),c("ngForOf",t.filteredCustomers()),l(),c("ngIf",t.filteredCustomers().length===0),l(),c("text","Crear Cliente")("variant","secondary")("size","md")("fullWidth",!1),l(7),ee((je=t.form.get("property_id"))!=null&&je.invalid&&((je=t.form.get("property_id"))!=null&&je.touched)?33:-1),l(),M("error-border",((Qe=t.form.get("property_id"))==null?null:Qe.invalid)&&((Qe=t.form.get("property_id"))==null?null:Qe.touched)),c("matAutocomplete",So),ne("aria-describedby",(Ye=t.form.get("property_id"))!=null&&Ye.invalid&&((Ye=t.form.get("property_id"))!=null&&Ye.touched)?"property-error":"property-help-text")("aria-invalid",((Ke=t.form.get("property_id"))==null?null:Ke.invalid)&&((Ke=t.form.get("property_id"))==null?null:Ke.touched)),l(4),ee((Ze=t.form.get("property_id"))!=null&&Ze.invalid&&((Ze=t.form.get("property_id"))!=null&&Ze.touched)?38:-1),l(),c("displayWith",t.displayProperty.bind(t)),l(2),c("ngForOf",t.filteredProperties()),l(),c("ngIf",t.filteredProperties().length===0),l(5),c("label","N\xFAmero de Contrato *")("placeholder","Ej: CONT-001")("form_control",t.form.get("contract_number"))("type","text"),l(),c("label","Fecha de Contrato *")("form_control",t.form.get("contract_date"))("type","date"),l(),c("label","Precio Total *")("placeholder","0.00")("form_control",t.form.get("total_price"))("type","number"),l(),c("label","Enganche *")("placeholder","0.00")("form_control",t.form.get("down_payment"))("type","number"),l(5),g(" ",t.formattedRemainingBalance()," "),l(),c("label","Meses de Pago *")("placeholder","1")("form_control",t.form.get("payment_months"))("type","number"),l(5),g(" ",t.formattedMonthlyPayment()," "),l(),c("label","Fecha Primer Pago *")("form_control",t.form.get("first_payment_date"))("type","date"),l(),c("label","Moneda *")("config",t.currencySelectConfig),l(),c("label","Estado *")("config",t.statusSelectConfig),l(2),c("label","Notas")("placeholder","Notas adicionales (opcional)")("form_control",t.form.get("notes"))("type","textarea"),l(2),c("text","Cancelar")("variant","secondary")("size","md")("fullWidth",!1),l(),c("text","Crear Contrato")("variant","primary")("size","md")("fullWidth",!1)("disabled",t.form.invalid||t.loading())("loading",t.loading())}},dependencies:[T,ke,L,ce,dt,Te,Fe,le,se,ct,ge,yo,vo,Ve,Be,N,z,F,me,Ae],styles:[".modal-container[_ngcontent-%COMP%]{width:900px;max-height:90vh;display:flex;flex-direction:column}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid #e5e7eb}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:#111827;margin:0}.modal-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{padding:.5rem;border-radius:.375rem;transition:background-color .2s;background:transparent;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center}.modal-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6}.modal-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.modal-body[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]{margin-bottom:2rem}.modal-body[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#374151;margin-bottom:1rem}.modal-body[_ngcontent-%COMP%]   .autocomplete-with-button[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-end}.modal-body[_ngcontent-%COMP%]   .autocomplete-with-button[_ngcontent-%COMP%]   .autocomplete-field[_ngcontent-%COMP%]{flex:1}.modal-body[_ngcontent-%COMP%]   .autocomplete-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.modal-body[_ngcontent-%COMP%]   .autocomplete-field[_ngcontent-%COMP%]   .field-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#374151}.modal-body[_ngcontent-%COMP%]   .autocomplete-field[_ngcontent-%COMP%]   .autocomplete-input[_ngcontent-%COMP%]{width:100%;padding:.625rem .75rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.875rem;transition:border-color .2s,box-shadow .2s}.modal-body[_ngcontent-%COMP%]   .autocomplete-field[_ngcontent-%COMP%]   .autocomplete-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px #6366f11a}.modal-body[_ngcontent-%COMP%]   .autocomplete-field[_ngcontent-%COMP%]   .autocomplete-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.modal-body[_ngcontent-%COMP%]   .autocomplete-field[_ngcontent-%COMP%]   .autocomplete-input.error-border[_ngcontent-%COMP%]{border-color:#f87171}.modal-body[_ngcontent-%COMP%]   .autocomplete-field[_ngcontent-%COMP%]   .autocomplete-input.error-border[_ngcontent-%COMP%]:focus{border-color:#ef4444;box-shadow:0 0 0 3px #ef44441a}.modal-body[_ngcontent-%COMP%]   .no-results-text[_ngcontent-%COMP%]{color:#6b7280;font-size:.875rem;font-style:italic}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1.5rem;border-top:1px solid #e5e7eb}.grid[_ngcontent-%COMP%]{display:grid}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.gap-4[_ngcontent-%COMP%]{gap:1rem}.mt-4[_ngcontent-%COMP%]{margin-top:1rem}.sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}  .mat-mdc-autocomplete-panel{background:#fff;border-radius:.375rem;box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d;border:1px solid #e5e7eb;max-height:256px;overflow-y:auto}  .mat-mdc-autocomplete-panel .mat-mdc-option{font-size:.875rem;padding:.75rem 1rem;min-height:48px}  .mat-mdc-autocomplete-panel .mat-mdc-option:hover{background-color:#f3f4f6}  .mat-mdc-autocomplete-panel .mat-mdc-option.mat-mdc-option-active,   .mat-mdc-autocomplete-panel .mat-mdc-option.mdc-list-item--selected{background-color:#eef2ff;color:#4f46e5}  .mat-mdc-autocomplete-panel .mat-mdc-option .mdc-list-item__primary-text{color:#374151}"]})};var Bn=["tableTemplate"];function jn(n,i){if(n&1){let e=D();a(0,"div",9)(1,"div",10),u("click",function(){x(e);let o=p();return C(o.applyFilter("total"))}),a(2,"div",11)(3,"p",12),s(4,"Total"),r(),a(5,"p",13),s(6,"Todos los contratos"),r()(),a(7,"div",14)(8,"p",15),s(9),v(10,"currency"),r(),a(11,"span",16),s(12),r()()(),a(13,"div",17),u("click",function(){x(e);let o=p();return C(o.applyFilter("completed"))}),a(14,"div",11)(15,"p",18),s(16,"Completados"),r(),a(17,"p",19),s(18,"Pagados en su totalidad"),r()(),a(19,"div",14)(20,"p",20),s(21),v(22,"currency"),r(),a(23,"span",21),s(24),r()()(),a(25,"div",22),u("click",function(){x(e);let o=p();return C(o.applyFilter("pending"))}),a(26,"div",11)(27,"p",23),s(28,"Activos"),r(),a(29,"p",24),s(30,"En proceso de pago"),r()(),a(31,"div",25)(32,"p",26),s(33),v(34,"currency"),r(),a(35,"span",27),s(36),r()(),a(37,"div",28)(38,"span",29),s(39,"Pagado: "),a(40,"strong"),s(41),v(42,"currency"),r()(),a(43,"span",30),s(44,"Pendiente: "),a(45,"strong"),s(46),v(47,"currency"),r()()()(),a(48,"div",31),u("click",function(){x(e);let o=p();return C(o.applyFilter("overdue"))}),a(49,"div",11)(50,"p",32),s(51,"Vencidos"),r(),a(52,"p",33),s(53,"Con pagos atrasados"),r()(),a(54,"div",14)(55,"p",34),s(56),v(57,"currency"),r(),a(58,"span",35),s(59),r()()()()}if(n&2){let e=p();l(),M("ring-2",e.activeFilter()==="total")("ring-gray-500",e.activeFilter()==="total"),l(8),b(xe(10,26,e.stats().total.value,"USD","symbol","1.0-0")),l(3),b(e.stats().total.count),l(),M("ring-2",e.activeFilter()==="completed")("ring-blue-500",e.activeFilter()==="completed"),l(8),b(xe(22,31,e.stats().completed.value,"USD","symbol","1.0-0")),l(3),b(e.stats().completed.count),l(),M("ring-2",e.activeFilter()==="pending")("ring-green-500",e.activeFilter()==="pending"),l(8),b(xe(34,36,e.stats().pending.value,"USD","symbol","1.0-0")),l(3),b(e.stats().pending.count),l(5),b(xe(42,41,e.stats().pending.paid,"USD","symbol","1.0-0")),l(5),b(xe(47,46,e.stats().pending.remaining,"USD","symbol","1.0-0")),l(2),M("ring-2",e.activeFilter()==="overdue")("ring-red-500",e.activeFilter()==="overdue"),l(8),b(xe(57,51,e.stats().overdue.value,"USD","symbol","1.0-0")),l(3),b(e.stats().overdue.count)}}function $n(n,i){if(n&1){let e=D();a(0,"span",42),u("click",function(o){x(e);let d=p().$implicit;return p().navigateToCustomer(d.customer.id),C(o.stopPropagation())}),s(1),r()}if(n&2){let e=p().$implicit,t=p();c("title",t.getCustomerName(e)),l(),g(" ",t.getCustomerName(e)," ")}}function Hn(n,i){n&1&&(a(0,"span",43),s(1,"\u2014"),r())}function qn(n,i){if(n&1){let e=D();a(0,"span",44),u("click",function(o){x(e);let d=p().$implicit;return p().navigateToProperty(d.property.id),C(o.stopPropagation())}),s(1),r()}if(n&2){let e=p().$implicit;l(),g(" ",e.property.code," ")}}function Gn(n,i){n&1&&(a(0,"span",43),s(1,"\u2014"),r())}function Un(n,i){if(n&1){let e=D();a(0,"td")(1,"span",36),s(2),r()(),a(3,"td"),P(4,$n,2,2,"span",37)(5,Hn,2,0,"span",38),r(),a(6,"td"),P(7,qn,2,1,"span",39)(8,Gn,2,0,"span",38),r(),a(9,"td"),s(10),v(11,"date"),r(),a(12,"td"),s(13),v(14,"currency"),r(),a(15,"td"),s(16),v(17,"currency"),r(),a(18,"td"),s(19),v(20,"date"),r(),a(21,"td")(22,"span"),s(23),r()(),a(24,"td",40),u("click",function(o){return x(e),C(o.stopPropagation())}),a(25,"app-button",41),u("clicked",function(){let o=x(e).$implicit,d=p();return C(d.viewDetail(o))}),r()()}if(n&2){let e=i.$implicit,t=p();l(2),g(" ",e.contract_number," "),l(2),c("ngIf",e.customer),l(),c("ngIf",!e.customer),l(2),c("ngIf",e.property),l(),c("ngIf",!e.property),l(2),b(w(11,14,e.contract_date,"mediumDate")),l(3),b(w(14,17,e.total_price,e.currency)),l(3),b(w(17,20,e.remaining_balance,e.currency)),l(3),b(w(20,23,e.first_payment_date,"mediumDate")),l(3),Q(t.getStatusClass(e.status)),l(),g(" ",t.getStatusLabel(e.status)," "),l(2),c("fullWidth",!1)("icon",t.ArrowRight)}}var xo=class n{constructor(i,e,t,o,d){this.router=i;this.route=e;this.contractService=t;this.propertyService=o;this.dialog=d;this.loadStats(),this.route.queryParams.pipe(U(this.destroy$)).subscribe(m=>{let E=JSON.stringify(m);E!==this.lastQueryParams&&(this.lastQueryParams=E,this.search=m?.search??"",m?.status==="completado"?this.activeFilter.set("completed"):m?.status==="activo"?this.activeFilter.set("pending"):m?.hasOverdue==="true"?this.activeFilter.set("overdue"):!m?.status&&!m?.hasOverdue?this.activeFilter.set("total"):this.activeFilter.set(null),this.getContracts())})}tableTemplate;table_config=S({rows:[],columns:[{name:"N\xFAmero",prop:"contract_number",sortable:!0,canAutoResize:!0,width:120},{name:"Cliente",prop:"customer",sortable:!1,canAutoResize:!1,width:200},{name:"Lote",prop:"property",sortable:!1,canAutoResize:!0,width:120},{name:"Fecha",prop:"contract_date",sortable:!0,canAutoResize:!0,width:120},{name:"Precio Total",prop:"total_price",sortable:!0,canAutoResize:!0,width:120},{name:"Saldo Pendiente",prop:"remaining_balance",sortable:!0,canAutoResize:!0,width:130},{name:"Siguiente Pago",prop:"first_payment_date",sortable:!0,canAutoResize:!0,width:130},{name:"Estado",prop:"status",sortable:!0,canAutoResize:!0,width:100},{name:"Acciones",prop:"actions",sortable:!1,canAutoResize:!0,width:120}],externalPaging:!1,externalSorting:!1,page:1,limit:20,totalResults:0,loading:!1,emptyState:{title:"Sin resultados",subtitle:"No se encontraron contratos"},columnMode:"force",reorderable:!1});ArrowRight=Ci;search="";currentSort=null;stats=S(null);activeFilter=S(null);destroy$=new G;lastQueryParams="";ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadStats(){this.contractService.getContractStats().subscribe({next:i=>{this.stats.set(i)},error:i=>{console.error("Error loading stats:",i)}})}applyFilter(i){let e=B({},this.search&&{search:this.search});switch(i){case"completed":e.status="completado";break;case"pending":e.status="activo";break;case"overdue":e.hasOverdue="true";break;default:break}this.router.navigate([],{relativeTo:this.route,queryParams:e})}getContracts(){this.table_config.update(t=>Ot(B({},t),{loading:!0}));let i=this.route.snapshot.queryParams,e=B(B(B({},this.search&&{search:this.search}),i.status&&{status:i.status}),i.hasOverdue&&{hasOverdue:i.hasOverdue});this.contractService.getContracts(e).subscribe(t=>{let o=Array.isArray(t)?t:t?.data??[],d=Array.isArray(t)?t.length:t?.total??0;this.table_config.update(m=>Ot(B({},m),{rows:o,totalResults:d,loading:!1}))})}onPageChange(i){}onSortChange(i){this.currentSort=i}onRowClick(i){this.viewDetail(i)}onSearchChange(i){this.search=i,this.router.navigate([],{relativeTo:this.route,queryParams:{search:i||void 0},queryParamsHandling:"merge"})}createContract(){console.log("Create contract")}openCreateContractModal(){this.dialog.open(It,{width:"900px",disableClose:!1}).afterClosed().subscribe(e=>{e&&this.getContracts()})}viewDetail(i){this.dialog.open(kt,{data:{contract:i}})}navigateToCustomer(i){this.router.navigate(["/customers/detail",i])}navigateToProperty(i){this.propertyService.getProperty(i).subscribe({next:e=>{this.dialog.open(yt,{data:{property:e}})},error:e=>{console.error("Error loading property:",e)}})}getStatusClass(i){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{activo:"bg-green-100 text-green-800",completado:"bg-blue-100 text-blue-800",cancelado:"bg-red-100 text-red-800",suspendido:"bg-yellow-100 text-yellow-800"}[i]||"bg-gray-100 text-gray-800"}`}getStatusLabel(i){return{activo:"Activo",completado:"Completado",cancelado:"Cancelado",suspendido:"Suspendido"}[i]||i}getCustomerName(i){return i.customer?`${i.customer.name} ${i.customer.lastname}`:"\u2014"}static \u0275fac=function(e){return new(e||n)(f(rt),f(xi),f(be),f(Re),f(K))};static \u0275cmp=k({type:n,selectors:[["app-contracts-list"]],viewQuery:function(e,t){if(e&1&&X(Bn,5),e&2){let o;A(o=R())&&(t.tableTemplate=o.first)}},decls:11,vars:4,consts:[["tableTemplate",""],[1,"p-6","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],[1,"flex","flex-col","gap-4","md:flex-row","md:items-center","md:justify-between","mb-5"],[1,"text-2xl","font-semibold","text-gray-800"],[1,"flex","items-center","gap-3"],["param_name","search",1,"w-64",3,"searchChange","param_activate"],["text","Crear Contrato","custom_class","btn_primary",3,"clicked"],["class","grid grid-cols-4 gap-4 mb-6",4,"ngIf"],[3,"pageChange","sortChange","rowClick","config","rowTemplate"],[1,"grid","grid-cols-4","gap-4","mb-6"],[1,"bg-gradient-to-br","from-gray-50","to-gray-100","p-4","rounded-xl","border","border-gray-200","cursor-pointer","hover:shadow-lg","transition-all",3,"click"],[1,"mb-2"],[1,"text-xs","text-gray-600","font-semibold","uppercase","tracking-wide","mb-0.5"],[1,"text-[10px]","text-gray-500"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-2xl","font-bold","text-gray-900"],[1,"bg-gradient-to-br","from-blue-50","to-blue-100","p-4","rounded-xl","border","border-blue-200","cursor-pointer","hover:shadow-lg","transition-all",3,"click"],[1,"text-xs","text-blue-600","font-semibold","uppercase","tracking-wide","mb-0.5"],[1,"text-[10px]","text-blue-500"],[1,"text-xl","font-bold","text-blue-900"],[1,"text-2xl","font-bold","text-blue-900"],[1,"bg-gradient-to-br","from-green-50","to-green-100","p-4","rounded-xl","border","border-green-200","cursor-pointer","hover:shadow-lg","transition-all",3,"click"],[1,"text-xs","text-green-600","font-semibold","uppercase","tracking-wide","mb-0.5"],[1,"text-[10px]","text-green-500"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xl","font-bold","text-green-900"],[1,"text-2xl","font-bold","text-green-900"],[1,"flex","gap-2","text-xs"],[1,"text-green-700"],[1,"text-orange-700"],[1,"bg-gradient-to-br","from-red-50","to-red-100","p-4","rounded-xl","border","border-red-200","cursor-pointer","hover:shadow-lg","transition-all",3,"click"],[1,"text-xs","text-red-600","font-semibold","uppercase","tracking-wide","mb-0.5"],[1,"text-[10px]","text-red-500"],[1,"text-xl","font-bold","text-red-900"],[1,"text-2xl","font-bold","text-red-900"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-purple-100","text-purple-800","whitespace-nowrap"],["class","inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 cursor-pointer hover:bg-blue-200 transition-colors max-w-[200px] truncate",3,"title","click",4,"ngIf"],["class","text-sm text-gray-400",4,"ngIf"],["class","inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 whitespace-nowrap cursor-pointer hover:bg-green-200 transition-colors",3,"click",4,"ngIf"],[3,"click"],["text","Detalle","size","sm","custom_class","btn_primary",3,"clicked","fullWidth","icon"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-blue-100","text-blue-800","cursor-pointer","hover:bg-blue-200","transition-colors","max-w-[200px]","truncate",3,"click","title"],[1,"text-sm","text-gray-400"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-green-100","text-green-800","whitespace-nowrap","cursor-pointer","hover:bg-green-200","transition-colors",3,"click"]],template:function(e,t){if(e&1){let o=D();a(0,"div",1)(1,"div",2)(2,"h2",3),s(3,"Contratos"),r(),a(4,"div",4)(5,"app-search",5),u("searchChange",function(m){return x(o),C(t.onSearchChange(m))}),r(),a(6,"app-button",6),u("clicked",function(){return x(o),C(t.openCreateContractModal())}),r()()(),P(7,jn,60,56,"div",7),a(8,"app-datatable-wrapper",8),u("pageChange",function(m){return x(o),C(t.onPageChange(m))})("sortChange",function(m){return x(o),C(t.onSortChange(m))})("rowClick",function(m){return x(o),C(t.onRowClick(m))}),r()(),P(9,Un,26,26,"ng-template",null,0,bi)}if(e&2){let o=We(10);l(5),c("param_activate",!0),l(2),c("ngIf",t.stats()),l(),c("config",t.table_config())("rowTemplate",o)}},dependencies:[T,L,io,Ri,F,re,O],encapsulation:2})};export{xo as ContractsListComponent};
