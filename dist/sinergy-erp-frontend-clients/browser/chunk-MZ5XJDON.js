import{a as _e,b as ve}from"./chunk-LGDAEHFX.js";import{a as ct}from"./chunk-5YITP4Z5.js";import{a as at}from"./chunk-NYQ6E34N.js";import{a as fe}from"./chunk-SJ2MQSEX.js";import{c as z,d as L,e as B,f as te,k as O}from"./chunk-OANT22MG.js";import{b as nt,c as C,e as it,f as J,h as ot,l as K,q as Y,r as rt,s as Z,t as ee,v as w}from"./chunk-MQV4I3IR.js";import{A as T,B as W,a as Xe,c as He,f as Qe,i as We,j as Je,k as Ke,m as Ye,r as ue,s as Ze,u as et,v as ge,w as tt,y as A,z as k}from"./chunk-PIG46PEF.js";import{A as de,c as Ge,d as pe,e as F,i as Ue,j as I,l as V,m as E,t as Q,y as qe}from"./chunk-66A2AKCP.js";import{$ as b,$b as N,Ab as s,Bb as o,Cb as i,Db as f,Kb as D,L as we,Na as ke,Ob as d,Q as q,Qa as r,Qb as m,U as X,Ub as Oe,Vb as Fe,Wb as Ae,Za as p,Zb as $e,_ as y,bc as H,cc as c,d as Ee,db as M,dc as g,ec as x,fc as Re,gb as Te,hc as Ne,ic as je,jb as S,jc as Ve,kc as j,la as P,pc as ze,tc as _,uc as Le,vc as v,wc as Be}from"./chunk-56XCPM73.js";import{a as U,b as se}from"./chunk-7CGTOI24.js";var ne=class a{constructor(t){this.http=t}api=W.api;getContractDocuments(t){return this.http.get(`${this.api}/tenant/contracts/${t}/documents`)}uploadDocument(t,e){return this.http.post(`${this.api}/tenant/contracts/${t}/documents`,e)}updateDocumentStatus(t,e,n){return this.http.patch(`${this.api}/tenant/contracts/${t}/documents/${e}/status`,n)}deleteDocument(t,e){return this.http.delete(`${this.api}/tenant/contracts/${t}/documents/${e}`)}static \u0275fac=function(e){return new(e||a)(X(Q))};static \u0275prov=q({token:a,factory:a.\u0275fac,providedIn:"root"})};function ut(a,t){if(a&1&&(o(0,"p",17),c(1),i()),a&2){let e=m();r(),Re(" \u2713 ",e.selectedFile.name," (",e.formatFileSize(e.selectedFile.size),") ")}}var ye=class a{constructor(t,e,n,l){this.data=t;this.dialogRef=e;this.documentService=n;this.interceptorService=l}uploading=P(!1);selectedFile=null;notes="";Upload=tt;X=A;onFileSelected(t){let e=t.target.files[0];if(e){if(e.size>10*1024*1024){this.interceptorService.openSnackbar({type:"error",title:"Error",message:"El archivo es muy grande (m\xE1ximo 10MB)"});return}this.selectedFile=e}}uploadDocument(){if(!this.selectedFile){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Selecciona un archivo"});return}this.uploading.set(!0);let t=new FormData;t.append("file",this.selectedFile),this.notes&&t.append("notes",this.notes),this.documentService.uploadDocument(this.data.contractId,t).subscribe({next:()=>{this.uploading.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Documento subido correctamente"}),this.dialogRef.close(!0)},error:e=>{this.uploading.set(!1);let n="Error al subir documento";e.status===413?n="Archivo muy grande (m\xE1ximo 10MB)":e.status===415&&(n="Tipo de archivo no permitido"),this.interceptorService.openSnackbar({type:"error",title:"Error",message:n})}})}close(){this.dialogRef.close()}formatFileSize(t){return t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB"}static \u0275fac=function(e){return new(e||a)(p(L),p(z),p(ne),p(O))};static \u0275cmp=M({type:a,selectors:[["app-contract-document-upload-modal"]],decls:24,vars:7,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-title"],[1,"close-button",3,"click"],[3,"img","size"],[1,"dialog-content"],[1,"form-grid"],[1,"form-field","full-width"],[1,"field-label"],[1,"file-input-wrapper"],["type","file","accept",".jpg,.jpeg,.png,.pdf,.doc,.docx","id","fileInput",1,"field-input","file-input",3,"change"],["class","file-info",4,"ngIf"],["placeholder","Notas adicionales...","rows","3",1,"field-input",3,"ngModelChange","ngModel"],[1,"help-text"],[1,"dialog-footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Subir Documento","custom_class","btn_primary",3,"clicked","loading","disabled","icon"],[1,"file-info"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),c(3,"Subir Documento del Contrato"),i(),o(4,"button",3),d("click",function(){return n.close()}),f(5,"lucide-icon",4),i()(),o(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),c(10,"Archivo"),i(),o(11,"div",9)(12,"input",10),d("change",function(u){return n.onFileSelected(u)}),i()(),S(13,ut,2,2,"p",11),i(),o(14,"div",7)(15,"label",8),c(16,"Notas (Opcional)"),i(),o(17,"textarea",12),Ve("ngModelChange",function(u){return je(n.notes,u)||(n.notes=u),u}),c(18,"        "),i()()(),o(19,"p",13),c(20," Formatos permitidos: JPG, PNG, PDF, DOC, DOCX (m\xE1x. 10MB) "),i()(),o(21,"div",14)(22,"app-button",15),d("clicked",function(){return n.close()}),i(),o(23,"app-button",16),d("clicked",function(){return n.uploadDocument()}),i()()()),e&2&&(r(5),s("img",n.X)("size",20),r(8),s("ngIf",n.selectedFile),r(4),Ne("ngModel",n.notes),r(6),s("loading",n.uploading())("disabled",!n.selectedFile)("icon",n.Upload))},dependencies:[E,F,rt,nt,it,ot,te,w,T,k],styles:[".dialog[_ngcontent-%COMP%]{width:100dvw;max-width:600px}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid #e5e7eb}.dialog-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#111827;margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#6b7280;padding:.5rem;border-radius:.375rem;transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#111827}.dialog-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:1rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-field.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.field-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#374151}.field-input[_ngcontent-%COMP%]{width:100%;padding:.625rem .75rem;border:1px solid #d1d5db;border-radius:.5rem;font-size:.875rem;transition:all .2s;background-color:#fff;cursor:pointer}.field-input[_ngcontent-%COMP%]:hover{border-color:#9ca3af;background-color:#f9fafb}.field-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px #6366f11a;background-color:#fff}.field-input[_ngcontent-%COMP%]:disabled{background-color:#f9fafb;cursor:not-allowed;opacity:.6}input[type=file].field-input[_ngcontent-%COMP%]{padding:.5rem .75rem;cursor:pointer}input[type=file].field-input[_ngcontent-%COMP%]::file-selector-button{padding:.375rem .75rem;margin-right:.75rem;background-color:#6366f1;color:#fff;border:none;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s}input[type=file].field-input[_ngcontent-%COMP%]::file-selector-button:hover{background-color:#4f46e5}textarea.field-input[_ngcontent-%COMP%]{resize:vertical;font-family:inherit}.file-info[_ngcontent-%COMP%]{font-size:.75rem;color:#059669;margin-top:.5rem;font-weight:500}.file-input-wrapper[_ngcontent-%COMP%]{position:relative}.help-text[_ngcontent-%COMP%]{font-size:.75rem;color:#6b7280;margin-top:1rem;margin-bottom:0}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1.5rem;border-top:1px solid #e5e7eb}"]})};function gt(a,t){a&1&&(o(0,"div",7)(1,"p",8),c(2,"Cargando documentos..."),i()())}function ft(a,t){a&1&&(o(0,"div",9)(1,"p",10),c(2,"No hay documentos subidos"),i()())}function _t(a,t){if(a&1&&(o(0,"p",26),c(1),i()),a&2){let e=m().$implicit;r(),g(e.notes)}}function vt(a,t){if(a&1){let e=D();o(0,"div",27)(1,"button",28),d("click",function(){y(e);let l=m().$implicit,u=m(2);return b(u.updateStatus(l,"approved"))}),f(2,"lucide-icon",25),i(),o(3,"button",29),d("click",function(){y(e);let l=m().$implicit,u=m(2);return b(u.updateStatus(l,"rejected"))}),f(4,"lucide-icon",25),i()()}if(a&2){let e=m(3);r(2),s("img",e.FileCheck)("size",16),r(2),s("img",e.FileX)("size",16)}}function yt(a,t){if(a&1&&(o(0,"a",30),f(1,"lucide-icon",25),i()),a&2){let e=m().$implicit,n=m(2);s("href",e.download_url,ke),r(),s("img",n.Download)("size",16)}}function bt(a,t){if(a&1){let e=D();o(0,"div",13)(1,"div",14),f(2,"lucide-icon",15),o(3,"div",16)(4,"div",17)(5,"span",18),c(6),i(),o(7,"span"),c(8),i()(),o(9,"div",19)(10,"span"),c(11),i(),o(12,"span"),c(13,"\u2022"),i(),o(14,"span"),c(15),_(16,"date"),i()(),S(17,_t,2,1,"p",20),i()(),o(18,"div",21),S(19,vt,5,4,"div",22)(20,yt,2,3,"a",23),o(21,"button",24),d("click",function(){let l=y(e).$implicit,u=m(2);return b(u.deleteDocument(l))}),f(22,"lucide-icon",25),i()()()}if(a&2){let e=t.$implicit,n=m(2);r(2),s("img",n.getFileIcon(e.mime_type))("size",20),r(4),g(e.file_name),r(),H(n.getStatusClass(e.status)),r(),x(" ",n.getStatusLabel(e.status)," "),r(3),g(n.formatFileSize(e.file_size)),r(4),g(v(16,13,e.created_at,"mediumDate")),r(2),s("ngIf",e.notes),r(2),s("ngIf",e.status==="pending"),r(),s("ngIf",e.download_url),r(2),s("img",n.Trash2)("size",16)}}function xt(a,t){if(a&1&&(o(0,"div",11),S(1,bt,23,16,"div",12),i()),a&2){let e=m();r(),s("ngForOf",e.documents())}}var be=class a{constructor(t,e,n){this.documentService=t;this.interceptorService=e;this.dialog=n}contractId;documents=P([]);loading=P(!1);Plus=ue;Download=Qe;Trash2=ge;FileText=Je;Image=Ye;FileCheck=We;FileX=Ke;ngOnInit(){this.loadDocuments()}loadDocuments(){this.loading.set(!0),this.documentService.getContractDocuments(this.contractId).subscribe({next:t=>{this.documents.set(t),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar los documentos"})}})}openUploadModal(){this.dialog.open(ye,{data:{contractId:this.contractId}}).afterClosed().subscribe(e=>{e&&this.loadDocuments()})}deleteDocument(t){confirm(`\xBFEliminar documento "${t.file_name}"?`)&&this.documentService.deleteDocument(this.contractId,t.id).subscribe({next:()=>{this.loadDocuments(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Documento eliminado"})},error:()=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudo eliminar el documento"})}})}updateStatus(t,e){this.documentService.updateDocumentStatus(this.contractId,t.id,{status:e}).subscribe({next:()=>{this.loadDocuments(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Estado actualizado"})},error:()=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudo actualizar el estado"})}})}getStatusClass(t){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[t]}`}getStatusLabel(t){return{pending:"Pendiente",approved:"Aprobado",rejected:"Rechazado"}[t]}getFileIcon(t){return t.startsWith("image/")?this.Image:t.includes("pdf")?this.FileText:this.FileText}formatFileSize(t){return t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(1)+" MB"}static \u0275fac=function(e){return new(e||a)(p(ne),p(O),p(B))};static \u0275cmp=M({type:a,selectors:[["app-contract-documents"]],inputs:{contractId:"contractId"},decls:8,vars:4,consts:[[1,"documents-section"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-base","font-semibold","text-gray-800"],["text","Subir Documento","custom_class","btn_primary","size","sm",3,"clicked","icon"],["class","text-center py-6",4,"ngIf"],["class","text-center py-6 text-gray-500",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"text-center","py-6"],[1,"text-sm","text-gray-500"],[1,"text-center","py-6","text-gray-500"],[1,"text-sm"],[1,"space-y-2"],["class","flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-3","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors"],[1,"flex","items-center","gap-3","flex-1","min-w-0"],[1,"text-gray-400","flex-shrink-0",3,"img","size"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","mb-1"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"flex","items-center","gap-2","text-xs","text-gray-500"],["class","text-xs text-gray-600 mt-1 truncate",4,"ngIf"],[1,"flex","items-center","gap-1","flex-shrink-0"],["class","flex gap-1",4,"ngIf"],["target","_blank","class","p-1.5 text-indigo-600 hover:bg-indigo-50 rounded transition-colors","title","Descargar",3,"href",4,"ngIf"],["title","Eliminar",1,"p-1.5","text-red-600","hover:bg-red-50","rounded","transition-colors",3,"click"],[3,"img","size"],[1,"text-xs","text-gray-600","mt-1","truncate"],[1,"flex","gap-1"],["title","Aprobar",1,"p-1.5","text-green-600","hover:bg-green-50","rounded","transition-colors",3,"click"],["title","Rechazar",1,"p-1.5","text-red-600","hover:bg-red-50","rounded","transition-colors",3,"click"],["target","_blank","title","Descargar",1,"p-1.5","text-indigo-600","hover:bg-indigo-50","rounded","transition-colors",3,"href"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h4",2),c(3,"Documentos del Contrato"),i(),o(4,"app-button",3),d("clicked",function(){return n.openUploadModal()}),i()(),S(5,gt,3,0,"div",4)(6,ft,3,0,"div",5)(7,xt,2,1,"div",6),i()),e&2&&(r(4),s("icon",n.Plus),r(),s("ngIf",n.loading()),r(),s("ngIf",!n.loading()&&n.documents().length===0),r(),s("ngIf",!n.loading()&&n.documents().length>0))},dependencies:[E,pe,F,w,T,k,I],styles:[".documents-section[_ngcontent-%COMP%]{margin-top:0;padding-top:0;border-top:none}"]})};var R=class a{constructor(t){this.datePipe=t}transform(t,e="mediumDate"){if(!t)return null;if(typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t)){let n=new Date(t+"T00:00:00");return this.datePipe.transform(n,e)}return this.datePipe.transform(t,e)}static \u0275fac=function(e){return new(e||a)(p(I,16))};static \u0275pipe=Te({name:"localDate",type:a,pure:!0})};var G=class a{constructor(t){this.http=t}api=W.api;generatePayments(t){return this.http.post(`${this.api}/tenant/contracts/${t}/payments/generate`,{})}getPayments(t){return this.http.get(`${this.api}/tenant/contracts/${t}/payments`)}getPaymentStats(t){return this.http.get(`${this.api}/tenant/contracts/${t}/payments/stats`)}getPayment(t,e){return this.http.get(`${this.api}/tenant/contracts/${t}/payments/${e}`)}updatePayment(t,e,n){return this.http.put(`${this.api}/tenant/contracts/${t}/payments/${e}`,n)}markAsPaid(t,e,n){return this.http.post(`${this.api}/tenant/contracts/${t}/payments/${e}/pay`,n)}cancelPayment(t,e){return this.http.post(`${this.api}/tenant/contracts/${t}/payments/${e}/cancel`,{})}deletePayment(t,e){return this.http.delete(`${this.api}/tenant/contracts/${t}/payments/${e}`)}static \u0275fac=function(e){return new(e||a)(X(Q))};static \u0275prov=q({token:a,factory:a.\u0275fac,providedIn:"root"})};var xe=class a{constructor(t,e,n,l,u){this.data=t;this.dialogRef=e;this.fb=n;this.paymentService=l;this.interceptorService=u;let h=this.getLocalDateString(new Date);this.form=this.fb.group({paid_date:[h,C.required],payment_method:["",C.required],reference_number:[""]}),this.paymentMethodSelectConfig.form_control=this.form.get("payment_method")}X=A;form;saving=P(!1);paymentMethodSelectConfig={placeholder:"Selecciona un m\xE9todo",data:[{value:"transferencia",label:"Transferencia"},{value:"efectivo",label:"Efectivo"},{value:"tarjeta",label:"Tarjeta"},{value:"cheque",label:"Cheque"}],value:"value",option:"label",form_control:null};getLocalDateString(t){let e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${l}`}save(){if(this.form.invalid){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Completa todos los campos requeridos"});return}this.saving.set(!0),this.paymentService.markAsPaid(this.data.contractId,this.data.payment.id,this.form.value).subscribe({next:()=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pago registrado correctamente"}),this.dialogRef.close(!0)},error:t=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:t.error?.message||"Error al registrar el pago"})}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||a)(p(L),p(z),p(Y),p(G),p(O))};static \u0275cmp=M({type:a,selectors:[["app-mark-payment-paid-modal"]],features:[j([I])],decls:28,vars:16,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-title"],[1,"close-button",3,"click"],[3,"img","size"],[1,"dialog-content",3,"formGroup"],[1,"mb-3","p-2","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"text-sm","text-blue-900"],[1,"font-semibold"],[1,"space-y-3"],["label","Fecha de Pago",3,"form_control"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"config"],["label","N\xFAmero de Referencia (Opcional)",3,"form_control"],[1,"dialog-footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Confirmar Pago","custom_class","btn_primary",3,"clicked","loading"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),c(3),i(),o(4,"button",3),d("click",function(){return n.close()}),f(5,"lucide-icon",4),i()(),o(6,"div",5)(7,"div",6)(8,"p",7)(9,"span",8),c(10,"Monto:"),i(),c(11),_(12,"currency"),i(),o(13,"p",7)(14,"span",8),c(15,"Vencimiento:"),i(),c(16),_(17,"localDate"),i()(),o(18,"div",9),f(19,"app-input",10),o(20,"div")(21,"label",11),c(22,"M\xE9todo de Pago"),i(),f(23,"app-select",12),i(),f(24,"app-input",13),i()(),o(25,"div",14)(26,"app-button",15),d("clicked",function(){return n.close()}),i(),o(27,"app-button",16),d("clicked",function(){return n.save()}),i()()()),e&2&&(r(3),x("Marcar Pago #",n.data.payment.payment_number," como Pagado"),r(2),s("img",n.X)("size",20),r(),s("formGroup",n.form),r(5),x(" ",v(12,10,n.data.payment.amount,n.data.currency)," "),r(5),x(" ",v(17,13,n.data.payment.due_date,"mediumDate")," "),r(3),s("form_control",n.form.controls.paid_date),r(4),s("config",n.paymentMethodSelectConfig),r(),s("form_control",n.form.controls.reference_number),r(3),s("loading",n.saving()))},dependencies:[E,Z,J,K,te,w,ee,fe,T,k,V,R],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh;width:100dvw;max-width:500px}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.25rem 1.5rem;border-bottom:1px solid #e5e7eb}.dialog-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#111827;margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#6b7280;padding:.5rem;border-radius:.375rem;transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#111827}.dialog-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1.25rem 1.5rem;border-top:1px solid #e5e7eb}"]})};var Ce=class a{constructor(t,e,n,l,u){this.data=t;this.dialogRef=e;this.fb=n;this.paymentService=l;this.interceptorService=u;this.form=this.fb.group({amount:[this.data.payment.amount,[C.required,C.min(.01)]],due_date:[this.data.payment.due_date,C.required],notes:[this.data.payment.notes||""]})}X=A;form;saving=P(!1);save(){if(this.form.invalid){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Completa todos los campos requeridos"});return}this.saving.set(!0),this.paymentService.updatePayment(this.data.contractId,this.data.payment.id,this.form.value).subscribe({next:()=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pago actualizado correctamente"}),this.dialogRef.close(!0)},error:t=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:t.error?.message||"Error al actualizar el pago"})}})}close(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||a)(p(L),p(z),p(Y),p(G),p(O))};static \u0275cmp=M({type:a,selectors:[["app-edit-payment-modal"]],features:[j([I])],decls:24,vars:13,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-title"],[1,"close-button",3,"click"],[3,"img","size"],[1,"dialog-content",3,"formGroup"],[1,"mb-3","p-2","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"text-sm","text-blue-900"],[1,"font-semibold"],[1,"space-y-3"],["label","Monto","type","number",3,"form_control"],["label","Fecha de Vencimiento",3,"form_control"],["label","Notas","type","textarea",3,"form_control"],[1,"dialog-footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Guardar Cambios","custom_class","btn_primary",3,"clicked","loading"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),c(3),i(),o(4,"button",3),d("click",function(){return n.close()}),f(5,"lucide-icon",4),i()(),o(6,"div",5)(7,"div",6)(8,"p",7)(9,"span",8),c(10,"Estado:"),i(),c(11),i(),o(12,"p",7)(13,"span",8),c(14,"Vencimiento Original:"),i(),c(15),_(16,"localDate"),i()(),o(17,"div",9),f(18,"app-input",10)(19,"app-input",11)(20,"app-input",12),i()(),o(21,"div",13)(22,"app-button",14),d("clicked",function(){return n.close()}),i(),o(23,"app-button",15),d("clicked",function(){return n.save()}),i()()()),e&2&&(r(3),x("Editar Pago #",n.data.payment.payment_number),r(2),s("img",n.X)("size",20),r(),s("formGroup",n.form),r(5),x(" ",n.data.payment.status," "),r(4),x(" ",v(16,10,n.data.payment.due_date,"mediumDate")," "),r(3),s("form_control",n.form.controls.amount),r(),s("form_control",n.form.controls.due_date),r(),s("form_control",n.form.controls.notes),r(3),s("loading",n.saving()))},dependencies:[E,Z,J,K,te,w,ee,T,k,R],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh;width:100dvw;max-width:500px}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.25rem 1.5rem;border-bottom:1px solid #e5e7eb}.dialog-title[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;color:#111827;margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#6b7280;padding:.5rem;border-radius:.375rem;transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#111827}.dialog-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1.25rem 1.5rem;border-top:1px solid #e5e7eb}"]})};function Ct(a,t){if(a&1){let e=D();o(0,"app-button",10),d("clicked",function(){y(e);let l=m();return b(l.generatePayments())}),i()}if(a&2){let e=m();s("icon",e.Plus)("loading",e.generating())}}function ht(a,t){if(a&1){let e=D();o(0,"app-button",11),d("clicked",function(){y(e);let l=m();return l.loadPayments(),b(l.loadStats())}),i()}if(a&2){let e=m();s("icon",e.RefreshCw)}}function St(a,t){if(a&1&&(o(0,"div",12)(1,"div",13)(2,"p",14),c(3,"Total Pagos"),i(),o(4,"p",15),c(5),i()(),o(6,"div",16)(7,"p",17),c(8,"Pagados"),i(),o(9,"p",18),c(10),i(),o(11,"p",19),c(12),_(13,"currency"),i()(),o(14,"div",20)(15,"p",21),c(16,"Pendientes"),i(),o(17,"p",22),c(18),i(),o(19,"p",23),c(20),_(21,"currency"),i()(),o(22,"div",24)(23,"p",25),c(24,"Vencidos"),i(),o(25,"p",26),c(26),i()()()),a&2){let e=m();r(5),g(e.stats().total_payments),r(5),g(e.stats().paid_count),r(2),g(v(13,6,e.stats().total_paid,e.currency)),r(6),g(e.stats().pending_count),r(2),g(v(21,9,e.stats().total_pending,e.currency)),r(6),g(e.stats().overdue_count)}}function Pt(a,t){a&1&&(o(0,"div",27)(1,"p",28),c(2,"Cargando pagos..."),i()())}function Dt(a,t){a&1&&(o(0,"div",29)(1,"p",30),c(2,"No hay pagos generados"),i()())}function It(a,t){if(a&1){let e=D();o(0,"button",47),d("click",function(){y(e);let l=m().$implicit,u=m(2);return b(u.markAsPaid(l))}),f(1,"lucide-icon",48),i()}if(a&2){let e=m(3);r(),s("img",e.Check)("size",16)}}function Mt(a,t){if(a&1){let e=D();o(0,"button",49),d("click",function(){y(e);let l=m().$implicit,u=m(2);return b(u.editPayment(l))}),f(1,"lucide-icon",48),i()}if(a&2){let e=m(3);r(),s("img",e.Edit)("size",16)}}function Et(a,t){if(a&1){let e=D();o(0,"button",50),d("click",function(){y(e);let l=m().$implicit,u=m(2);return b(u.cancelPayment(l))}),f(1,"lucide-icon",48),i()}if(a&2){let e=m(3);r(),s("img",e.X)("size",16)}}function wt(a,t){if(a&1){let e=D();o(0,"button",51),d("click",function(){y(e);let l=m().$implicit,u=m(2);return b(u.deletePayment(l))}),f(1,"lucide-icon",48),i()}if(a&2){let e=m(3);r(),s("img",e.Trash2)("size",16)}}function kt(a,t){if(a&1&&(o(0,"tr",37)(1,"td",38),c(2),i(),o(3,"td",39),c(4),_(5,"currency"),i(),o(6,"td",40),c(7),_(8,"localDate"),i(),o(9,"td",40),c(10),_(11,"localDate"),i(),o(12,"td",41)(13,"span"),c(14),i()(),o(15,"td",40),c(16),i(),o(17,"td",40),c(18),i(),o(19,"td",41)(20,"div",42),S(21,It,2,2,"button",43)(22,Mt,2,2,"button",44)(23,Et,2,2,"button",45)(24,wt,2,2,"button",46),i()()()),a&2){let e=t.$implicit,n=m(2);r(2),g(e.payment_number),r(2),g(v(5,13,e.amount,n.currency)),r(3),g(v(8,16,e.due_date,"mediumDate")),r(3),g(e.paid_date?v(11,19,e.paid_date,"mediumDate"):"\u2014"),r(3),H(n.getStatusClass(e.status)),r(),x(" ",n.getStatusLabel(e.status)," "),r(2),g(e.payment_method||"\u2014"),r(2),g(e.reference_number||"\u2014"),r(3),s("ngIf",n.canMarkAsPaid(e)),r(),s("ngIf",n.canEdit(e)),r(),s("ngIf",n.canCancel(e)),r(),s("ngIf",n.canDelete(e))}}function Tt(a,t){if(a&1&&(o(0,"div",31)(1,"table",32)(2,"thead",33)(3,"tr")(4,"th",34),c(5,"#"),i(),o(6,"th",34),c(7,"Monto"),i(),o(8,"th",34),c(9,"Vencimiento"),i(),o(10,"th",34),c(11,"Fecha Pago"),i(),o(12,"th",34),c(13,"Estado"),i(),o(14,"th",34),c(15,"M\xE9todo"),i(),o(16,"th",34),c(17,"Referencia"),i(),o(18,"th",34),c(19,"Acciones"),i()()(),o(20,"tbody",35),S(21,kt,25,22,"tr",36),i()()()),a&2){let e=m();r(21),s("ngForOf",e.payments())}}var he=class a{constructor(t,e,n){this.paymentService=t;this.interceptorService=e;this.dialog=n}contractId;currency="USD";payments=P([]);stats=P(null);loading=P(!1);generating=P(!1);Plus=ue;RefreshCw=Ze;Edit=et;Trash2=ge;Check=He;X=A;ngOnInit(){this.loadPayments(),this.loadStats()}loadPayments(){this.loading.set(!0),this.paymentService.getPayments(this.contractId).subscribe({next:t=>{this.payments.set(t),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar los pagos"})}})}loadStats(){this.paymentService.getPaymentStats(this.contractId).subscribe({next:t=>{this.stats.set(t)},error:()=>{}})}generatePayments(){confirm("\xBFGenerar todos los pagos del contrato? Esta acci\xF3n solo se puede realizar una vez.")&&(this.generating.set(!0),this.paymentService.generatePayments(this.contractId).subscribe({next:()=>{this.generating.set(!1),this.loadPayments(),this.loadStats(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pagos generados correctamente"})},error:t=>{this.generating.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:t.error?.message||"Error al generar pagos"})}}))}markAsPaid(t){this.dialog.open(xe,{data:{payment:t,contractId:this.contractId,currency:this.currency}}).afterClosed().subscribe(n=>{n&&(this.loadPayments(),this.loadStats())})}editPayment(t){this.dialog.open(Ce,{data:{payment:t,contractId:this.contractId,currency:this.currency}}).afterClosed().subscribe(n=>{n&&(this.loadPayments(),this.loadStats())})}cancelPayment(t){confirm(`\xBFCancelar el pago #${t.payment_number}?`)&&this.paymentService.cancelPayment(this.contractId,t.id).subscribe({next:()=>{this.loadPayments(),this.loadStats(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pago cancelado"})},error:e=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:e.error?.message||"No se pudo cancelar el pago"})}})}deletePayment(t){confirm(`\xBFEliminar permanentemente el pago #${t.payment_number}? Esta acci\xF3n no se puede deshacer.`)&&this.paymentService.deletePayment(this.contractId,t.id).subscribe({next:()=>{this.loadPayments(),this.loadStats(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Pago eliminado"})},error:e=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:e.error?.message||"No se pudo eliminar el pago"})}})}getStatusClass(t){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{pendiente:"bg-yellow-100 text-yellow-800",pagado:"bg-green-100 text-green-800",vencido:"bg-red-100 text-red-800",cancelado:"bg-gray-100 text-gray-800"}[t]||"bg-gray-100 text-gray-800"}`}getStatusLabel(t){return{pendiente:"Pendiente",pagado:"Pagado",vencido:"Vencido",cancelado:"Cancelado"}[t]||t}canEdit(t){return t.status==="pendiente"||t.status==="vencido"}canDelete(t){return t.status!=="pagado"}canCancel(t){return t.status==="pendiente"||t.status==="vencido"}canMarkAsPaid(t){return t.status==="pendiente"||t.status==="vencido"}static \u0275fac=function(e){return new(e||a)(p(G),p(O),p(B))};static \u0275cmp=M({type:a,selectors:[["app-contract-payments"]],inputs:{contractId:"contractId",currency:"currency"},features:[j([I])],decls:11,vars:6,consts:[[1,"payments-container"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-base","font-semibold","text-gray-800"],[1,"flex","gap-2"],["text","Generar Pagos","custom_class","btn_primary","size","sm",3,"icon","loading","clicked",4,"ngIf"],["text","Actualizar","custom_class","btn_secondary","size","sm",3,"icon","clicked",4,"ngIf"],["class","grid grid-cols-4 gap-3 mb-4",4,"ngIf"],["class","text-center py-8",4,"ngIf"],["class","text-center py-8 text-gray-500",4,"ngIf"],["class","overflow-x-auto",4,"ngIf"],["text","Generar Pagos","custom_class","btn_primary","size","sm",3,"clicked","icon","loading"],["text","Actualizar","custom_class","btn_secondary","size","sm",3,"clicked","icon"],[1,"grid","grid-cols-4","gap-3","mb-4"],[1,"bg-blue-50","p-3","rounded-lg","border","border-blue-200"],[1,"text-xs","text-blue-600","font-medium"],[1,"text-lg","font-bold","text-blue-900"],[1,"bg-green-50","p-3","rounded-lg","border","border-green-200"],[1,"text-xs","text-green-600","font-medium"],[1,"text-lg","font-bold","text-green-900"],[1,"text-xs","text-green-700"],[1,"bg-yellow-50","p-3","rounded-lg","border","border-yellow-200"],[1,"text-xs","text-yellow-600","font-medium"],[1,"text-lg","font-bold","text-yellow-900"],[1,"text-xs","text-yellow-700"],[1,"bg-red-50","p-3","rounded-lg","border","border-red-200"],[1,"text-xs","text-red-600","font-medium"],[1,"text-lg","font-bold","text-red-900"],[1,"text-center","py-8"],[1,"text-sm","text-gray-500"],[1,"text-center","py-8","text-gray-500"],[1,"text-sm"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-3","py-2","text-left","text-xs","font-medium","text-gray-500","uppercase"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"hover:bg-gray-50"],[1,"px-3","py-2","text-sm","font-medium","text-gray-900"],[1,"px-3","py-2","text-sm","text-gray-900"],[1,"px-3","py-2","text-sm","text-gray-600"],[1,"px-3","py-2"],[1,"flex","gap-1"],["class","p-1 text-green-600 hover:bg-green-50 rounded transition-colors","title","Marcar como Pagado",3,"click",4,"ngIf"],["class","p-1 text-blue-600 hover:bg-blue-50 rounded transition-colors","title","Editar",3,"click",4,"ngIf"],["class","p-1 text-orange-600 hover:bg-orange-50 rounded transition-colors","title","Cancelar",3,"click",4,"ngIf"],["class","p-1 text-red-600 hover:bg-red-50 rounded transition-colors","title","Eliminar",3,"click",4,"ngIf"],["title","Marcar como Pagado",1,"p-1","text-green-600","hover:bg-green-50","rounded","transition-colors",3,"click"],[3,"img","size"],["title","Editar",1,"p-1","text-blue-600","hover:bg-blue-50","rounded","transition-colors",3,"click"],["title","Cancelar",1,"p-1","text-orange-600","hover:bg-orange-50","rounded","transition-colors",3,"click"],["title","Eliminar",1,"p-1","text-red-600","hover:bg-red-50","rounded","transition-colors",3,"click"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"h4",2),c(3,"Pagos del Contrato"),i(),o(4,"div",3),S(5,Ct,1,2,"app-button",4)(6,ht,1,1,"app-button",5),i()(),S(7,St,27,12,"div",6)(8,Pt,3,0,"div",7)(9,Dt,3,0,"div",8)(10,Tt,22,1,"div",9),i()),e&2&&(r(5),s("ngIf",n.payments().length===0),r(),s("ngIf",n.payments().length>0),r(),s("ngIf",n.stats()),r(),s("ngIf",n.loading()),r(),s("ngIf",!n.loading()&&n.payments().length===0),r(),s("ngIf",!n.loading()&&n.payments().length>0))},dependencies:[E,pe,F,w,T,k,V,R],styles:["table[_ngcontent-%COMP%]{font-size:.875rem}"]})};var ae=class a{constructor(t){this.http=t}api=W.api;getContracts(t){return this.http.get(`${this.api}/tenant/contracts`,{params:t})}getContract(t){return this.http.get(`${this.api}/tenant/contracts/${t}`)}getContractByNumber(t){return this.http.get(`${this.api}/tenant/contracts/by-number/${t}`)}getContractStats(){return this.http.get(`${this.api}/tenant/contracts/stats`)}createContract(t){return this.http.post(`${this.api}/tenant/contracts`,t)}updateContract(t,e){return this.http.put(`${this.api}/tenant/contracts/${t}`,e)}deleteContract(t){return this.http.delete(`${this.api}/tenant/contracts/${t}`)}static \u0275fac=function(e){return new(e||a)(X(Q))};static \u0275prov=q({token:a,factory:a.\u0275fac,providedIn:"root"})};var At=(a,t,e,n)=>({"bg-green-100 text-green-800":a,"bg-blue-100 text-blue-800":t,"bg-red-100 text-red-800":e,"bg-yellow-100 text-yellow-800":n});function $t(a,t){if(a&1){let e=D();o(0,"div",41)(1,"span",42),d("click",function(){y(e);let l=m();return b(l.navigateToCustomer())}),c(2),i()()}if(a&2){let e=m();r(2),x(" ",e.getCustomerName()," ")}}function Rt(a,t){if(a&1){let e=D();o(0,"span",43),d("click",function(){y(e);let l=m();return b(l.openPropertyModal())}),c(1),i()}if(a&2){let e=m();r(),x(" ",e.data.contract.property.code," ")}}function Nt(a,t){a&1&&(o(0,"span",44),c(1,"\u2014"),i())}function jt(a,t){if(a&1){let e=D();o(0,"app-button",45),d("clicked",function(){y(e);let l=m();return b(l.saveContract())}),i()}if(a&2){let e=m();s("loading",e.saving())}}var Se=class a{constructor(t,e,n,l,u,h,ce,Pe){this.dialog=t;this.dialog_ref=e;this.data=n;this.router=l;this.propertyService=u;this.contractService=h;this.interceptorService=ce;this.fb=Pe;this.form=this.fb.group({contract_date:[this.data.contract.contract_date,C.required],total_price:[this.data.contract.total_price,[C.required,C.min(0)]],down_payment:[this.data.contract.down_payment,[C.required,C.min(0)]],remaining_balance:[this.data.contract.remaining_balance,[C.required,C.min(0)]],payment_months:[this.data.contract.payment_months,[C.required,C.min(0)]],monthly_payment:[this.data.contract.monthly_payment,[C.required,C.min(0)]],first_payment_date:[this.data.contract.first_payment_date,C.required],currency:[this.data.contract.currency||"USD",C.required],status:[this.data.contract.status,C.required],notes:[this.data.contract.notes||""]}),this.statusSelectConfig.form_control=this.form.get("status")}X=A;form;saving=P(!1);activeTab=P("edit");statusSelectConfig={placeholder:"Selecciona un estado",data:[{value:"activo",label:"Activo"},{value:"completado",label:"Completado"},{value:"cancelado",label:"Cancelado"},{value:"suspendido",label:"Suspendido"}],value:"value",option:"label",form_control:null};ngOnInit(){}setActiveTab(t){this.activeTab.set(t)}saveContract(){if(this.form.invalid){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Por favor completa todos los campos requeridos"});return}this.saving.set(!0),this.contractService.updateContract(this.data.contract.id,this.form.value).subscribe({next:()=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Contrato actualizado correctamente"}),this.dialog_ref.close(!0)},error:t=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:t.error?.message||"Error al actualizar el contrato"})}})}closeDialog(){this.dialog_ref.close()}navigateToCustomer(){this.data.contract.customer&&(this.dialog_ref.close(),this.router.navigate(["/customers/detail",this.data.contract.customer.id]))}openPropertyModal(){this.data.contract.property&&this.propertyService.getProperty(this.data.contract.property.id).subscribe({next:t=>{this.dialog.open(ve,{data:{property:t}})}})}getStatusClass(t){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{activo:"bg-green-100 text-green-800",completado:"bg-blue-100 text-blue-800",cancelado:"bg-red-100 text-red-800",suspendido:"bg-yellow-100 text-yellow-800"}[t]||"bg-gray-100 text-gray-800"}`}getStatusLabel(t){return{activo:"Activo",completado:"Completado",cancelado:"Cancelado",suspendido:"Suspendido"}[t]||t}getCustomerName(){return this.data.contract.customer?`${this.data.contract.customer.name} ${this.data.contract.customer.lastname}`:"\u2014"}static \u0275fac=function(e){return new(e||a)(p(B),p(z),p(L),p(de),p(_e),p(ae),p(O),p(Y))};static \u0275cmp=M({type:a,selectors:[["app-contract-detail-modal"]],features:[j([I])],decls:109,vars:76,consts:[[1,"dialog"],[1,"dialog__header"],[1,"flex","items-center","gap-2"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium",3,"ngClass"],["class","mt-1",4,"ngIf"],[1,"close","cursor-pointer",3,"click","img"],[1,"tabs","px-6","pt-4"],[1,"tab",3,"click"],[1,"contract-summary","px-6","py-3","bg-gray-50","border-b","border-gray-200"],[1,"grid","grid-cols-7","gap-3","text-xs"],[1,"block","text-gray-500","font-medium","mb-0.5"],[1,"text-gray-900","font-semibold"],[1,"text-green-600","font-semibold"],[1,"text-red-600","font-semibold"],[1,"dialog__body"],[1,"tab-content"],[1,"mb-2","p-1.5","bg-gray-50","rounded-lg","border","border-gray-200"],[1,"grid","grid-cols-2","gap-2","text-xs"],[1,"block","font-semibold","text-gray-500","mb-0.5"],[1,"text-gray-600"],[1,"space-y-2.5",3,"formGroup"],[1,"grid","grid-cols-2","gap-2.5"],[1,"block","text-xs","font-semibold","text-gray-500","mb-1"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-purple-100","text-purple-800"],["class","inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 cursor-pointer hover:bg-green-200 transition-colors",3,"click",4,"ngIf"],["class","text-gray-900",4,"ngIf"],["label","Fecha del Contrato",3,"form_control"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"config"],["label","Precio Total","type","number",3,"form_control"],["label","Enganche","type","number",3,"form_control"],["label","Saldo Pendiente","type","number",3,"form_control"],["label","Meses de Pago","type","number",3,"form_control"],["label","Pago Mensual","type","number",3,"form_control"],["label","Primer Pago",3,"form_control"],["label","Notas","type","textarea",3,"form_control"],[3,"contractId","currency"],[3,"contractId"],[1,"dialog__footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Guardar Cambios","custom_class","btn_primary",3,"loading","clicked",4,"ngIf"],[1,"mt-1"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-blue-100","text-blue-800","cursor-pointer","hover:bg-blue-200","transition-colors",3,"click"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-green-100","text-green-800","cursor-pointer","hover:bg-green-200","transition-colors",3,"click"],[1,"text-gray-900"],["text","Guardar Cambios","custom_class","btn_primary",3,"clicked","loading"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"div",1)(2,"div")(3,"div",2)(4,"h2"),c(5),i(),o(6,"span",3),c(7),_(8,"titlecase"),i()(),S(9,$t,3,1,"div",4),i(),o(10,"lucide-icon",5),d("click",function(){return n.closeDialog()}),i()(),o(11,"div",6)(12,"button",7),d("click",function(){return n.setActiveTab("edit")}),c(13," Editar "),i(),o(14,"button",7),d("click",function(){return n.setActiveTab("payments")}),c(15," Pagos "),i(),o(16,"button",7),d("click",function(){return n.setActiveTab("documents")}),c(17," Documentos "),i()(),o(18,"div",8)(19,"div",9)(20,"div")(21,"span",10),c(22,"Fecha Contrato"),i(),o(23,"span",11),c(24),_(25,"localDate"),i()(),o(26,"div")(27,"span",10),c(28,"Precio Total"),i(),o(29,"span",11),c(30),_(31,"currency"),i()(),o(32,"div")(33,"span",10),c(34,"Enganche"),i(),o(35,"span",11),c(36),_(37,"currency"),i()(),o(38,"div")(39,"span",10),c(40,"Total Pagado"),i(),o(41,"span",12),c(42),_(43,"currency"),i()(),o(44,"div")(45,"span",10),c(46,"Saldo Pendiente"),i(),o(47,"span",13),c(48),_(49,"currency"),i()(),o(50,"div")(51,"span",10),c(52,"Meses de Pago"),i(),o(53,"span",11),c(54),i()(),o(55,"div")(56,"span",10),c(57,"Pago Mensual"),i(),o(58,"span",11),c(59),_(60,"currency"),i()()()(),o(61,"div",14)(62,"div",15)(63,"div",16)(64,"div",17)(65,"div")(66,"span",18),c(67,"Creado"),i(),o(68,"span",19),c(69),_(70,"date"),i()(),o(71,"div")(72,"span",18),c(73,"Actualizado"),i(),o(74,"span",19),c(75),_(76,"date"),i()()()(),o(77,"div",20)(78,"div",21)(79,"div")(80,"span",22),c(81,"N\xFAmero de Contrato"),i(),o(82,"span",23),c(83),i()(),o(84,"div")(85,"span",22),c(86,"Lote"),i(),S(87,Rt,2,1,"span",24)(88,Nt,2,0,"span",25),i()(),o(89,"div",21),f(90,"app-input",26),o(91,"div")(92,"label",27),c(93,"Estado"),i(),f(94,"app-select",28),i(),f(95,"app-input",29)(96,"app-input",30)(97,"app-input",31)(98,"app-input",32)(99,"app-input",33)(100,"app-input",34),i(),f(101,"app-input",35),i()(),o(102,"div",15),f(103,"app-contract-payments",36),i(),o(104,"div",15),f(105,"app-contract-documents",37),i()(),o(106,"div",38)(107,"app-button",39),d("clicked",function(){return n.closeDialog()}),i(),S(108,jt,1,1,"app-button",40),i()()),e&2&&(N("dialog--wide",n.activeTab()==="payments"),r(5),x("Contrato ",n.data.contract.contract_number),r(),s("ngClass",ze(71,At,n.data.contract.status==="activo",n.data.contract.status==="completado",n.data.contract.status==="cancelado",n.data.contract.status==="suspendido")),r(),x(" ",Le(8,45,n.data.contract.status)," "),r(2),s("ngIf",n.data.contract.customer),r(),s("img",n.X),r(2),N("active",n.activeTab()==="edit"),r(2),N("active",n.activeTab()==="payments"),r(2),N("active",n.activeTab()==="documents"),r(8),g(v(25,47,n.data.contract.contract_date,"mediumDate")),r(6),g(v(31,50,n.data.contract.total_price,n.data.contract.currency)),r(6),g(v(37,53,n.data.contract.down_payment,n.data.contract.currency)),r(6),g(v(43,56,n.data.contract.total_price-n.data.contract.remaining_balance,n.data.contract.currency)),r(6),g(v(49,59,n.data.contract.remaining_balance,n.data.contract.currency)),r(6),x("",n.data.contract.payment_months," meses"),r(5),g(v(60,62,n.data.contract.monthly_payment,n.data.contract.currency)),r(3),N("active",n.activeTab()==="edit"),r(7),g(v(70,65,n.data.contract.created_at,"medium")),r(6),g(v(76,68,n.data.contract.updated_at,"medium")),r(2),s("formGroup",n.form),r(6),x(" ",n.data.contract.contract_number," "),r(4),s("ngIf",n.data.contract.property),r(),s("ngIf",!n.data.contract.property),r(2),s("form_control",n.form.controls.contract_date),r(4),s("config",n.statusSelectConfig),r(),s("form_control",n.form.controls.total_price),r(),s("form_control",n.form.controls.down_payment),r(),s("form_control",n.form.controls.remaining_balance),r(),s("form_control",n.form.controls.payment_months),r(),s("form_control",n.form.controls.monthly_payment),r(),s("form_control",n.form.controls.first_payment_date),r(),s("form_control",n.form.controls.notes),r(),N("active",n.activeTab()==="payments"),r(),s("contractId",n.data.contract.id)("currency",n.data.contract.currency),r(),N("active",n.activeTab()==="documents"),r(),s("contractId",n.data.contract.id),r(3),s("ngIf",n.activeTab()==="edit"))},dependencies:[E,Ge,F,Z,J,K,w,ee,fe,T,k,be,he,Ue,V,I,R],styles:[".dialog[_ngcontent-%COMP%]{width:100dvw;max-width:900px;height:85vh;max-height:92vh;margin:.75rem auto;display:flex;flex-direction:column;transition:max-width .3s ease}.dialog.dialog--wide[_ngcontent-%COMP%]{max-width:1200px}.dialog__header[_ngcontent-%COMP%]{padding:.875rem 1.125rem;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}.dialog__header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:600;color:#111827}.dialog__header[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{cursor:pointer;color:#6b7280;transition:color .2s}.dialog__header[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover{color:#111827}.dialog__body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:.625rem 1.125rem;min-height:0}.dialog__footer[_ngcontent-%COMP%]{padding:.75rem 1.125rem;border-top:1px solid #e5e7eb;display:flex;justify-content:flex-end;gap:.625rem;flex-shrink:0}.tabs[_ngcontent-%COMP%]{display:flex;border-bottom:2px solid #e5e7eb;margin-bottom:.625rem;gap:.25rem;flex-shrink:0}.tab[_ngcontent-%COMP%]{padding:.5rem .75rem;font-size:.875rem;font-weight:500;color:#6b7280;background:none;border:none;border-bottom:2px solid transparent;margin-bottom:-2px;cursor:pointer;transition:all .2s}.tab[_ngcontent-%COMP%]:hover{color:#111827}.tab.active[_ngcontent-%COMP%]{color:#6366f1;border-bottom-color:#6366f1}.tab-content[_ngcontent-%COMP%]{display:none}.tab-content.active[_ngcontent-%COMP%]{display:block}"]})};var Vt=["tableTemplate"];function zt(a,t){if(a&1){let e=D();o(0,"span",14),d("click",function(l){y(e);let u=m().$implicit;return m().navigateToCustomer(u.customer.id),b(l.stopPropagation())}),c(1),i()}if(a&2){let e=m().$implicit,n=m();s("title",n.getCustomerName(e)),r(),x(" ",n.getCustomerName(e)," ")}}function Lt(a,t){a&1&&(o(0,"span",15),c(1,"\u2014"),i())}function Bt(a,t){if(a&1){let e=D();o(0,"span",16),d("click",function(l){y(e);let u=m().$implicit;return m().navigateToProperty(u.property.id),b(l.stopPropagation())}),c(1),i()}if(a&2){let e=m().$implicit;r(),x(" ",e.property.code," ")}}function Gt(a,t){a&1&&(o(0,"span",15),c(1,"\u2014"),i())}function Ut(a,t){if(a&1){let e=D();o(0,"td")(1,"span",8),c(2),i()(),o(3,"td"),S(4,zt,2,2,"span",9)(5,Lt,2,0,"span",10),i(),o(6,"td"),S(7,Bt,2,1,"span",11)(8,Gt,2,0,"span",10),i(),o(9,"td"),c(10),_(11,"date"),i(),o(12,"td"),c(13),_(14,"currency"),i(),o(15,"td"),c(16),_(17,"currency"),i(),o(18,"td"),c(19),_(20,"date"),i(),o(21,"td")(22,"span"),c(23),i()(),o(24,"td",12),d("click",function(l){return y(e),b(l.stopPropagation())}),o(25,"app-button",13),d("clicked",function(){let l=y(e).$implicit,u=m();return b(u.viewDetail(l))}),i()()}if(a&2){let e=t.$implicit,n=m();r(2),x(" ",e.contract_number," "),r(2),s("ngIf",e.customer),r(),s("ngIf",!e.customer),r(2),s("ngIf",e.property),r(),s("ngIf",!e.property),r(2),g(v(11,14,e.contract_date,"mediumDate")),r(3),g(v(14,17,e.total_price,e.currency)),r(3),g(v(17,20,e.remaining_balance,e.currency)),r(3),g(v(20,23,e.first_payment_date,"mediumDate")),r(3),H(n.getStatusClass(e.status)),r(),x(" ",n.getStatusLabel(e.status)," "),r(2),s("fullWidth",!1)("icon",n.ArrowRight)}}var pt=class a{constructor(t,e,n,l,u){this.router=t;this.route=e;this.contractService=n;this.propertyService=l;this.dialog=u;this.route.queryParams.pipe(we(this.destroy$)).subscribe(h=>{let ce=JSON.stringify(h);if(ce===this.lastQueryParams)return;this.lastQueryParams=ce,this.search=h?.search??"";let Pe=h?.page?Number(h.page):1,Me=h?.limit?Number(h.limit):20;this.table_config.update(dt=>se(U({},dt),{page:isNaN(Pe)?1:Pe,limit:isNaN(Me)?20:Me})),this.getContracts()})}tableTemplate;table_config=P({rows:[],columns:[{name:"N\xFAmero",prop:"contract_number",sortable:!0,canAutoResize:!0,width:120},{name:"Cliente",prop:"customer",sortable:!1,canAutoResize:!1,width:200},{name:"Lote",prop:"property",sortable:!1,canAutoResize:!0,width:120},{name:"Fecha",prop:"contract_date",sortable:!0,canAutoResize:!0,width:120},{name:"Precio Total",prop:"total_price",sortable:!0,canAutoResize:!0,width:120},{name:"Saldo Pendiente",prop:"remaining_balance",sortable:!0,canAutoResize:!0,width:130},{name:"Siguiente Pago",prop:"first_payment_date",sortable:!0,canAutoResize:!0,width:130},{name:"Estado",prop:"status",sortable:!0,canAutoResize:!0,width:100},{name:"Acciones",prop:"actions",sortable:!1,canAutoResize:!0,width:120}],externalPaging:!0,externalSorting:!0,page:1,limit:20,totalResults:0,loading:!1,emptyState:{title:"Sin resultados",subtitle:"No se encontraron contratos"},columnMode:"force",reorderable:!1});ArrowRight=Xe;search="";currentSort=null;destroy$=new Ee;lastQueryParams="";ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getContracts(){this.table_config.update(n=>se(U({},n),{loading:!0}));let t=this.table_config(),e=U(U({page:t.page,limit:t.limit},this.search&&{search:this.search}),this.currentSort&&this.currentSort.direction&&{sort:this.currentSort.column.prop,order:this.currentSort.direction});this.contractService.getContracts(e).subscribe(n=>{let l=Array.isArray(n)?n:n?.data??[],u=Array.isArray(n)?n.length:n?.total??0,h=Array.isArray(n)?!1:n?.hasNext??!1;this.table_config.update(ce=>se(U({},ce),{rows:l,totalResults:u,hasNext:h,loading:!1}))})}onPageChange(t){this.router.navigate([],{relativeTo:this.route,queryParams:{page:t.page,limit:t.limit,search:this.search||void 0},queryParamsHandling:"merge"})}onSortChange(t){this.currentSort=t,this.table_config.update(e=>se(U({},e),{page:1})),this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,search:this.search||void 0},queryParamsHandling:"merge"})}onRowClick(t){this.viewDetail(t)}onSearchChange(t){this.search=t,this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,search:t||void 0},queryParamsHandling:"merge"})}createContract(){console.log("Create contract")}viewDetail(t){this.dialog.open(Se,{data:{contract:t}})}navigateToCustomer(t){this.router.navigate(["/customers/detail",t])}navigateToProperty(t){this.propertyService.getProperty(t).subscribe({next:e=>{this.dialog.open(ve,{data:{property:e}})},error:e=>{console.error("Error loading property:",e)}})}getStatusClass(t){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{activo:"bg-green-100 text-green-800",completado:"bg-blue-100 text-blue-800",cancelado:"bg-red-100 text-red-800",suspendido:"bg-yellow-100 text-yellow-800"}[t]||"bg-gray-100 text-gray-800"}`}getStatusLabel(t){return{activo:"Activo",completado:"Completado",cancelado:"Cancelado",suspendido:"Suspendido"}[t]||t}getCustomerName(t){return t.customer?`${t.customer.name} ${t.customer.lastname}`:"\u2014"}static \u0275fac=function(e){return new(e||a)(p(de),p(qe),p(ae),p(_e),p(B))};static \u0275cmp=M({type:a,selectors:[["app-contracts-list"]],viewQuery:function(e,n){if(e&1&&Oe(Vt,5),e&2){let l;Fe(l=Ae())&&(n.tableTemplate=l.first)}},decls:10,vars:3,consts:[["tableTemplate",""],[1,"p-6","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],[1,"flex","flex-col","gap-4","md:flex-row","md:items-center","md:justify-between","mb-5"],[1,"text-2xl","font-semibold","text-gray-800"],[1,"flex","items-center","gap-3"],["param_name","search",1,"w-64",3,"searchChange","param_activate"],["text","Crear Contrato","custom_class","btn_primary",3,"clicked"],[3,"pageChange","sortChange","rowClick","config","rowTemplate"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-purple-100","text-purple-800","whitespace-nowrap"],["class","inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 cursor-pointer hover:bg-blue-200 transition-colors max-w-[200px] truncate",3,"title","click",4,"ngIf"],["class","text-sm text-gray-400",4,"ngIf"],["class","inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800 whitespace-nowrap cursor-pointer hover:bg-green-200 transition-colors",3,"click",4,"ngIf"],[3,"click"],["text","Detalle","size","sm","custom_class","btn_primary",3,"clicked","fullWidth","icon"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-blue-100","text-blue-800","cursor-pointer","hover:bg-blue-200","transition-colors","max-w-[200px]","truncate",3,"click","title"],[1,"text-sm","text-gray-400"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-green-100","text-green-800","whitespace-nowrap","cursor-pointer","hover:bg-green-200","transition-colors",3,"click"]],template:function(e,n){if(e&1){let l=D();o(0,"div",1)(1,"div",2)(2,"h2",3),c(3,"Contratos"),i(),o(4,"div",4)(5,"app-search",5),d("searchChange",function(h){return y(l),b(n.onSearchChange(h))}),i(),o(6,"app-button",6),d("clicked",function(){return y(l),b(n.createContract())}),i()()(),o(7,"app-datatable-wrapper",7),d("pageChange",function(h){return y(l),b(n.onPageChange(h))})("sortChange",function(h){return y(l),b(n.onSortChange(h))})("rowClick",function(h){return y(l),b(n.onRowClick(h))}),i()(),S(8,Ut,26,26,"ng-template",null,0,Be)}if(e&2){let l=$e(9);r(5),s("param_activate",!0),r(2),s("config",n.table_config())("rowTemplate",l)}},dependencies:[E,F,ct,at,w,V,I],encapsulation:2})};export{pt as ContractsListComponent};
