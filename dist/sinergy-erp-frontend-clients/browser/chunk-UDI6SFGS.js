import{b as x,f as B,h as z,i as K,j as Q,k as W}from"./chunk-WEYOGA7X.js";import{a as J}from"./chunk-SJ2MQSEX.js";import{c as V,d as X,e as U,k as Y}from"./chunk-OANT22MG.js";import{c,f as $,l as F,q as R,s as y,t as H,v as q}from"./chunk-MQV4I3IR.js";import{A as w,B as b,C as P,y as j,z as k}from"./chunk-PIG46PEF.js";import{A as N,m as v,t as _,y as T}from"./chunk-66A2AKCP.js";import{Ab as r,Bb as s,Cb as p,Db as g,Ob as G,Q as L,Qa as i,Qb as O,U as u,Za as l,cc as f,db as m,dc as h,ga as M,la as d,tb as A,vb as E}from"./chunk-56XCPM73.js";import{a as D,b as I}from"./chunk-7CGTOI24.js";var C=class a{constructor(e,o,t){this.router=e;this.http=o;this.activated_route=t}api=b.api;getLeads(e){return this.http.get(`${this.api}/leads`,{params:e})}getDetail(e){return this.http.get(`${this.api}/leads/${e}`)}createLead(e){return this.http.post(`${this.api}/leads`,e)}updateLead(e){return this.http.put(`${this.api}/leads/${e.id}`,e)}createActivity(e){return this.http.post(`${this.api}/leads/${e.lead_id}/activities`,e)}getLeadsStats(){return this.http.get(`${this.api}/leads/stats/overview`)}static \u0275fac=function(o){return new(o||a)(u(N),u(_),u(T))};static \u0275prov=L({token:a,factory:a.\u0275fac,providedIn:"root"})};function re(a,e){if(a&1&&(s(0,"label",0),f(1),p()),a&2){let o=O();i(),h(o.label)}}var S=class a{constructor(e){this.http=e}control=null;groupType="lead";label="";groupSelected=new M;groups=d([]);loading=d(!1);api=b.api;ngOnInit(){this.loadGroups()}selectConfig(){return{placeholder:"Selecciona un grupo",data:this.groups(),value:"id",option:"displayName",form_control:this.control,loading:this.loading()}}loadGroups(){this.loading.set(!0);let e=this.groupType==="lead"?"/lead-groups":"/customer-groups";this.http.get(`${this.api}${e}`).subscribe({next:o=>{let t=Array.isArray(o)?o:o.groups||o.data||[];this.groups.set(t.map(n=>({id:n.id,name:n.name,count:n.lead_count||n.customer_count||0,displayName:`${n.name} (${n.lead_count||n.customer_count||0})`}))),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.groups.set([])}})}static \u0275fac=function(o){return new(o||a)(l(_))};static \u0275cmp=m({type:a,selectors:[["app-group-select"]],inputs:{control:"control",groupType:"groupType",label:"label"},outputs:{groupSelected:"groupSelected"},decls:3,vars:3,consts:[[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[3,"config","has_error"]],template:function(o,t){o&1&&(s(0,"div"),A(1,re,2,1,"label",0),g(2,"app-select",1),p()),o&2&&(i(),E(t.label?1:-1),i(),r("config",t.selectConfig())("has_error",(t.control==null?null:t.control.invalid)&&(t.control==null?null:t.control.touched)))},dependencies:[v,y,J],encapsulation:2})};var ee=class a{constructor(e,o,t,n,ae,ne,le){this.fb=e;this.dialog=o;this.dialog_ref=t;this.data=n;this.lead_service=ae;this.interceptor_service=ne;this.auth_service=le;this.form=this.fb.group({name:["",[c.required]],lastname:["",[c.required]],email:[""],phone:["",[c.required]],phone_code:["+1",[c.required]],phone_country:["US",[c.required]],source:[""],status_id:[""],company_name:[""],website:[""],group_id:[""]}),this.data?.id&&(this.form.patchValue({name:this.data.name,lastname:this.data.lastname,email:this.data.email,phone:this.data.phone,phone_code:this.data.phone_code,phone_country:this.data.phone_country,source:this.data.source,status_id:this.data?.status?.id,company_name:this.data.company_name,website:this.data.website,group_id:this.data.group_id||""}),this.selectedGroupId.set(this.data.group_id||null))}loading=d(!1);update=d(!1);selectedGroupId=d(null);X=j;form;ngOnInit(){}onGroupSelected(e){this.selectedGroupId.set(e),this.form.patchValue({group_id:e})}get phoneCodeControl(){return this.form.get("phone_code")}get phoneCountryControl(){return this.form.get("phone_country")}get groupControl(){return this.form.get("group_id")}getPhoneCodeControl(){return this.form.get("phone_code")}getPhoneCountryControl(){return this.form.get("phone_country")}getGroupControl(){return this.form.get("group_id")}closeDialog(){this.loading()||this.dialog_ref.close(this.update())}submit(){this.data?.id?this.updateLead():this.createLead()}updateLead(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading.set(!0);let e=I(D({id:this.data.id},this.form.value),{group_id:this.selectedGroupId()});this.lead_service.updateLead(e).subscribe({next:()=>{this.update.set(!0),this.loading.set(!1),this.interceptor_service.openSnackbar({type:"success",title:"\xC9xito",message:"Lead actualizado exitosamente."})},error:()=>{this.loading.set(!1),this.interceptor_service.openSnackbar({type:"error",title:"Error",message:"No pudimos actualizar el lead. Por favor intenta de nuevo."})}})}createLead(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading.set(!0);let e=I(D({tenant_id:this.auth_service.user_info.tenant_id,status_id:1},this.form.value),{group_id:this.selectedGroupId()});this.lead_service.createLead(e).subscribe({next:()=>{this.update.set(!0),this.loading.set(!1),this.interceptor_service.openSnackbar({type:"success",title:"\xC9xito",message:"Lead creado exitosamente."}),this.closeDialog()},error:()=>{this.loading.set(!1),this.interceptor_service.openSnackbar({type:"error",title:"Error",message:"No pudimos crear el lead. Por favor intenta de nuevo."})}})}static \u0275fac=function(o){return new(o||a)(l(R),l(U),l(V),l(X),l(C),l(Y),l(P))};static \u0275cmp=m({type:a,selectors:[["app-lead-edit-dialog"]],decls:18,vars:15,consts:[[1,"dialog"],[1,"dialog__header"],[1,"close","cursor-pointer",3,"click","img"],[1,"dialog__body"],[1,"container","grid","grid-cols-1","md:grid-cols-2","gap-4",3,"formGroup"],["label","Nombre",3,"form_control"],["label","Apellido",3,"form_control"],["label","Email",3,"form_control"],["label","Tel\xE9fono","appPhoneDigits","",3,"form_control"],[3,"control"],["label","Nombre de la empresa",3,"form_control"],["label","Sitio web",3,"form_control"],["groupType","lead",3,"control","label"],[1,"dialog__footer"],["custom_class","btn_primary",3,"click","text","loading"]],template:function(o,t){o&1&&(s(0,"div",0)(1,"div",1)(2,"h2"),f(3),p(),s(4,"lucide-icon",2),G("click",function(){return t.closeDialog()}),p()(),s(5,"div",3)(6,"div",4),g(7,"app-input",5)(8,"app-input",6)(9,"app-input",7)(10,"app-input",8)(11,"app-phone-code-select",9)(12,"app-phone-country-select",9)(13,"app-input",10)(14,"app-input",11)(15,"app-group-select",12),p()(),s(16,"div",13)(17,"app-button",14),G("click",function(){return t.submit()}),p()()()),o&2&&(i(3),h(t.data.id?"Actualizar lead":"Crear lead"),i(),r("img",t.X),i(2),r("formGroup",t.form),i(),r("form_control",t.form.controls.name),i(),r("form_control",t.form.controls.lastname),i(),r("form_control",t.form.controls.email),i(),r("form_control",t.form.controls.phone),i(),r("control",t.getPhoneCodeControl()),i(),r("control",t.getPhoneCountryControl()),i(),r("form_control",t.form.controls.company_name),i(),r("form_control",t.form.controls.website),i(),r("control",t.getGroupControl())("label","Grupo"),i(2),r("text",t.data.id?"Actualizar":"Crear")("loading",t.loading()))},dependencies:[v,B,z,x,q,w,k,H,y,$,F,S,K,Q,W],styles:[".dialog[_ngcontent-%COMP%]{width:100dvw;max-width:700px}"]})};export{C as a,ee as b};
