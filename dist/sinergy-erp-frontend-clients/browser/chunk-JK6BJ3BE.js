import{a as R,b as Tt}from"./chunk-DXMKZQEY.js";import{a as Nt}from"./chunk-U35SLASU.js";import{a as Dt}from"./chunk-5XN6F6LE.js";import{a as St,b as G,c as Ft,d as yt,f as Et,h as V,i as kt}from"./chunk-3EZ4E46M.js";import"./chunk-HO6VT44Y.js";import{a as It}from"./chunk-ESGHQXLB.js";import"./chunk-CKDP52D7.js";import{J as Lt}from"./chunk-RBHIJQFK.js";import{r as Mt,v as wt}from"./chunk-7TNFDLAZ.js";import{A as Pt}from"./chunk-5MRBIJ7N.js";import{A as Ot,c as k,d as A,e as Ct,j as vt,m as P,t as xt,y as bt}from"./chunk-UZLFZEBK.js";import{$b as ut,Ab as L,Ac as W,Cc as ft,Db as ct,Eb as dt,Fb as u,Gb as a,H as at,Hb as r,Ib as C,Lc as ht,N as Q,O as rt,Pb as h,S as ot,Ta as s,Tb as _,Vb as m,W as st,Zb as pt,_b as gt,aa as p,ab as b,ba as g,c as Z,cc as mt,d as q,dc as I,e as tt,gb as O,gc as T,hc as d,ia as w,ic as f,j as et,jc as S,kc as _t,m as nt,mb as M,na as lt,rc as N,ta as E,y as it,yb as D,yc as H}from"./chunk-NOG5ANO3.js";import{a as v,b as x}from"./chunk-7CGTOI24.js";var Rt=o=>({active:o});function zt(o,e){if(o&1){let t=h();a(0,"div",3),_("click",function(){let i=p(t).$implicit,l=m();return g(l.onCardClick(i.filter))}),a(1,"div",4)(2,"div",5),d(3),r(),a(4,"div",6)(5,"p",7),d(6),r(),a(7,"p",8),d(8),r()()(),C(9,"div",9),r()}if(o&2){let t=e.$implicit,n=m();u("ngClass",N(5,Rt,n.isActive(t.filter))),s(3),f(t.icon),s(3),f(t.title),s(2),f(t.value),s(),u("ngClass","gradient-"+t.gradient)}}var z=class o{constructor(e,t){this.leadsService=e;this.cdr=t}activeFilter=null;filterChange=new w;stats=[];loading=!1;ngOnInit(){this.loadStats()}loadStats(){this.loading=!0,this.cdr.markForCheck(),this.leadsService.getLeadsStats().subscribe({next:e=>{this.stats=[{title:"Total de Leads",value:e.total_leads,icon:"\u{1F4CA}",gradient:"from-blue-500 to-blue-600",filter:null},{title:"No Contactados",value:e.not_contacted,icon:"\u{1F4E7}",gradient:"from-gray-500 to-gray-600",filter:"not_contacted"},{title:"Contactados",value:e.customer_responded_no_reply,icon:"\u23F3",gradient:"from-orange-500 to-orange-600",filter:"contacted_no_response"},{title:"Cliente Respondi\xF3",value:e.customer_responded,icon:"\u2705",gradient:"from-green-500 to-green-600",filter:"customer_responded"}],this.loading=!1,this.cdr.markForCheck()},error:()=>{this.loading=!1,this.cdr.markForCheck()}})}onCardClick(e){this.filterChange.emit(e)}isActive(e){return this.activeFilter===e}static \u0275fac=function(t){return new(t||o)(b(R),b(ht))};static \u0275cmp=O({type:o,selectors:[["app-leads-stats"]],inputs:{activeFilter:"activeFilter"},outputs:{filterChange:"filterChange"},decls:3,vars:1,consts:[[1,"stats-container"],[1,"stats-grid"],["class","stat-card",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"stat-card",3,"click","ngClass"],[1,"card-content"],[1,"icon"],[1,"info"],[1,"title"],[1,"value"],[3,"ngClass"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1),M(2,zt,10,7,"div",2),r()()),t&2&&(s(2),u("ngForOf",n.stats))},dependencies:[P,k,A],styles:[".stats-container[_ngcontent-%COMP%]{margin-bottom:24px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;margin-bottom:16px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{position:relative;background:#fff;border-radius:12px;padding:20px;cursor:pointer;transition:all .3s ease;border:2px solid transparent;overflow:hidden;box-shadow:0 2px 8px #00000014}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 12px 24px #0000001a}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card.active[_ngcontent-%COMP%]{border-color:#6366f1;box-shadow:0 2px 8px #6366f114}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{position:relative;z-index:2;display:flex;align-items:center;gap:16px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:32px;min-width:48px;text-align:center}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{flex:1;min-width:0}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin:0;font-size:13px;color:#6b7280;font-weight:500;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{margin:4px 0 0;font-size:28px;font-weight:700;color:#1f2937}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .gradient-from-blue-500[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:100px;height:100px;background:linear-gradient(135deg,#3b82f61a,#2563eb0d);border-radius:50%;z-index:1}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .gradient-from-purple-500[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:100px;height:100px;background:linear-gradient(135deg,#a855f71a,#9333ea0d);border-radius:50%;z-index:1}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .gradient-from-green-500[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:100px;height:100px;background:linear-gradient(135deg,#22c55e1a,#16a34a0d);border-radius:50%;z-index:1}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .gradient-from-orange-500[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:100px;height:100px;background:linear-gradient(135deg,#f973161a,#ea580c0d);border-radius:50%;z-index:1}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .gradient-from-teal-500[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:100px;height:100px;background:linear-gradient(135deg,#14b8a61a,#0d94880d);border-radius:50%;z-index:1}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .gradient-from-gray-500[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:100px;height:100px;background:linear-gradient(135deg,#6b72801a,#4b55630d);border-radius:50%;z-index:1}@media(max-width:1024px){.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:14px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{padding:18px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{gap:14px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:28px;min-width:44px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:12px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:24px}}@media(max-width:640px){.stats-container[_ngcontent-%COMP%]{margin-bottom:16px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:10px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{padding:14px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{gap:10px;flex-direction:column;text-align:center}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:24px;min-width:auto}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:11px}.stats-container[_ngcontent-%COMP%]   .stats-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:20px}}"],changeDetection:0})};var F=(n=>(n.NOT_CONTACTED="not_contacted",n.CONTACTED="contacted",n.RESPONDED="responded",n))(F||{});var Bt=o=>({"active-filter":o});function $t(o,e){if(o&1){let t=h();a(0,"div",1),_("click",function(){p(t);let i=m();return g(i.onBadgeClick())}),C(1,"i"),a(2,"span"),d(3),r()()}if(o&2){let t=m();I("background-color",t.getBgColor())("border-color",t.getBorderColor())("border-style",t.getBorderStyle()),u("pTooltip",t.badgeData.tooltip)("ngClass",N(15,Bt,t.isFilterActive)),s(),T("pi "+t.badgeData.icon),I("color",t.badgeData.color),s(),I("color",t.badgeData.color),s(),f(t.badgeData.label)}}var $=class o{lead;isFilterActive=!1;statusFilterChange=new w;badgeData=null;CommunicationStatus=F;statusConfig={not_contacted:{label:"No Contactado",icon:"pi-envelope-open",color:"#9CA3AF",bgColor:"#F3F4F6",tooltip:"Sin contactar"},contacted:{label:"Contactado",icon:"pi-envelope",color:"#3B82F6",bgColor:"#EFF6FF",tooltip:e=>e?`Contactado: ${this.formatDate(e)}`:"Fecha no disponible"},responded:{label:"Respondido",icon:"pi-check",color:"#10B981",bgColor:"#ECFDF5",tooltip:e=>e?`Respondido: ${this.formatDate(e)}`:"Fecha no disponible"}};ngOnInit(){this.updateBadgeData()}ngOnChanges(){this.updateBadgeData()}getStatusFromLead(e){return e.email_contacted&&e.customer_answered?"responded":e.email_contacted?"contacted":"not_contacted"}updateBadgeData(){if(!this.lead)return;let e=this.getStatusFromLead(this.lead),t=this.statusConfig[e],n="";if(typeof t.tooltip=="function"){let i=null;switch(e){case"contacted":i=this.lead.first_email_sent_at;break;case"responded":i=this.lead.customer_answered_at;break}n=t.tooltip(i)}else n=t.tooltip;this.badgeData={status:e,label:t.label,icon:t.icon,color:t.color,tooltip:n}}formatDate(e){try{let t=new Date(e),n=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear(),c=String(t.getHours()).padStart(2,"0"),y=String(t.getMinutes()).padStart(2,"0");return`${n}/${i}/${l} ${c}:${y}`}catch{return"Fecha no disponible"}}onBadgeClick(){this.badgeData&&this.statusFilterChange.emit(this.badgeData.status)}getBgColor(){return this.badgeData?this.statusConfig[this.badgeData.status].bgColor:"#F3F4F6"}getBorderStyle(){return this.isFilterActive?"2px solid":"1px solid"}getBorderColor(){return this.badgeData&&this.isFilterActive?this.badgeData.color:"#E5E7EB"}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=O({type:o,selectors:[["app-status-badge"]],inputs:{lead:"lead",isFilterActive:"isFilterActive"},outputs:{statusFilterChange:"statusFilterChange"},features:[E],decls:1,vars:1,consts:[["tooltipPosition","top",1,"status-badge",3,"backgroundColor","borderColor","borderStyle","pTooltip","ngClass"],["tooltipPosition","top",1,"status-badge",3,"click","pTooltip","ngClass"]],template:function(t,n){t&1&&D(0,$t,4,17,"div",0),t&2&&L(n.badgeData?0:-1)},dependencies:[P,k,yt,Ft,V],styles:[".status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;border-radius:.25rem;font-size:.75rem;font-weight:500;cursor:pointer;transition:all .2s ease;border:1px solid #E5E7EB;white-space:nowrap}.status-badge[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem;flex-shrink:0}.status-badge[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex-shrink:0}.status-badge[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.status-badge.active-filter[_ngcontent-%COMP%]{box-shadow:0 0 0 2px #0000001a}"]})};function jt(o,e){if(o&1){let t=h();a(0,"div",7),C(1,"i"),a(2,"span"),d(3),r(),a(4,"button",8),_("click",function(){let i=p(t).$implicit,l=m(2);return g(l.clearFilter(i.type))}),C(5,"i",9),r()()}if(o&2){let t=e.$implicit,n=m(2);s(),T("pi "+n.getFilterIcon(t.type)),s(2),f(t.label)}}function Ut(o,e){if(o&1){let t=h();a(0,"div",1)(1,"div",2)(2,"span",3),d(3,"Filtros activos:"),r(),a(4,"div",4),M(5,jt,6,3,"div",5),r(),a(6,"button",6),_("click",function(){p(t);let i=m();return g(i.clearAllFilters())}),r()()()}if(o&2){let t=m();s(5),u("ngForOf",t.activeFilters)}}var j=class o{activeStatusFilter=null;activeGroupId=null;activeGroupName=null;filterClear=new w;activeFilters=[];statusLabels={not_contacted:"No Contactados",contacted:"Contactados",responded:"Cliente Respondi\xF3"};ngOnChanges(){this.updateActiveFilters()}updateActiveFilters(){this.activeFilters=[],this.activeStatusFilter&&this.activeFilters.push({type:"status",value:this.activeStatusFilter,label:this.statusLabels[this.activeStatusFilter]||this.activeStatusFilter}),this.activeGroupId&&this.activeGroupName&&this.activeFilters.push({type:"group",value:this.activeGroupId,label:`Grupo: ${this.activeGroupName}`})}hasActiveFilters(){return this.activeFilters.length>0}clearFilter(e){this.filterClear.emit(e)}clearAllFilters(){this.filterClear.emit("all")}getFilterIcon(e){return e==="status"?"pi-filter":"pi-tag"}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=O({type:o,selectors:[["app-filter-indicator"]],inputs:{activeStatusFilter:"activeStatusFilter",activeGroupId:"activeGroupId",activeGroupName:"activeGroupName"},outputs:{filterClear:"filterClear"},features:[E],decls:1,vars:1,consts:[["class","filter-indicator",4,"ngIf"],[1,"filter-indicator"],[1,"filters-container"],[1,"filters-label"],[1,"filter-chips"],["class","filter-chip",4,"ngFor","ngForOf"],["type","button","pButton","","label","Limpiar todos",1,"p-button-sm","p-button-text",3,"click"],[1,"filter-chip"],["type","button","title","Limpiar filtro",1,"remove-btn",3,"click"],[1,"pi","pi-times"]],template:function(t,n){t&1&&M(0,Ut,7,1,"div",0),t&2&&u("ngIf",n.hasActiveFilters())},dependencies:[P,A,Ct,G,St],styles:[".filter-indicator[_ngcontent-%COMP%]{background-color:#eff6ff;border:1px solid #bfdbfe;border-radius:.375rem;padding:1rem;margin-bottom:1rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filters-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#1e40af}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;background-color:#fff;border:1px solid #3b82f6;border-radius:.25rem;padding:.375rem .75rem;font-size:.875rem;color:#1e40af}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]{background:none;border:none;color:#1e40af;cursor:pointer;padding:0;display:flex;align-items:center;justify-content:center;font-size:.75rem;transition:color .2s ease}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]:hover{color:#dc2626}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .clear-all-btn[_ngcontent-%COMP%]{margin-left:auto}@media(max-width:767px){.filter-indicator[_ngcontent-%COMP%]{padding:.75rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]{gap:.5rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filters-label[_ngcontent-%COMP%]{font-size:.8125rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]{font-size:.8125rem;padding:.25rem .5rem}}"]})};var U=class o{constructor(e){this.http=e}api=Pt.api;groupsCache=null;cacheExpiry=0;CACHE_DURATION=300*1e3;groupsSubject=new tt([]);groups$=this.groupsSubject.asObservable();fetchGroups(){return this.groupsCache&&Date.now()<this.cacheExpiry?new Z(e=>{e.next(this.groupsCache),e.complete()}):this.http.get(`${this.api}/lead-groups`).pipe(at(2),rt(e=>{let t=Array.isArray(e)?e:e.groups||[];this.groupsCache=t,this.cacheExpiry=Date.now()+this.CACHE_DURATION,this.groupsSubject.next(t)}),nt(e=>Array.isArray(e)?e:e.groups||[]),it(e=>{console.error("Error fetching groups:",e);let t="Failed to fetch groups. Please try again.",n="network";return e.status>=500?(t="Error del servidor. Por favor, intenta m\xE1s tarde.",n="server"):e.status>=400?(t="Error de validaci\xF3n. Por favor, verifica los datos.",n="validation"):e.status===0&&(t="No se puede conectar. Por favor, verifica tu conexi\xF3n a internet.",n="network"),et(()=>({type:n,message:t,originalError:e}))}))}invalidateCache(){this.groupsCache=null,this.cacheExpiry=0}getCachedGroups(){return this.groupsCache||[]}static \u0275fac=function(t){return new(t||o)(st(xt))};static \u0275prov=ot({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ht=["tableTemplate"],Wt=(o,e)=>e.id;function Yt(o,e){if(o&1){let t=h();a(0,"div",18),_("click",function(){let i=p(t).$implicit,l=m();return g(l.viewDetail(i))}),a(1,"div",19)(2,"h3",20),d(3),r(),a(4,"app-button",21),_("click",function(i){let l=p(t).$implicit;return m().viewDetail(l),g(i.stopPropagation())}),r()(),a(5,"div",22)(6,"div",23)(7,"span",24),d(8),r(),a(9,"app-status-badge",25),_("statusFilterChange",function(i){p(t);let l=m();return g(l.onStatusFilterChange(i))}),r(),a(10,"span",26),d(11),r()(),a(12,"div",27)(13,"div",28),d(14),r(),a(15,"div",29),C(16,"app-phone",30),r(),a(17,"div",31),d(18),H(19,"date"),r()()()()}if(o&2){let t=e.$implicit,n=m();s(3),f(t.name),s(),u("fullWidth",!1),s(4),S(" ",(t.status==null?null:t.status.name)||"Sin estado"," "),s(),u("lead",t)("isFilterActive",n.isStatusFilterActive(t.id)),s(2),S(" ",(t.group==null?null:t.group.name)||"Sin grupo"," "),s(3),f(t.email),s(2),u("phone",t.phone)("countryCode",t.phone_country)("countryPhoneCode",t.phone_code),s(2),S(" ",W(19,11,t.created_at,"shortDate")," ")}}function Jt(o,e){if(o&1){let t=h();a(0,"div",17)(1,"div",32)(2,"button",33),_("click",function(){p(t);let i=m();return g(i.onPageChange({page:i.table_config().page-1,limit:i.table_config().limit}))}),d(3," Anterior "),r(),a(4,"span",27),d(5),r(),a(6,"button",33),_("click",function(){p(t);let i=m();return g(i.onPageChange({page:i.table_config().page+1,limit:i.table_config().limit}))}),d(7," Siguiente "),r()()()}if(o&2){let t=m();s(2),u("disabled",t.table_config().page===1),s(3),_t(" P\xE1gina ",t.table_config().page," de ",t.Math.ceil(t.table_config().totalResults/t.table_config().limit)," "),s(),u("disabled",!t.table_config().hasNext)}}function Kt(o,e){if(o&1){let t=h();a(0,"td",34)(1,"p",35),d(2),r()(),a(3,"td",36)(4,"span",37),d(5),r()(),a(6,"td",38)(7,"app-status-badge",25),_("statusFilterChange",function(i){p(t);let l=m();return g(l.onStatusFilterChange(i))}),r()(),a(8,"td",39)(9,"span",40),d(10),r()(),a(11,"td",41)(12,"span",42),d(13),r()(),a(14,"td",34),C(15,"app-phone",30),r(),a(16,"td",43),d(17),H(18,"date"),r(),a(19,"td",44)(20,"button",45),_("click",function(i){let l=p(t).$implicit;return m().viewDetail(l),g(i.stopPropagation())}),C(21,"i",46),r()()}if(o&2){let t=e.$implicit,n=m();s(2),f(t.name),s(3),S(" ",(t.status==null?null:t.status.name)||"N/A"," "),s(2),u("lead",t)("isFilterActive",n.isStatusFilterActive(t.id)),s(3),S(" ",(t.group==null?null:t.group.name)||"Sin grupo"," "),s(3),f(t.email),s(2),u("phone",t.phone)("countryCode",t.phone_country)("countryPhoneCode",t.phone_code),s(2),f(W(18,10,t.created_at,"M/d/yy"))}}var At=class o{constructor(e,t,n,i,l){this.router=e;this.leads_service=t;this.route=n;this.dialog=i;this.groupFetchService=l;this.route.queryParams.pipe(Q(this.destroy$)).subscribe(c=>{let y=JSON.stringify(c);if(y===this.lastQueryParams)return;this.lastQueryParams=y,this.search=c?.search??"";let K=c?.page?Number(c.page):1,X=c?.limit?Number(c.limit):15;this.table_config.update(Gt=>x(v({},Gt),{page:isNaN(K)?1:K,limit:isNaN(X)?15:X})),c?.email_contacted==="false"?(this.activeStatusFilter="not_contacted",this.activeFilter="not_contacted"):c?.email_contacted==="true"&&c?.customer_answered==="false"?(this.activeStatusFilter="contacted",this.activeFilter="contacted_no_response"):c?.email_contacted==="true"&&c?.customer_answered==="true"?(this.activeStatusFilter="responded",this.activeFilter="customer_responded"):(this.activeStatusFilter=null,this.activeFilter=null),c?.group_id?this.activeGroupId=c.group_id:this.activeGroupId=null,this.getLeads()}),this.loadGroups()}tableTemplate;Math=Math;table_config=lt({rows:[],columns:[{name:"Nombre",prop:"name",sortable:!0,canAutoResize:!1,width:100},{name:"Estado",prop:"status",sortable:!1,canAutoResize:!1,width:75},{name:"Contacto",prop:"contact_status",sortable:!1,canAutoResize:!1,width:85},{name:"Grupo",prop:"group",sortable:!1,canAutoResize:!1,width:110},{name:"Email",prop:"email",sortable:!0,canAutoResize:!1,width:140},{name:"Tel\xE9fono",prop:"phone",sortable:!0,canAutoResize:!1,width:100},{name:"Fecha",prop:"created_at",sortable:!0,canAutoResize:!1,width:75},{name:"",prop:"actions",sortable:!1,canAutoResize:!1,width:45}],externalPaging:!0,externalSorting:!0,page:1,limit:15,totalResults:0,loading:!1,emptyState:{title:"Sin resultados",subtitle:"No se encontraron leads"},columnMode:"force",reorderable:!1});search="";destroy$=new q;lastQueryParams="";activeFilter=null;activeStatusFilter=null;activeGroupId=null;activeGroupName=null;groupSelectConfig={placeholder:"Filtrar por grupo",data:[],value:"id",option:"name",all:!0,all_message:"Ver Todos",loading:!1,error:!1,value_default:null};loadGroups(){this.groupSelectConfig.loading=!0,this.groupSelectConfig.error=!1,this.groupFetchService.fetchGroups().pipe(Q(this.destroy$)).subscribe({next:e=>{this.groupSelectConfig.data=e.map(t=>({id:t.id,name:`${t.name} (${t.lead_count||0})`,lead_count:t.lead_count||0})),this.groupSelectConfig.loading=!1},error:e=>{this.groupSelectConfig.loading=!1,this.groupSelectConfig.error=!0,console.error("Error loading groups:",e)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getLeads(){this.table_config.update(l=>x(v({},l),{loading:!0}));let e=this.table_config(),t=isNaN(e.page)?1:e.page,n=isNaN(e.limit)?15:e.limit,i={search:this.search,page:t,limit:n};this.activeFilter==="not_contacted"?i.email_contacted=!1:this.activeFilter==="contacted_no_response"?(i.email_contacted=!0,i.customer_answered=!1):this.activeFilter==="customer_responded"&&(i.email_contacted=!0,i.customer_answered=!0),this.activeGroupId&&(i.group_id=this.activeGroupId),this.leads_service.getLeads(i).subscribe(l=>{this.table_config.update(c=>x(v({},c),{rows:l?.data??[],totalResults:l?.total??0,hasNext:l?.hasNext??!1,loading:!1}))})}onPageChange(e){this.table_config.update(t=>x(v({},t),{page:e.page,limit:e.limit})),this.updateUrlParams()}onSortChange(e){console.log("Sort changed:",e)}updateUrlParams(){let e=this.table_config(),t={page:e.page,limit:e.limit};this.search&&(t.search=this.search),this.activeFilter==="not_contacted"?t.email_contacted="false":this.activeFilter==="contacted_no_response"?(t.email_contacted="true",t.customer_answered="false"):this.activeFilter==="customer_responded"&&(t.email_contacted="true",t.customer_answered="true"),this.activeGroupId&&(t.group_id=this.activeGroupId),this.router.navigate([],{relativeTo:this.route,queryParams:t,replaceUrl:!0})}getSeverity(e){switch(e){case"Al corriente":return"success";case"Atrasado":return"danger";case"Sin iniciar":return"info";default:return"warn"}}viewDetail(e){this.router.navigate(["/leads/detail",e.id])}createLead(){this.dialog.open(Tt,{data:{}}).afterClosed().subscribe(e=>{e&&this.getLeads()})}onFilterChange(e){this.activeFilter=e,this.activeStatusFilter=null,this.table_config.update(t=>x(v({},t),{page:1})),e==="not_contacted"?this.activeStatusFilter="not_contacted":e==="contacted_no_response"?this.activeStatusFilter="contacted":e==="customer_responded"&&(this.activeStatusFilter="responded"),this.updateUrlParams()}onStatusFilterChange(e){this.activeStatusFilter===e?this.activeStatusFilter=null:this.activeStatusFilter=e,this.table_config.update(t=>x(v({},t),{page:1})),this.updateUrlParams()}onGroupDropdownSelect(e){this.activeGroupId=e.groupId,this.activeGroupName=e.groupName,this.table_config.update(t=>x(v({},t),{page:1})),this.updateUrlParams()}onGroupSelectChange(e){let t=e.value,i=this.groupSelectConfig.data.find(l=>l.id===t)?.name?.split(" (")[0]||null;this.activeGroupId=t,this.activeGroupName=i,this.table_config.update(l=>x(v({},l),{page:1})),this.updateUrlParams()}onFilterClear(e){(e==="status"||e==="all")&&(this.activeStatusFilter=null,this.activeFilter=null),(e==="group"||e==="all")&&(this.activeGroupId=null,this.activeGroupName=null),this.table_config.update(n=>x(v({},n),{page:1}));let t={page:1,limit:this.table_config().limit};this.search&&(t.search=this.search),e!=="status"&&e!=="all"&&this.activeFilter&&(this.activeFilter==="not_contacted"?t.email_contacted="false":this.activeFilter==="contacted_no_response"?(t.email_contacted="true",t.customer_answered="false"):this.activeFilter==="customer_responded"&&(t.email_contacted="true",t.customer_answered="true")),e!=="group"&&e!=="all"&&this.activeGroupId&&(t.group_id=this.activeGroupId),this.router.navigate([],{relativeTo:this.route,queryParams:t,replaceUrl:!0})}isStatusFilterActive(e){return this.activeStatusFilter!==null}static \u0275fac=function(t){return new(t||o)(b(Ot),b(R),b(bt),b(Lt),b(U))};static \u0275cmp=O({type:o,selectors:[["app-leads-list"]],viewQuery:function(t,n){if(t&1&&pt(Ht,5),t&2){let i;gt(i=ut())&&(n.tableTemplate=i.first)}},decls:21,vars:9,consts:[["tableTemplate",""],[1,"leads-list-container"],[1,"leads-content"],[1,"p-6","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],[1,"flex","flex-col","gap-4","md:flex-row","md:items-center","md:justify-between","mb-5"],[1,"text-2xl","font-semibold","text-gray-800"],[1,"flex","items-center","gap-3","md:justify-end","flex-wrap"],[3,"changeOption","config"],["param_name","search",1,"w-64",3,"searchChange","param_activate"],["text","Crear lead","custom_class","btn_primary",3,"click"],[3,"filterClear","activeStatusFilter","activeGroupId","activeGroupName"],[3,"filterChange","activeFilter"],[1,"hidden","md:block"],[3,"pageChange","sortChange","rowClick","config","rowTemplate"],[1,"block","md:hidden"],[1,"space-y-3"],[1,"bg-white","border","border-gray-200","rounded-lg","p-4","shadow-sm"],[1,"mt-4","flex","justify-center"],[1,"bg-white","border","border-gray-200","rounded-lg","p-4","shadow-sm",3,"click"],[1,"flex","justify-between","items-start","mb-2"],[1,"font-semibold","text-gray-900","truncate","flex-1","mr-2"],["text","Ver","size","sm","custom_class","btn_primary text-xs px-2 py-1",3,"click","fullWidth"],[1,"space-y-2"],[1,"flex","items-center","gap-2","flex-wrap"],[1,"inline-flex","items-center","px-1.5","py-0.5","rounded","text-xs","font-medium","bg-blue-100","text-blue-800"],[3,"statusFilterChange","lead","isFilterActive"],[1,"inline-flex","items-center","px-1.5","py-0.5","rounded","text-xs","font-medium","bg-gray-100","text-gray-600"],[1,"text-sm","text-gray-600"],[1,"truncate"],[1,"mt-1"],[3,"phone","countryCode","countryPhoneCode"],[1,"text-xs","text-gray-500","mt-1"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1","text-sm","border","rounded","disabled:opacity-50",3,"click","disabled"],[1,"px-2","py-2","w-[100px]"],[1,"truncate","text-sm","font-medium","m-0"],[1,"px-2","py-2","w-[75px]"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-blue-100","text-blue-800","whitespace-nowrap","max-w-[70px]","h-[24px]","min-h-[24px]","overflow-hidden","text-ellipsis"],[1,"px-2","py-2","w-[85px]"],[1,"px-2","py-2","w-[110px]"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-gray-100","text-gray-600","whitespace-nowrap","max-w-[105px]","h-[24px]","min-h-[24px]","overflow-hidden","text-ellipsis"],[1,"px-2","py-2","w-[140px]"],[1,"truncate","text-sm","block","m-0"],[1,"px-2","py-2","w-[75px]","text-xs"],[1,"px-2","py-2","w-[45px]"],["title","Ver",1,"text-blue-600","hover:text-blue-800","text-sm","p-1",3,"click"],[1,"pi","pi-arrow-right","w-4","h-4"]],template:function(t,n){if(t&1){let i=h();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h2",5),d(5,"Leads"),r(),a(6,"div",6)(7,"app-select",7),_("changeOption",function(c){return p(i),g(n.onGroupSelectChange(c))}),r(),a(8,"app-search",8),_("searchChange",function(c){return p(i),g(n.search=c)}),r(),a(9,"app-button",9),_("click",function(){return p(i),g(n.createLead())}),r()()(),a(10,"app-filter-indicator",10),_("filterClear",function(c){return p(i),g(n.onFilterClear(c))}),r(),a(11,"app-leads-stats",11),_("filterChange",function(c){return p(i),g(n.onFilterChange(c))}),r(),a(12,"div",12)(13,"app-datatable-wrapper",13),_("pageChange",function(c){return p(i),g(n.onPageChange(c))})("sortChange",function(c){return p(i),g(n.onSortChange(c))})("rowClick",function(c){return p(i),g(n.viewDetail(c))}),r()(),a(14,"div",14)(15,"div",15),ct(16,Yt,20,14,"div",16,Wt),r(),D(18,Jt,8,4,"div",17),r()()()(),M(19,Kt,22,13,"ng-template",null,0,ft)}if(t&2){let i=mt(20);s(7),u("config",n.groupSelectConfig),s(),u("param_activate",!0),s(2),u("activeStatusFilter",n.activeStatusFilter)("activeGroupId",n.activeGroupId)("activeGroupName",n.activeGroupName),s(),u("activeFilter",n.activeFilter),s(2),u("config",n.table_config())("rowTemplate",i),s(3),dt(n.table_config().rows),s(2),L(n.table_config().totalResults>n.table_config().limit?18:-1)}},dependencies:[P,Mt,Et,V,G,Nt,Dt,wt,z,$,It,j,kt,vt],styles:[".leads-list-container[_ngcontent-%COMP%]{display:flex;gap:0;min-height:100vh;background-color:#f9fafb}.leads-list-container[_ngcontent-%COMP%]   .leads-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.leads-list-container[_ngcontent-%COMP%]   .name-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.leads-list-container[_ngcontent-%COMP%]   .name-cell[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}[_nghost-%COMP%]     .datatable-wrapper .ngx-datatable{width:100%!important;max-width:760px!important;font-size:12px!important}[_nghost-%COMP%]     .datatable-wrapper .ngx-datatable .datatable-header .datatable-header-cell{padding:.5rem .25rem!important;font-size:.875rem!important;font-weight:600!important;height:32px!important;min-height:32px!important}[_nghost-%COMP%]     .datatable-wrapper .ngx-datatable .datatable-body .datatable-body-row{height:40px!important;min-height:40px!important}[_nghost-%COMP%]     .datatable-wrapper .ngx-datatable .datatable-body .datatable-body-row .datatable-body-cell{padding:.5rem .25rem!important;font-size:.875rem!important;overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;line-height:1.4!important}[_nghost-%COMP%]     .datatable-wrapper .ngx-datatable .datatable-row-wrapper .datatable-body-row{height:40px!important;min-height:40px!important}@media(max-width:767px){.leads-list-container[_ngcontent-%COMP%]{flex-direction:column}.leads-list-container[_ngcontent-%COMP%]   .leads-content[_ngcontent-%COMP%]{flex:1}}@media(min-width:768px)and (max-width:1023px){.leads-list-container[_ngcontent-%COMP%]{display:flex;gap:0}}@media(min-width:1024px){.leads-list-container[_ngcontent-%COMP%]{display:flex;gap:0}}"]})};export{At as LeadsList};
