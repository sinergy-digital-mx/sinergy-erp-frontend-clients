import{a as le}from"./chunk-5YITP4Z5.js";import{a as ae}from"./chunk-NYQ6E34N.js";import{a as ue,b as pe,c as me}from"./chunk-4ETYXVDW.js";import{a as ie,b as P,f as re,h as ne,l as ce}from"./chunk-WEYOGA7X.js";import{a as se}from"./chunk-SJ2MQSEX.js";import"./chunk-6GYIPIAK.js";import{e as oe}from"./chunk-OANT22MG.js";import{r as ee,v as te}from"./chunk-MQV4I3IR.js";import{a as Z}from"./chunk-PIG46PEF.js";import{A as Y,d as U,e as w,j as K,m as y,y as X}from"./chunk-66A2AKCP.js";import{$ as m,Ab as d,Bb as n,Cb as s,Db as x,Kb as b,L as j,Ob as f,Q as L,Qa as l,Qb as _,Ub as $,Vb as q,Wb as B,Za as S,Zb as O,_ as p,bc as Q,cc as g,d as V,db as I,dc as C,e as A,ec as T,fc as H,ga as R,jb as v,la as D,ra as z,tc as W,vc as J,wc as G}from"./chunk-56XCPM73.js";import{a as u,b as h}from"./chunk-7CGTOI24.js";function ve(a,e){if(a&1){let t=b();n(0,"div",7),x(1,"i"),n(2,"span"),g(3),s(),n(4,"button",8),f("click",function(){let o=p(t).$implicit,c=_(2);return m(c.clearFilter(o.type))}),x(5,"i",9),s()()}if(a&2){let t=e.$implicit,i=_(2);l(),Q("pi "+i.getFilterIcon(t.type)),l(2),C(t.label)}}function Ce(a,e){if(a&1){let t=b();n(0,"div",1)(1,"div",2)(2,"span",3),g(3,"Filtros activos:"),s(),n(4,"div",4),v(5,ve,6,3,"div",5),s(),n(6,"button",6),f("click",function(){p(t);let o=_();return m(o.clearAllFilters())}),s()()()}if(a&2){let t=_();l(5),d("ngForOf",t.activeFilters)}}var M=class a{activeStatusFilter=null;activeGroupId=null;activeGroupName=null;activeSearchTerm=null;filterClear=new R;activeFilters=[];ngOnChanges(){this.updateActiveFilters()}updateActiveFilters(){this.activeFilters=[],this.activeStatusFilter&&this.activeFilters.push({type:"status",value:this.activeStatusFilter,label:`Estado: ${this.activeStatusFilter}`}),this.activeGroupId&&this.activeGroupName&&this.activeFilters.push({type:"group",value:this.activeGroupId,label:`Grupo: ${this.activeGroupName}`}),this.activeSearchTerm&&this.activeFilters.push({type:"search",value:this.activeSearchTerm,label:`B\xFAsqueda: ${this.activeSearchTerm}`})}hasActiveFilters(){return this.activeFilters.length>0}clearFilter(e){this.filterClear.emit(e)}clearAllFilters(){this.filterClear.emit("all")}getFilterIcon(e){switch(e){case"status":return"pi-filter";case"group":return"pi-tag";case"search":return"pi-search";default:return"pi-filter"}}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=I({type:a,selectors:[["app-customer-filter-indicator"]],inputs:{activeStatusFilter:"activeStatusFilter",activeGroupId:"activeGroupId",activeGroupName:"activeGroupName",activeSearchTerm:"activeSearchTerm"},outputs:{filterClear:"filterClear"},features:[z],decls:1,vars:1,consts:[["class","filter-indicator",4,"ngIf"],[1,"filter-indicator"],[1,"filters-container"],[1,"filters-label"],[1,"filter-chips"],["class","filter-chip",4,"ngFor","ngForOf"],["type","button","pButton","","label","Limpiar todos",1,"p-button-sm","p-button-text",3,"click"],[1,"filter-chip"],["type","button","title","Limpiar filtro",1,"remove-btn",3,"click"],[1,"pi","pi-times"]],template:function(t,i){t&1&&v(0,Ce,7,1,"div",0),t&2&&d("ngIf",i.hasActiveFilters())},dependencies:[y,U,w,P,ie],styles:[".filter-indicator[_ngcontent-%COMP%]{background-color:#eff6ff;border:1px solid #bfdbfe;border-radius:.375rem;padding:1rem;margin-bottom:1rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filters-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#1e40af}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;background-color:#fff;border:1px solid #3b82f6;border-radius:.25rem;padding:.375rem .75rem;font-size:.875rem;color:#1e40af}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]{background:none;border:none;color:#1e40af;cursor:pointer;padding:0;display:flex;align-items:center;justify-content:center;font-size:.75rem;transition:color .2s ease}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]:hover{color:#dc2626}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .clear-all-btn[_ngcontent-%COMP%]{margin-left:auto}@media(max-width:767px){.filter-indicator[_ngcontent-%COMP%]{padding:.75rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]{gap:.5rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filters-label[_ngcontent-%COMP%]{font-size:.8125rem}.filter-indicator[_ngcontent-%COMP%]   .filters-container[_ngcontent-%COMP%]   .filter-chips[_ngcontent-%COMP%]   .filter-chip[_ngcontent-%COMP%]{font-size:.8125rem;padding:.25rem .5rem}}"]})};var F=class a{initialState={groupId:null,groupName:null,searchTerm:null,statusId:null,page:1,limit:20};filterStateSubject=new A(this.initialState);filterState$=this.filterStateSubject.asObservable();constructor(){}getFilterState(){return this.filterStateSubject.value}setGroupFilter(e,t){let i=this.filterStateSubject.value;this.filterStateSubject.next(h(u({},i),{groupId:e,groupName:t,page:1}))}setSearchFilter(e){let t=this.filterStateSubject.value;this.filterStateSubject.next(h(u({},t),{searchTerm:e,page:1}))}setStatusFilter(e){let t=this.filterStateSubject.value;this.filterStateSubject.next(h(u({},t),{statusId:e,page:1}))}setPagination(e,t){let i=this.filterStateSubject.value;this.filterStateSubject.next(h(u({},i),{page:e,limit:t}))}clearFilter(e){let t=this.filterStateSubject.value,i=h(u({},t),{page:1});switch(e){case"group":i.groupId=null,i.groupName=null;break;case"search":i.searchTerm=null;break;case"status":i.statusId=null;break}this.filterStateSubject.next(i)}clearAllFilters(){this.filterStateSubject.next(this.initialState)}reset(){this.filterStateSubject.next(this.initialState)}static \u0275fac=function(t){return new(t||a)};static \u0275prov=L({token:a,factory:a.\u0275fac,providedIn:"root"})};var be=["tableTemplate"];function xe(a,e){if(a&1&&(n(0,"span",22),g(1),s()),a&2){let t=_(2).$implicit;l(),T(" +",t.contracts.length-1," ")}}function Ie(a,e){if(a&1&&(n(0,"div",19)(1,"span",20),g(2),s(),v(3,xe,2,1,"span",21),s()),a&2){let t=_().$implicit;l(2),T(" ",t.contracts[0].property.code," "),l(),d("ngIf",t.contracts.length>1)}}function we(a,e){a&1&&(n(0,"span",23),g(1,"\u2014"),s())}function ye(a,e){if(a&1){let t=b();n(0,"td")(1,"p"),g(2),s()(),n(3,"td"),g(4),s(),n(5,"td"),x(6,"app-phone",14),s(),n(7,"td"),g(8),s(),n(9,"td"),v(10,Ie,4,2,"div",15)(11,we,2,0,"ng-template",null,1,G),s(),n(13,"td"),g(14),s(),n(15,"td"),g(16),W(17,"date"),s(),n(18,"td",16),f("click",function(o){return p(t),m(o.stopPropagation())}),n(19,"div",17)(20,"app-button",18),f("clicked",function(){let o=p(t).$implicit,c=_();return m(c.viewDetail(o))}),s()()()}if(a&2){let t=e.$implicit,i=O(12),o=_();l(2),H("",t.name," ",t.lastname),l(2),C(t.email),l(2),d("phone",t.phone)("countryCode",t.phone_country)("countryPhoneCode",t.phone_code),l(2),C((t.group==null?null:t.group.name)||"\u2014"),l(2),d("ngIf",t.contracts&&t.contracts.length>0)("ngIfElse",i),l(4),C((t.status==null?null:t.status.name)||t.status_id),l(2),C(J(17,13,t.created_at,"mediumDate")),l(4),d("fullWidth",!1)("icon",o.ArrowRight)}}var ge=class a{constructor(e,t,i,o,c){this.router=e;this.customer_service=t;this.route=i;this.dialog=o;this.filterStateService=c;this.route.queryParams.pipe(j(this.destroy$)).subscribe(r=>{let N=JSON.stringify(r);if(N===this.lastQueryParams)return;this.lastQueryParams=N,this.search=r?.search??"",this.selectedGroupId=r?.group_id??null,this.selectedStatusId=r?.status_id??null;let E=r?.page?Number(r.page):1,k=r?.limit?Number(r.limit):20;this.table_config.update(fe=>h(u({},fe),{page:isNaN(E)?1:E,limit:isNaN(k)?20:k})),this.getCustomers()})}tableTemplate;table_config=D({rows:[],columns:[{name:"Nombre",prop:"name",sortable:!0,canAutoResize:!0},{name:"Email",prop:"email",sortable:!0,canAutoResize:!0},{name:"Tel\xE9fono",prop:"phone",sortable:!0,canAutoResize:!0},{name:"Grupo",prop:"group_id",sortable:!0,canAutoResize:!0},{name:"Lotes",prop:"contracts",sortable:!1,canAutoResize:!0},{name:"Estado",prop:"status",sortable:!0,canAutoResize:!0},{name:"Creado",prop:"created_at",sortable:!0,canAutoResize:!0},{name:"Acciones",prop:"actions",sortable:!1,canAutoResize:!0}],externalPaging:!0,externalSorting:!0,page:1,limit:20,totalResults:0,loading:!1,emptyState:{title:"Sin resultados",subtitle:"No se encontraron clientes"},columnMode:"force",reorderable:!1});ArrowRight=Z;search="";selectedGroupId=null;selectedGroupName=null;selectedStatusId=null;currentSort=null;destroy$=new V;lastQueryParams="";statusSelectConfig={placeholder:"Filtrar por estado",data:[{id:"active",name:"Activo"},{id:"inactive",name:"Inactivo"}],value:null,option:"name",all:!0,all_message:"Ver Todos"};ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getCustomers(){this.table_config.update(c=>h(u({},c),{loading:!0}));let e=this.table_config(),t=isNaN(e.page)?1:e.page,i=isNaN(e.limit)?20:e.limit,o=u(u(u(u({page:t,limit:i},this.search&&{search:this.search}),this.selectedGroupId&&{group_id:this.selectedGroupId}),this.selectedStatusId&&{status_id:this.selectedStatusId}),this.currentSort&&this.currentSort.direction&&{sort:this.currentSort.column.prop,order:this.currentSort.direction});this.customer_service.getCustomers(o).subscribe(c=>{console.log("Customers with contracts:",c?.data?.map(r=>({name:r.name,contractsCount:r.contracts?.length||0,contracts:r.contracts}))),this.table_config.update(r=>h(u({},r),{rows:c?.data??[],totalResults:c?.total??0,hasNext:c?.hasNext??!1,loading:!1}))})}onPageChange(e){this.router.navigate([],{relativeTo:this.route,queryParams:{page:e.page,limit:e.limit,search:this.search||void 0,group_id:this.selectedGroupId||void 0,status_id:this.selectedStatusId||void 0},queryParamsHandling:"merge"})}onSortChange(e){this.currentSort=e,this.table_config.update(t=>h(u({},t),{page:1})),this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,search:this.search||void 0,group_id:this.selectedGroupId||void 0,status_id:this.selectedStatusId||void 0},queryParamsHandling:"merge"})}onRowClick(e){this.viewDetail(e)}onGroupSelect(e){this.selectedGroupId=e.groupId,this.selectedGroupName=e.groupName,this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,group_id:e.groupId||void 0,search:this.search||void 0,status_id:this.selectedStatusId||void 0},queryParamsHandling:"merge"})}onStatusSelect(e){let t=e?.value||null;this.selectedStatusId=t,this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,status_id:t||void 0,search:this.search||void 0,group_id:this.selectedGroupId||void 0},queryParamsHandling:"merge"})}onFilterClear(e){e==="all"?(this.selectedGroupId=null,this.selectedGroupName=null,this.selectedStatusId=null,this.search=""):e==="group"?(this.selectedGroupId=null,this.selectedGroupName=null):e==="status"?this.selectedStatusId=null:e==="search"&&(this.search=""),this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,search:this.search||void 0,group_id:this.selectedGroupId||void 0,status_id:this.selectedStatusId||void 0},queryParamsHandling:"merge"})}onSearchChange(e){this.search=e,this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,search:e||void 0,group_id:this.selectedGroupId||void 0,status_id:this.selectedStatusId||void 0},queryParamsHandling:"merge"})}editCustomer(e){}createCustomer(){this.dialog.open(me,{data:{customer:null},width:"500px"}).afterClosed().subscribe(e=>{e&&this.getCustomers()})}getSeverity(e){switch(e){case"Al corriente":return"success";case"Atrasado":return"danger";case"Sin iniciar":return"info";default:return"warn"}}viewDetail(e){this.router.navigate(["/customers/detail",e.id])}getFirstLotCode(e){return!e.contracts||e.contracts.length===0?"\u2014":e.contracts[0].property.code}getAdditionalLotsCount(e){return!e.contracts||e.contracts.length<=1?0:e.contracts.length-1}hasMultipleLots(e){return(e.contracts?.length||0)>1}static \u0275fac=function(t){return new(t||a)(S(Y),S(pe),S(X),S(oe),S(F))};static \u0275cmp=I({type:a,selectors:[["app-customers-list"]],viewQuery:function(t,i){if(t&1&&$(be,5),t&2){let o;q(o=B())&&(i.tableTemplate=o.first)}},decls:15,vars:9,consts:[["tableTemplate",""],["noLots",""],[1,"p-6","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],[1,"flex","flex-col","gap-4","md:flex-row","md:items-center","md:justify-between","mb-5"],[1,"text-2xl","font-semibold","text-gray-800"],[1,"flex","flex-col","gap-3","md:flex-row","md:items-center","md:justify-end"],[1,"flex","flex-col","gap-3","md:flex-row","md:items-center"],[3,"groupSelect","selectedGroupId"],[3,"changeOption","config"],[1,"flex","items-center","gap-3"],["param_name","search",1,"w-64",3,"searchChange","param_activate"],["text","Crear Cliente","custom_class","btn_primary",3,"click"],[3,"filterClear","activeGroupId","activeGroupName","activeStatusFilter","activeSearchTerm"],[3,"pageChange","sortChange","rowClick","config","rowTemplate"],[3,"phone","countryCode","countryPhoneCode"],["class","flex items-center gap-1.5",4,"ngIf","ngIfElse"],[3,"click"],[1,"flex","gap-2"],["text","Detalle","size","sm","custom_class","btn_primary",3,"clicked","fullWidth","icon"],[1,"flex","items-center","gap-1.5"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-green-100","text-green-800","whitespace-nowrap"],["class","inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",4,"ngIf"],[1,"inline-flex","items-center","px-1.5","py-0.5","rounded-full","text-xs","font-medium","bg-indigo-100","text-indigo-800"],[1,"text-sm","text-gray-400"]],template:function(t,i){if(t&1){let o=b();n(0,"div",2)(1,"div",3)(2,"h2",4),g(3,"Clientes"),s(),n(4,"div",5)(5,"div",6)(6,"app-customer-group-dropdown",7),f("groupSelect",function(r){return p(o),m(i.onGroupSelect(r))}),s(),n(7,"app-select",8),f("changeOption",function(r){return p(o),m(i.onStatusSelect(r))}),s()(),n(8,"div",9)(9,"app-search",10),f("searchChange",function(r){return p(o),m(i.onSearchChange(r))}),s(),n(10,"app-button",11),f("click",function(){return p(o),m(i.createCustomer())}),s()()()(),n(11,"app-customer-filter-indicator",12),f("filterClear",function(r){return p(o),m(i.onFilterClear(r))}),s(),n(12,"app-datatable-wrapper",13),f("pageChange",function(r){return p(o),m(i.onPageChange(r))})("sortChange",function(r){return p(o),m(i.onSortChange(r))})("rowClick",function(r){return p(o),m(i.onRowClick(r))}),s()(),v(13,ye,21,16,"ng-template",null,0,G)}if(t&2){let o=O(14);l(6),d("selectedGroupId",i.selectedGroupId),l(),d("config",i.statusSelectConfig),l(2),d("param_activate",!0),l(2),d("activeGroupId",i.selectedGroupId)("activeGroupName",i.selectedGroupName)("activeStatusFilter",i.selectedStatusId)("activeSearchTerm",i.search),l(),d("config",i.table_config())("rowTemplate",o)}},dependencies:[y,w,ee,re,ne,P,ae,te,se,le,ue,M,ce,K],styles:["[_nghost-%COMP%]{display:block;background-color:#f9fafb}.status-select[_ngcontent-%COMP%]{padding:.5rem .75rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.875rem;background-color:#fff;cursor:pointer;transition:border-color .2s ease;min-width:200px}.status-select[_ngcontent-%COMP%]:hover{border-color:#9ca3af}.status-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.status-select[_ngcontent-%COMP%]:disabled{background-color:#f3f4f6;cursor:not-allowed;opacity:.6}@media(max-width:767px){.status-select[_ngcontent-%COMP%]{width:100%;min-width:auto}}"]})};export{ge as CustomersList};
