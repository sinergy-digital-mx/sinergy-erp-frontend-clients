import{a as xt}from"./chunk-NYKBYLBW.js";import{a as ht}from"./chunk-5XN6F6LE.js";import{a as Pe}from"./chunk-ESGHQXLB.js";import{H as pe,I as ue,J as Ue,K as $e,O as _t,P as bt,Q as O,R as y,S as Ct}from"./chunk-RBHIJQFK.js";import{b as Ee,c as I,e as ke,f as X,i as Ie,k as Fe,l as J,q as K,r as vt,s as Q,t as De,v as P}from"./chunk-7TNFDLAZ.js";import{A as de,B as ft,x as pt,y as ut,z as gt}from"./chunk-5MRBIJ7N.js";import{A as me,d as ct,h as se,i as Me,j as mt,m as _,t as le,y as ce,z as dt}from"./chunk-UZLFZEBK.js";import{Ab as x,Ac as Ze,Bb as st,D as j,Db as H,Eb as q,Fb as u,Gb as n,Hb as r,Ib as b,J as R,Jb as ae,Kb as xe,L as rt,Lb as ye,Lc as lt,M as Ye,O as $,Pb as w,Qb as Se,S as G,Ta as s,Tb as d,Ub as Re,Vb as c,W as L,aa as g,ab as m,ba as f,c as te,ca as V,da as ne,e as S,ec as we,gb as v,gc as A,hc as l,i as Qe,ia as U,ic as h,jc as E,kc as W,m as M,mb as at,n as z,na as fe,ta as Ce,vb as ie,yb as C,yc as k,zb as re,zc as F}from"./chunk-NOG5ANO3.js";import{a as oe}from"./chunk-7CGTOI24.js";var Oe=class o{static \u0275fac=function(t){return new(t||o)};static \u0275cmp=v({type:o,selectors:[["app-rbac-tenant-ui"]],decls:2,vars:0,consts:[[1,"h-screen","flex","flex-col"]],template:function(t,i){t&1&&(n(0,"div",0),b(1,"router-outlet"),r())},dependencies:[_,dt],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};function wt(o,e){if(o&1){let t=w();n(0,"div",7),d("click",function(){let a=g(t).$implicit,p=c();return f(p.navigateTo(a.route))}),b(1,"div",8),n(2,"div",9)(3,"div",10)(4,"div",11),l(5),r(),V(),n(6,"svg",12),b(7,"path",13),r()(),ne(),n(8,"h2",14),l(9),r(),n(10,"p",15),l(11),r(),n(12,"div",16),l(13),V(),n(14,"svg",17),b(15,"path",13),r()()(),ne(),b(16,"div",18),r()}if(o&2){let t=e.$implicit;s(5),h(t.icon),s(4),h(t.title),s(2),h(t.description),s(2),E(" Ir a ",t.title," ")}}var Te=class o{constructor(e,t){this.router=e;this.activatedRoute=t}sections=[{id:"users",title:"Usuarios",description:"Gestiona usuarios del tenant, asigna roles y controla permisos de acceso de forma centralizada",icon:"\u{1F465}",route:"users"},{id:"roles",title:"Roles y Permisos",description:"Crea y gestiona roles personalizados, define permisos granulares y organiza el control de acceso",icon:"\u{1F510}",route:"roles"}];navigateTo(e){this.router.navigate([e],{relativeTo:this.activatedRoute})}static \u0275fac=function(t){return new(t||o)(m(me),m(ce))};static \u0275cmp=v({type:o,selectors:[["app-settings"]],decls:9,vars:1,consts:[[1,"bg-gray-50","min-h-screen"],[1,"p-6"],[1,"mb-8","max-w-2xl"],[1,"text-3xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","max-w-2xl"],["class","group relative bg-white rounded-xl border border-gray-200 p-6 hover:shadow-lg transition-all duration-300 cursor-pointer overflow-hidden",3,"click",4,"ngFor","ngForOf"],[1,"group","relative","bg-white","rounded-xl","border","border-gray-200","p-6","hover:shadow-lg","transition-all","duration-300","cursor-pointer","overflow-hidden",3,"click"],[1,"absolute","inset-0","bg-linear-to-br","from-indigo-50","to-transparent","opacity-0","group-hover:opacity-100","transition-opacity","duration-300"],[1,"relative","z-10"],[1,"flex","items-start","justify-between","mb-3"],[1,"text-4xl"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-indigo-600","opacity-0","group-hover:opacity-100","transform","group-hover:translate-x-1","transition-all","duration-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"text-xl","font-bold","text-gray-900","mb-2"],[1,"text-gray-600","text-sm","leading-relaxed","mb-4"],[1,"inline-flex","items-center","text-indigo-600","font-semibold","text-sm","group-hover:text-indigo-700","transition-colors"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"ml-2","w-4","h-4","transform","group-hover:translate-x-1","transition-transform"],[1,"absolute","inset-0","rounded-xl","border","border-indigo-200","opacity-0","group-hover:opacity-100","transition-opacity","duration-300","pointer-events-none"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),l(4,"Configuraci\xF3n"),r(),n(5,"p",4),l(6,"Gestiona usuarios, roles y permisos de tu tenant"),r()(),n(7,"div",5),at(8,wt,17,4,"div",6),r()()()),t&2&&(s(8),u("ngForOf",i.sections))},dependencies:[_,ct],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})};var Y=class o{usersSubject=new S([]);rolesSubject=new S([]);modulesSubject=new S([]);selectedUserIdSubject=new S(null);selectedRoleIdSubject=new S(null);userSearchFilterSubject=new S("");userStatusFilterSubject=new S("all");roleSearchFilterSubject=new S("");arrayComparator=(e,t)=>e.length!==t.length?!1:e.every((i,a)=>i.id===t[a].id&&i.permission_count===t[a].permission_count);users$=this.usersSubject.asObservable().pipe(j(this.arrayComparator));roles$=this.rolesSubject.asObservable().pipe(j(this.arrayComparator));modules$=this.modulesSubject.asObservable().pipe(j(this.arrayComparator));selectedUserId$=this.selectedUserIdSubject.asObservable().pipe(j());selectedRoleId$=this.selectedRoleIdSubject.asObservable().pipe(j());userSearchFilter$=this.userSearchFilterSubject.asObservable().pipe(j());userStatusFilter$=this.userStatusFilterSubject.asObservable().pipe(j());roleSearchFilter$=this.roleSearchFilterSubject.asObservable().pipe(j());filteredUsers$=z([this.users$,this.userSearchFilter$,this.userStatusFilter$]).pipe(M(([e,t,i])=>e.filter(a=>{let p=t===""||a.email.toLowerCase().includes(t.toLowerCase()),_e=typeof a.status=="string"?a.status:a.status&&typeof a.status=="object"&&a.status.code?a.status.code:"active";return p&&(i==="all"||_e===i)})),j((e,t)=>e.length!==t.length?!1:e.every((i,a)=>i.id===t[a].id)));filteredRoles$=z([this.roles$,this.roleSearchFilter$]).pipe(M(([e,t])=>e.filter(i=>t===""||i.name.toLowerCase().includes(t.toLowerCase()))),j((e,t)=>e.length!==t.length?!1:e.every((i,a)=>i.id===t[a].id&&i.permission_count===t[a].permission_count)));constructor(){}selectUser(e){this.selectedUserIdSubject.next(e)}clearUserSelection(){this.selectedUserIdSubject.next(null)}setUserSearchFilter(e){this.userSearchFilterSubject.next(e)}setUserStatusFilter(e){this.userStatusFilterSubject.next(e)}updateUsers(e){this.usersSubject.next(e)}selectRole(e){this.selectedRoleIdSubject.next(e)}clearRoleSelection(){this.selectedRoleIdSubject.next(null)}setRoleSearchFilter(e){this.roleSearchFilterSubject.next(e)}updateRoles(e){this.rolesSubject.next(e)}updateModules(e){this.modulesSubject.next(e)}resetFilters(){this.userSearchFilterSubject.next(""),this.userStatusFilterSubject.next("all"),this.roleSearchFilterSubject.next("")}resetSelections(){this.selectedUserIdSubject.next(null),this.selectedRoleIdSubject.next(null)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var Ae=class o{constructor(e){this.stateService=e;this.statusFilterConfig={placeholder:"Filtrar por estado",data:[{value:"all",label:"Todos los Estados"},{value:"active",label:"Activo"},{value:"inactive",label:"Inactivo"},{value:"pending",label:"Pendiente"}],name_select:"status",value:null,option:"label",value_default:null,all:!1}}statusFilterConfig;ngOnInit(){}onSearchChange(e){this.stateService.setUserSearchFilter(e)}onStatusFilterChange(e){let t=e.value;this.stateService.setUserStatusFilter(t)}static \u0275fac=function(t){return new(t||o)(m(Y))};static \u0275cmp=v({type:o,selectors:[["app-user-search-filter"]],decls:5,vars:1,consts:[[1,"space-y-3","w-full"],[1,"w-full","overflow-hidden"],["placeholder","Buscar por email...",3,"searchChange"],[1,"w-full"],[3,"changeOption","config"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"div",1)(2,"app-search",2),d("searchChange",function(p){return i.onSearchChange(p)}),r()(),n(3,"div",3)(4,"app-select",4),d("changeOption",function(p){return i.onStatusFilterChange(p)}),r()()()),t&2&&(s(4),u("config",i.statusFilterConfig))},dependencies:[_,ht,Pe],styles:["[_nghost-%COMP%]{display:block;width:100%}  .search_container{width:100%}  .search_container input{width:100%!important;max-width:100%!important}  .select_container{width:100%}  .filter__control{width:100%}"]})};var ve=class o{constructor(e,t){this.dialogRef=e;this.data=t}onCancel(){this.dialogRef.close(!1)}onConfirm(){this.dialogRef.close(!0)}static \u0275fac=function(t){return new(t||o)(m(pe),m(ue))};static \u0275cmp=v({type:o,selectors:[["app-confirm-dialog"]],decls:10,vars:6,consts:[[1,"p-6"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-sm","text-gray-600","mb-6"],[1,"flex","gap-3","justify-end"],["mat-button","",1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-gray-100","hover:bg-gray-200","rounded","transition-colors",3,"click"],["mat-button","",1,"px-4","py-2","text-sm","font-medium","rounded","transition-colors",3,"click"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"h2",1),l(2),r(),n(3,"p",2),l(4),r(),n(5,"div",3)(6,"button",4),d("click",function(){return i.onCancel()}),l(7),r(),n(8,"button",5),d("click",function(){return i.onConfirm()}),l(9),r()()()),t&2&&(s(2),h(i.data.title),s(2),h(i.data.message),s(3),E(" ",i.data.cancelText||"Cancel"," "),s(),A(i.data.isDangerous?"bg-red-600 hover:bg-red-700 text-white":"bg-blue-600 hover:bg-blue-700 text-white"),s(),E(" ",i.data.confirmText||"Confirm"," "))},dependencies:[_,$e,bt,_t],encapsulation:2})};var Z=class o{mapUser(e){return oe({id:e.id,email:e.email,status:this.normalizeStatus(e.status),createdAt:e.createdAt||e.created_at||e.creationDate,updatedAt:e.updatedAt||e.updated_at,first_name:e.first_name||e.firstName||"",last_name:e.last_name||e.lastName||"",phone:e.phone||"",tenant_id:e.tenant_id||e.tenantId||"",last_login_at:e.last_login_at||e.lastLoginAt},e)}mapUsers(e){console.log("mapUsers received:",e,"type:",typeof e,"isArray:",Array.isArray(e));let t=[];return Array.isArray(e)?t=e:e&&typeof e=="object"&&(t=e.users||e.data||e.items||[]),console.log("usersArray:",t),t.map(i=>this.mapUser(i))}mapRole(e){return oe({id:e.id,name:e.name,description:e.description||"",permissions:e.permissions||[],createdAt:e.createdAt,updatedAt:e.updatedAt},e)}mapRoles(e){console.log("mapRoles received:",e,"type:",typeof e,"isArray:",Array.isArray(e));let t=[];return Array.isArray(e)?t=e:e&&typeof e=="object"&&(t=e.roles||e.data||e.items||[]),console.log("rolesArray after extraction:",t,"isArray:",Array.isArray(t)),Array.isArray(t)?t.map(i=>this.mapRole(i)):(console.error("rolesArray is not an array!",t),[])}mapModule(e){return oe({id:e.id,name:e.name,permissions:e.permissions||[]},e)}mapModules(e){return(Array.isArray(e)?e:e?.modules||[]).map(i=>this.mapModule(i))}normalizeStatus(e){return typeof e=="string"?e:e&&typeof e=="object"&&e.code?e.code:"active"}static \u0275fac=function(t){return new(t||o)};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var ee=class o{constructor(e,t){this.http=e;this.dataMapper=t}usersCache$=new S(null);api=de.api;getUsers(){return this.usersCache$.value?new te(e=>{e.next(this.usersCache$.value),e.complete()}):this.http.get(`${this.api}/tenant/users`).pipe(M(e=>this.dataMapper.mapUsers(e)),$(e=>this.usersCache$.next(e)),R(1))}getUserRoles(e){return this.http.get(`${this.api}/tenant/users/${e}/roles`).pipe(M(t=>this.dataMapper.mapRoles(t)),R(1))}assignRoleToUser(e,t){return this.http.post(`${this.api}/tenant/users/${e}/roles/${t}`,{}).pipe($(()=>this.clearCache()),R(1))}replaceUserRole(e,t,i){return this.http.put(`${this.api}/tenant/users/${e}/roles/${t}`,{new_role_id:i}).pipe($(()=>this.clearCache()),R(1))}deleteRoleFromUser(e,t){return this.http.delete(`${this.api}/tenant/users/${e}/roles/${t}`).pipe($(()=>this.clearCache()),R(1))}createUser(e){return this.http.post(`${this.api}/tenant/users`,e).pipe($(()=>this.clearCache()),R(1))}updateUser(e,t){return this.http.put(`${this.api}/tenant/users/${e}`,t).pipe(M(i=>this.dataMapper.mapUser(i)),$(()=>this.clearCache()),R(1))}clearCache(){this.usersCache$.next(null)}static \u0275fac=function(t){return new(t||o)(L(le),L(Z))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var je=class o{constructor(e,t,i,a,p){this.data=e;this.dialogRef=t;this.fb=i;this.userService=a;this.interceptorService=p;this.form=this.fb.group({first_name:[this.data.user.first_name||"",I.required],last_name:[this.data.user.last_name||"",I.required],email:[this.data.user.email,[I.required,I.email]],phone:[this.data.user.phone||""]})}X=pt;form;saving=fe(!1);saveUser(){if(this.form.invalid){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Por favor completa todos los campos requeridos"});return}this.saving.set(!0),this.userService.updateUser(this.data.user.id,this.form.value).subscribe({next:()=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Usuario actualizado correctamente"}),this.dialogRef.close(!0)},error:e=>{this.saving.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:e.error?.message||"Error al actualizar el usuario"})}})}close(){this.dialogRef.close()}static \u0275fac=function(t){return new(t||o)(m(ue),m(pe),m(K),m(ee),m(Ct))};static \u0275cmp=v({type:o,selectors:[["app-user-edit-dialog"]],decls:15,vars:8,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-title"],[1,"close-button",3,"click"],[3,"img","size"],[1,"dialog-content",3,"formGroup"],[1,"grid","grid-cols-2","gap-4"],["label","Nombre",3,"form_control"],["label","Apellido",3,"form_control"],["label","Email",3,"form_control"],["label","Tel\xE9fono (Opcional)",3,"form_control"],[1,"dialog-footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Guardar Cambios","custom_class","btn_primary",3,"clicked","loading"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"Editar Usuario"),r(),n(4,"button",3),d("click",function(){return i.close()}),b(5,"lucide-icon",4),r()(),n(6,"div",5)(7,"div",6),b(8,"app-input",7)(9,"app-input",8)(10,"app-input",9)(11,"app-input",10),r()(),n(12,"div",11)(13,"app-button",12),d("clicked",function(){return i.close()}),r(),n(14,"app-button",13),d("clicked",function(){return i.saveUser()}),r()()()),t&2&&(s(5),u("img",i.X)("size",20),s(),u("formGroup",i.form),s(2),u("form_control",i.form.controls.first_name),s(),u("form_control",i.form.controls.last_name),s(),u("form_control",i.form.controls.email),s(),u("form_control",i.form.controls.phone),s(3),u("loading",i.saving()))},dependencies:[_,Q,X,J,$e,P,De,gt,ut],styles:[".dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh;width:100dvw;max-width:600px}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid #e5e7eb}.dialog-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#111827;margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#6b7280;padding:.5rem;border-radius:.375rem;transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#111827}.dialog-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1.5rem;border-top:1px solid #e5e7eb}"]})};var Mt=(o,e)=>e.id;function Et(o,e){if(o&1){let t=w();n(0,"div",18)(1,"div",21)(2,"app-select",22),d("changeOption",function(a){g(t);let p=c();return f(p.onRoleAssignmentChange(a))}),r()(),n(3,"app-button",23),k(4,"async"),d("clicked",function(){g(t);let a=c();return f(a.confirmRoleAssignment())}),r()()}if(o&2){let t=c();s(2),u("config",t.assignRoleSelectConfig),ie("data-testid","assign-role-select"),s(),u("fullWidth",!1)("disabled",!F(4,5,t.selectedRoleIdForAssignment$)),ie("data-testid","confirm-assign-role-btn")}}function kt(o,e){o&1&&(n(0,"div",19)(1,"div",24),b(2,"div",25),n(3,"p",26),l(4,"Cargando roles..."),r()()())}function It(o,e){o&1&&(n(0,"div",27)(1,"p",26),l(2,"No hay roles asignados"),r()())}function Ft(o,e){if(o&1){let t=w();n(0,"app-button",36),d("clicked",function(){g(t);let a=c().$implicit,p=c(4);return f(p.openRoleReplacementDropdown(a.id))}),r()}if(o&2){let t=c().$implicit;u("fullWidth",!1),ie("data-testid","replace-role-btn-"+t.id)}}function Dt(o,e){if(o&1){let t=w();n(0,"div",27)(1,"div",29)(2,"div",3)(3,"p",30),l(4),r(),n(5,"p",31),l(6),r(),n(7,"p",32),l(8),r()(),n(9,"div",33),C(10,Ft,1,2,"app-button",34),k(11,"async"),n(12,"app-button",35),d("clicked",function(){let a=g(t).$implicit,p=c(4);return f(p.deleteRoleFromUser(a.id))}),r()()()()}if(o&2){let t,i=e.$implicit,a=c(4);ie("data-testid","role-item-"+i.id),s(4),h(i.name),s(2),W(" ",i.permissions.length," permiso",i.permissions.length!==1?"s":""," "),s(2),h(i.description),s(2),x((t=F(11,8,a.availableRoles$))?10:-1,t),s(2),u("fullWidth",!1),ie("data-testid","delete-role-btn-"+i.id)}}function Ut(o,e){if(o&1&&(n(0,"div",28),H(1,Dt,13,10,"div",27,Mt),r()),o&2){let t=c();s(),q(t)}}function $t(o,e){o&1&&C(0,It,3,0,"div",27)(1,Ut,3,0,"div",28),o&2&&x(e.length===0?0:1)}function Pt(o,e){if(o&1&&(C(0,$t,2,1),k(1,"async")),o&2){let t,i=c();x((t=F(1,1,i.userRoles$))?0:-1,t)}}function Ot(o,e){if(o&1){let t=w();n(0,"app-select",22),d("changeOption",function(a){g(t);let p=c(2);return f(p.onRoleReplacementChange(a))}),r()}if(o&2){let t=c(2);u("config",t.replaceRoleSelectConfig),ie("data-testid","replace-role-select")}}function Tt(o,e){if(o&1&&(n(0,"div",20)(1,"h4",17),l(2,"Selecciona Nuevo Rol"),r(),C(3,Ot,1,2,"app-select",37),k(4,"async"),r()),o&2){let t,i=c();s(3),x((t=F(4,1,i.availableRoles$))?3:-1,t)}}var Ve=class o{constructor(e,t){this.snackBar=e;this.dialog=t}user;userRoles$;availableRoles$;isLoadingRoles$;roleAssigned=new U;roleReplaced=new U;roleDeleted=new U;userUpdated=new U;showRoleReplacementDropdown$=new S(!1);selectedRoleIdForReplacement=null;selectedRoleIdForAssignment$=new S(null);assignRoleSelectConfig={placeholder:"Select a role to assign",data:[],value:"id",option:"name",name_select:"role",value_default:null,all:!1};replaceRoleSelectConfig={placeholder:"Select a new role",data:[],value:"id",option:"name",name_select:"role",value_default:null,all:!1};ngOnInit(){this.availableRoles$&&this.availableRoles$.subscribe(e=>{this.assignRoleSelectConfig.data=e,this.replaceRoleSelectConfig.data=e})}openRoleReplacementDropdown(e){this.selectedRoleIdForReplacement=e,this.showRoleReplacementDropdown$.next(!0)}onRoleAssignmentChange(e){e.value?this.selectedRoleIdForAssignment$.next(e.value):this.selectedRoleIdForAssignment$.next(null)}confirmRoleAssignment(){let e=this.selectedRoleIdForAssignment$.value;e&&this.dialog.open(ve,{data:{title:"Assign Role",message:`Are you sure you want to assign this role to ${this.user.email}?`,confirmText:"Assign",cancelText:"Cancel"}}).afterClosed().subscribe(t=>{t&&(this.roleAssigned.emit({userId:this.user.id,roleId:e}),this.selectedRoleIdForAssignment$.next(null),this.assignRoleSelectConfig.value_default=null)})}onRoleReplacementChange(e){e.value&&this.selectedRoleIdForReplacement&&(this.roleReplaced.emit({userId:this.user.id,oldRoleId:this.selectedRoleIdForReplacement,newRoleId:e.value}),this.showRoleReplacementDropdown$.next(!1),this.selectedRoleIdForReplacement=null,this.replaceRoleSelectConfig.value_default=null)}deleteRoleFromUser(e){let t=this.userRoles$,i="this role";this.dialog.open(ve,{data:{title:"Remove Role",message:`Are you sure you want to remove this role from ${this.user.email}? This action cannot be undone.`,confirmText:"Remove",cancelText:"Cancel",isDangerous:!0}}).afterClosed().subscribe(a=>{a&&this.roleDeleted.emit({userId:this.user.id,roleId:e})})}getStatusBadgeClass(e){switch(e){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-gray-100 text-gray-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}}getNormalizedStatus(e){return typeof e=="string"?e:e&&typeof e=="object"&&e.code?e.code:"active"}openEditDialog(){this.dialog.open(je,{data:{user:this.user}}).afterClosed().subscribe(e=>{e&&this.userUpdated.emit()})}static \u0275fac=function(t){return new(t||o)(m(O),m(Ue))};static \u0275cmp=v({type:o,selectors:[["app-user-details"]],inputs:{user:"user",userRoles$:"userRoles$",availableRoles$:"availableRoles$",isLoadingRoles$:"isLoadingRoles$"},outputs:{roleAssigned:"roleAssigned",roleReplaced:"roleReplaced",roleDeleted:"roleDeleted",userUpdated:"userUpdated"},decls:71,vars:32,consts:[[1,"flex","flex-col","h-full"],[1,"p-6","border-b","border-gray-200"],[1,"flex","items-start","justify-between","gap-4"],[1,"flex-1","min-w-0"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1","truncate",3,"title"],["text","Editar","size","sm","custom_class","btn_primary",3,"clicked"],[1,"flex-1","overflow-y-auto","p-6"],[1,"space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1","text-sm","text-gray-900"],[1,"mt-1","text-sm","text-gray-900","truncate",3,"title"],[1,"mt-1"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium"],[1,"mt-1","text-sm","text-gray-900","break-all"],[1,"border-t","border-gray-200"],[1,"text-sm","font-medium","text-gray-900","mb-4"],[1,"flex","gap-2"],[1,"flex","items-center","justify-center","p-8"],[1,"mt-4"],[1,"flex-1"],[3,"changeOption","config"],["text","Agregar Rol","variant","primary","size","md",3,"clicked","fullWidth","disabled"],[1,"flex","flex-col","items-center","gap-3"],[1,"w-8","h-8","border-4","border-gray-200","border-t-blue-600","rounded-full","animate-spin"],[1,"text-sm","text-gray-600"],[1,"p-4","bg-gray-50","rounded-lg","border","border-gray-200"],[1,"space-y-3"],[1,"flex","flex-col","md:flex-row","md:items-start","md:justify-between","gap-3"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-600","mt-1"],[1,"text-xs","text-gray-500","mt-2","wrap-break-word"],[1,"flex","gap-2","shrink-0"],["text","Reemplazar","variant","secondary","size","sm",3,"fullWidth"],["text","Eliminar","variant","danger","size","sm",3,"clicked","fullWidth"],["text","Reemplazar","variant","secondary","size","sm",3,"clicked","fullWidth"],[3,"config"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h3",4),l(5),r(),n(6,"p",5),l(7),r()(),n(8,"app-button",6),d("clicked",function(){return i.openEditDialog()}),r()()(),n(9,"div",7)(10,"div",8)(11,"div",9)(12,"div")(13,"label",10),l(14,"Nombre"),r(),n(15,"p",11),l(16),r()(),n(17,"div")(18,"label",10),l(19,"Apellido"),r(),n(20,"p",11),l(21),r()(),n(22,"div")(23,"label",10),l(24,"Email"),r(),n(25,"p",12),l(26),r()(),n(27,"div")(28,"label",10),l(29,"Tel\xE9fono"),r(),n(30,"p",11),l(31),r()(),n(32,"div")(33,"label",10),l(34,"Estado"),r(),n(35,"p",13)(36,"span",14),l(37),k(38,"titlecase"),r()()(),n(39,"div")(40,"label",10),l(41,"Creado"),r(),n(42,"p",11),l(43),k(44,"date"),r()(),n(45,"div")(46,"label",10),l(47,"ID del Tenant"),r(),n(48,"p",15),l(49),r()(),n(50,"div")(51,"label",10),l(52,"\xDAltimo Acceso"),r(),n(53,"p",11),l(54),k(55,"date"),r()()(),b(56,"div",16),n(57,"div")(58,"h4",17),l(59,"Asignar Nuevo Rol"),r(),C(60,Et,5,7,"div",18),k(61,"async"),r(),b(62,"div",16),n(63,"div")(64,"h4",17),l(65,"Roles Actuales"),r(),C(66,kt,5,0,"div",19),k(67,"async"),re(68,Pt,2,3),r(),C(69,Tt,5,3,"div",20),k(70,"async"),r()()()),t&2){let a;s(5),W(" ",i.user.first_name||i.user.name||"N/A"," ",i.user.last_name||""," "),s(),u("title",i.user.email),s(),h(i.user.email),s(9),h(i.user.first_name||"N/A"),s(5),h(i.user.last_name||"N/A"),s(4),u("title",i.user.email),s(),h(i.user.email),s(5),h(i.user.phone||"N/A"),s(5),A(i.getStatusBadgeClass(i.getNormalizedStatus(i.user.status))),s(),E(" ",F(38,18,i.getNormalizedStatus(i.user.status))," "),s(6),E(" ",Ze(44,20,i.user.createdAt,"MMM d, y")," "),s(6),h(i.user.tenant_id||"N/A"),s(5),E(" ",i.user.last_login_at?Ze(55,23,i.user.last_login_at,"MMM d, y"):"Nunca"," "),s(6),x((a=F(61,26,i.availableRoles$))?60:-1,a),s(6),x(F(67,28,i.isLoadingRoles$)?66:68),s(3),x(F(70,30,i.showRoleReplacementDropdown$)?69:-1)}},dependencies:[_,Pe,P,se,Me,mt],styles:["[_nghost-%COMP%]{display:block;height:100%}.overflow-y-auto[_ngcontent-%COMP%]{overflow-y:auto;-webkit-overflow-scrolling:touch}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}"]})};var Ne=class o{title="Close";clicked=new U;onClick(){this.clicked.emit()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=v({type:o,selectors:[["app-close-button"]],inputs:{title:"title"},outputs:{clicked:"clicked"},decls:3,vars:1,consts:[[1,"inline-flex","items-center","justify-center","w-8","h-8","rounded-full","text-gray-600","hover:text-gray-900","hover:bg-gray-100","transition-all","duration-200",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"]],template:function(t,i){t&1&&(ae(0,"button",0),Re("click",function(){return i.onClick()}),V(),ae(1,"svg",1),ye(2,"path",2),xe()()),t&2&&Se("title",i.title)},dependencies:[_],styles:["[_nghost-%COMP%]{display:inline-block}button[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}button[_ngcontent-%COMP%]:active{transform:scale(.95)}"]})};var Ge=class o{constructor(e,t,i,a,p,_e){this.fb=e;this.dialogRef=t;this.data=i;this.userService=a;this.snackBar=p;this.authService=_e;this.form=this.fb.group({first_name:["",[I.required]],last_name:["",[I.required]],email:["",[I.required,I.email]],phone:[""]})}loading=fe(!1);created=fe(!1);form;closeDialog(){this.loading()||this.dialogRef.close(this.created())}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading.set(!0);let e=oe({tenant_id:this.authService.user_info.tenant_id},this.form.value);this.userService.createUser(e).subscribe({next:()=>{this.created.set(!0),this.loading.set(!1),this.snackBar.openFromComponent(y,{data:{message:"User created successfully",type:"success"},duration:3e3}),this.closeDialog()},error:t=>{this.loading.set(!1),this.snackBar.openFromComponent(y,{data:{message:t.error?.message||"Failed to create user",type:"error"},duration:5e3})}})}static \u0275fac=function(t){return new(t||o)(m(K),m(pe),m(ue),m(ee),m(O),m(ft))};static \u0275cmp=v({type:o,selectors:[["app-user-creation-dialog"]],decls:13,vars:6,consts:[[1,"dialog"],[1,"dialog__header"],[3,"clicked"],[1,"dialog__body"],[1,"container","grid","grid-cols-1","md:grid-cols-2","gap-4",3,"formGroup"],["label","First Name",3,"form_control"],["label","Last Name",3,"form_control"],["label","Email",3,"form_control"],["label","Phone",3,"form_control"],[1,"dialog__footer"],["text","Create","custom_class","btn_primary",3,"click","loading"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"div",1)(2,"h2"),l(3,"Create User"),r(),n(4,"app-close-button",2),d("clicked",function(){return i.closeDialog()}),r()(),n(5,"div",3)(6,"div",4),b(7,"app-input",5)(8,"app-input",6)(9,"app-input",7)(10,"app-input",8),r()(),n(11,"div",9)(12,"app-button",10),d("click",function(){return i.submit()}),r()()()),t&2&&(s(6),u("formGroup",i.form),s(),u("form_control",i.form.controls.first_name),s(),u("form_control",i.form.controls.last_name),s(),u("form_control",i.form.controls.email),s(),u("form_control",i.form.controls.phone),s(2),u("loading",i.loading()))},dependencies:[_,De,P,Ne,Q,X,J],styles:["[_nghost-%COMP%]     .custom-dialog-container .mat-mdc-dialog-container{padding:0!important;overflow:visible!important}[_nghost-%COMP%]     .mat-mdc-dialog-container .mdc-dialog__surface{overflow:visible!important}"]})};var B=class o{constructor(e,t){this.http=e;this.dataMapper=t}rolesCache$=new S(null);api=de.api;getRoles(){return this.rolesCache$.value?new te(e=>{e.next(this.rolesCache$.value),e.complete()}):this.http.get(`${this.api}/tenant/roles`).pipe(M(e=>this.dataMapper.mapRoles(e)),$(e=>this.rolesCache$.next(e)),R(1))}getRoleById(e){return this.http.get(`${this.api}/tenant/roles/${e}`).pipe(M(t=>this.dataMapper.mapRole(t)),R(1))}createRole(e){return this.http.post(`${this.api}/tenant/roles`,e).pipe(M(t=>this.dataMapper.mapRole(t)),$(()=>this.clearCache()),R(1))}updateRole(e,t){return this.http.put(`${this.api}/tenant/roles/${e}`,t).pipe(M(i=>this.dataMapper.mapRole(i)),$(()=>this.clearCache()),R(1))}updateRolePermissions(e,t){return this.http.put(`${this.api}/tenant/roles/${e}`,{permission_ids:t}).pipe(M(i=>this.dataMapper.mapRole(i)),$(()=>this.clearCache()),R(1))}deleteRole(e){return this.http.delete(`${this.api}/tenant/roles/${e}`).pipe($(()=>this.clearCache()),R(1))}getRoleUsers(e){return this.http.get(`${this.api}/tenant/roles/${e}/users`).pipe(R(1))}getRolePermissionsAvailable(e){return this.http.get(`${this.api}/tenant/roles/${e}/permissions/available`).pipe(R(1))}getAvailablePermissions(){return this.http.get(`${this.api}/tenant/roles/permissions/available`).pipe(R(1))}getRoleSummary(){return this.http.get(`${this.api}/tenant/roles/summary/counts`).pipe(R(1))}clearCache(){this.rolesCache$.next(null)}static \u0275fac=function(t){return new(t||o)(L(le),L(Z))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var At=(o,e)=>e.id;function Bt(o,e){o&1&&(n(0,"div",15)(1,"p"),l(2,"No se encontraron usuarios"),r()())}function jt(o,e){if(o&1){let t=w();n(0,"div",16)(1,"button",17),k(2,"async"),d("click",function(){let a=g(t).$implicit,p=c(3);return f(p.onUserSelected(a.id))}),n(3,"div",18)(4,"div",19)(5,"p",20),l(6),r(),n(7,"p",21),l(8),r(),n(9,"p",22)(10,"span"),l(11),k(12,"titlecase"),r()()()()()()}if(o&2){let t=e.$implicit,i=c(3);s(),we("bg-blue-50",F(2,8,i.selectedUserId$)===t.id),s(5),W(" ",t.first_name||"N/A"," ",t.last_name||"N/A"," "),s(2),h(t.email),s(2),A(i.getStatusClass(t.status)),s(),E(" ",F(12,10,i.getNormalizedStatus(t.status))," ")}}function Vt(o,e){if(o&1&&H(0,jt,13,12,"div",16,At),o&2){let t=c();q(t)}}function Nt(o,e){o&1&&C(0,Bt,3,0,"div",15)(1,Vt,2,0),o&2&&x(e.length===0?0:1)}function Gt(o,e){if(o&1){let t=w();n(0,"div",13)(1,"app-user-details",23),d("roleAssigned",function(a){g(t);let p=c();return f(p.onRoleAssigned(a))})("roleReplaced",function(a){g(t);let p=c();return f(p.onRoleReplaced(a))})("roleDeleted",function(a){g(t);let p=c();return f(p.onRoleDeleted(a))})("userUpdated",function(){g(t);let a=c();return f(a.onUserUpdated())}),r()()}if(o&2){let t=c();s(),u("user",e)("userRoles$",t.selectedUserRoles$)("availableRoles$",t.roles$)("isLoadingRoles$",t.isLoadingRoles$)}}function zt(o,e){o&1&&(n(0,"div",14)(1,"div",24)(2,"p",25),l(3,"Selecciona un usuario para ver los detalles"),r()()())}var ze=class o{constructor(e,t,i,a,p,_e,be){this.stateService=e;this.userService=t;this.roleService=i;this.snackBar=a;this.router=p;this.activatedRoute=_e;this.dialog=be;this.users$=this.stateService.users$,this.filteredUsers$=this.stateService.filteredUsers$,this.selectedUserId$=this.stateService.selectedUserId$,this.roles$=this.stateService.roles$,this.userSearchFilter$=this.stateService.userSearchFilter$,this.userStatusFilter$=this.stateService.userStatusFilter$,this.selectedUser$=z([this.selectedUserId$,this.users$]).pipe(M(([N,Ke])=>N&&Ke.find(Rt=>Rt.id===N)||null)),this.selectedUserRoles$=z([this.selectedUserId$,this.refreshUserRoles$]).pipe(Ye(([N])=>N?this.userService.getUserRoles(N):Qe([]))),this.isLoadingRoles$=z([this.selectedUserId$,this.refreshUserRoles$]).pipe(Ye(([N])=>N?this.userService.getUserRoles(N).pipe(M(()=>!1),rt(!0)):Qe(!1)))}users$;filteredUsers$;selectedUserId$;selectedUser$;selectedUserRoles$;isLoadingRoles$;roles$;userSearchFilter$;userStatusFilter$;refreshUserRoles$=new S(0);ngOnInit(){this.userService.getUsers().subscribe(e=>{console.log("Users loaded:",e),this.stateService.updateUsers(e)}),this.roleService.getRoles().subscribe(e=>{console.log("Roles loaded:",e),this.stateService.updateRoles(e)})}onUserSelected(e){this.stateService.selectUser(e)}goBackToSettings(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}openCreateUserDialog(){this.dialog.open(Ge,{width:"466px",disableClose:!1,panelClass:"custom-dialog-container"}).afterClosed().subscribe(e=>{e&&this.userService.getUsers().subscribe(t=>{this.stateService.updateUsers(t)})})}onRoleAssigned(e){this.userService.assignRoleToUser(e.userId,e.roleId).subscribe({next:()=>{this.refreshUserRoles$.next(this.refreshUserRoles$.value+1),this.snackBar.openFromComponent(y,{data:{message:"Rol asignado correctamente",type:"success"},duration:3e3})},error:t=>{this.snackBar.openFromComponent(y,{data:{message:t.error?.message||"No pudimos asignar el rol",type:"error"},duration:5e3})}})}onRoleReplaced(e){this.userService.replaceUserRole(e.userId,e.oldRoleId,e.newRoleId).subscribe({next:()=>{this.refreshUserRoles$.next(this.refreshUserRoles$.value+1),this.snackBar.openFromComponent(y,{data:{message:"Rol reemplazado correctamente",type:"success"},duration:3e3})},error:t=>{this.snackBar.openFromComponent(y,{data:{message:t.error?.message||"No pudimos reemplazar el rol",type:"error"},duration:5e3})}})}onRoleDeleted(e){this.userService.deleteRoleFromUser(e.userId,e.roleId).subscribe({next:()=>{this.refreshUserRoles$.next(this.refreshUserRoles$.value+1),this.snackBar.openFromComponent(y,{data:{message:"Rol eliminado correctamente",type:"success"},duration:3e3})},error:t=>{this.snackBar.openFromComponent(y,{data:{message:t.error?.message||"No pudimos eliminar el rol",type:"error"},duration:5e3})}})}getNormalizedStatus(e){return typeof e=="string"?e:e&&typeof e=="object"&&e.code?e.code:"active"}onUserUpdated(){this.userService.clearCache();let e=null;this.selectedUserId$.subscribe(t=>e=t).unsubscribe(),this.userService.getUsers().subscribe(t=>{this.stateService.updateUsers(t),e&&setTimeout(()=>{this.stateService.selectUser(e)},50)})}getStatusClass(e){switch(this.getNormalizedStatus(e)){case"active":return"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800";case"inactive":return"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800";case"pending":return"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800";default:return"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800"}}static \u0275fac=function(t){return new(t||o)(m(Y),m(ee),m(B),m(O),m(me),m(ce),m(Ue))};static \u0275cmp=v({type:o,selectors:[["app-users-management"]],decls:21,vars:7,consts:[[1,"p-6","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],[1,"flex","items-center","gap-3","mb-6","justify-between"],[1,"flex","items-center","gap-3"],[3,"clicked"],[1,"text-2xl","font-semibold","text-gray-900"],["text","+ Crear Usuario","variant","primary","size","md",3,"clicked","fullWidth"],[1,"flex","gap-6","h-[calc(100vh-200px)]"],[1,"w-1/3","bg-gray-50","rounded-lg","border","border-gray-200","flex","flex-col","overflow-hidden"],[1,"px-6","py-4","border-b","border-gray-200","bg-white"],[1,"text-lg","font-semibold","text-gray-900"],[1,"px-6","py-4","border-b","border-gray-200","bg-white","space-y-3"],[1,"flex-1","overflow-y-auto","bg-white"],[1,"flex-1","bg-gray-50","rounded-lg","border","border-gray-200","flex","flex-col","overflow-hidden"],[1,"flex","flex-col","h-full","overflow-hidden","bg-white"],[1,"flex","items-center","justify-center","h-full","bg-white"],[1,"p-4","text-center","text-gray-500"],[1,"border-b","border-gray-100","last:border-b-0"],[1,"w-full","text-left","px-6","py-4","hover:bg-gray-50","transition-colors","focus:outline-none","focus:ring-2","focus:ring-inset","focus:ring-blue-500",3,"click"],[1,"flex","items-center","justify-between"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"text-xs","text-gray-600","mt-1","truncate"],[1,"text-xs","text-gray-500","mt-1"],[3,"roleAssigned","roleReplaced","roleDeleted","userUpdated","user","userRoles$","availableRoles$","isLoadingRoles$"],[1,"text-center"],[1,"text-gray-500","text-lg"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-back-button",3),d("clicked",function(){return i.goBackToSettings()}),r(),n(4,"h1",4),l(5,"Gesti\xF3n de Usuarios"),r()(),n(6,"app-button",5),d("clicked",function(){return i.openCreateUserDialog()}),r()(),n(7,"div",6)(8,"div",7)(9,"div",8)(10,"h2",9),l(11,"Usuarios"),r()(),n(12,"div",10),b(13,"app-user-search-filter"),r(),n(14,"div",11),C(15,Nt,2,1),k(16,"async"),r()(),n(17,"div",12),C(18,Gt,2,4,"div",13),k(19,"async"),re(20,zt,4,0,"div",14),r()()()),t&2){let a,p;s(6),u("fullWidth",!1),s(9),x((a=F(16,3,i.filteredUsers$))?15:-1,a),s(3),x((p=F(19,5,i.selectedUser$))?18:20,p)}},dependencies:[_,Ae,Ve,xt,P,se,Me],styles:["[_nghost-%COMP%]{display:block;height:100%}.w-1-3[_ngcontent-%COMP%]{flex:0 0 33.333%}.w-2-3[_ngcontent-%COMP%]{flex:0 0 66.667%}.overflow-y-auto[_ngcontent-%COMP%]{overflow-y:auto;-webkit-overflow-scrolling:touch}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}button[_ngcontent-%COMP%]:hover{background-color:#f9fafb}button[_ngcontent-%COMP%]:focus{outline:none}"]})};var Le=class o{title="Go back";clicked=new U;onClick(){this.clicked.emit()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=v({type:o,selectors:[["app-back-button"]],inputs:{title:"title"},outputs:{clicked:"clicked"},decls:3,vars:1,consts:[[1,"inline-flex","items-center","justify-center","w-8","h-8","rounded-full","text-gray-600","hover:text-gray-900","hover:bg-gray-100","transition-all","duration-200",3,"click","title"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"]],template:function(t,i){t&1&&(ae(0,"button",0),Re("click",function(){return i.onClick()}),V(),ae(1,"svg",1),ye(2,"path",2),xe()()),t&2&&Se("title",i.title)},dependencies:[_],styles:["[_nghost-%COMP%]{display:inline-block}button[_ngcontent-%COMP%]{cursor:pointer;transition:all .2s ease}button[_ngcontent-%COMP%]:active{transform:scale(.95)}"]})};var Lt=(o,e)=>e.module_id;function Ht(o,e){o&1&&(n(0,"div",1),b(1,"div",2),n(2,"span",3),l(3,"Cargando permisos..."),r()())}function qt(o,e){if(o&1){let t=w();n(0,"label",20)(1,"input",21),d("change",function(){let a=g(t).$implicit,p=c(3);return f(p.togglePermission(a))}),r(),n(2,"div",22)(3,"div",13)(4,"span",23),l(5),r(),n(6,"p",24),l(7),r()(),n(8,"p",25),l(9),r()()()}if(o&2){let t=e.$implicit;s(),u("checked",t.isAssigned),s(3),A(t.isAssigned?"text-green-600":"text-gray-400"),s(),E(" ",t.isAssigned?"\u2611\uFE0F":"\u2610"," "),s(2),h(t.name),s(2),h(t.description)}}function Wt(o,e){if(o&1){let t=w();n(0,"div",9)(1,"div",11)(2,"div",12)(3,"div",13)(4,"span",14),l(5,"\u{1F4E6}"),r(),n(6,"h3",15),l(7),r()(),n(8,"div",16)(9,"span",5),l(10),r(),n(11,"button",17),d("click",function(){let a=g(t).$implicit,p=c(2);return f(p.toggleAllModulePermissions(a))}),l(12),r()()()(),n(13,"div",18)(14,"div",19),H(15,qt,10,6,"label",20,st),r()()()}if(o&2){let t=e.$implicit,i=c(2);s(7),h(t.module_name),s(3),W(" ",i.getModuleAssignedCount(t),"/",t.permissions.length," permisos "),s(2),E(" ",i.isModuleFullyAssigned(t)?"Desmarcar Todo":"Marcar Todo"," "),s(3),q(t.permissions)}}function Xt(o,e){o&1&&(n(0,"div",10)(1,"p",26),l(2,"No hay m\xF3dulos disponibles para este tenant."),r()())}function Jt(o,e){if(o&1){let t=w();n(0,"div",4)(1,"div",5)(2,"span",6),l(3),r(),l(4," permisos asignados "),r(),n(5,"app-button",7),d("clicked",function(){g(t);let a=c();return f(a.savePermissions())}),r()(),n(6,"div",8),H(7,Wt,17,4,"div",9,Lt),r(),C(9,Xt,3,0,"div",10)}if(o&2){let t=c();s(3),h(t.getTotalAssignedPermissions()),s(2),u("loading",t.saving)("disabled",t.saving||!t.hasChanges),s(2),q(t.modulePermissions),s(2),x(t.modulePermissions.length===0?9:-1)}}var He=class o{constructor(e,t,i){this.roleService=e;this.snackBar=t;this.cdr=i}role=null;permissionsUpdated=new U;modulePermissions=[];loading=!1;saving=!1;hasChanges=!1;originalPermissions=new Set;ngOnInit(){this.role&&this.loadPermissions()}ngOnChanges(){this.role&&this.loadPermissions()}loadPermissions(){this.role&&(this.loading=!0,this.hasChanges=!1,this.cdr.markForCheck(),this.roleService.getRolePermissionsAvailable(this.role.id).subscribe({next:e=>{console.log("Permissions loaded successfully:",e),this.processPermissions(e),this.loading=!1,this.cdr.markForCheck()},error:e=>{console.error("Error loading permissions:",e),this.snackBar.openFromComponent(y,{data:{message:e.error?.message||"Error al cargar permisos",type:"error"},duration:5e3}),this.loading=!1,this.cdr.markForCheck()}}))}processPermissions(e){if(console.log("Processing permissions response:",e),!e||!e.modules||!Array.isArray(e.modules)){console.error("Invalid response structure:",e),this.modulePermissions=[];return}let t=e.modules.flatMap(i=>i.permissions||[]).filter(i=>i.assigned).map(i=>i.id);this.originalPermissions=new Set(t),this.modulePermissions=e.modules.map(i=>({module_id:i.id,module_name:i.name,permissions:(i.permissions||[]).map(a=>({id:a.id,name:a.action,description:a.description,isAssigned:a.assigned||!1}))})),console.log("Processed modules:",this.modulePermissions)}togglePermission(e){e.isAssigned=!e.isAssigned,this.checkForChanges()}toggleAllModulePermissions(e){let t=this.isModuleFullyAssigned(e);e.permissions.forEach(i=>{i.isAssigned=!t}),this.checkForChanges()}isModuleFullyAssigned(e){return e.permissions.every(t=>t.isAssigned)}getModuleAssignedCount(e){return e.permissions.filter(t=>t.isAssigned).length}getTotalAssignedPermissions(){return this.modulePermissions.reduce((e,t)=>e+this.getModuleAssignedCount(t),0)}checkForChanges(){let e=new Set(this.modulePermissions.flatMap(t=>t.permissions).filter(t=>t.isAssigned).map(t=>t.id));this.hasChanges=!this.setsEqual(this.originalPermissions,e)}setsEqual(e,t){if(e.size!==t.size)return!1;for(let i of e)if(!t.has(i))return!1;return!0}savePermissions(){if(!this.role||this.saving||!this.hasChanges)return;this.saving=!0;let e=this.modulePermissions.flatMap(t=>t.permissions).filter(t=>t.isAssigned).map(t=>t.id);this.roleService.updateRolePermissions(this.role.id,e).subscribe({next:t=>{this.snackBar.openFromComponent(y,{data:{message:"Permisos actualizados correctamente",type:"success"},duration:3e3}),this.originalPermissions=new Set(e),this.hasChanges=!1,this.saving=!1,this.permissionsUpdated.emit(t)},error:t=>{console.error("Error saving permissions:",t),this.snackBar.openFromComponent(y,{data:{message:t.error?.message||"Error al guardar permisos",type:"error"},duration:5e3}),this.saving=!1}})}static \u0275fac=function(t){return new(t||o)(m(B),m(O),m(lt))};static \u0275cmp=v({type:o,selectors:[["app-role-permissions-manager"]],inputs:{role:"role"},outputs:{permissionsUpdated:"permissionsUpdated"},features:[Ce],decls:3,vars:1,consts:[[1,"role-permissions-manager"],[1,"flex","items-center","justify-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"ml-3","text-gray-600"],[1,"mb-6","flex","justify-between","items-center"],[1,"text-sm","text-gray-600"],[1,"font-medium"],["text","Guardar Cambios","custom_class","btn_primary",3,"clicked","loading","disabled"],[1,"space-y-6"],[1,"border","border-gray-200","rounded-lg","overflow-hidden"],[1,"text-center","py-8"],[1,"bg-gray-50","px-4","py-3","border-b","border-gray-200"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"text-lg","mr-2"],[1,"text-lg","font-medium","text-gray-900"],[1,"flex","items-center","gap-3"],[1,"text-sm","text-blue-600","hover:text-blue-800","font-medium",3,"click"],[1,"p-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-3"],[1,"flex","items-start","space-x-3","p-3","rounded-lg","border","border-gray-200","hover:bg-gray-50","cursor-pointer","transition-colors"],["type","checkbox",1,"mt-1","h-4","w-4","text-blue-600","focus:ring-blue-500","border-gray-300","rounded",3,"change","checked"],[1,"flex-1","min-w-0"],[1,"mr-2"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-500","mt-1"],[1,"text-gray-500"]],template:function(t,i){t&1&&(n(0,"div",0),C(1,Ht,4,0,"div",1)(2,Jt,10,4),r()),t&2&&(s(),x(i.loading?1:2))},dependencies:[_,vt,P],styles:[".role-permissions-manager[_ngcontent-%COMP%]{max-height:calc(100vh - 300px);overflow-y:auto}.role-permissions-manager[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.role-permissions-manager[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.role-permissions-manager[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}.role-permissions-manager[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}"]})};function Kt(o,e){o&1&&(n(0,"p",7),l(1,"El nombre es requerido"),r())}function Qt(o,e){if(o&1){let t=w();n(0,"form",4),d("ngSubmit",function(){g(t);let a=c();return f(a.saveRole())}),n(1,"div")(2,"label",5),l(3," Nombre del Rol * "),r(),b(4,"input",6),C(5,Kt,2,0,"p",7),r(),n(6,"div")(7,"label",5),l(8," Descripci\xF3n "),r(),n(9,"textarea",8),l(10,"            "),r()(),n(11,"div",9)(12,"app-button",10),d("clicked",function(){g(t);let a=c();return f(a.saveRole())}),r(),n(13,"app-button",11),d("clicked",function(){g(t);let a=c();return f(a.cancelEdit())}),r()()()}if(o&2){let t,i=c();u("formGroup",i.roleForm),s(5),x((t=i.roleForm.get("name"))!=null&&t.invalid&&((t=i.roleForm.get("name"))!=null&&t.touched)?5:-1),s(7),u("loading",i.saving)("disabled",i.roleForm.invalid||i.saving)}}function Yt(o,e){if(o&1){let t=w();n(0,"div",2)(1,"div",12)(2,"h3",13),l(3),r(),n(4,"p",14),l(5),r()(),n(6,"div",15)(7,"button",16),d("click",function(){g(t);let a=c();return f(a.startEdit())}),V(),n(8,"svg",17),b(9,"path",18),r()(),ne(),n(10,"button",19),d("click",function(){g(t);let a=c();return f(a.confirmDelete())}),V(),n(11,"svg",17),b(12,"path",20),r()()()()}if(o&2){let t=c();s(3),h(t.role==null?null:t.role.name),s(2),h((t.role==null?null:t.role.description)||"Sin descripci\xF3n")}}function Zt(o,e){if(o&1){let t=w();n(0,"div",3)(1,"div",21)(2,"div",22)(3,"div",23),V(),n(4,"svg",24),b(5,"path",25),r()(),ne(),n(6,"div",26)(7,"h3",27),l(8,"Eliminar Rol"),r()()(),n(9,"div",28)(10,"p",29),l(11," \xBFEst\xE1s seguro de que deseas eliminar el rol "),n(12,"strong"),l(13),r(),l(14,"? "),r(),n(15,"p",30),l(16," Esta acci\xF3n no se puede deshacer y todos los usuarios asignados a este rol perder\xE1n sus permisos. "),r()(),n(17,"div",31)(18,"app-button",32),d("clicked",function(){g(t);let a=c();return f(a.cancelDelete())}),r(),n(19,"app-button",33),d("clicked",function(){g(t);let a=c();return f(a.deleteRole())}),r()()()()}if(o&2){let t=c();s(13),E('"',t.role==null?null:t.role.name,'"'),s(6),u("loading",t.deleting)("disabled",t.deleting)}}var qe=class o{constructor(e,t,i){this.fb=e;this.roleService=t;this.snackBar=i;this.roleForm=this.createForm()}role=null;roleUpdated=new U;roleDeleted=new U;roleForm;isEditing=!1;saving=!1;showDeleteConfirm=!1;deleting=!1;ngOnInit(){this.initializeForm()}ngOnChanges(){this.initializeForm(),this.isEditing=!1}createForm(){return this.fb.group({name:["",[I.required,I.minLength(2),I.maxLength(50)]],description:["",[I.maxLength(200)]]})}initializeForm(){this.role&&this.roleForm.patchValue({name:this.role.name||"",description:this.role.description||""})}startEdit(){this.isEditing=!0,this.initializeForm()}cancelEdit(){this.isEditing=!1,this.initializeForm()}saveRole(){if(!this.role||this.roleForm.invalid||this.saving)return;this.saving=!0;let e=this.roleForm.value,t={name:e.name.trim(),description:e.description?.trim()||"",permission_ids:this.role.permissions||[]};this.roleService.updateRole(this.role.id,t).subscribe({next:i=>{this.snackBar.openFromComponent(y,{data:{message:"Rol actualizado correctamente",type:"success"},duration:3e3}),this.isEditing=!1,this.saving=!1,this.roleUpdated.emit(i)},error:i=>{console.error("Error updating role:",i),this.snackBar.openFromComponent(y,{data:{message:i.error?.message||"Error al actualizar el rol",type:"error"},duration:5e3}),this.saving=!1}})}confirmDelete(){this.showDeleteConfirm=!0}cancelDelete(){this.showDeleteConfirm=!1}deleteRole(){!this.role||this.deleting||(this.deleting=!0,this.roleService.deleteRole(this.role.id).subscribe({next:()=>{this.snackBar.openFromComponent(y,{data:{message:"Rol eliminado correctamente",type:"success"},duration:3e3}),this.showDeleteConfirm=!1,this.deleting=!1,this.roleDeleted.emit(this.role.id)},error:e=>{console.error("Error deleting role:",e),this.snackBar.openFromComponent(y,{data:{message:e.error?.message||"Error al eliminar el rol",type:"error"},duration:5e3}),this.deleting=!1}}))}static \u0275fac=function(t){return new(t||o)(m(K),m(B),m(O))};static \u0275cmp=v({type:o,selectors:[["app-role-edit-form"]],inputs:{role:"role"},outputs:{roleUpdated:"roleUpdated",roleDeleted:"roleDeleted"},features:[Ce],decls:4,vars:2,consts:[[1,"role-edit-form"],[1,"space-y-4",3,"formGroup"],[1,"flex","items-start","justify-between"],[1,"fixed","inset-0","bg-black/30","flex","items-center","justify-center","z-50"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","formControlName","name","placeholder","Ej: Gerente de Ventas",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","placeholder-gray-400","focus:outline-none","focus:ring-blue-500","focus:border-blue-500"],[1,"mt-1","text-sm","text-red-600"],["formControlName","description","rows","3","placeholder","Descripci\xF3n del rol (opcional)",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","placeholder-gray-400","focus:outline-none","focus:ring-blue-500","focus:border-blue-500"],[1,"flex","gap-3"],["text","Guardar","custom_class","btn_primary","type","submit",3,"clicked","loading","disabled"],["text","Cancelar","custom_class","btn_secondary","type","button",3,"clicked"],[1,"flex-1"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"flex","items-center","gap-2","ml-4"],["title","Editar rol",1,"p-2","text-gray-400","hover:text-blue-600","transition-colors",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],["title","Eliminar rol",1,"p-2","text-gray-400","hover:text-red-600","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"bg-white","rounded-lg","p-6","max-w-md","w-full","mx-4","shadow-lg"],[1,"flex","items-center","mb-4"],[1,"shrink-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-red-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"],[1,"ml-3"],[1,"text-lg","font-medium","text-gray-900"],[1,"mb-4"],[1,"text-sm","text-gray-600"],[1,"text-sm","text-gray-600","mt-2"],[1,"flex","gap-3","justify-end"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Eliminar","custom_class","btn_danger",3,"clicked","loading","disabled"]],template:function(t,i){t&1&&(n(0,"div",0),C(1,Qt,14,4,"form",1)(2,Yt,13,2,"div",2),C(3,Zt,20,3,"div",3),r()),t&2&&(s(),x(i.isEditing?1:2),s(2),x(i.showDeleteConfirm?3:-1))},dependencies:[_,Q,Ie,Ee,ke,X,J,Fe,P],encapsulation:2})};function ei(o,e){o&1&&(n(0,"p",6),l(1,"El nombre es requerido"),r())}var We=class o{constructor(e,t,i){this.fb=e;this.roleService=t;this.snackBar=i;this.roleForm=this.fb.group({name:["",[I.required,I.minLength(2),I.maxLength(50)]],description:["",[I.maxLength(200)]]})}roleCreated=new U;cancelled=new U;roleForm;saving=!1;createRole(){if(this.roleForm.invalid||this.saving)return;this.saving=!0;let e=this.roleForm.value,t={name:e.name.trim(),description:e.description?.trim()||"",permission_ids:[]};this.roleService.createRole(t).subscribe({next:i=>{this.snackBar.openFromComponent(y,{data:{message:"Rol creado correctamente",type:"success"},duration:3e3}),this.saving=!1,this.roleCreated.emit(i)},error:i=>{console.error("Error creating role:",i),this.snackBar.openFromComponent(y,{data:{message:i.error?.message||"Error al crear el rol",type:"error"},duration:5e3}),this.saving=!1}})}cancel(){this.cancelled.emit()}static \u0275fac=function(t){return new(t||o)(m(K),m(B),m(O))};static \u0275cmp=v({type:o,selectors:[["app-role-create-dialog"]],outputs:{roleCreated:"roleCreated",cancelled:"cancelled"},decls:18,vars:4,consts:[[1,"fixed","inset-0","bg-black/30","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded-lg","p-6","max-w-md","w-full","mx-4","shadow-lg"],[1,"text-xl","font-semibold","text-gray-900","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","formControlName","name","placeholder","Ej: Gerente de Ventas",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","placeholder-gray-400","focus:outline-none","focus:ring-blue-500","focus:border-blue-500"],[1,"mt-1","text-sm","text-red-600"],["formControlName","description","rows","3","placeholder","Descripci\xF3n del rol (opcional)",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","placeholder-gray-400","focus:outline-none","focus:ring-blue-500","focus:border-blue-500"],[1,"flex","gap-3","justify-end","pt-4"],["text","Cancelar","custom_class","btn_secondary","type","button",3,"clicked"],["text","Crear Rol","custom_class","btn_primary","type","submit",3,"clicked","loading","disabled"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"Crear Nuevo Rol"),r(),n(4,"form",3),d("ngSubmit",function(){return i.createRole()}),n(5,"div")(6,"label",4),l(7," Nombre del Rol * "),r(),b(8,"input",5),C(9,ei,2,0,"p",6),r(),n(10,"div")(11,"label",4),l(12," Descripci\xF3n "),r(),n(13,"textarea",7),l(14,"            "),r()(),n(15,"div",8)(16,"app-button",9),d("clicked",function(){return i.cancel()}),r(),n(17,"app-button",10),d("clicked",function(){return i.createRole()}),r()()()()()),t&2){let a;s(4),u("formGroup",i.roleForm),s(5),x((a=i.roleForm.get("name"))!=null&&a.invalid&&((a=i.roleForm.get("name"))!=null&&a.touched)?9:-1),s(8),u("loading",i.saving)("disabled",i.roleForm.invalid||i.saving)}},dependencies:[_,Q,Ie,Ee,ke,X,J,Fe,P],encapsulation:2})};var Xe=class o{constructor(e,t){this.http=e;this.dataMapper=t}modulesCache$=new S(null);modulePermissionsCache$=new S(null);api=de.api;getModules(){return this.modulesCache$.value?new te(e=>{e.next(this.modulesCache$.value),e.complete()}):this.http.get(`${this.api}/tenant/modules`).pipe(M(e=>this.dataMapper.mapModules(e)),$(e=>this.modulesCache$.next(e)),R(1))}getModulePermissions(){return this.modulePermissionsCache$.value?new te(e=>{e.next(this.modulePermissionsCache$.value),e.complete()}):this.http.get(`${this.api}/tenant/module-permissions`).pipe($(e=>this.modulePermissionsCache$.next(e)),R(1))}clearCache(){this.modulesCache$.next(null),this.modulePermissionsCache$.next(null)}static \u0275fac=function(t){return new(t||o)(L(le),L(Z))};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};var ii=(o,e)=>e.id;function oi(o,e){o&1&&(n(0,"div",16)(1,"p"),l(2,"No se encontraron roles"),r()())}function ni(o,e){if(o&1){let t=w();n(0,"div",17)(1,"button",18),k(2,"async"),d("click",function(){let a=g(t).$implicit,p=c(3);return f(p.onRoleSelected(a.id))}),n(3,"div",19)(4,"div",20)(5,"p",21),l(6),r(),n(7,"div",22)(8,"span",23),l(9),r(),n(10,"span",24),l(11),r()()()()()()}if(o&2){let t=e.$implicit,i=c(3);s(),we("bg-blue-50",F(2,8,i.selectedRoleId$)===t.id),s(5),h(t.name),s(3),W(" ",i.getPermissionCount(t)," permiso",i.getPermissionCount(t)!==1?"s":""," "),s(),A(i.getPermissionBadgeClass(t)),s(),E(" ",i.getPermissionStatusText(t)," ")}}function ri(o,e){if(o&1&&H(0,ni,12,10,"div",17,ii),o&2){let t=c();q(t)}}function ai(o,e){o&1&&C(0,oi,3,0,"div",16)(1,ri,2,0),o&2&&x(e.length===0?0:1)}function si(o,e){if(o&1){let t=w();n(0,"div",14)(1,"div",25)(2,"app-role-edit-form",26),d("roleUpdated",function(a){g(t);let p=c();return f(p.onRoleUpdated(a))})("roleDeleted",function(a){g(t);let p=c();return f(p.onRoleDeleted(a))}),r(),n(3,"div",27)(4,"div",28)(5,"span",29),l(6,"Permisos:"),r(),n(7,"span",30),l(8),r()(),n(9,"div",28)(10,"span",29),l(11,"Estado:"),r(),n(12,"span",31),l(13),r()()()(),n(14,"div",32)(15,"app-role-permissions-manager",33),d("permissionsUpdated",function(a){g(t);let p=c();return f(p.onPermissionsUpdated(a))}),r()()()}if(o&2){let t=e,i=c();s(2),u("role",t),s(5),A(i.getPermissionBadgeClass(t)),s(),E(" ",i.getPermissionCount(t)," "),s(4),A(i.getPermissionBadgeClass(t)),s(),E(" ",i.getPermissionStatusText(t)," "),s(2),u("role",t)}}function li(o,e){o&1&&(n(0,"div",15)(1,"div",34)(2,"p",35),l(3,"Selecciona un rol para ver detalles"),r()()())}function ci(o,e){if(o&1){let t=w();n(0,"app-role-create-dialog",36),d("roleCreated",function(a){g(t);let p=c();return f(p.onRoleCreated(a))})("cancelled",function(){g(t);let a=c();return f(a.onCreateDialogCancelled())}),r()}}var Je=class o{constructor(e,t,i,a,p,_e){this.stateService=e;this.roleService=t;this.moduleService=i;this.snackBar=a;this.router=p;this.activatedRoute=_e;this.roles$=this.stateService.roles$,this.filteredRoles$=this.stateService.filteredRoles$,this.selectedRoleId$=this.stateService.selectedRoleId$,this.modules$=this.stateService.modules$,this.roleSearchFilter$=this.stateService.roleSearchFilter$,this.selectedRole$=z([this.selectedRoleId$,this.roles$]).pipe(M(([be,N])=>be&&N.find(Ke=>Ke.id===be)||null))}roles$;filteredRoles$;selectedRoleId$;selectedRole$;modules$;roleSearchFilter$;showOnlyUnconfigurated=!1;showCreateDialog=!1;showOnlyUnconfiguratedSubject=new S(!1);ngOnInit(){this.roleService.getRoles().subscribe(e=>{console.log("Roles loaded:",e),this.stateService.updateRoles(e)},e=>{console.error("Failed to load roles:",e),this.snackBar.openFromComponent(y,{data:{message:e.error?.message||"Failed to load roles",type:"error"},duration:5e3})}),this.moduleService.getModules().subscribe(e=>{console.log("Modules loaded:",e),this.stateService.updateModules(e)},e=>{console.error("Failed to load modules:",e),this.snackBar.openFromComponent(y,{data:{message:e.error?.message||"Failed to load modules",type:"error"},duration:5e3})})}onRoleSelected(e){this.stateService.selectRole(e)}onRoleSearchChange(e){let t=e.target.value;this.stateService.setRoleSearchFilter(t)}onCreateRoleClicked(){this.showCreateDialog=!0}onRoleCreated(e){this.showCreateDialog=!1,this.roleService.getRoles().subscribe(t=>{this.stateService.updateRoles(t),this.stateService.selectRole(e.id)})}onCreateDialogCancelled(){this.showCreateDialog=!1}goBackToSettings(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}onRoleUpdated(e){this.roleService.getRoles().subscribe(t=>{this.stateService.updateRoles(t)})}onRoleDeleted(e){this.stateService.selectedRoleId$&&e&&this.stateService.clearRoleSelection(),this.roleService.getRoles().subscribe(t=>{this.stateService.updateRoles(t)})}onPermissionsUpdated(e){console.log("Permissions updated, refreshing roles list"),this.roleService.clearCache(),this.roleService.getRoles().subscribe(t=>{console.log("Roles refreshed after permission update:",t),console.log("Updated role:",t.find(i=>i.id===e.id)),this.stateService.updateRoles(t)},t=>{console.error("Error refreshing roles:",t)})}getPermissionCount(e){return e.permission_count??e.permissions?.length??0}getPermissionBadgeClass(e){let t=this.getPermissionCount(e);return t===0?"bg-red-100 text-red-800":t<=5?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}getPermissionStatusText(e){let t=this.getPermissionCount(e);return t===0?"Sin configurar":t<=5?"B\xE1sico":"Completo"}static \u0275fac=function(t){return new(t||o)(m(Y),m(B),m(Xe),m(O),m(me),m(ce))};static \u0275cmp=v({type:o,selectors:[["app-roles-management"]],decls:22,vars:7,consts:[[1,"p-6","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],[1,"flex","items-center","gap-3","mb-6"],[3,"clicked"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"flex","gap-6","h-[calc(100vh-200px)]","items-center","justify-center"],[1,"w-1/3","bg-gray-50","rounded-lg","border","border-gray-200","flex","flex-col","overflow-hidden","h-full"],[1,"px-6","py-4","border-b","border-gray-200","bg-white"],[1,"text-lg","font-semibold","text-gray-900"],[1,"px-6","py-4","border-b","border-gray-200","bg-white","space-y-3"],[1,"flex","gap-3","flex-wrap"],["type","text","placeholder","Buscar roles...",1,"flex-1","min-w-[200px]","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","placeholder-gray-400","focus:outline-none","focus:ring-blue-500","focus:border-blue-500",3,"input"],["text","Nuevo Rol","custom_class","btn_primary",3,"clicked"],[1,"flex-1","overflow-y-auto","bg-white"],[1,"flex-1","bg-gray-50","rounded-lg","border","border-gray-200","flex","flex-col","overflow-hidden","h-full"],[1,"flex","flex-col","h-full","bg-white"],[1,"flex","items-center","justify-center","h-full","bg-white"],[1,"p-4","text-center","text-gray-500"],[1,"border-b","border-gray-100","last:border-b-0"],[1,"w-full","text-left","px-6","py-4","hover:bg-gray-50","transition-colors","focus:outline-none","focus:ring-2","focus:ring-inset","focus:ring-blue-500",3,"click"],[1,"flex","items-center","justify-between"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"flex","items-center","gap-2","mt-1"],[1,"text-xs","text-gray-500"],[1,"inline-flex","items-center","px-1.5","py-0.5","rounded-full","text-xs","font-medium"],[1,"px-6","py-4","border-b","border-gray-200"],[3,"roleUpdated","roleDeleted","role"],[1,"flex","items-center","gap-4","mt-4"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-gray-500"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-sm","font-medium"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium"],[1,"flex-1","overflow-y-auto","p-6"],[3,"permissionsUpdated","role"],[1,"text-center"],[1,"text-gray-500","text-lg"],[3,"roleCreated","cancelled"]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"app-back-button",2),d("clicked",function(){return i.goBackToSettings()}),r(),n(3,"h1",3),l(4,"Gesti\xF3n de Roles y Permisos"),r()(),n(5,"div",4)(6,"div",5)(7,"div",6)(8,"h2",7),l(9,"Roles"),r()(),n(10,"div",8)(11,"div",9)(12,"input",10),d("input",function(p){return i.onRoleSearchChange(p)}),r(),n(13,"app-button",11),d("clicked",function(){return i.onCreateRoleClicked()}),r()()(),n(14,"div",12),C(15,ai,2,1),k(16,"async"),r()(),n(17,"div",13),C(18,si,16,8,"div",14),k(19,"async"),re(20,li,4,0,"div",15),r()(),C(21,ci,1,0,"app-role-create-dialog"),r()),t&2){let a,p;s(15),x((a=F(16,3,i.filteredRoles$))?15:-1,a),s(3),x((p=F(19,5,i.selectedRole$))?18:20,p),s(3),x(i.showCreateDialog?21:-1)}},dependencies:[_,Le,He,qe,We,P,se],styles:["[_nghost-%COMP%]{display:block;height:100%}.w-1-3[_ngcontent-%COMP%]{flex:0 0 33.333%}.w-2-3[_ngcontent-%COMP%]{flex:0 0 66.667%}.overflow-y-auto[_ngcontent-%COMP%]{overflow-y:auto;-webkit-overflow-scrolling:touch}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#d1d5db;border-radius:4px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9ca3af}button[_ngcontent-%COMP%]:hover{background-color:#f9fafb}button[_ngcontent-%COMP%]:focus{outline:none}"]})};var Yn=[{path:"",component:Oe,children:[{path:"",component:Te,pathMatch:"full"},{path:"users",component:ze},{path:"roles",component:Je}]}];export{Yn as RBAC_TENANT_UI_ROUTES};
