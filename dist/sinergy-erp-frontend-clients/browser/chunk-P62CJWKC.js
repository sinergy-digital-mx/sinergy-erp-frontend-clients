import{a as N,b as et}from"./chunk-DXMKZQEY.js";import{a as He,b as Xe,e as Ye,f as Je,g as Ke,h as Qe,i as tt}from"./chunk-3EZ4E46M.js";import"./chunk-HO6VT44Y.js";import"./chunk-ESGHQXLB.js";import{ga as qe}from"./chunk-CKDP52D7.js";import{H as oe,I as re,J as Ze,S as ae}from"./chunk-RBHIJQFK.js";import{b as Y,c as xe,e as j,f as J,h as K,k as We,l as Q,m as Ue,n as Ge,o as $e,p as Z,q as ee,r as A,s as te,t as ne,v as ie}from"./chunk-7TNFDLAZ.js";import{x as $,y as H,z as X}from"./chunk-5MRBIJ7N.js";import{d as G,e as E,j as ze,m as O,r as Me,t as Fe,w as Be,y as V}from"./chunk-UZLFZEBK.js";import{Ac as ye,Cc as ve,Fb as s,Gb as o,Hb as i,I as he,Ib as p,Pb as S,Qa as U,S as je,Ta as a,Tb as g,Vb as m,W as Ae,aa as h,ab as v,ba as C,c as Ve,cc as Ce,ec as k,gb as x,hc as l,ia as P,ic as M,j as F,jc as _,kc as Ne,mb as u,mc as I,na as y,nc as R,o as W,oc as L,u as fe,y as B,yc as be}from"./chunk-NOG5ANO3.js";import{a as f,b}from"./chunk-7CGTOI24.js";var le=class r{constructor(n,e,t,d,c,T){this.fb=n;this.dialogRef=e;this.data=t;this.route=d;this.leads_service=c;this.interceptor_service=T;this.lead_id.set(t.lead_id),this.form=this.fb.group({type:[null,xe.required],title:["",xe.required],description:[""],notes:[""],duration_minutes:[""]})}X=$;loading=y(!1);form;update=y(!1);activityTypes=[{label:"Call",value:"call"},{label:"Email",value:"email"},{label:"Meeting",value:"meeting"},{label:"Note",value:"note"},{label:"Task",value:"task"},{label:"Follow up",value:"follow_up"}];lead_id=y(null);closeDialog(){console.log(this.loading()),this.loading()||this.dialogRef.close(this.update())}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading.set(!0);let n=f({lead_id:this.lead_id()},this.form.value);this.leads_service.createActivity(n).subscribe(e=>{this.update.set(!0),this.loading.set(!1),this.interceptor_service.openSnackbar({type:"success",title:"Success",message:"Activity created successfully."}),this.closeDialog()},e=>{this.interceptor_service.openSnackbar({type:"error",title:"Error",message:"We couldn\u2019t create the activity. Please try again."}),this.loading.set(!1)})}static \u0275fac=function(e){return new(e||r)(v(ee),v(oe),v(re),v(V),v(N),v(ae))};static \u0275cmp=x({type:r,selectors:[["app-lead-activity-dialog"]],decls:32,vars:8,consts:[[1,"dialog"],[1,"dialog__header"],["name","x",1,"close","cursor-pointer",3,"click","img"],[1,"dialog__body"],[1,"container","grid","grid-cols-1","md:grid-cols-2","gap-4",3,"formGroup"],[1,"flex","flex-col","gap-1"],[1,"text-sm","font-medium","text-gray-700"],["formControlName","type",1,"w-full","rounded-lg","border","border-gray-300","px-3","py-2","text-sm","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:border-indigo-500"],["value","","disabled",""],["value","call"],["value","email"],["value","meeting"],["value","note"],["value","task"],["value","follow_up"],["label","Title","placeholder","e.g. Follow-up call",3,"form_control"],["label","Description","placeholder","e.g. Follow-up call",3,"form_control"],["label","Duration","placeholder","e.g. Follow-up call","type","number",3,"form_control"],[1,"md:col-span-2"],["label","Notes","placeholder","e.g. Follow-up call",3,"type","form_control"],[1,"dialog__footer"],["text","Create activity","custom_class","btn_primary",3,"click","loading"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),l(3,"Create Activity"),i(),o(4,"lucide-icon",2),g("click",function(){return t.closeDialog()}),i()(),o(5,"div",3)(6,"div",4)(7,"div",5)(8,"label",6),l(9," Activity type "),i(),o(10,"select",7)(11,"option",8),l(12,"Select type"),i(),o(13,"option",9),l(14,"Call"),i(),o(15,"option",10),l(16,"Email"),i(),o(17,"option",11),l(18,"Meeting"),i(),o(19,"option",12),l(20,"Note"),i(),o(21,"option",13),l(22,"Task"),i(),o(23,"option",14),l(24,"Follow up"),i()()(),p(25,"app-input",15)(26,"app-input",16)(27,"app-input",17),o(28,"div",18),p(29,"app-input",19),i()()(),o(30,"div",20)(31,"app-button",21),g("click",function(){return t.submit()}),i()()()),e&2&&(a(4),s("img",t.X),a(2),s("formGroup",t.form),a(19),s("form_control",t.form.controls.title),a(),s("form_control",t.form.controls.description),a(),s("form_control",t.form.controls.duration_minutes),a(2),s("type","textarea")("form_control",t.form.controls.notes),a(2),s("loading",t.loading()))},dependencies:[O,X,H,ne,ie,Z,Ge,$e,Ue,j,J,te,Q,We],styles:[".dialog[_ngcontent-%COMP%]{width:100dvw;max-width:700px}"]})};var de=class r{constructor(n,e,t,d,c,T){this.fb=n;this.dialogRef=e;this.data=t;this.route=d;this.leads_service=c;this.interceptor_service=T;this.lead_id.set(t.lead_id),this.form=this.fb.group({street_address:[null],city:[""],state:[""],notes:[""],postal_code:[""],country:[""]})}X=$;loading=y(!1);form;update=y(!1);lead_id=y(null);closeDialog(){console.log(this.loading()),this.loading()||this.dialogRef.close(this.update())}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.loading.set(!0);let n=f({lead_id:this.lead_id()},this.form.value);this.leads_service.createActivity(n).subscribe(e=>{this.update.set(!0),this.loading.set(!1),this.interceptor_service.openSnackbar({type:"success",title:"Success",message:"Activity created successfully."}),this.closeDialog()},e=>{this.interceptor_service.openSnackbar({type:"error",title:"Error",message:"We couldn\u2019t create the activity. Please try again."}),this.loading.set(!1)})}static \u0275fac=function(e){return new(e||r)(v(ee),v(oe),v(re),v(V),v(N),v(ae))};static \u0275cmp=x({type:r,selectors:[["app-lead-activity-dialog"]],decls:16,vars:10,consts:[[1,"dialog"],[1,"dialog__header"],["name","x",1,"close","cursor-pointer",3,"click","img"],[1,"dialog__body"],[1,"container","grid","grid-cols-1","md:grid-cols-2","gap-4",3,"formGroup"],["label","Street address","placeholder","e.g. 123 Main St, Apt 4B",3,"form_control"],["label","City","placeholder","e.g. Tijuana",3,"form_control"],["label","State","placeholder","e.g. Baja California",3,"form_control"],["label","Postal code","placeholder","e.g. 22000",3,"form_control"],["label","Country","placeholder","e.g. Mexico",3,"form_control"],[1,"md:col-span-2"],["label","Notes","placeholder","e.g. Gate code, delivery instructions...",3,"type","form_control"],[1,"dialog__footer"],["text","Create address","custom_class","btn_primary",3,"click","loading"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),l(3,"Create address"),i(),o(4,"lucide-icon",2),g("click",function(){return t.closeDialog()}),i()(),o(5,"div",3)(6,"div",4),p(7,"app-input",5)(8,"app-input",6)(9,"app-input",7)(10,"app-input",8)(11,"app-input",9),o(12,"div",10),p(13,"app-input",11),i()()(),o(14,"div",12)(15,"app-button",13),g("click",function(){return t.submit()}),i()()()),e&2&&(a(4),s("img",t.X),a(2),s("formGroup",t.form),a(),s("form_control",t.form.controls.street_address),a(),s("form_control",t.form.controls.city),a(),s("form_control",t.form.controls.state),a(),s("form_control",t.form.controls.postal_code),a(),s("form_control",t.form.controls.country),a(2),s("type","textarea")("form_control",t.form.controls.notes),a(2),s("loading",t.loading()))},dependencies:[O,X,H,ne,ie,Z,J,te,Q],styles:[".dialog[_ngcontent-%COMP%]{width:100dvw;max-width:700px}"]})};function ct(r,n){r&1&&(o(0,"div",4),p(1,"div",5),o(2,"p"),l(3,"Loading email threads..."),i()())}function mt(r,n){if(r&1){let e=S();o(0,"button",11),g("click",function(){h(e);let d=m(2);return C(d.retry())}),p(1,"i",12),l(2," Retry "),i()}}function pt(r,n){if(r&1&&(o(0,"div",6)(1,"div",7),p(2,"i",8),i(),o(3,"p",9),l(4),i(),u(5,mt,3,0,"button",10),i()),r&2){let e=m();a(4),M(e.error.message),a(),s("ngIf",e.error.retryable)}}function gt(r,n){r&1&&(o(0,"div",13)(1,"div",14),p(2,"i",15),i(),o(3,"p"),l(4,"No email threads yet"),i(),o(5,"p",16),l(6,"Start a conversation by sending an email"),i()())}function _t(r,n){if(r&1){let e=S();o(0,"div",19),g("click",function(){let d=h(e).$implicit,c=m(2);return C(c.selectThread(d.id))})("keydown.enter",function(){let d=h(e).$implicit,c=m(2);return C(c.selectThread(d.id))})("keydown.space",function(){let d=h(e).$implicit,c=m(2);return C(c.selectThread(d.id))}),o(1,"div",20)(2,"div",21)(3,"div",22),l(4),i(),o(5,"div",23)(6,"div",24),l(7),i(),o(8,"div",25),l(9),i()()(),o(10,"div",26),l(11),i()(),o(12,"div",27)(13,"div",28),l(14),i(),o(15,"div",29),l(16),i()(),o(17,"div",30)(18,"span",31),l(19),i()()()}if(r&2){let e=n.$implicit,t=m(2);a(4),_(" ",e.sender.charAt(0).toUpperCase()," "),a(3),M(e.sender),a(2),M(e.senderEmail),a(2),M(t.formatDate(e.lastMessageDate)),a(3),M(e.subject),a(2),M(t.truncatePreview(e.messagePreview)),a(3),_("",e.messageCount," messages")}}function ut(r,n){if(r&1&&(o(0,"div",17),u(1,_t,20,7,"div",18),i()),r&2){let e=m();a(),s("ngForOf",e.threads)}}var se=class r{threads=[];isLoading=!1;error=null;threadSelected=new P;retryClicked=new P;formatDate(n){let e=new Date(n),t=new Date,d=t.getTime()-e.getTime(),c=Math.floor(d/6e4),T=Math.floor(d/36e5),z=Math.floor(d/864e5);return c<1?"Just now":c<60?`${c}m ago`:T<24?`${T}h ago`:z<7?`${z}d ago`:e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==t.getFullYear()?"numeric":void 0})}truncatePreview(n,e=100){return n.length>e?n.substring(0,e)+"...":n}selectThread(n){this.threadSelected.emit(n)}retry(){this.retryClicked.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=x({type:r,selectors:[["app-thread-list-view"]],inputs:{threads:"threads",isLoading:"isLoading",error:"error"},outputs:{threadSelected:"threadSelected",retryClicked:"retryClicked"},decls:4,vars:4,consts:[["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","thread-list",4,"ngIf"],[1,"loading-state"],[1,"spinner"],[1,"error-state"],[1,"error-icon"],[1,"pi","pi-exclamation-circle"],[1,"error-message"],["class","retry-btn",3,"click",4,"ngIf"],[1,"retry-btn",3,"click"],[1,"pi","pi-refresh"],[1,"empty-state"],[1,"empty-icon"],[1,"pi","pi-inbox"],[1,"empty-subtitle"],[1,"thread-list"],["class","thread-item","role","button","tabindex","0",3,"click","keydown.enter","keydown.space",4,"ngFor","ngForOf"],["role","button","tabindex","0",1,"thread-item",3,"click","keydown.enter","keydown.space"],[1,"thread-item-header"],[1,"thread-sender"],[1,"sender-avatar"],[1,"sender-info"],[1,"sender-name"],[1,"sender-email"],[1,"thread-date"],[1,"thread-item-body"],[1,"thread-subject"],[1,"thread-preview"],[1,"thread-item-footer"],[1,"message-count"]],template:function(e,t){e&1&&u(0,ct,4,0,"div",0)(1,pt,6,2,"div",1)(2,gt,7,0,"div",2)(3,ut,2,1,"div",3),e&2&&(s("ngIf",t.isLoading),a(),s("ngIf",t.error&&!t.isLoading),a(),s("ngIf",!t.isLoading&&!t.error&&t.threads.length===0),a(),s("ngIf",!t.isLoading&&!t.error&&t.threads.length>0))},dependencies:[O,G,E],styles:[".loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;text-align:center;min-height:300px}.loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #e5e7eb;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7280;font-size:.875rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-state[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%]{font-size:2.5rem;color:#ef4444;margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:#374151;font-size:.875rem;margin-bottom:1rem;max-width:400px}.error-state[_ngcontent-%COMP%]   .retry-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background-color:#3b82f6;color:#fff;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem;font-weight:500;transition:background-color .2s}.error-state[_ngcontent-%COMP%]   .retry-btn[_ngcontent-%COMP%]:hover{background-color:#2563eb}.error-state[_ngcontent-%COMP%]   .retry-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:3rem;color:#d1d5db;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#374151;font-size:.875rem;margin:.5rem 0}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-of-type{font-weight:500}.empty-state[_ngcontent-%COMP%]   .empty-subtitle[_ngcontent-%COMP%]{color:#9ca3af;font-size:.75rem}.thread-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.thread-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;padding:1rem;border:1px solid #e5e7eb;border-radius:.5rem;cursor:pointer;transition:all .2s;background-color:#fff}.thread-item[_ngcontent-%COMP%]:hover{background-color:#f9fafb;border-color:#d1d5db;box-shadow:0 1px 2px #0000000d}.thread-item[_ngcontent-%COMP%]:focus{outline:2px solid #3b82f6;outline-offset:2px}.thread-item[_ngcontent-%COMP%]   .thread-item-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:1rem}.thread-item[_ngcontent-%COMP%]   .thread-item-header[_ngcontent-%COMP%]   .thread-sender[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem;flex:1}.thread-item[_ngcontent-%COMP%]   .thread-item-header[_ngcontent-%COMP%]   .thread-sender[_ngcontent-%COMP%]   .sender-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:40px;height:40px;min-width:40px;background-color:#dbeafe;color:#1e40af;border-radius:50%;font-weight:600;font-size:.875rem}.thread-item[_ngcontent-%COMP%]   .thread-item-header[_ngcontent-%COMP%]   .thread-sender[_ngcontent-%COMP%]   .sender-info[_ngcontent-%COMP%]{flex:1;min-width:0}.thread-item[_ngcontent-%COMP%]   .thread-item-header[_ngcontent-%COMP%]   .thread-sender[_ngcontent-%COMP%]   .sender-info[_ngcontent-%COMP%]   .sender-name[_ngcontent-%COMP%]{font-weight:600;color:#111827;font-size:.875rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.thread-item[_ngcontent-%COMP%]   .thread-item-header[_ngcontent-%COMP%]   .thread-sender[_ngcontent-%COMP%]   .sender-info[_ngcontent-%COMP%]   .sender-email[_ngcontent-%COMP%]{color:#6b7280;font-size:.75rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.thread-item[_ngcontent-%COMP%]   .thread-item-header[_ngcontent-%COMP%]   .thread-date[_ngcontent-%COMP%]{color:#9ca3af;font-size:.75rem;white-space:nowrap}.thread-item[_ngcontent-%COMP%]   .thread-item-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.thread-item[_ngcontent-%COMP%]   .thread-item-body[_ngcontent-%COMP%]   .thread-subject[_ngcontent-%COMP%]{font-weight:600;color:#111827;font-size:.875rem;line-height:1.25}.thread-item[_ngcontent-%COMP%]   .thread-item-body[_ngcontent-%COMP%]   .thread-preview[_ngcontent-%COMP%]{color:#6b7280;font-size:.75rem;line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;word-break:break-word}.thread-item[_ngcontent-%COMP%]   .thread-item-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.thread-item[_ngcontent-%COMP%]   .thread-item-footer[_ngcontent-%COMP%]   .message-count[_ngcontent-%COMP%]{color:#9ca3af;font-size:.75rem}@media(max-width:767px){.thread-item[_ngcontent-%COMP%]{padding:.75rem}.thread-item[_ngcontent-%COMP%]   .thread-item-header[_ngcontent-%COMP%]   .thread-sender[_ngcontent-%COMP%]   .sender-avatar[_ngcontent-%COMP%]{width:32px;height:32px;min-width:32px;font-size:.75rem}}@media(min-width:768px)and (max-width:1023px){.thread-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}}@media(min-width:1024px){.thread-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem}}"]})};function ft(r,n){if(r&1&&(o(0,"div",9),p(1,"i",10),o(2,"span"),l(3),i()()),r&2){let e=m();a(3),M(e.error.message)}}function ht(r,n){if(r&1&&(o(0,"span",11),l(1),i()),r&2){let e=m();a(),_(" ",e.validationError()," ")}}function Ct(r,n){r&1&&(o(0,"span"),p(1,"i",12),l(2," Send Reply "),i())}function bt(r,n){r&1&&(o(0,"span"),p(1,"i",13),l(2," Sending... "),i())}var ce=class r{isSending=!1;error=null;replySent=new P;replyCancelled=new P;messageBody=y("");validationError=y("");validateReply(){return this.messageBody().trim()?(this.validationError.set(""),!0):(this.validationError.set("Message body is required"),!1)}submit(){if(!this.validateReply())return;let n={body:this.messageBody()};this.replySent.emit(n)}cancel(){this.messageBody.set(""),this.validationError.set(""),this.replyCancelled.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=x({type:r,selectors:[["app-reply-compose"]],inputs:{isSending:"isSending",error:"error"},outputs:{replySent:"replySent",replyCancelled:"replyCancelled"},decls:11,vars:10,consts:[[1,"reply-compose"],["class","error-message",4,"ngIf"],[1,"form-group"],["placeholder","Write your reply here...","rows","4",1,"form-textarea",3,"ngModelChange","ngModel","disabled"],["class","error-text",4,"ngIf"],[1,"action-buttons"],[1,"cancel-btn",3,"click","disabled"],[1,"send-btn",3,"click","disabled"],[4,"ngIf"],[1,"error-message"],[1,"pi","pi-exclamation-circle"],[1,"error-text"],[1,"pi","pi-send"],[1,"pi","pi-spin","pi-spinner"]],template:function(e,t){e&1&&(o(0,"div",0),u(1,ft,4,1,"div",1),o(2,"div",2)(3,"textarea",3),L("ngModelChange",function(c){return R(t.messageBody,c)||(t.messageBody=c),c}),i(),u(4,ht,2,1,"span",4),i(),o(5,"div",5)(6,"button",6),g("click",function(){return t.cancel()}),l(7," Cancel "),i(),o(8,"button",7),g("click",function(){return t.submit()}),u(9,Ct,3,0,"span",8)(10,bt,3,0,"span",8),i()()()),e&2&&(a(),s("ngIf",t.error),a(2),k("error",t.validationError()),I("ngModel",t.messageBody),s("disabled",t.isSending),a(),s("ngIf",t.validationError()),a(2),s("disabled",t.isSending),a(2),s("disabled",t.isSending),a(),s("ngIf",!t.isSending),a(),s("ngIf",t.isSending))},dependencies:[O,E,A,Y,j,K],styles:[".reply-compose[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;padding:1rem;background-color:#f9fafb;border:1px solid #e5e7eb;border-radius:.5rem}.reply-compose[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background-color:#fee2e2;border:1px solid #fecaca;border-radius:.375rem;color:#991b1b;font-size:.875rem}.reply-compose[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;flex-shrink:0}.reply-compose[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.reply-compose[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.875rem;font-family:inherit;resize:vertical;transition:all .2s}.reply-compose[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.reply-compose[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea[_ngcontent-%COMP%]:disabled{background-color:#f3f4f6;color:#9ca3af;cursor:not-allowed}.reply-compose[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea.error[_ngcontent-%COMP%]{border-color:#ef4444}.reply-compose[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea.error[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #ef44441a}.reply-compose[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error-text[_ngcontent-%COMP%]{color:#ef4444;font-size:.75rem}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:.75rem}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem;font-weight:500;transition:all .2s}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background-color:#fff;color:#374151;border:1px solid #d1d5db}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f3f4f6}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}@media(max-width:767px){.reply-compose[_ngcontent-%COMP%]{padding:.75rem}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{gap:.5rem}.reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .reply-compose[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{flex:1;justify-content:center}}"]})};function yt(r,n){r&1&&(o(0,"div",6),p(1,"div",7),o(2,"p"),l(3,"Loading thread details..."),i()())}function vt(r,n){if(r&1){let e=S();o(0,"button",13),g("click",function(){h(e);let d=m(2);return C(d.retry())}),p(1,"i",14),l(2," Retry "),i()}}function Mt(r,n){if(r&1&&(o(0,"div",8)(1,"div",9),p(2,"i",10),i(),o(3,"p",11),l(4),i(),u(5,vt,3,0,"button",12),i()),r&2){let e=m();a(4),M(e.error.message),a(),s("ngIf",e.error.retryable)}}function xt(r,n){if(r&1&&(o(0,"div",22)(1,"div",23)(2,"div",24)(3,"div",25),l(4),i(),o(5,"div",26)(6,"div",27),l(7),i(),o(8,"div",28),l(9),i()()(),o(10,"div",29),l(11),i()(),o(12,"div",30),l(13),i()()),r&2){let e=n.$implicit,t=m(2);k("outgoing",e.isOutgoing),a(4),_(" ",e.sender.charAt(0).toUpperCase()," "),a(3),M(e.sender),a(2),M(e.senderEmail),a(2),M(t.formatTimestamp(e.timestamp)),a(2),_(" ",e.body," ")}}function Ot(r,n){if(r&1){let e=S();o(0,"button",31),g("click",function(){h(e);let d=m(2);return C(d.openReply())}),p(1,"i",32),l(2," Reply "),i()}if(r&2){let e=m(2);s("disabled",e.isSendingReply)}}function Pt(r,n){if(r&1){let e=S();o(0,"app-reply-compose",33),g("replySent",function(d){h(e);let c=m(2);return C(c.sendReply(d))})("replyCancelled",function(){h(e);let d=m(2);return C(d.cancelReply())}),i()}if(r&2){let e=m(2);s("isSending",e.isSendingReply)("error",e.sendError)}}function St(r,n){if(r&1&&(o(0,"div",15)(1,"div",16)(2,"h2"),l(3),i()(),o(4,"div",17),u(5,xt,14,7,"div",18),i(),o(6,"div",19),u(7,Ot,3,1,"button",20)(8,Pt,1,2,"app-reply-compose",21),i()()),r&2){let e=m();a(3),M(e.threadDetail.subject),a(2),s("ngForOf",e.threadDetail.messages),a(2),s("ngIf",!e.isReplyComposeOpen),a(),s("ngIf",e.isReplyComposeOpen)}}var me=class r{threadDetail=null;isLoading=!1;error=null;isReplyComposeOpen=!1;isSendingReply=!1;sendError=null;backClicked=new P;replyClicked=new P;replyCancelled=new P;replySent=new P;retryClicked=new P;formatTimestamp(n){return new Date(n).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}goBack(){this.backClicked.emit()}openReply(){this.replyClicked.emit()}cancelReply(){this.replyCancelled.emit()}sendReply(n){this.replySent.emit(n)}retry(){this.retryClicked.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=x({type:r,selectors:[["app-thread-detail-view"]],inputs:{threadDetail:"threadDetail",isLoading:"isLoading",error:"error",isReplyComposeOpen:"isReplyComposeOpen",isSendingReply:"isSendingReply",sendError:"sendError"},outputs:{backClicked:"backClicked",replyClicked:"replyClicked",replyCancelled:"replyCancelled",replySent:"replySent",retryClicked:"retryClicked"},decls:7,vars:3,consts:[[1,"thread-detail-header"],[1,"back-btn",3,"click"],[1,"pi","pi-arrow-left"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","thread-detail",4,"ngIf"],[1,"loading-state"],[1,"spinner"],[1,"error-state"],[1,"error-icon"],[1,"pi","pi-exclamation-circle"],[1,"error-message"],["class","retry-btn",3,"click",4,"ngIf"],[1,"retry-btn",3,"click"],[1,"pi","pi-refresh"],[1,"thread-detail"],[1,"thread-subject"],[1,"messages-list"],["class","message-item",3,"outgoing",4,"ngFor","ngForOf"],[1,"reply-section"],["class","reply-btn",3,"disabled","click",4,"ngIf"],[3,"isSending","error","replySent","replyCancelled",4,"ngIf"],[1,"message-item"],[1,"message-header"],[1,"message-sender"],[1,"sender-avatar"],[1,"sender-info"],[1,"sender-name"],[1,"sender-email"],[1,"message-timestamp"],[1,"message-body"],[1,"reply-btn",3,"click","disabled"],[1,"pi","pi-reply"],[3,"replySent","replyCancelled","isSending","error"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"button",1),g("click",function(){return t.goBack()}),p(2,"i",2),l(3," Back to threads "),i()(),u(4,yt,4,0,"div",3)(5,Mt,6,2,"div",4)(6,St,9,4,"div",5)),e&2&&(a(4),s("ngIf",t.isLoading),a(),s("ngIf",t.error&&!t.isLoading),a(),s("ngIf",!t.isLoading&&!t.error&&t.threadDetail))},dependencies:[O,G,E,ce],styles:[".thread-detail-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.thread-detail-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background-color:transparent;color:#3b82f6;border:1px solid #3b82f6;border-radius:.375rem;cursor:pointer;font-size:.875rem;font-weight:500;transition:all .2s}.thread-detail-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover{background-color:#eff6ff}.thread-detail-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 1rem;text-align:center;min-height:300px}.loading-state[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #e5e7eb;border-top-color:#3b82f6;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6b7280;font-size:.875rem}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-state[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%]{font-size:2.5rem;color:#ef4444;margin-bottom:1rem}.error-state[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:#374151;font-size:.875rem;margin-bottom:1rem;max-width:400px}.error-state[_ngcontent-%COMP%]   .retry-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background-color:#3b82f6;color:#fff;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem;font-weight:500;transition:background-color .2s}.error-state[_ngcontent-%COMP%]   .retry-btn[_ngcontent-%COMP%]:hover{background-color:#2563eb}.error-state[_ngcontent-%COMP%]   .retry-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.thread-detail[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.thread-detail[_ngcontent-%COMP%]   .thread-subject[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:700;color:#111827}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;max-height:500px;overflow-y:auto;padding:1rem;background-color:#f9fafb;border-radius:.5rem;border:1px solid #e5e7eb}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;padding:1rem;background-color:#fff;border-radius:.5rem;border:1px solid #e5e7eb}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item.outgoing[_ngcontent-%COMP%]{background-color:#dbeafe;border-color:#93c5fd}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:1rem}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]   .message-sender[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:.75rem}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]   .message-sender[_ngcontent-%COMP%]   .sender-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;min-width:32px;background-color:#dbeafe;color:#1e40af;border-radius:50%;font-weight:600;font-size:.75rem}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]   .message-sender[_ngcontent-%COMP%]   .sender-info[_ngcontent-%COMP%]   .sender-name[_ngcontent-%COMP%]{font-weight:600;color:#111827;font-size:.875rem}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]   .message-sender[_ngcontent-%COMP%]   .sender-info[_ngcontent-%COMP%]   .sender-email[_ngcontent-%COMP%]{color:#6b7280;font-size:.75rem}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-header[_ngcontent-%COMP%]   .message-timestamp[_ngcontent-%COMP%]{color:#9ca3af;font-size:.75rem;white-space:nowrap}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-body[_ngcontent-%COMP%]{color:#374151;font-size:.875rem;line-height:1.5;white-space:pre-wrap;word-break:break-word}.thread-detail[_ngcontent-%COMP%]   .reply-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.thread-detail[_ngcontent-%COMP%]   .reply-section[_ngcontent-%COMP%]   .reply-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background-color:#3b82f6;color:#fff;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem;font-weight:500;transition:background-color .2s;align-self:flex-start}.thread-detail[_ngcontent-%COMP%]   .reply-section[_ngcontent-%COMP%]   .reply-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb}.thread-detail[_ngcontent-%COMP%]   .reply-section[_ngcontent-%COMP%]   .reply-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.thread-detail[_ngcontent-%COMP%]   .reply-section[_ngcontent-%COMP%]   .reply-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}@media(max-width:767px){.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]{max-height:400px;padding:.75rem}.thread-detail[_ngcontent-%COMP%]   .messages-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]{padding:.75rem}}"]})};function Et(r,n){if(r&1&&(o(0,"div",19),p(1,"i",20),o(2,"span"),l(3),i()()),r&2){let e=m();a(3),M(e.error.message)}}function wt(r,n){if(r&1&&(o(0,"span",21),l(1),i()),r&2){let e=m();a(),_(" ",e.validationErrors().subject," ")}}function Tt(r,n){if(r&1&&(o(0,"span",21),l(1),i()),r&2){let e=m();a(),_(" ",e.validationErrors().body," ")}}function kt(r,n){r&1&&(o(0,"span"),p(1,"i",22),l(2," Send "),i())}function Dt(r,n){r&1&&(o(0,"span"),p(1,"i",23),l(2," Sending... "),i())}var pe=class r{recipientEmail="";isSending=!1;error=null;emailSent=new P;modalClosed=new P;formData=y({recipientEmail:"",subject:"",body:""});validationErrors=y({});ngOnInit(){let n=this.formData();this.formData.set(b(f({},n),{recipientEmail:this.recipientEmail}))}validateForm(){let n={},e=this.formData();return(!e.subject||e.subject.trim()==="")&&(n.subject="Subject is required"),(!e.body||e.body.trim()==="")&&(n.body="Message body is required"),this.validationErrors.set(n),Object.keys(n).length===0}submit(){if(!this.validateForm())return;let n=this.formData(),e={recipientEmail:n.recipientEmail,subject:n.subject,body:n.body};this.emailSent.emit(e)}cancel(){this.modalClosed.emit()}closeOnBackdropClick(n){n.target===n.currentTarget&&this.cancel()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=x({type:r,selectors:[["app-compose-modal"]],inputs:{recipientEmail:"recipientEmail",isSending:"isSending",error:"error"},outputs:{emailSent:"emailSent",modalClosed:"modalClosed"},decls:29,vars:17,consts:[[1,"modal-backdrop",3,"click"],[1,"modal-content"],[1,"modal-header"],[1,"close-btn",3,"click","disabled"],[1,"pi","pi-times"],[1,"modal-body"],["class","error-message",4,"ngIf"],[1,"form-group"],["for","recipient"],["id","recipient","type","email","placeholder","Recipient email","disabled","",1,"form-input",3,"ngModelChange","ngModel"],["for","subject"],["id","subject","type","text","placeholder","Email subject",1,"form-input",3,"ngModelChange","ngModel","disabled"],["class","error-text",4,"ngIf"],["for","body"],["id","body","placeholder","Write your message here...","rows","8",1,"form-textarea",3,"ngModelChange","ngModel","disabled"],[1,"modal-footer"],[1,"cancel-btn",3,"click","disabled"],[1,"send-btn",3,"click","disabled"],[4,"ngIf"],[1,"error-message"],[1,"pi","pi-exclamation-circle"],[1,"error-text"],[1,"pi","pi-send"],[1,"pi","pi-spin","pi-spinner"]],template:function(e,t){e&1&&(o(0,"div",0),g("click",function(c){return t.closeOnBackdropClick(c)}),o(1,"div",1)(2,"div",2)(3,"h2"),l(4,"Compose Email"),i(),o(5,"button",3),g("click",function(){return t.cancel()}),p(6,"i",4),i()(),o(7,"div",5),u(8,Et,4,1,"div",6),o(9,"div",7)(10,"label",8),l(11,"To:"),i(),o(12,"input",9),L("ngModelChange",function(c){return R(t.formData().recipientEmail,c)||(t.formData().recipientEmail=c),c}),i()(),o(13,"div",7)(14,"label",10),l(15,"Subject:"),i(),o(16,"input",11),L("ngModelChange",function(c){return R(t.formData().subject,c)||(t.formData().subject=c),c}),i(),u(17,wt,2,1,"span",12),i(),o(18,"div",7)(19,"label",13),l(20,"Message:"),i(),o(21,"textarea",14),L("ngModelChange",function(c){return R(t.formData().body,c)||(t.formData().body=c),c}),i(),u(22,Tt,2,1,"span",12),i()(),o(23,"div",15)(24,"button",16),g("click",function(){return t.cancel()}),l(25," Cancel "),i(),o(26,"button",17),g("click",function(){return t.submit()}),u(27,kt,3,0,"span",18)(28,Dt,3,0,"span",18),i()()()()),e&2&&(a(5),s("disabled",t.isSending),a(3),s("ngIf",t.error),a(4),I("ngModel",t.formData().recipientEmail),a(4),k("error",t.validationErrors().subject),I("ngModel",t.formData().subject),s("disabled",t.isSending),a(),s("ngIf",t.validationErrors().subject),a(4),k("error",t.validationErrors().body),I("ngModel",t.formData().body),s("disabled",t.isSending),a(),s("ngIf",t.validationErrors().body),a(2),s("disabled",t.isSending),a(2),s("disabled",t.isSending),a(),s("ngIf",!t.isSending),a(),s("ngIf",t.isSending))},dependencies:[O,E,A,Y,j,K],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:1rem}.modal-content[_ngcontent-%COMP%]{background-color:#fff;border-radius:.75rem;box-shadow:0 20px 25px -5px #0000001a;max-width:600px;width:100%;max-height:90vh;display:flex;flex-direction:column;overflow:hidden}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1.5rem;border-bottom:1px solid #e5e7eb}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:#111827}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background-color:transparent;border:none;border-radius:.375rem;cursor:pointer;color:#6b7280;transition:all .2s}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f3f4f6;color:#111827}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.25rem}.modal-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem;display:flex;flex-direction:column;gap:1.5rem}.modal-body[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background-color:#fee2e2;border:1px solid #fecaca;border-radius:.375rem;color:#991b1b;font-size:.875rem}.modal-body[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem;flex-shrink:0}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#374151;font-size:.875rem}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%], .modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #d1d5db;border-radius:.375rem;font-size:.875rem;font-family:inherit;transition:all .2s}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]:focus, .modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]:disabled, .modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea[_ngcontent-%COMP%]:disabled{background-color:#f3f4f6;color:#9ca3af;cursor:not-allowed}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-input.error[_ngcontent-%COMP%], .modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea.error[_ngcontent-%COMP%]{border-color:#ef4444}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-input.error[_ngcontent-%COMP%]:focus, .modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea.error[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #ef44441a}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-textarea[_ngcontent-%COMP%]{resize:vertical;min-height:150px}.modal-body[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .error-text[_ngcontent-%COMP%]{color:#ef4444;font-size:.75rem}.modal-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;gap:.75rem;padding:1.5rem;border-top:1px solid #e5e7eb;background-color:#f9fafb}.modal-footer[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem;font-weight:500;transition:all .2s}.modal-footer[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.modal-footer[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]{background-color:#fff;color:#374151;border:1px solid #d1d5db}.modal-footer[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#f3f4f6}.modal-footer[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.modal-footer[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.modal-footer[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb}.modal-footer[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}@media(max-width:767px){.modal-backdrop[_ngcontent-%COMP%]{padding:0}.modal-content[_ngcontent-%COMP%]{max-width:100%;max-height:100vh;border-radius:0}.modal-header[_ngcontent-%COMP%]{padding:1rem}.modal-body[_ngcontent-%COMP%]{padding:1rem;gap:1rem}.modal-footer[_ngcontent-%COMP%]{padding:1rem;gap:.5rem}.modal-footer[_ngcontent-%COMP%]   .cancel-btn[_ngcontent-%COMP%], .modal-footer[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{flex:1;justify-content:center}}"]})};var ge=class r{constructor(n){this.http=n}apiUrl="/api/tenant/email-threads";getThreads(n){return this.http.get(`${this.apiUrl}?entityType=lead&entityId=${n}`).pipe(he(e=>e.pipe(W((t,d)=>this.isNetworkError(t)&&d<2?fe(2e3):F(()=>t)))),B(e=>this.handleError(e)),W(e=>e.success&&Array.isArray(e.data)?new Ve(t=>{t.next(e.data),t.complete()}):F(()=>({type:"validation",message:"Invalid response format",retryable:!1}))))}getThreadDetail(n){return this.http.get(`${this.apiUrl}/${n}`).pipe(he(e=>e.pipe(W((t,d)=>this.isNetworkError(t)&&d<2?fe(2e3):F(()=>t)))),B(e=>this.handleError(e)))}sendEmail(n,e){let t={entityType:"lead",entityId:n,emailTo:e.recipientEmail,subject:e.subject,body:e.body};return this.http.post(this.apiUrl,t).pipe(B(d=>this.handleError(d)))}sendReply(n,e){return this.http.post(`${this.apiUrl}/${n}/messages`,e).pipe(B(t=>this.handleError(t)))}isNetworkError(n){return n instanceof Me&&(n.status===0||n.status>=500)}handleError(n){let e;return n instanceof Me?n.status===0?e={type:"network",message:"Unable to connect. Please check your internet connection.",retryable:!0}:n.status>=500?e={type:"server",message:"Server error. Please try again later.",retryable:!0}:n.status>=400?e={type:"validation",message:n.error?.message||"Invalid request. Please check your input.",retryable:!1}:e={type:"server",message:"An unexpected error occurred.",retryable:!0}:e={type:"server",message:"An unexpected error occurred.",retryable:!0},F(()=>e)}static \u0275fac=function(e){return new(e||r)(Ae(Fe))};static \u0275prov=je({token:r,factory:r.\u0275fac,providedIn:"root"})};function Rt(r,n){if(r&1){let e=S();o(0,"div",8)(1,"app-thread-list-view",9),g("threadSelected",function(d){h(e);let c=m();return C(c.selectThread(d))})("retryClicked",function(){h(e);let d=m();return C(d.retryLastAction())}),i()()}if(r&2){let e=m();a(),s("threads",e.state().threads)("isLoading",e.state().isLoadingThreads)("error",e.state().threadsError)}}function Lt(r,n){if(r&1){let e=S();o(0,"div",10)(1,"app-thread-detail-view",11),g("backClicked",function(){h(e);let d=m();return C(d.goBackToThreadList())})("replyClicked",function(){h(e);let d=m();return C(d.openReplyCompose())})("replyCancelled",function(){h(e);let d=m();return C(d.closeReplyCompose())})("replySent",function(d){h(e);let c=m();return C(c.sendReply(d))})("retryClicked",function(){h(e);let d=m();return C(d.retryLastAction())}),i()()}if(r&2){let e=m();a(),s("threadDetail",e.state().selectedThreadDetails)("isLoading",e.state().isLoadingThreadDetail)("error",e.state().threadDetailError)("isReplyComposeOpen",e.state().isReplyComposeOpen)("isSendingReply",e.state().isSendingReply)("sendError",e.state().sendError)}}function Vt(r,n){if(r&1){let e=S();o(0,"app-compose-modal",12),g("emailSent",function(d){h(e);let c=m();return C(c.sendEmail(d))})("modalClosed",function(){h(e);let d=m();return C(d.closeComposeModal())}),i()}if(r&2){let e=m();s("recipientEmail",e.leadEmail)("isSending",e.state().isSendingEmail)("error",e.state().sendError)}}var _e=class r{constructor(n){this.emailThreadService=n}leadId;leadEmail;state=y({threads:[],isLoadingThreads:!1,threadsError:null,selectedThreadId:null,selectedThreadDetails:null,isLoadingThreadDetail:!1,threadDetailError:null,isComposeModalOpen:!1,isReplyComposeOpen:!1,isSendingEmail:!1,isSendingReply:!1,sendError:null,lastRefresh:0});ngOnInit(){this.loadThreads()}loadThreads(){let n=this.state();this.state.set(b(f({},n),{isLoadingThreads:!0,threadsError:null})),this.emailThreadService.getThreads(this.leadId).subscribe({next:e=>{let t=this.state();this.state.set(b(f({},t),{threads:e,isLoadingThreads:!1,lastRefresh:Date.now()}))},error:e=>{let t=this.state();this.state.set(b(f({},t),{isLoadingThreads:!1,threadsError:e}))}})}selectThread(n){let e=this.state();this.state.set(b(f({},e),{selectedThreadId:n,isLoadingThreadDetail:!0,threadDetailError:null})),this.emailThreadService.getThreadDetail(n).subscribe({next:t=>{let d=this.state();this.state.set(b(f({},d),{selectedThreadDetails:t,isLoadingThreadDetail:!1}))},error:t=>{let d=this.state();this.state.set(b(f({},d),{isLoadingThreadDetail:!1,threadDetailError:t}))}})}goBackToThreadList(){let n=this.state();this.state.set(b(f({},n),{selectedThreadId:null,selectedThreadDetails:null,isReplyComposeOpen:!1}))}openComposeModal(){let n=this.state();this.state.set(b(f({},n),{isComposeModalOpen:!0}))}closeComposeModal(){let n=this.state();this.state.set(b(f({},n),{isComposeModalOpen:!1,sendError:null}))}sendEmail(n){let e=this.state();this.state.set(b(f({},e),{isSendingEmail:!0,sendError:null})),this.emailThreadService.sendEmail(this.leadId,n).subscribe({next:()=>{let t=this.state();this.state.set(b(f({},t),{isSendingEmail:!1,isComposeModalOpen:!1})),this.loadThreads()},error:t=>{let d=this.state();this.state.set(b(f({},d),{isSendingEmail:!1,sendError:t}))}})}sendReply(n){let e=this.state(),t=e.selectedThreadId;t&&(this.state.set(b(f({},e),{isSendingReply:!0,sendError:null})),this.emailThreadService.sendReply(t,n).subscribe({next:()=>{let d=this.state();this.state.set(b(f({},d),{isSendingReply:!1,isReplyComposeOpen:!1})),this.selectThread(t)},error:d=>{let c=this.state();this.state.set(b(f({},c),{isSendingReply:!1,sendError:d}))}}))}retryLastAction(){let n=this.state();n.threadsError?this.loadThreads():n.threadDetailError&&n.selectedThreadId&&this.selectThread(n.selectedThreadId)}openReplyCompose(){let n=this.state();this.state.set(b(f({},n),{isReplyComposeOpen:!0}))}closeReplyCompose(){let n=this.state();this.state.set(b(f({},n),{isReplyComposeOpen:!1,sendError:null}))}static \u0275fac=function(e){return new(e||r)(v(ge))};static \u0275cmp=x({type:r,selectors:[["app-email-threads-section"]],inputs:{leadId:"leadId",leadEmail:"leadEmail"},decls:10,vars:4,consts:[[1,"email-threads-section"],[1,"email-threads-header"],[1,"text-lg","font-semibold","text-gray-800"],[1,"send-email-btn",3,"click","disabled"],[1,"pi","pi-envelope"],["class","thread-list-container",4,"ngIf"],["class","thread-detail-container",4,"ngIf"],[3,"recipientEmail","isSending","error","emailSent","modalClosed",4,"ngIf"],[1,"thread-list-container"],[3,"threadSelected","retryClicked","threads","isLoading","error"],[1,"thread-detail-container"],[3,"backClicked","replyClicked","replyCancelled","replySent","retryClicked","threadDetail","isLoading","error","isReplyComposeOpen","isSendingReply","sendError"],[3,"emailSent","modalClosed","recipientEmail","isSending","error"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"h3",2),l(3,"Email Threads"),i(),o(4,"button",3),g("click",function(){return t.openComposeModal()}),p(5,"i",4),l(6," Send Email "),i()(),u(7,Rt,2,3,"div",5)(8,Lt,2,6,"div",6)(9,Vt,1,3,"app-compose-modal",7),i()),e&2&&(a(4),s("disabled",t.state().isSendingEmail),a(3),s("ngIf",!t.state().selectedThreadId),a(),s("ngIf",t.state().selectedThreadId),a(),s("ngIf",t.state().isComposeModalOpen))},dependencies:[O,E,A,Be,se,me,pe],styles:[".email-threads-section[_ngcontent-%COMP%]{background-color:#fff;border-radius:.75rem;border:1px solid #f3f4f6;box-shadow:0 1px 3px #0000001a;padding:1.5rem 1.5rem 2rem;margin-bottom:2rem}.email-threads-section[_ngcontent-%COMP%]   .email-threads-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem}.email-threads-section[_ngcontent-%COMP%]   .email-threads-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.email-threads-section[_ngcontent-%COMP%]   .email-threads-header[_ngcontent-%COMP%]   .send-email-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background-color:#3b82f6;color:#fff;border:none;border-radius:.375rem;cursor:pointer;font-size:.875rem;font-weight:500;transition:background-color .2s}.email-threads-section[_ngcontent-%COMP%]   .email-threads-header[_ngcontent-%COMP%]   .send-email-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#2563eb}.email-threads-section[_ngcontent-%COMP%]   .email-threads-header[_ngcontent-%COMP%]   .send-email-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.email-threads-section[_ngcontent-%COMP%]   .email-threads-header[_ngcontent-%COMP%]   .send-email-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.875rem}.email-threads-section[_ngcontent-%COMP%]   .thread-list-container[_ngcontent-%COMP%], .email-threads-section[_ngcontent-%COMP%]   .thread-detail-container[_ngcontent-%COMP%]{width:100%}@media(max-width:767px){.email-threads-section[_ngcontent-%COMP%]{padding:1rem}.email-threads-section[_ngcontent-%COMP%]   .email-threads-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}.email-threads-section[_ngcontent-%COMP%]   .email-threads-header[_ngcontent-%COMP%]   .send-email-btn[_ngcontent-%COMP%]{width:100%;justify-content:center}}"]})};function jt(r,n){if(r&1&&(o(0,"a",26),l(1),p(2,"i",27),i()),r&2){let e,t,d=m();s("href","mailto:"+((e=d.lead())==null?null:e.email),U),a(),_(" ",(t=d.lead())==null?null:t.email," ")}}function At(r,n){r&1&&l(0,"\u2014")}function Nt(r,n){if(r&1&&(o(0,"a",28),l(1),p(2,"i",29),i()),r&2){let e,t,d=m();s("href",!((e=d.lead())==null||e.website==null)&&e.website.startsWith("http")?(e=d.lead())==null?null:e.website:"https://"+((e=d.lead())==null?null:e.website),U),a(),_(" ",(t=d.lead())==null?null:t.website," ")}}function zt(r,n){r&1&&l(0,"\u2014")}function Ft(r,n){r&1&&(o(0,"tr")(1,"th"),l(2,"Tipo"),i(),o(3,"th"),l(4,"Direcci\xF3n"),i(),o(5,"th"),l(6,"Ciudad"),i(),o(7,"th"),l(8,"Estado"),i(),o(9,"th"),l(10,"C\xF3digo postal"),i(),o(11,"th"),l(12,"Pa\xEDs"),i(),o(13,"th"),l(14,"Principal"),i()())}function Bt(r,n){r&1&&p(0,"p-tag",35)}function qt(r,n){if(r&1&&(o(0,"tr")(1,"td",30),l(2),i(),o(3,"td")(4,"a",31),l(5),p(6,"i",32),i()(),o(7,"td"),l(8),i(),o(9,"td"),l(10),i(),o(11,"td"),l(12),i(),o(13,"td"),l(14),i(),o(15,"td",33),u(16,Bt,1,0,"p-tag",34),i()()),r&2){let e=n.$implicit,t=m();a(2),_(" ",e.type," "),a(2),s("href",t.mapsUrl(e),U),a(),_(" ",e.street_address," "),a(3),_(" ",e.city," "),a(2),_(" ",e.state," "),a(2),_(" ",e.postal_code," "),a(2),_(" ",e.country," "),a(2),s("ngIf",e.is_primary)}}function Wt(r,n){r&1&&(o(0,"tr")(1,"th"),l(2,"Tipo"),i(),o(3,"th"),l(4,"T\xEDtulo"),i(),o(5,"th"),l(6,"Estado"),i(),o(7,"th"),l(8,"Fecha de actividad"),i(),o(9,"th"),l(10,"Duraci\xF3n"),i(),o(11,"th"),l(12,"Resultado"),i()())}function Ut(r,n){if(r&1&&(o(0,"tr")(1,"td",30),p(2,"p-tag",36),i(),o(3,"td")(4,"div",37),l(5),i(),o(6,"div",38),l(7),i()(),o(8,"td"),p(9,"p-tag",39),i(),o(10,"td"),l(11),be(12,"date"),i(),o(13,"td"),l(14),i(),o(15,"td",30),l(16),i()()),r&2){let e=n.$implicit;a(2),s("value",e.type),a(3),_(" ",e.title," "),a(2),_(" ",e.description," "),a(2),s("value",e.status),a(2),_(" ",ye(12,7,e.activity_date,"medium")," "),a(3),_(" ",e.duration_minutes," min "),a(2),_(" ",e.outcome==null?null:e.outcome.replace("_"," ")," ")}}var rt=class r{constructor(n,e,t){this.dialog=n;this.leads_service=e;this.route=t;this.lead_id.set(this.route.snapshot.paramMap.get("id"))}lead_id=y(null);lead=y({});activities=y([]);ngOnInit(){this.getDetail()}openEdit(){this.dialog.open(et,{data:this.lead()}).afterClosed().subscribe(n=>{n&&this.getDetail()})}getDetail(){this.leads_service.getDetail(this.lead_id()).subscribe(n=>{this.lead.set(n)})}createActivity(){this.dialog.open(le,{data:{lead_id:this.lead_id()}}).afterClosed().subscribe(n=>{n&&this.getDetail()})}createAddress(){this.dialog.open(de,{data:{lead_id:this.lead_id()}}).afterClosed().subscribe(n=>{n&&this.getDetail()})}mapsUrl(n){let t=[n.street_address,n.city,n.state,n.postal_code,n.country].filter(Boolean).join(", ");return`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t)}`}static \u0275fac=function(e){return new(e||r)(v(Ze),v(N),v(V))};static \u0275cmp=x({type:r,selectors:[["app-lead-detail"]],decls:67,vars:22,consts:[["noEmail",""],["noWebsite",""],[1,"space-y-10","min-h-screen"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500"],["pButton","","label","Editar lead","icon","pi pi-pencil","size","small",1,"p-button-rounded","p-button-solid","text-sm",3,"click"],[1,"bg-white","shadow-md","rounded-xl","p-6","border","border-gray-100"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"grid","grid-cols-2","gap-y-3","gap-x-10","text-sm","text-gray-800"],[1,"font-semibold","text-gray-500"],["class","link-pro link-pro-break",3,"href",4,"ngIf","ngIfElse"],[3,"phone","countryCode","countryPhoneCode"],[1,"col-span-2"],["target","_blank","rel","noopener noreferrer","class","link-pro link-pro-break",3,"href",4,"ngIf","ngIfElse"],[1,"flex","items-center","gap-2"],["rounded","true",3,"value"],[1,"mt-0.5"],[3,"leadId","leadEmail"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-800"],["pButton","","icon","pi pi-plus","label","Agregar direcci\xF3n",1,"p-button-sm","p-button-outlined"],["responsiveLayout","scroll","styleClass","p-datatable-sm w-full",3,"value"],["pTemplate","header"],["pTemplate","body"],["pButton","","icon","pi pi-plus","label","Agregar actividad",1,"p-button-sm","p-button-outlined",3,"click"],[1,"link-pro","link-pro-break",3,"href"],[1,"pi","pi-envelope","link-pro-icon"],["target","_blank","rel","noopener noreferrer",1,"link-pro","link-pro-break",3,"href"],[1,"pi","pi-external-link","link-pro-icon"],[1,"capitalize"],["target","_blank","rel","noopener noreferrer",1,"link-pro","link-pro-muted",3,"href"],[1,"pi","pi-map-marker","link-pro-icon"],[1,"text-center"],["value","Principal","severity","success","rounded","true",4,"ngIf"],["value","Principal","severity","success","rounded","true"],["severity","info","rounded","true",3,"value"],[1,"font-medium","text-gray-800"],[1,"text-xs","text-gray-500"],["severity","success","rounded","true",3,"value"]],template:function(e,t){if(e&1){let d=S();o(0,"div",2)(1,"div",3)(2,"div")(3,"h2",4),l(4),i(),o(5,"p",5),l(6),i()(),o(7,"button",6),g("click",function(){return h(d),C(t.openEdit())}),i()(),o(8,"div",7)(9,"h3",8),l(10," Informaci\xF3n del Lead "),i(),o(11,"div",9)(12,"div")(13,"span",10),l(14,"Nombre:"),i(),l(15),i(),o(16,"div")(17,"span",10),l(18,"Apellido:"),i(),l(19),i(),o(20,"div")(21,"span",10),l(22,"Email:"),i(),u(23,jt,3,2,"a",11)(24,At,1,0,"ng-template",null,0,ve),i(),o(26,"div")(27,"span",10),l(28,"Tel\xE9fono:"),i(),p(29,"app-phone",12),i(),o(30,"div")(31,"span",10),l(32,"Fuente:"),i(),l(33),i(),o(34,"div",13)(35,"span",10),l(36,"Sitio web:"),i(),u(37,Nt,3,2,"a",14)(38,zt,1,0,"ng-template",null,1,ve),i(),o(40,"div",15)(41,"span",10),l(42,"Estado:"),i(),p(43,"p-tag",16),i(),o(44,"div",13)(45,"span",10),l(46,"Creado el:"),i(),o(47,"div",17),l(48),be(49,"date"),i()()()(),p(50,"app-email-threads-section",18),o(51,"div",7)(52,"div",19)(53,"h3",20),l(54," Direcciones "),i(),p(55,"button",21),i(),o(56,"p-table",22),u(57,Ft,15,0,"ng-template",23)(58,qt,17,8,"ng-template",24),i()(),o(59,"div",7)(60,"div",19)(61,"h3",20),l(62," Actividades "),i(),o(63,"button",25),g("click",function(){return h(d),C(t.createActivity())}),i()(),o(64,"p-table",22),u(65,Wt,13,0,"ng-template",23)(66,Ut,17,10,"ng-template",24),i()()()}if(e&2){let d,c,T,z,Pe,Se,Ee,we,Te,ke,ue,De,Ie,Re,Le,at=Ce(25),lt=Ce(39);a(4),Ne(" ",(d=t.lead())==null?null:d.name," ",(d=t.lead())==null?null:d.lastname," "),a(2),_(" ",(c=t.lead())==null?null:c.email," "),a(9),_(" ",(T=t.lead())==null?null:T.name," "),a(4),_(" ",(z=t.lead())==null?null:z.lastname," "),a(4),s("ngIf",(Pe=t.lead())==null?null:Pe.email)("ngIfElse",at),a(6),s("phone",(Se=t.lead())==null?null:Se.phone)("countryCode",(Ee=t.lead())==null?null:Ee.phone_country)("countryPhoneCode",(we=t.lead())==null?null:we.phone_code),a(4),_(" ",(Te=t.lead())==null?null:Te.source," "),a(4),s("ngIf",(ke=t.lead())==null?null:ke.website)("ngIfElse",lt),a(6),s("value",(ue=t.lead())==null||ue.status==null?null:ue.status.name),a(5),_(" ",ye(49,19,(De=t.lead())==null?null:De.created_at,"medium")," "),a(2),s("leadId",t.lead_id())("leadEmail",(Ie=t.lead())==null?null:Ie.email),a(6),s("value",(Re=t.lead())==null?null:Re.addresses),a(8),s("value",(Le=t.lead())==null?null:Le.activities)}},dependencies:[O,E,Je,Ye,qe,Qe,Ke,Xe,He,_e,tt,ze],encapsulation:2})};export{rt as LeadDetail};
