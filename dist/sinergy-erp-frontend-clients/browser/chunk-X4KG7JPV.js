import{b as et,c as tt}from"./chunk-6RVAJVAQ.js";import{a as $e,b as Ue,e as Ge,f as Xe,g as He,h as Qe,i as Ye}from"./chunk-3EZ4E46M.js";import"./chunk-HO6VT44Y.js";import"./chunk-ESGHQXLB.js";import{ga as Me}from"./chunk-CKDP52D7.js";import{F as Ke,H as qe,I as Je,J as Q,K as Ze,S as K,s as H}from"./chunk-RBHIJQFK.js";import{b as je,e as Be,h as Ne,m as Re,n as Le,o as Ve,r as We,v as X}from"./chunk-7TNFDLAZ.js";import{A as ze,e as Ee,h as we,i as Ie,j as ke,l as Te,q as Fe,u as Pe,v as Ae,x as Oe,y as U,z as G}from"./chunk-5MRBIJ7N.js";import{A as De,c as he,d as V,e as W,g as xe,i as Ce,j as $,l as ye,m as I,t as be,y as Se}from"./chunk-UZLFZEBK.js";import{$b as pe,Ab as D,Ac as M,Cc as _e,Db as de,Eb as se,Fb as m,Gb as i,Hb as t,Ib as u,N as Z,Ob as O,Pb as E,Qa as P,Qc as L,S as re,T as F,Ta as o,Tb as _,V as ne,Vb as l,W as ae,X as Y,Zb as me,_b as le,aa as y,ab as f,ba as b,ca as ee,cc as ue,d as ie,da as oe,dc as z,ec as te,gb as x,gc as j,hb as A,hc as a,ic as p,jc as g,kc as ge,mb as v,mc as B,na as h,nc as N,oc as R,tc as fe,vb as w,wa as ce,yb as S,yc as C,zc as ve}from"./chunk-NOG5ANO3.js";import"./chunk-7CGTOI24.js";var it=(()=>{class r{static \u0275fac=function(c){return new(c||r)};static \u0275mod=A({type:r});static \u0275inj=F({imports:[H]})}return r})();var lt=["determinateSpinner"];function pt(r,n){if(r&1&&(ee(),i(0,"svg",11),u(1,"circle",12),t()),r&2){let e=l();w("viewBox",e._viewBox()),o(),z("stroke-dasharray",e._strokeCircumference(),"px")("stroke-dashoffset",e._strokeCircumference()/2,"px")("stroke-width",e._circleStrokeWidth(),"%"),w("r",e._circleRadius())}}var ut=new ne("mat-progress-spinner-default-options",{providedIn:"root",factory:()=>({diameter:rt})}),rt=100,gt=10,nt=(()=>{class r{_elementRef=Y(ce);_noopAnimations;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;_defaultColor="primary";_determinateCircle;constructor(){let e=Y(ut),c=Ke(),s=this._elementRef.nativeElement;this._noopAnimations=c==="di-disabled"&&!!e&&!e._forceAnimations,this.mode=s.nodeName.toLowerCase()==="mat-spinner"?"indeterminate":"determinate",!this._noopAnimations&&c==="reduced-motion"&&s.classList.add("mat-progress-spinner-reduced-motion"),e&&(e.color&&(this.color=this._defaultColor=e.color),e.diameter&&(this.diameter=e.diameter),e.strokeWidth&&(this.strokeWidth=e.strokeWidth))}mode;get value(){return this.mode==="determinate"?this._value:0}set value(e){this._value=Math.max(0,Math.min(100,e||0))}_value=0;get diameter(){return this._diameter}set diameter(e){this._diameter=e||0}_diameter=rt;get strokeWidth(){return this._strokeWidth??this.diameter/10}set strokeWidth(e){this._strokeWidth=e||0}_strokeWidth;_circleRadius(){return(this.diameter-gt)/2}_viewBox(){let e=this._circleRadius()*2+this.strokeWidth;return`0 0 ${e} ${e}`}_strokeCircumference(){return 2*Math.PI*this._circleRadius()}_strokeDashOffset(){return this.mode==="determinate"?this._strokeCircumference()*(100-this._value)/100:null}_circleStrokeWidth(){return this.strokeWidth/this.diameter*100}static \u0275fac=function(c){return new(c||r)};static \u0275cmp=x({type:r,selectors:[["mat-progress-spinner"],["mat-spinner"]],viewQuery:function(c,s){if(c&1&&me(lt,5),c&2){let d;le(d=pe())&&(s._determinateCircle=d.first)}},hostAttrs:["role","progressbar","tabindex","-1",1,"mat-mdc-progress-spinner","mdc-circular-progress"],hostVars:18,hostBindings:function(c,s){c&2&&(w("aria-valuemin",0)("aria-valuemax",100)("aria-valuenow",s.mode==="determinate"?s.value:null)("mode",s.mode),j("mat-"+s.color),z("width",s.diameter,"px")("height",s.diameter,"px")("--mat-progress-spinner-size",s.diameter+"px")("--mat-progress-spinner-active-indicator-width",s.diameter+"px"),te("_mat-animation-noopable",s._noopAnimations)("mdc-circular-progress--indeterminate",s.mode==="indeterminate"))},inputs:{color:"color",mode:"mode",value:[2,"value","value",L],diameter:[2,"diameter","diameter",L],strokeWidth:[2,"strokeWidth","strokeWidth",L]},exportAs:["matProgressSpinner"],decls:14,vars:11,consts:[["circle",""],["determinateSpinner",""],["aria-hidden","true",1,"mdc-circular-progress__determinate-container"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__determinate-circle-graphic"],["cx","50%","cy","50%",1,"mdc-circular-progress__determinate-circle"],["aria-hidden","true",1,"mdc-circular-progress__indeterminate-container"],[1,"mdc-circular-progress__spinner-layer"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-left"],[3,"ngTemplateOutlet"],[1,"mdc-circular-progress__gap-patch"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-right"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__indeterminate-circle-graphic"],["cx","50%","cy","50%"]],template:function(c,s){if(c&1&&(v(0,pt,2,8,"ng-template",null,0,_e),i(2,"div",2,1),ee(),i(4,"svg",3),u(5,"circle",4),t()(),oe(),i(6,"div",5)(7,"div",6)(8,"div",7),O(9,8),t(),i(10,"div",9),O(11,8),t(),i(12,"div",10),O(13,8),t()()()),c&2){let d=ue(1);o(4),w("viewBox",s._viewBox()),o(),z("stroke-dasharray",s._strokeCircumference(),"px")("stroke-dashoffset",s._strokeDashOffset(),"px")("stroke-width",s._circleStrokeWidth(),"%"),w("r",s._circleRadius()),o(4),m("ngTemplateOutlet",d),o(2),m("ngTemplateOutlet",d),o(2),m("ngTemplateOutlet",d)}},dependencies:[xe],styles:[`.mat-mdc-progress-spinner{--mat-progress-spinner-animation-multiplier: 1;display:block;overflow:hidden;line-height:0;position:relative;direction:ltr;transition:opacity 250ms cubic-bezier(0.4, 0, 0.6, 1)}.mat-mdc-progress-spinner circle{stroke-width:var(--mat-progress-spinner-active-indicator-width, 4px)}.mat-mdc-progress-spinner._mat-animation-noopable,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__determinate-circle{transition:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__spinner-layer,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container{animation:none !important}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container circle{stroke-dasharray:0 !important}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle{stroke:currentColor;stroke:CanvasText}}.mat-progress-spinner-reduced-motion{--mat-progress-spinner-animation-multiplier: 1.25}.mdc-circular-progress__determinate-container,.mdc-circular-progress__indeterminate-circle-graphic,.mdc-circular-progress__indeterminate-container,.mdc-circular-progress__spinner-layer{position:absolute;width:100%;height:100%}.mdc-circular-progress__determinate-container{transform:rotate(-90deg)}.mdc-circular-progress--indeterminate .mdc-circular-progress__determinate-container{opacity:0}.mdc-circular-progress__indeterminate-container{font-size:0;letter-spacing:0;white-space:nowrap;opacity:0}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{opacity:1;animation:mdc-circular-progress-container-rotate calc(1568.2352941176ms*var(--mat-progress-spinner-animation-multiplier)) linear infinite}.mdc-circular-progress__determinate-circle-graphic,.mdc-circular-progress__indeterminate-circle-graphic{fill:rgba(0,0,0,0)}.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:var(--mat-progress-spinner-active-indicator-color, var(--mat-sys-primary))}@media(forced-colors: active){.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}.mdc-circular-progress__determinate-circle{transition:stroke-dashoffset 500ms cubic-bezier(0, 0, 0.2, 1)}.mdc-circular-progress__gap-patch{position:absolute;top:0;left:47.5%;box-sizing:border-box;width:5%;height:100%;overflow:hidden}.mdc-circular-progress__gap-patch .mdc-circular-progress__indeterminate-circle-graphic{left:-900%;width:2000%;transform:rotate(180deg)}.mdc-circular-progress__circle-clipper .mdc-circular-progress__indeterminate-circle-graphic{width:200%}.mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{left:-100%}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-left .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-left-spin calc(1333ms*var(--mat-progress-spinner-animation-multiplier)) cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-right-spin calc(1333ms*var(--mat-progress-spinner-animation-multiplier)) cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress__circle-clipper{display:inline-flex;position:relative;width:50%;height:100%;overflow:hidden}.mdc-circular-progress--indeterminate .mdc-circular-progress__spinner-layer{animation:mdc-circular-progress-spinner-layer-rotate calc(5332ms*var(--mat-progress-spinner-animation-multiplier)) cubic-bezier(0.4, 0, 0.2, 1) infinite both}@keyframes mdc-circular-progress-container-rotate{to{transform:rotate(360deg)}}@keyframes mdc-circular-progress-spinner-layer-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes mdc-circular-progress-left-spin{from{transform:rotate(265deg)}50%{transform:rotate(130deg)}to{transform:rotate(265deg)}}@keyframes mdc-circular-progress-right-spin{from{transform:rotate(-265deg)}50%{transform:rotate(-130deg)}to{transform:rotate(-265deg)}}
`],encapsulation:2,changeDetection:0})}return r})();var at=(()=>{class r{static \u0275fac=function(c){return new(c||r)};static \u0275mod=A({type:r});static \u0275inj=F({imports:[H]})}return r})();var k=class r{constructor(n){this.http=n}api=ze.api;getDocumentTypes(){return this.http.get(`${this.api}/tenant/document-types`)}getCustomerDocuments(n){return this.http.get(`${this.api}/tenant/customers/${n}/documents`)}uploadDocument(n,e){return this.http.post(`${this.api}/tenant/customers/${n}/documents`,e)}updateDocumentStatus(n,e,c){return this.http.patch(`${this.api}/tenant/customers/${n}/documents/${e}/status`,c)}deleteDocument(n,e){return this.http.delete(`${this.api}/tenant/customers/${n}/documents/${e}`)}static \u0275fac=function(e){return new(e||r)(ae(be))};static \u0275prov=re({token:r,factory:r.\u0275fac,providedIn:"root"})};function ht(r,n){if(r&1&&(i(0,"option",22),a(1),t()),r&2){let e=n.$implicit;m("value",e.id),o(),g(" ",e.name," ")}}function xt(r,n){if(r&1&&(i(0,"p",23),a(1),t()),r&2){let e=l();o(),ge(" \u2713 ",e.selectedFile.name," (",e.formatFileSize(e.selectedFile.size),") ")}}var q=class r{constructor(n,e,c,s){this.data=n;this.dialogRef=e;this.documentService=c;this.interceptorService=s;this.loadDocumentTypes()}documentTypes=h([]);uploading=h(!1);selectedFile=null;selectedTypeId="";expirationDate="";notes="";Upload=Ae;X=Oe;loadDocumentTypes(){this.documentService.getDocumentTypes().subscribe({next:n=>{this.documentTypes.set(n)},error:()=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar los tipos de documento"})}})}onFileSelected(n){let e=n.target.files[0];if(e){if(e.size>10*1024*1024){this.interceptorService.openSnackbar({type:"error",title:"Error",message:"El archivo es muy grande (m\xE1ximo 10MB)"});return}this.selectedFile=e}}uploadDocument(){if(!this.selectedFile||!this.selectedTypeId){this.interceptorService.openSnackbar({type:"warning",title:"Advertencia",message:"Selecciona un archivo y tipo de documento"});return}this.uploading.set(!0);let n=new FormData;n.append("file",this.selectedFile),n.append("document_type_id",this.selectedTypeId),this.expirationDate&&n.append("expiration_date",this.expirationDate),this.notes&&n.append("notes",this.notes),this.documentService.uploadDocument(this.data.customerId,n).subscribe({next:()=>{this.uploading.set(!1),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Documento subido correctamente"}),this.dialogRef.close(!0)},error:e=>{this.uploading.set(!1);let c="Error al subir documento";e.status===413?c="Archivo muy grande (m\xE1ximo 10MB)":e.status===415&&(c="Tipo de archivo no permitido"),this.interceptorService.openSnackbar({type:"error",title:"Error",message:c})}})}close(){this.dialogRef.close()}formatFileSize(n){return n<1024?n+" B":n<1024*1024?(n/1024).toFixed(1)+" KB":(n/(1024*1024)).toFixed(1)+" MB"}static \u0275fac=function(e){return new(e||r)(f(Je),f(qe),f(k),f(K))};static \u0275cmp=x({type:r,selectors:[["app-document-upload-modal"]],decls:35,vars:10,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-title"],[1,"close-button",3,"click"],[3,"img","size"],[1,"dialog-content"],[1,"form-grid"],[1,"form-field"],[1,"field-label"],[1,"field-input",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"file-input-wrapper"],["type","file","accept",".jpg,.jpeg,.png,.pdf,.doc,.docx","id","fileInput",1,"field-input","file-input",3,"change"],["class","file-info",4,"ngIf"],["type","date",1,"field-input",3,"ngModelChange","ngModel"],[1,"form-field","full-width"],["placeholder","Notas adicionales...","rows","3",1,"field-input",3,"ngModelChange","ngModel"],[1,"help-text"],[1,"dialog-footer"],["text","Cancelar","custom_class","btn_secondary",3,"clicked"],["text","Subir Documento","custom_class","btn_primary",3,"clicked","loading","disabled","icon"],[3,"value"],[1,"file-info"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Subir Documento"),t(),i(4,"button",3),_("click",function(){return c.close()}),u(5,"lucide-icon",4),t()(),i(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),a(10,"Tipo de Documento"),t(),i(11,"select",9),R("ngModelChange",function(d){return N(c.selectedTypeId,d)||(c.selectedTypeId=d),d}),i(12,"option",10),a(13,"Selecciona un tipo de documento"),t(),v(14,ht,2,2,"option",11),t()(),i(15,"div",7)(16,"label",8),a(17,"Archivo"),t(),i(18,"div",12)(19,"input",13),_("change",function(d){return c.onFileSelected(d)}),t()(),v(20,xt,2,2,"p",14),t(),i(21,"div",7)(22,"label",8),a(23,"Fecha de Expiraci\xF3n (Opcional)"),t(),i(24,"input",15),R("ngModelChange",function(d){return N(c.expirationDate,d)||(c.expirationDate=d),d}),t()(),i(25,"div",16)(26,"label",8),a(27,"Notas (Opcional)"),t(),i(28,"textarea",17),R("ngModelChange",function(d){return N(c.notes,d)||(c.notes=d),d}),a(29,"        "),t()()(),i(30,"p",18),a(31," Formatos permitidos: JPG, PNG, PDF, DOC, DOCX (m\xE1x. 10MB) "),t()(),i(32,"div",19)(33,"app-button",20),_("clicked",function(){return c.close()}),t(),i(34,"app-button",21),_("clicked",function(){return c.uploadDocument()}),t()()()),e&2&&(o(5),m("img",c.X)("size",20),o(6),B("ngModel",c.selectedTypeId),o(3),m("ngForOf",c.documentTypes()),o(6),m("ngIf",c.selectedFile),o(4),B("ngModel",c.expirationDate),o(4),B("ngModel",c.notes),o(6),m("loading",c.uploading())("disabled",!c.selectedFile||!c.selectedTypeId)("icon",c.Upload))},dependencies:[I,V,W,We,Le,Ve,je,Re,Be,Ne,Ze,X,G,U],styles:[`.dialog[_ngcontent-%COMP%]{width:100dvw;max-width:600px}.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;max-height:90vh}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem;border-bottom:1px solid #e5e7eb}.dialog-title[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#111827;margin:0}.close-button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:#6b7280;padding:.5rem;border-radius:.375rem;transition:all .2s}.close-button[_ngcontent-%COMP%]:hover{background-color:#f3f4f6;color:#111827}.dialog-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-field.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.field-label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;color:#374151}.field-input[_ngcontent-%COMP%]{width:100%;padding:.625rem .75rem;border:1px solid #d1d5db;border-radius:.5rem;font-size:.875rem;transition:all .2s;background-color:#fff;cursor:pointer}.field-input[_ngcontent-%COMP%]:hover{border-color:#9ca3af;background-color:#f9fafb}.field-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px #6366f11a;background-color:#fff}.field-input[_ngcontent-%COMP%]:disabled{background-color:#f9fafb;cursor:not-allowed;opacity:.6}select.field-input[_ngcontent-%COMP%]{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .75rem center;padding-right:2.5rem}select.field-input[_ngcontent-%COMP%]:hover{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23374151' d='M6 9L1 4h10z'/%3E%3C/svg%3E")}input[type=file].field-input[_ngcontent-%COMP%]{padding:.5rem .75rem;cursor:pointer}input[type=file].field-input[_ngcontent-%COMP%]::file-selector-button{padding:.375rem .75rem;margin-right:.75rem;background-color:#6366f1;color:#fff;border:none;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s}input[type=file].field-input[_ngcontent-%COMP%]::file-selector-button:hover{background-color:#4f46e5}textarea.field-input[_ngcontent-%COMP%]{resize:vertical;font-family:inherit}.file-info[_ngcontent-%COMP%]{font-size:.75rem;color:#059669;margin-top:.5rem;font-weight:500}.file-input-wrapper[_ngcontent-%COMP%]{position:relative}.help-text[_ngcontent-%COMP%]{font-size:.75rem;color:#6b7280;margin-top:1rem;margin-bottom:0}.dialog-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.75rem;padding:1.5rem;border-top:1px solid #e5e7eb}`]})};function Ct(r,n){r&1&&(i(0,"div",7)(1,"p",8),a(2,"Cargando documentos..."),t()())}function yt(r,n){r&1&&(i(0,"div",9)(1,"p",10),a(2,"No hay documentos subidos"),t()())}function bt(r,n){if(r&1&&(i(0,"span")(1,"span"),a(2,"\u2022"),t(),i(3,"span",27),a(4),C(5,"date"),t()()),r&2){let e=l().$implicit;o(4),g("Vence: ",M(5,1,e.expiration_date,"mediumDate"))}}function St(r,n){if(r&1&&(i(0,"p",28),a(1),t()),r&2){let e=l().$implicit;o(),p(e.notes)}}function Dt(r,n){if(r&1){let e=E();i(0,"div",29)(1,"button",30),_("click",function(){y(e);let s=l().$implicit,d=l(2);return b(d.updateStatus(s,"approved"))}),u(2,"lucide-icon",26),t(),i(3,"button",31),_("click",function(){y(e);let s=l().$implicit,d=l(2);return b(d.updateStatus(s,"rejected"))}),u(4,"lucide-icon",26),t()()}if(r&2){let e=l(3);o(2),m("img",e.FileCheck)("size",18),o(2),m("img",e.FileX)("size",18)}}function Mt(r,n){if(r&1&&(i(0,"a",32),u(1,"lucide-icon",26),t()),r&2){let e=l().$implicit,c=l(2);m("href",e.download_url,P),o(),m("img",c.Download)("size",18)}}function Et(r,n){if(r&1){let e=E();i(0,"div",13)(1,"div",14),u(2,"lucide-icon",15),i(3,"div",16)(4,"div",17)(5,"span",18),a(6),t(),i(7,"span"),a(8),t()(),i(9,"div",19)(10,"span"),a(11),t(),i(12,"span"),a(13,"\u2022"),t(),i(14,"span"),a(15),t(),i(16,"span"),a(17,"\u2022"),t(),i(18,"span"),a(19),C(20,"date"),t(),v(21,bt,6,4,"span",20),t(),v(22,St,2,1,"p",21),t()(),i(23,"div",22),v(24,Dt,5,4,"div",23)(25,Mt,2,3,"a",24),i(26,"button",25),_("click",function(){let s=y(e).$implicit,d=l(2);return b(d.deleteDocument(s))}),u(27,"lucide-icon",26),t()()()}if(r&2){let e=n.$implicit,c=l(2);o(2),m("img",c.getFileIcon(e.mime_type))("size",24),o(4),p(e.file_name),o(),j(c.getStatusClass(e.status)),o(),g(" ",c.getStatusLabel(e.status)," "),o(3),p(e.document_type.name),o(4),p(c.formatFileSize(e.file_size)),o(4),p(M(20,15,e.created_at,"mediumDate")),o(2),m("ngIf",e.expiration_date),o(),m("ngIf",e.notes),o(2),m("ngIf",e.status==="pending"),o(),m("ngIf",e.download_url),o(2),m("img",c.Trash2)("size",18)}}function wt(r,n){if(r&1&&(i(0,"div",11),v(1,Et,28,18,"div",12),t()),r&2){let e=l();o(),m("ngForOf",e.documents())}}var J=class r{constructor(n,e,c){this.documentService=n;this.interceptorService=e;this.dialog=c}customerId;documents=h([]);loading=h(!1);Plus=Fe;Download=Ee;Trash2=Pe;FileText=Ie;Image=Te;FileCheck=we;FileX=ke;ngOnInit(){this.loadDocuments()}loadDocuments(){this.loading.set(!0),this.documentService.getCustomerDocuments(this.customerId).subscribe({next:n=>{this.documents.set(n),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudieron cargar los documentos"})}})}openUploadModal(){this.dialog.open(q,{data:{customerId:this.customerId}}).afterClosed().subscribe(e=>{e&&this.loadDocuments()})}deleteDocument(n){confirm(`\xBFEliminar documento "${n.file_name}"?`)&&this.documentService.deleteDocument(this.customerId,n.id).subscribe({next:()=>{this.loadDocuments(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Documento eliminado"})},error:()=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudo eliminar el documento"})}})}updateStatus(n,e){this.documentService.updateDocumentStatus(this.customerId,n.id,{status:e}).subscribe({next:()=>{this.loadDocuments(),this.interceptorService.openSnackbar({type:"success",title:"\xC9xito",message:"Estado actualizado"})},error:()=>{this.interceptorService.openSnackbar({type:"error",title:"Error",message:"No se pudo actualizar el estado"})}})}getStatusClass(n){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[n]}`}getStatusLabel(n){return{pending:"Pendiente",approved:"Aprobado",rejected:"Rechazado"}[n]}getFileIcon(n){return n.startsWith("image/")?this.Image:n.includes("pdf")?this.FileText:this.FileText}formatFileSize(n){return n<1024?n+" B":n<1024*1024?(n/1024).toFixed(1)+" KB":(n/(1024*1024)).toFixed(1)+" MB"}static \u0275fac=function(e){return new(e||r)(f(k),f(K),f(Q))};static \u0275cmp=x({type:r,selectors:[["app-customer-documents"]],inputs:{customerId:"customerId"},decls:8,vars:4,consts:[[1,"bg-white","shadow-md","rounded-xl","p-6","border","border-gray-100","mb-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-800"],["text","Subir Documento","custom_class","btn_primary",3,"clicked","icon"],["class","text-center py-8",4,"ngIf"],["class","text-center py-8 text-gray-500",4,"ngIf"],["class","space-y-3",4,"ngIf"],[1,"text-center","py-8"],[1,"text-gray-500"],[1,"text-center","py-8","text-gray-500"],[1,"text-sm"],[1,"space-y-3"],["class","flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-4","border","border-gray-200","rounded-lg","hover:bg-gray-50","transition-colors"],[1,"flex","items-center","gap-3","flex-1"],[1,"text-gray-400",3,"img","size"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","mb-1"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"flex","items-center","gap-3","text-xs","text-gray-500"],[4,"ngIf"],["class","text-xs text-gray-600 mt-1",4,"ngIf"],[1,"flex","items-center","gap-2"],["class","flex gap-1",4,"ngIf"],["target","_blank","class","p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors","title","Descargar",3,"href",4,"ngIf"],["title","Eliminar",1,"p-2","text-red-600","hover:bg-red-50","rounded-lg","transition-colors",3,"click"],[3,"img","size"],[1,"text-orange-600"],[1,"text-xs","text-gray-600","mt-1"],[1,"flex","gap-1"],["title","Aprobar",1,"p-2","text-green-600","hover:bg-green-50","rounded-lg","transition-colors",3,"click"],["title","Rechazar",1,"p-2","text-red-600","hover:bg-red-50","rounded-lg","transition-colors",3,"click"],["target","_blank","title","Descargar",1,"p-2","text-indigo-600","hover:bg-indigo-50","rounded-lg","transition-colors",3,"href"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"h3",2),a(3,"Documentos"),t(),i(4,"app-button",3),_("clicked",function(){return c.openUploadModal()}),t()(),v(5,Ct,3,0,"div",4)(6,yt,3,0,"div",5)(7,wt,2,1,"div",6),t()),e&2&&(o(4),m("icon",c.Plus),o(),m("ngIf",c.loading()),o(),m("ngIf",!c.loading()&&c.documents().length===0),o(),m("ngIf",!c.loading()&&c.documents().length>0))},dependencies:[I,V,W,X,G,U,$],encapsulation:2})};var It=(r,n,e)=>({"bg-green-100 text-green-800":r,"bg-gray-100 text-gray-800":n,"bg-red-100 text-red-800":e}),kt=(r,n)=>n.id;function Tt(r,n){r&1&&(i(0,"div",1),u(1,"mat-spinner",3),i(2,"p",4),a(3,"Cargando detalles del cliente..."),t()())}function Ft(r,n){if(r&1){let e=E();i(0,"div",2)(1,"p",5),a(2),t(),i(3,"button",6),_("click",function(){y(e);let s=l();return b(s.loadCustomer())}),t()()}if(r&2){let e=l();o(2),p(e.error().message)}}function Pt(r,n){if(r&1&&(i(0,"a",16),a(1),t()),r&2){let e=l(2);m("href","mailto:"+e.customer().email,P),o(),g(" ",e.customer().email," ")}}function At(r,n){r&1&&(i(0,"span",15),a(1,"\u2014"),t())}function Ot(r,n){if(r&1){let e=E();i(0,"tr",33),_("click",function(){let s=y(e).$implicit,d=l(3);return b(d.navigateToProperty(s.property.id))}),i(1,"td",34)(2,"span",35),a(3),t()(),i(4,"td",36),a(5),t(),i(6,"td",37),a(7),t(),i(8,"td",36),a(9),C(10,"currency"),t(),i(11,"td",34)(12,"span",38),a(13),t()(),i(14,"td",34)(15,"span",39),a(16),C(17,"titlecase"),t()()()}if(r&2){let e=n.$implicit;o(3),g(" ",e.property.code," "),o(2),p(e.property.name),o(2),g("",e.property.total_area," m\xB2"),o(2),p(M(10,7,e.total_price,e.currency)),o(4),g(" ",e.contract_number," "),o(2),m("ngClass",fe(12,It,e.status==="activo",e.status==="completado",e.status==="cancelado")),o(),g(" ",ve(17,10,e.status)," ")}}function zt(r,n){if(r&1&&(i(0,"div",22)(1,"table",28)(2,"thead",29)(3,"tr")(4,"th",30),a(5,"C\xF3digo"),t(),i(6,"th",30),a(7,"Nombre"),t(),i(8,"th",30),a(9,"\xC1rea"),t(),i(10,"th",30),a(11,"Precio"),t(),i(12,"th",30),a(13,"Contrato"),t(),i(14,"th",30),a(15,"Estado"),t()()(),i(16,"tbody",31),de(17,Ot,18,16,"tr",32,kt),t()()()),r&2){let e=l(2);o(17),se(e.customer().contracts)}}function jt(r,n){r&1&&(i(0,"div",23)(1,"p",40),a(2,"No hay contratos asociados"),t()())}function Bt(r,n){r&1&&(i(0,"tr")(1,"th"),a(2,"Tipo"),t(),i(3,"th"),a(4,"Direcci\xF3n"),t(),i(5,"th"),a(6,"Ciudad"),t(),i(7,"th"),a(8,"Estado"),t(),i(9,"th"),a(10,"C\xF3digo postal"),t(),i(11,"th"),a(12,"Pa\xEDs"),t()())}function Nt(r,n){if(r&1&&(i(0,"tr")(1,"td",43),a(2),t(),i(3,"td"),a(4),t(),i(5,"td"),a(6),t(),i(7,"td"),a(8),t(),i(9,"td"),a(10),t(),i(11,"td"),a(12),t()()),r&2){let e=n.$implicit;o(2),p(e.type),o(2),p(e.street_address),o(2),p(e.city),o(2),p(e.state),o(2),p(e.postal_code),o(2),p(e.country)}}function Rt(r,n){if(r&1&&(i(0,"p-table",26),v(1,Bt,13,0,"ng-template",41)(2,Nt,13,6,"ng-template",42),t()),r&2){let e=l(2);m("value",e.customer().addresses)}}function Lt(r,n){r&1&&(i(0,"div",23)(1,"p",40),a(2,"No hay direcciones agregadas"),t()())}function Vt(r,n){r&1&&(i(0,"tr")(1,"th"),a(2,"Tipo"),t(),i(3,"th"),a(4,"T\xEDtulo"),t(),i(5,"th"),a(6,"Estado"),t(),i(7,"th"),a(8,"Fecha de actividad"),t(),i(9,"th"),a(10,"Duraci\xF3n"),t()())}function Wt(r,n){if(r&1&&(i(0,"tr")(1,"td",43),u(2,"p-tag",44),t(),i(3,"td")(4,"div",45),a(5),t(),i(6,"div",46),a(7),t()(),i(8,"td"),u(9,"p-tag",47),t(),i(10,"td"),a(11),C(12,"date"),t(),i(13,"td"),a(14),t()()),r&2){let e=n.$implicit;o(2),m("value",e.type),o(3),g(" ",e.title," "),o(2),g(" ",e.description," "),o(2),m("value",e.status),o(2),g(" ",M(12,6,e.activity_date,"medium")," "),o(3),g(" ",e.duration_minutes," min ")}}function $t(r,n){if(r&1&&(i(0,"p-table",26),v(1,Vt,11,0,"ng-template",41)(2,Wt,15,9,"ng-template",42),t()),r&2){let e=l(2);m("value",e.customer().activities)}}function Ut(r,n){r&1&&(i(0,"div",23)(1,"p",40),a(2,"No hay actividades agregadas"),t()())}function Gt(r,n){if(r&1){let e=E();i(0,"div",7)(1,"div")(2,"h2",8),a(3),t(),i(4,"p",9),a(5),t()(),i(6,"button",10),_("click",function(){y(e);let s=l();return b(s.editCustomer())}),t()(),i(7,"div",11)(8,"h3",12),a(9," Informaci\xF3n del Cliente "),t(),i(10,"div",13)(11,"div")(12,"span",14),a(13,"Nombre"),t(),i(14,"span",15),a(15),t()(),i(16,"div")(17,"span",14),a(18,"Apellido"),t(),i(19,"span",15),a(20),t()(),i(21,"div")(22,"span",14),a(23,"Email"),t(),S(24,Pt,2,2,"a",16)(25,At,2,0,"span",15),t(),i(26,"div")(27,"span",14),a(28,"Tel\xE9fono"),t(),u(29,"app-phone",17),t(),i(30,"div")(31,"span",14),a(32,"Empresa"),t(),i(33,"span",15),a(34),t()(),i(35,"div")(36,"span",14),a(37,"Grupo"),t(),i(38,"span",15),a(39),t()(),i(40,"div")(41,"span",14),a(42,"Estado"),t(),i(43,"div"),u(44,"p-tag",18),t()(),i(45,"div")(46,"span",14),a(47,"Creado"),t(),i(48,"span",15),a(49),C(50,"date"),t()(),i(51,"div",19)(52,"span",14),a(53,"Actualizado"),t(),i(54,"span",15),a(55),C(56,"date"),t()()()(),i(57,"div",11)(58,"div",20)(59,"h3",21),a(60," Propiedades y Contratos "),t()(),S(61,zt,19,0,"div",22)(62,jt,3,0,"div",23),t(),u(63,"app-customer-documents",24),i(64,"div",11)(65,"div",20)(66,"h3",21),a(67," Direcciones "),t(),u(68,"button",25),t(),S(69,Rt,3,1,"p-table",26)(70,Lt,3,0,"div",23),t(),i(71,"div",11)(72,"div",20)(73,"h3",21),a(74," Actividades "),t(),u(75,"button",27),t(),S(76,$t,3,1,"p-table",26)(77,Ut,3,0,"div",23),t()}if(r&2){let e,c,s,d=l();o(3),p(d.customer().name),o(2),p(d.customer().email),o(10),p(d.customer().name),o(5),p(d.customer().lastname||"\u2014"),o(4),D(d.customer().email?24:25),o(5),m("phone",d.customer().phone)("countryCode",d.customer().phone_country)("countryPhoneCode",d.customer().phone_code),o(5),p(d.customer().company_name||"\u2014"),o(5),p(((e=d.customer().group)==null?null:e.name)||"\u2014"),o(5),m("value",((c=d.customer().status)==null?null:c.name)||d.customer().status_id||"Desconocido")("severity",d.getSeverity(((s=d.customer().status)==null?null:s.name)||d.customer().status_id||"")),o(5),p(M(50,18,d.customer().created_at,"medium")),o(6),p(M(56,21,d.customer().updated_at,"medium")),o(6),D(d.customer().contracts&&d.customer().contracts.length>0?61:62),o(2),m("customerId",d.customer().id),o(6),D(d.customer().addresses&&d.customer().addresses.length>0?69:70),o(7),D(d.customer().activities&&d.customer().activities.length>0?76:77)}}var mt=class r{constructor(n,e,c,s){this.route=n;this.router=e;this.customerService=c;this.dialog=s}customer=h(null);isLoading=h(!0);error=h(null);customerId=null;destroy$=new ie;ngOnInit(){this.route.params.pipe(Z(this.destroy$)).subscribe(n=>{this.customerId=Number(n.id),this.customerId&&this.loadCustomer()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadCustomer(){this.customerId&&(this.isLoading.set(!0),this.error.set(null),this.customerService.getCustomer(String(this.customerId)).pipe(Z(this.destroy$)).subscribe({next:n=>{this.customer.set(n),this.isLoading.set(!1)},error:n=>{this.error.set(n),this.isLoading.set(!1)}}))}editCustomer(){if(!this.customer())return;this.dialog.open(tt,{width:"500px",data:{customer:this.customer()}}).afterClosed().subscribe(e=>{e&&this.loadCustomer()})}goBack(){this.router.navigate(["/customers"])}navigateToProperty(n){this.router.navigate(["/properties/detail",n])}getSeverity(n){return{Validado:"success","Al corriente":"success",Pagado:"success",Pendiente:"warn",Atrasado:"danger",active:"success",inactive:"danger"}[n]??"secondary"}static \u0275fac=function(e){return new(e||r)(f(Se),f(De),f(et),f(Q))};static \u0275cmp=x({type:r,selectors:[["app-customer-detail"]],decls:4,vars:3,consts:[[1,"space-y-10","min-h-screen"],[1,"flex","items-center","justify-center","py-12"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4"],["diameter","40"],[1,"ml-4"],[1,"text-red-800"],["pButton","","label","Reintentar",1,"p-button-sm","mt-2",3,"click"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500"],["pButton","","label","Editar cliente","icon","pi pi-pencil","size","small",1,"p-button-rounded","p-button-solid","text-sm",3,"click"],[1,"bg-white","shadow-md","rounded-xl","p-6","border","border-gray-100"],[1,"text-lg","font-semibold","text-gray-800","mb-4"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"block","text-xs","font-semibold","text-gray-500","mb-1"],[1,"text-gray-900"],[1,"text-indigo-600","hover:text-indigo-800","break-all",3,"href"],[3,"phone","countryCode","countryPhoneCode"],["rounded","true",3,"value","severity"],[1,"col-span-2"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-800"],[1,"overflow-x-auto"],[1,"text-center","py-8","text-gray-500"],[3,"customerId"],["pButton","","icon","pi pi-plus","label","Agregar direcci\xF3n",1,"p-button-sm","p-button-outlined"],["responsiveLayout","scroll","styleClass","p-datatable-sm w-full",3,"value"],["pButton","","icon","pi pi-plus","label","Agregar actividad",1,"p-button-sm","p-button-outlined"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50","cursor-pointer"],[1,"hover:bg-gray-50","cursor-pointer",3,"click"],[1,"px-4","py-3","whitespace-nowrap"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-green-100","text-green-800"],[1,"px-4","py-3","text-sm","text-gray-900"],[1,"px-4","py-3","text-sm","text-gray-600"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-purple-100","text-purple-800"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"text-sm"],["pTemplate","header"],["pTemplate","body"],[1,"capitalize"],["severity","info","rounded","true",3,"value"],[1,"font-medium","text-gray-800"],[1,"text-xs","text-gray-500"],["severity","success","rounded","true",3,"value"]],template:function(e,c){e&1&&(i(0,"div",0),S(1,Tt,4,0,"div",1),S(2,Ft,4,1,"div",2),S(3,Gt,78,24),t()),e&2&&(o(),D(c.isLoading()?1:-1),o(),D(c.error()&&!c.isLoading()?2:-1),o(),D(c.customer()&&!c.isLoading()&&!c.error()?3:-1))},dependencies:[I,he,Xe,Ge,Me,Qe,He,Ue,$e,it,at,nt,Ye,J,Ce,ye,$],encapsulation:2})};export{mt as CustomerDetail};
