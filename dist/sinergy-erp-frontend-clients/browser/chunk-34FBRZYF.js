import{a as ee,b as G}from"./chunk-AWUHIJQD.js";import{a as Z}from"./chunk-U35SLASU.js";import{a as K}from"./chunk-5XN6F6LE.js";import{a as Y}from"./chunk-ESGHQXLB.js";import{J as X}from"./chunk-RBHIJQFK.js";import{v as U}from"./chunk-7TNFDLAZ.js";import{A as J,a as W}from"./chunk-5MRBIJ7N.js";import{A as F,e as H,l as Q,m as P,t as q,y as B}from"./chunk-UZLFZEBK.js";import{$b as M,Ac as j,Cc as E,Fb as f,Gb as n,Hb as a,N as V,Pb as w,Ta as s,Tb as m,Vb as h,Zb as A,_b as L,aa as c,ab as _,ba as u,cc as T,d as N,gb as C,gc as O,hc as d,ia as k,ic as v,jc as x,kc as $,mb as S,na as b,yc as z}from"./chunk-NOG5ANO3.js";import{a as g,b as y}from"./chunk-7CGTOI24.js";var I=class l{constructor(t){this.http=t}selectedGroupId=null;groupSelect=new k;groups=b([]);loading=b(!1);api=J.api;ngOnInit(){this.loadGroups()}selectConfig(){return{placeholder:"Filtrar por proyecto",data:this.groups(),value:"id",option:"name",form_control:null,loading:this.loading(),all:!0,all_message:"Todos los proyectos"}}loadGroups(){this.loading.set(!0),this.http.get(`${this.api}/tenant/property-groups`).subscribe({next:t=>{let e=Array.isArray(t)?t:[];this.groups.set(e),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.groups.set([])}})}onGroupChange(t){let e=t?.value||null,r=e&&this.groups().find(i=>i.id===e)?.name||null;this.groupSelect.emit({groupId:e,groupName:r})}static \u0275fac=function(e){return new(e||l)(_(q))};static \u0275cmp=C({type:l,selectors:[["app-property-group-dropdown"]],inputs:{selectedGroupId:"selectedGroupId"},outputs:{groupSelect:"groupSelect"},decls:1,vars:1,consts:[[3,"changeOption","config"]],template:function(e,r){e&1&&(n(0,"app-select",0),m("changeOption",function(o){return r.onGroupChange(o)}),a()),e&2&&f("config",r.selectConfig())},dependencies:[P,Y],encapsulation:2})};var ne=["tableTemplate"];function ae(l,t){if(l&1){let e=w();n(0,"div")(1,"span",15),m("click",function(){c(e);let i=h().$implicit,o=h();return u(o.navigateToCustomer(i))}),d(2),a()()}if(l&2){let e=h().$implicit,r=h();s(2),x(" ",r.getOwnerName(e)," ")}}function se(l,t){l&1&&(n(0,"span",16),d(1,"\u2014"),a())}function pe(l,t){if(l&1){let e=w();n(0,"td")(1,"span",11),d(2),a()(),n(3,"td"),d(4),a(),n(5,"td"),d(6),a(),n(7,"td"),d(8),a(),n(9,"td",12),m("click",function(i){return c(e),u(i.stopPropagation())}),S(10,ae,3,1,"div",13)(11,se,2,0,"ng-template",null,1,E),a(),n(13,"td"),d(14),a(),n(15,"td"),d(16),z(17,"currency"),a(),n(18,"td")(19,"span"),d(20),a()(),n(21,"td",12),m("click",function(i){return c(e),u(i.stopPropagation())}),n(22,"app-button",14),m("clicked",function(){let i=c(e).$implicit,o=h();return u(o.viewDetail(i))}),a()()}if(l&2){let e=t.$implicit,r=T(12),i=h();s(2),x(" ",e.code," "),s(2),v(e.block||"\u2014"),s(2),v(e.name),s(2),v((e.group==null?null:e.group.name)||"\u2014"),s(2),f("ngIf",i.hasOwner(e))("ngIfElse",r),s(4),$("",e.total_area," ",(e.measurement_unit==null?null:e.measurement_unit.symbol)||"m\xB2"),s(2),v(j(17,14,e.total_price,e.currency)),s(3),O(i.getStatusClass(e.status)),s(),x(" ",i.getStatusLabel(e.status)," "),s(2),f("fullWidth",!1)("icon",i.ArrowRight)}}var te=class l{constructor(t,e,r,i){this.router=t;this.route=e;this.propertyService=r;this.dialog=i;this.route.queryParams.pipe(V(this.destroy$)).subscribe(o=>{let p=JSON.stringify(o);if(p===this.lastQueryParams)return;this.lastQueryParams=p,this.search=o?.search??"",this.selectedGroupId=o?.groupId??null;let R=o?.page?Number(o.page):1,D=o?.limit?Number(o.limit):20;this.table_config.update(re=>y(g({},re),{page:isNaN(R)?1:R,limit:isNaN(D)?20:D})),this.getProperties()})}tableTemplate;table_config=b({rows:[],columns:[{name:"C\xF3digo",prop:"code",sortable:!0,canAutoResize:!0},{name:"Manzana",prop:"block",sortable:!0,canAutoResize:!0},{name:"Nombre",prop:"name",sortable:!0,canAutoResize:!0},{name:"Proyecto",prop:"group",sortable:!1,canAutoResize:!0},{name:"Cliente",prop:"contracts",sortable:!1,canAutoResize:!0},{name:"\xC1rea",prop:"total_area",sortable:!0,canAutoResize:!0},{name:"Precio",prop:"total_price",sortable:!0,canAutoResize:!0},{name:"Estado",prop:"status",sortable:!0,canAutoResize:!0},{name:"Acciones",prop:"actions",sortable:!1,canAutoResize:!0}],externalPaging:!0,externalSorting:!0,page:1,limit:20,totalResults:0,loading:!1,emptyState:{title:"Sin resultados",subtitle:"No se encontraron lotes"},columnMode:"force",reorderable:!1});ArrowRight=W;search="";selectedGroupId=null;selectedGroupName=null;currentSort=null;destroy$=new N;lastQueryParams="";ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}getProperties(){this.table_config.update(r=>y(g({},r),{loading:!0}));let t=this.table_config(),e=g(g(g({page:t.page,limit:t.limit},this.search&&{search:this.search}),this.selectedGroupId&&{groupId:this.selectedGroupId}),this.currentSort&&this.currentSort.direction&&{sort:this.currentSort.column.prop,order:this.currentSort.direction});this.propertyService.getProperties(e).subscribe(r=>{let i=Array.isArray(r)?r:r?.data??[],o=Array.isArray(r)?r.length:r?.total??0;this.table_config.update(p=>y(g({},p),{rows:i,totalResults:o,hasNext:r?.hasNext??!1,loading:!1}))})}onPageChange(t){this.router.navigate([],{relativeTo:this.route,queryParams:{page:t.page,limit:t.limit,search:this.search||void 0,groupId:this.selectedGroupId||void 0},queryParamsHandling:"merge"})}onSortChange(t){this.currentSort=t,this.table_config.update(e=>y(g({},e),{page:1})),this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,search:this.search||void 0,groupId:this.selectedGroupId||void 0},queryParamsHandling:"merge"})}onRowClick(t){this.editProperty(t)}onSearchChange(t){this.search=t,this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,search:t||void 0,groupId:this.selectedGroupId||void 0},queryParamsHandling:"merge"})}onGroupSelect(t){this.selectedGroupId=t.groupId,this.selectedGroupName=t.groupName,this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,groupId:t.groupId||void 0,search:this.search||void 0},queryParamsHandling:"merge"})}createProperty(){this.dialog.open(G,{data:{property:null}}).afterClosed().subscribe(t=>{t&&this.getProperties()})}editProperty(t){this.dialog.open(G,{data:{property:t}}).afterClosed().subscribe(e=>{e&&this.getProperties()})}viewDetail(t){this.router.navigate(["/properties/detail",t.id])}getStatusClass(t){return`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${{disponible:"bg-green-100 text-green-800",vendido:"bg-blue-100 text-blue-800",reservado:"bg-yellow-100 text-yellow-800",cancelado:"bg-red-100 text-red-800"}[t]||"bg-gray-100 text-gray-800"}`}getStatusLabel(t){return{disponible:"Disponible",vendido:"Vendido",reservado:"Reservado",cancelado:"Cancelado"}[t]||t}getOwnerName(t){let e=t.contracts?.[0]?.customer;if(!e)return"\u2014";let r=e.lastname?.split(" ")[0]||"";return`${e.name} ${r}`.trim()}hasOwner(t){return!!(t.contracts&&t.contracts.length>0&&t.contracts[0].customer)}navigateToCustomer(t){let e=t.contracts?.[0]?.customer?.id;e&&this.router.navigate(["/customers/detail",e])}static \u0275fac=function(e){return new(e||l)(_(F),_(B),_(ee),_(X))};static \u0275cmp=C({type:l,selectors:[["app-properties-list"]],viewQuery:function(e,r){if(e&1&&A(ne,5),e&2){let i;L(i=M())&&(r.tableTemplate=i.first)}},decls:12,vars:4,consts:[["tableTemplate",""],["noOwner",""],[1,"p-6","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],[1,"flex","flex-col","gap-4","md:flex-row","md:items-center","md:justify-between","mb-5"],[1,"text-2xl","font-semibold","text-gray-800"],[1,"flex","flex-col","gap-3","md:flex-row","md:items-center","md:justify-end"],[3,"groupSelect","selectedGroupId"],[1,"flex","items-center","gap-3"],["param_name","search",1,"w-64",3,"searchChange","param_activate"],["text","Crear Lote","custom_class","btn_primary",3,"clicked"],[3,"pageChange","sortChange","rowClick","config","rowTemplate"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-green-100","text-green-800","whitespace-nowrap"],[3,"click"],[4,"ngIf","ngIfElse"],["text","Detalle","size","sm","custom_class","btn_primary",3,"clicked","fullWidth","icon"],[1,"inline-flex","items-center","px-2","py-1","rounded","text-xs","font-medium","bg-blue-100","text-blue-800","whitespace-nowrap","cursor-pointer","hover:bg-blue-200","transition-colors",3,"click"],[1,"text-sm","text-gray-400"]],template:function(e,r){if(e&1){let i=w();n(0,"div",2)(1,"div",3)(2,"h2",4),d(3,"Lotes"),a(),n(4,"div",5)(5,"app-property-group-dropdown",6),m("groupSelect",function(p){return c(i),u(r.onGroupSelect(p))}),a(),n(6,"div",7)(7,"app-search",8),m("searchChange",function(p){return c(i),u(r.onSearchChange(p))}),a(),n(8,"app-button",9),m("clicked",function(){return c(i),u(r.createProperty())}),a()()()(),n(9,"app-datatable-wrapper",10),m("pageChange",function(p){return c(i),u(r.onPageChange(p))})("sortChange",function(p){return c(i),u(r.onSortChange(p))})("rowClick",function(p){return c(i),u(r.onRowClick(p))}),a()(),S(10,pe,23,17,"ng-template",null,0,E)}if(e&2){let i=T(11);s(5),f("selectedGroupId",r.selectedGroupId),s(2),f("param_activate",!0),s(2),f("config",r.table_config())("rowTemplate",i)}},dependencies:[P,H,Z,K,U,I,Q],encapsulation:2})};export{te as PropertiesListComponent};
